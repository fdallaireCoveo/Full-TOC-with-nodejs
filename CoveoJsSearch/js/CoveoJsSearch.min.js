var secretFeatureVariable1309=!1,Coveo;!function(e){e.version={lib : "0.9.844.8",product:"0.9.1080.0"}}(Coveo||(Coveo={}));var Coveo;!function(e){e.$=jQuery}(Coveo||(Coveo={}));var Coveo;!function(e){var t=/<pl>(((?!<\/pl>).)*)<\/pl>/g,i=/<sn>(((?!<\/sn>).)*)<\/sn>/g;e.L10N={format:function(t){for(var i=[],n=0;n<arguments.length-1;n++)i[n]=arguments[n+1];var o=t.toLocaleString();if(i.length>0){var s=_.last(i);_.isNumber(s)&&(i.pop(),o=e.L10N.formatPlSn(o,s));for(var r in i)o=o.replace("{"+r+"}",i[r])}return o},formatPlSn:function(e,n){return e=n>1?e.replace(t,"$1").replace(i,""):e.replace(t,"").replace(i,"$1")}}}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){t.l={WiFi:function(){return e.L10N.format("WiFi")},Reauthenticate:function(t){return e.L10N.format("Reauthenticate",t)},QueryDidntMatchAnyDocuments:function(){return e.L10N.format("QueryDidntMatchAnyDocuments")},exchangedocument:function(){return e.L10N.format("exchangedocument")},ValueDescription:function(){return e.L10N.format("ValueDescription")},Forward:function(){return e.L10N.format("Forward")},ShowMore:function(){return e.L10N.format("ShowMore")},ReplyAll:function(){return e.L10N.format("ReplyAll")},Today:function(){return e.L10N.format("Today")},xml:function(){return e.L10N.format("xml")},CompleteQuery:function(){return e.L10N.format("CompleteQuery")},CELL_2G:function(){return e.L10N.format("CELL_2G")},Exclude:function(t){return e.L10N.format("Exclude",t)},CELL_4G:function(){return e.L10N.format("CELL_4G")},BadUserPass:function(){return e.L10N.format("BadUserPass")},folder:function(){return e.L10N.format("folder")},exchangemessage:function(){return e.L10N.format("exchangemessage")},Reset:function(){return e.L10N.format("Reset")},OpenInOutlookWhenPossible:function(){return e.L10N.format("OpenInOutlookWhenPossible")},Last:function(){return e.L10N.format("Last")},AlwaysOpenInNewWindow:function(){return e.L10N.format("AlwaysOpenInNewWindow")},Of:function(){return e.L10N.format("Of")},mov:function(){return e.L10N.format("mov")},Value:function(){return e.L10N.format("Value")},EnterExpressionToFilterWith:function(){return e.L10N.format("EnterExpressionToFilterWith")},Unexclude:function(t){return e.L10N.format("Unexclude",t)},Or:function(){return e.L10N.format("Or")},GetStarted:function(){return e.L10N.format("GetStarted")},noResultFor:function(t){return e.L10N.format("noResultFor",t)},Less:function(){return e.L10N.format("Less")},AreYouSureDeleteFilter:function(t,i){return e.L10N.format("AreYouSureDeleteFilter",t,i)},LoginInProgress:function(){return e.L10N.format("LoginInProgress")},AlphaDescending:function(){return e.L10N.format("AlphaDescending")},ShowingResultsOf:function(t,i,n,o){return e.L10N.format("ShowingResultsOf",t,i,n,o)},Tab:function(){return e.L10N.format("Tab")},CannotConnect:function(){return e.L10N.format("CannotConnect")},MostRelevantReplies:function(){return e.L10N.format("MostRelevantReplies")},Previous:function(){return e.L10N.format("Previous")},Retry:function(){return e.L10N.format("Retry")},From:function(){return e.L10N.format("From")},Preferences:function(){return e.L10N.format("Preferences")},ShareQuery:function(){return e.L10N.format("ShareQuery")},Create:function(){return e.L10N.format("Create")},ClientDuration:function(t){return e.L10N.format("ClientDuration",t)},Next:function(){return e.L10N.format("Next")},exchangecalendarmessage:function(){return e.L10N.format("exchangecalendarmessage")},Reply:function(){return e.L10N.format("Reply")},ComputedField:function(){return e.L10N.format("ComputedField")},More:function(){return e.L10N.format("More")},Username:function(){return e.L10N.format("Username")},txt:function(){return e.L10N.format("txt")},Collapse:function(){return e.L10N.format("Collapse")},Seconds:function(t,i){return e.L10N.format("Seconds",t,i)},SearchIn:function(t){return e.L10N.format("SearchIn",t)},Ascending:function(){return e.L10N.format("Ascending")},Link:function(){return e.L10N.format("Link")},DisplayingTheOnlyMessage:function(){return e.L10N.format("DisplayingTheOnlyMessage")},EnterTag:function(){return e.L10N.format("EnterTag")},ShowLess:function(){return e.L10N.format("ShowLess")},Me:function(){return e.L10N.format("Me")},Settings:function(){return e.L10N.format("Settings")},LinkOpeningSettings:function(){return e.L10N.format("LinkOpeningSettings")},ShowFacet:function(){return e.L10N.format("ShowFacet")},ShowAllReplies:function(){return e.L10N.format("ShowAllReplies")},ProxyDuration:function(t){return e.L10N.format("ProxyDuration",t)},didYouMean:function(t){return e.L10N.format("didYouMean",t)},CustomDescription:function(){return e.L10N.format("CustomDescription")},ChiSquare:function(){return e.L10N.format("ChiSquare")},MostRelevantItems:function(){return e.L10N.format("MostRelevantItems")},Authenticating:function(t){return e.L10N.format("Authenticating",t)},EthernetConnection:function(){return e.L10N.format("EthernetConnection")},Tabs:function(){return e.L10N.format("Tabs")},xls:function(){return e.L10N.format("xls")},QuickView:function(){return e.L10N.format("QuickView")},activedirperson:function(){return e.L10N.format("activedirperson")},RelativeFrequencyDescription:function(){return e.L10N.format("RelativeFrequencyDescription")},AndOthers:function(t,i){return e.L10N.format("AndOthers",t,i)},EnterExpressionName:function(){return e.L10N.format("EnterExpressionName")},ClearFacetState:function(){return e.L10N.format("ClearFacetState")},ProblemPersists:function(){return e.L10N.format("ProblemPersists")},image:function(){return e.L10N.format("image")},Label:function(){return e.L10N.format("Label")},IndexDuration:function(t){return e.L10N.format("IndexDuration",t)},ErrorReport:function(){return e.L10N.format("ErrorReport")},UnknownConnection:function(){return e.L10N.format("UnknownConnection")},Login:function(){return e.L10N.format("Login")},autoCorrectedQueryTo:function(t){return e.L10N.format("autoCorrectedQueryTo",t)},exchangeappointment:function(){return e.L10N.format("exchangeappointment")},zip:function(){return e.L10N.format("zip")},ClearAllFilters:function(){return e.L10N.format("ClearAllFilters")},exchangenote:function(){return e.L10N.format("exchangenote")},exchangeactivity:function(){return e.L10N.format("exchangeactivity")},ShowAllConversation:function(){return e.L10N.format("ShowAllConversation")},OopsError:function(){return e.L10N.format("OopsError")},Search:function(){return e.L10N.format("Search")},GoBack:function(){return e.L10N.format("GoBack")},RelativeFrequency:function(){return e.L10N.format("RelativeFrequency")},ShowCompleteThread:function(){return e.L10N.format("ShowCompleteThread")},Nosort:function(){return e.L10N.format("Nosort")},Expression:function(){return e.L10N.format("Expression")},exchangeofficecom:function(){return e.L10N.format("exchangeofficecom")},And:function(){return e.L10N.format("And")},ppt:function(){return e.L10N.format("ppt")},ShowOnlyTopMatchingPosts:function(){return e.L10N.format("ShowOnlyTopMatchingPosts")},CompleteThread:function(){return e.L10N.format("CompleteThread")},Done:function(){return e.L10N.format("Done")},Expand:function(){return e.L10N.format("Expand")},Close:function(){return e.L10N.format("Close")},Open:function(){return e.L10N.format("Open")},Tomorrow:function(){return e.L10N.format("Tomorrow")},exchangetask:function(){return e.L10N.format("exchangetask")},FiltersInYourPreferences:function(){return e.L10N.format("FiltersInYourPreferences")},NoNetworkConnection:function(){return e.L10N.format("NoNetworkConnection")},OnlineHelp:function(){return e.L10N.format("OnlineHelp")},ScoreDescription:function(){return e.L10N.format("ScoreDescription")},Custom:function(){return e.L10N.format("Custom")},Score:function(){return e.L10N.format("Score")},SaveFacetState:function(){return e.L10N.format("SaveFacetState")},MoreInfo:function(){return e.L10N.format("MoreInfo")},SwitchTo:function(t){return e.L10N.format("SwitchTo",t)},OccurrencesDescription:function(){return e.L10N.format("OccurrencesDescription")},AllConversation:function(){return e.L10N.format("AllConversation")},AlphaAscending:function(){return e.L10N.format("AlphaAscending")},Yesterday:function(){return e.L10N.format("Yesterday")},CELL:function(){return e.L10N.format("CELL")},SuggestedResults:function(){return e.L10N.format("SuggestedResults")},html:function(){return e.L10N.format("html")},Descending:function(){return e.L10N.format("Descending")},Password:function(){return e.L10N.format("Password")},ShowOnlyMostRelevantReplies:function(){return e.L10N.format("ShowOnlyMostRelevantReplies")},Clear:function(t){return e.L10N.format("Clear",t)},ResultsFilteringExpression:function(){return e.L10N.format("ResultsFilteringExpression")},SkipLogin:function(){return e.L10N.format("SkipLogin")},Remove:function(){return e.L10N.format("Remove")},Caption:function(){return e.L10N.format("Caption")},SelectTab:function(){return e.L10N.format("SelectTab")},SuggestedQueries:function(){return e.L10N.format("SuggestedQueries")},MostRelevantPosts:function(){return e.L10N.format("MostRelevantPosts")},pdf:function(){return e.L10N.format("pdf")},HideFacet:function(){return e.L10N.format("HideFacet")},Unavailable:function(){return e.L10N.format("Unavailable")},PleaseEnterYourCredentials:function(t){return e.L10N.format("PleaseEnterYourCredentials",t)},SearchFor:function(t){return e.L10N.format("SearchFor",t)},doc:function(){return e.L10N.format("doc")},CELL_3G:function(){return e.L10N.format("CELL_3G")},AllItems:function(){return e.L10N.format("AllItems")},LabelDescription:function(){return e.L10N.format("LabelDescription")},Occurrences:function(){return e.L10N.format("Occurrences")},exchangeperson:function(){return e.L10N.format("exchangeperson")},Duration:function(t){return e.L10N.format("Duration",t)}}}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={})),String.toLocaleString.call(this,{en:{WiFi:"WiFi connection",Reauthenticate:"Reauthenticate {0}",QueryDidntMatchAnyDocuments:"Your query did not match any documents.",exchangedocument:"Exchange document",ValueDescription:"Sort on the values of the first computed field",Forward:"Forward",ShowMore:"Show more",ReplyAll:"Reply All",Today:"Today",xml:"XML File",CompleteQuery:"Complete Query",CELL_2G:"Cellular 2G connection",Exclude:"Exclude {0}",CELL_4G:"Cellular 4G connection",BadUserPass:"Password does not match with user name.",folder:"Folder",exchangemessage:"Message",Reset:"Reset",OpenInOutlookWhenPossible:"Open in Outlook (when possible)",Last:"Last",AlwaysOpenInNewWindow:"Always open results in new window",Of:"of",mov:"QuickTime File",Value:"Value",EnterExpressionToFilterWith:"Enter Expression To Filter Results With",Unexclude:"Unexclude {0}",Or:"OR",GetStarted:"Get Started",noResultFor:"No results for {0}",Less:"Fewer",AreYouSureDeleteFilter:"Are you sure you want to delete the filter {0} with the expression {1}",LoginInProgress:"Login in progress, please wait ...",AlphaDescending:"Value Descending",ShowingResultsOf:"Result<pl>s</pl> {0}<pl>-{1} </pl>of {2}",Tab:"Tab",CannotConnect:"Cannot connect to the server address.",MostRelevantReplies:"Most Relevant Replies:",Previous:"Previous",Retry:"Retry",From:"From",Preferences:"Preferences",ShareQuery:"Share Query",Create:"Create",ClientDuration:"Client Duration: {0}",Next:"Next",exchangecalendarmessage:"Calendar message",Reply:"Reply",ComputedField:"Computed Field",More:"More",Username:"Username",txt:"Text",Collapse:"Collapse",Seconds:"in {0} second<pl>s</pl>",SearchIn:"Search in {0}",Ascending:"Ascending",Link:"Link",DisplayingTheOnlyMessage:"Displaying the only message in this conversation",EnterTag:"Add Tag",ShowLess:"Show less",Me:"Me",Settings:"Settings",LinkOpeningSettings:"Link Opening Settings",ShowFacet:"Show Facet",ShowAllReplies:"Show All Replies",ProxyDuration:"Proxy Duration: {0}",didYouMean:"Did you mean: {0}",CustomDescription:"Sort based on a custom order",ChiSquare:"Chi Square",MostRelevantItems:"Most relevant items:",Authenticating:"Authenticating {0}...",EthernetConnection:"Ethernet connection",Tabs:"Tabs",xls:"Excel Document",QuickView:"Quick View",activedirperson:"Active Directory user",RelativeFrequencyDescription:"Sort based on the relative frequency of values. Less common values will appear higher",AndOthers:"and {0} other<pl>s</pl>",EnterExpressionName:"Enter Expression Name",ClearFacetState:"Clear facet state",ProblemPersists:"If the problem persists contact the administrator.",image:"Image",Label:"Label",IndexDuration:"Index Duration: {0}",ErrorReport:"Error Report",UnknownConnection:"Unknown connection",Login:"Log In",autoCorrectedQueryTo:"Query was automatically corrected to {0}",exchangeappointment:"Appointment",zip:"Zip File",ClearAllFilters:"Clear All Filters",exchangenote:"Note",exchangeactivity:"Activity",ShowAllConversation:"Show All Conversation",OopsError:"Oops! Something went wrong on the server.",Search:"Search",GoBack:"Go Back",RelativeFrequency:"Relative Frequency",ShowCompleteThread:"Show Complete Thread",Nosort:"No Sort",Expression:"Expression",exchangeofficecom:"Communications",And:"AND",ppt:"PowerPoint Document",ShowOnlyTopMatchingPosts:"Show Only Top Matching Posts",CompleteThread:"Complete Thread:",Done:"Done",Expand:"Expand",Close:"Close",Open:"Open",Tomorrow:"Tomorrow",exchangetask:"Task",FiltersInYourPreferences:"Filters in your preferences",NoNetworkConnection:"No network connection",OnlineHelp:"Online Help",ScoreDescription:"The score is computed from the number of occurrences as well as from the position in the result set.",Custom:"Custom",Score:"Score",SaveFacetState:"Save this facet state",MoreInfo:"More Information",SwitchTo:"Switch to {0}",OccurrencesDescription:"Sort by number of occurrences, with values having the highest number appearing first.",AllConversation:"All Conversation:",AlphaAscending:"Value Ascending",Yesterday:"Yesterday",CELL:"Cellular connection",SuggestedResults:"Suggested Results",html:"HTML File",Descending:"Descending",Password:"Password",ShowOnlyMostRelevantReplies:"Show Only Most Relevant Replies",Clear:"Clear {0}",ResultsFilteringExpression:"Results Filtering Expressions",SkipLogin:"Skip login",Remove:"Remove",Caption:"Caption",SelectTab:"Select Tab",SuggestedQueries:"Suggested Queries",MostRelevantPosts:"Most Relevant Posts:",pdf:"PDF File",HideFacet:"Hide Facet",Unavailable:"Unavailable",PleaseEnterYourCredentials:"Please enter your credentials for {0}.",SearchFor:"Search for {0}",doc:"Word Document",CELL_3G:"Cellular 3G connection",AllItems:"All items:",LabelDescription:"Sort alphabetically on the field values.",Occurrences:"Occurrences",exchangeperson:"Exchange user",Duration:"Duration: {0}"}}),String.locale="en",String.defaultLocale="en";var Globalize=window.Globalize;Globalize.addCultureInfo("en-US","default",{name:"en-US",englishName:"English (United States)"}),Globalize.culture("en");var Coveo;!function(e){var t=function(){function e(e){this.owner=e}return e.prototype.trace=function(){for(var t=[],i=0;i<arguments.length-0;i++)t[i]=arguments[i+0];e.level<=e.TRACE&&this.log("TRACE",t)},e.prototype.debug=function(){for(var t=[],i=0;i<arguments.length-0;i++)t[i]=arguments[i+0];e.level<=e.DEBUG&&this.log("DEBUG",t)},e.prototype.info=function(){for(var t=[],i=0;i<arguments.length-0;i++)t[i]=arguments[i+0];e.level<=e.INFO&&this.log("INFO",t)},e.prototype.warn=function(){for(var t=[],i=0;i<arguments.length-0;i++)t[i]=arguments[i+0];e.level<=e.WARN&&this.log("WARN",t)},e.prototype.error=function(){for(var t=[],i=0;i<arguments.length-0;i++)t[i]=arguments[i+0];e.level<=e.ERROR&&this.log("ERROR",t)},e.prototype.log=function(t,i){window.console&&console.log&&(console.log([t,this.owner].concat(i)),e.executionTime&&(console.timeEnd("Execution time"),console.time("Execution time")))},e.enable=function(){e.level=e.TRACE},e.disable=function(){e.level=e.NOTHING},e.TRACE=1,e.DEBUG=2,e.INFO=3,e.WARN=4,e.ERROR=5,e.NOTHING=6,e.level=e.INFO,e.executionTime=!1,e}();e.Logger=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.prototype.merge=function(t){return e.$.extend({},this,t)},t.prototype.mergeDeep=function(t){return e.$.extend(!0,{},e.Utils.mergeDeep(this,t))},t}();e.Options=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.isUndefined=function(e){return"undefined"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return t.isUndefined(e)||t.isNull(e)},t.exists=function(e){return!t.isNullOrUndefined(e)},t.isString=function(e){return"string"==typeof e||"object"==typeof e&&e instanceof String},t.toNotNullString=function(e){return t.isString(e)?e:""},t.anyTypeToString=function(e){return e?e.toString():""},t.isNullOrEmptyString=function(e){return t.isNullOrUndefined(e)||!t.isNonEmptyString(e)},t.isNonEmptyString=function(e){return t.isString(e)&&""!==e},t.stringStartsWith=function(e,t){return e.slice(0,t.length)==t},t.isNumber=function(e){return"number"==typeof e},t.isBoolean=function(e){return"boolean"==typeof e},t.isDate=function(e){return e instanceof Date},t.isObject=function(e){return _.isObject(e)},t.isObjectType=function(e,t){return e instanceof t},t.isArray=function(e){return e instanceof Array},t.isNonEmptyArray=function(e){return t.isArray(e)&&e.length>0},t.isEmptyArray=function(e){return!t.isNonEmptyArray(e)},t.isHtmlElement=function(e){return void 0!=window.HTMLElement?e instanceof HTMLElement:e&&e.nodeType&&1==e.nodeType},t.mergeDeep=function(e,i){var n=_.isArray(i),o=n&&[]||{};return n?(e=e||[],o=o.concat(e),_.each(i,function(i,n){"undefined"==typeof e[n]?o[n]=i:"object"==typeof i?o[n]=t.mergeDeep(e[n],i):-1===e.indexOf(i)&&o.push(i)})):(e&&"object"==typeof e&&_.each(_.keys(e),function(t){o[t]=e[t]}),_.each(_.keys(i),function(n){o[n]="object"==typeof i[n]&&i[n]?e[n]?t.mergeDeep(e[n],i[n]):i[n]:i[n]})),o},t.parseIntIfNotUndefined=function(e){return t.isNonEmptyString(e)?parseInt(e,10):void 0},t.parseFloatIfNotUndefined=function(e){return t.isNonEmptyString(e)?parseFloat(e):void 0},t.round=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},t.parseBooleanIfNotUndefined=function(e){if(!t.isNonEmptyString(e))return void 0;switch(e.toLowerCase()){case"true":case"1":case"yes":return!0;case"false":case"0":case"no":return!1;default:return void 0}},t.trim=function(e){return null==e?null:e.replace(/^\s+|\s+$/g,"")},t.map=function(e,t){if(null==e)return null;for(var i=[],n=0;n<e.length;n++)i.push(t(e[n]));return i},t.filter=function(e,t){if(null==e)return null;for(var i=[],n=0;n<e.length;n++)t(e[n],n)&&i.push(e[n]);return i},t.arrayEqual=function(e,t,i){if("undefined"==typeof i&&(i=!0),i)return _.isEqual(e,t);var n=[e,t];return _.all(n,function(e){return e.length==n[0].length&&0==_.difference(e,n[0]).length})},t.objectEqual=function(e,t){return _.isEqual(e,t)},t.isCoveoField=function(e){return/^@[a-zA-Z0-9]+$/.test(e)},t.getCoveoFieldKey=function(t){var i=t.match(/^@([a-zA-Z0-9]+)$/);return e.Assert.check(null!=i,t+" is not a vaild field"),i[1].toLowerCase()},t.escapeRegexCharacter=function(e){var t=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");return t},t.throttle=function(e,t,i,n,o){"undefined"==typeof i&&(i={});var s,r=null,a=0,l=function(){a=i.leading===!1?0:(new Date).getTime(),r=null,s=e.apply(n,o)};return function(){var u=(new Date).getTime();a||i.leading!==!1||(a=u);var c=t-(u-a);return n=this,o=arguments,0>=c?(clearTimeout(r),r=null,a=u,s=e.apply(n,o)):r||i.trailing===!1||(r=setTimeout(l,c)),s}},t}();e.Utils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function e(){}return e.defer=function(t){e.functions.push(t),e.arm()},e.flush=function(){for(;e.popOne(););},e.arm=function(){_.defer(function(){e.popOne()&&e.arm()})},e.popOne=function(){if(e.functions.length>0){var t=e.functions[0];return e.functions=_.rest(e.functions),t(),e.functions.length>0}return!1},e.functions=[],e}();e.Defer=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.fail=function(e){t.failureHandler(e)},t.check=function(e,i){e||t.fail(i)},t.isUndefined=function(i){t.check(e.Utils.isUndefined(i),"Value should be undefined.")},t.isNotUndefined=function(i){t.check(!e.Utils.isUndefined(i),"Value should not be undefined.")},t.isNull=function(i){t.check(e.Utils.isNull(i),"Value should be null.")},t.isNotNull=function(i){t.check(!e.Utils.isNull(i),"Value should not be null.")},t.exists=function(i){t.check(!e.Utils.isNullOrUndefined(i),"Value should not be null or undefined")},t.doesNotExists=function(i){t.check(e.Utils.isNullOrUndefined(i),"Value should be null or undefined")},t.isString=function(i){t.check(e.Utils.isString(i),"Value should be a string.")},t.stringStartsWith=function(e,i){t.isNonEmptyString(e),t.isNonEmptyString(i),t.check(0==e.indexOf(i),"Value should start with "+i)},t.isNonEmptyString=function(i){t.check(e.Utils.isNonEmptyString(i),"Value should be a non-empty string.")},t.isNumber=function(i){t.check(e.Utils.isNumber(i),"Value should be a number.")},t.isLargerThan=function(e,i){t.check(i>e,"Value "+i+" should be larger than "+e)},t.isLargerOrEqualsThan=function(e,i){t.check(i>=e,"Value "+i+" should be larger or equal than "+e)},t.isSmallerThan=function(e,i){t.check(e>i,"Value "+i+" should be smaller than "+e)},t.isSmallerOrEqualsThan=function(e,i){t.check(e>=i,"Value "+i+" should be smaller or equal than "+e)},t.logger=new e.Logger("Assert"),t.failureHandler=function(n){throw t.logger.error("Assertion Failed!",n),void 0!=console.trace&&console.trace(),e.Utils.isNonEmptyString(n)?new i(n):new i("Assertion Failed!")},t}();e.Assert=t;var i=function(){function e(e){this.message=e}return e}();e.PreconditionFailedException=i}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(e){this.milliseconds=e}return t.prototype.getMilliseconds=function(){return this.milliseconds},t.prototype.getSeconds=function(){return this.getMilliseconds()/1e3},t.prototype.getMinutes=function(){return this.getSeconds()/60},t.prototype.getHours=function(){return this.getMinutes()/60},t.prototype.getDays=function(){return this.getHours()/24},t.prototype.getWeeks=function(){return this.getDays()/7},t.fromDates=function(i,n){return e.Assert.exists(i),e.Assert.exists(n),new t(n.valueOf()-i.valueOf())},t}();e.TimeSpan=t}(Coveo||(Coveo={}));var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},Coveo;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.now=new Date,this.useTodayYesterdayAndTomorrow=!0,this.useWeekdayIfThisWeek=!0,this.omitYearIfCurrentOne=!0,this.useLongDateFormat=!1,this.includeTimeIfToday=!0,this.includeTimeIfThisWeek=!0,this.alwaysIncludeTime=!1,this.predefinedFormat=void 0}return __extends(t,e),t}(e.Options),i=function(){function i(){}return i.convertFromJsonDateIfNeeded=function(t){return e.Utils.isDate(t)?t:e.Utils.isNumber(t)?new Date(t):e.Utils.isString(t)?new Date(t.replace("@"," ")):void 0},i.keepOnlyDatePart=function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())},i.offsetDateByDays=function(e,t){var i=new Date(e.valueOf());return i.setDate(i.getDate()+t),i},i.dateToString=function(n,o){if(e.Utils.isNullOrUndefined(n))return"";if(o=(new t).merge(o),e.Utils.isNullOrUndefined(n))return"";var n=i.keepOnlyDatePart(n),s=i.keepOnlyDatePart(o.now),r=i.offsetDateByDays(s,1),a=i.offsetDateByDays(s,-1),l=Math.abs(e.TimeSpan.fromDates(n,s).getDays())<7;return o.predefinedFormat?Globalize.format(n,o.predefinedFormat):o.useTodayYesterdayAndTomorrow&&n.valueOf()==s.valueOf()?e.Ui.l.Today():o.useTodayYesterdayAndTomorrow&&n.valueOf()==a.valueOf()?e.Ui.l.Yesterday():o.useTodayYesterdayAndTomorrow&&n.valueOf()==r.valueOf()?e.Ui.l.Tomorrow():o.useWeekdayIfThisWeek&&l?n.valueOf()>s.valueOf()?e.Ui.l.Next()+" "+Globalize.format(n,"dddd"):e.Ui.l.Last()+" "+Globalize.format(n,"dddd"):o.omitYearIfCurrentOne&&n.getFullYear()===s.getFullYear()?Globalize.format(n,"M"):o.useLongDateFormat?Globalize.format(n,"D"):Globalize.format(n,"d")},i.timeToString=function(t){return e.Utils.isNullOrUndefined(t)?"":Globalize.format(t,"t")},i.dateTimeToString=function(i,n){if(e.Utils.isNullOrUndefined(i))return"";n=(new t).merge(n);var o=e.DateUtils.keepOnlyDatePart(n.now),s=Math.abs(e.TimeSpan.fromDates(i,o).getDays())<7,r=e.DateUtils.dateToString(i,n),a=e.DateUtils.keepOnlyDatePart(i);return n.alwaysIncludeTime||n.includeTimeIfThisWeek&&s||n.includeTimeIfToday&&a.valueOf()==o.valueOf()?r+", "+e.DateUtils.timeToString(i):r},i}();e.DateUtils=i}(Coveo||(Coveo={})),Date.prototype.toISOString||!function(){function e(e){return 10>e?"0"+e:e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}();var Coveo;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.decimals=0}return __extends(t,e),t}(e.Options),i=function(){function i(){}return i.currencyToString=function(i,n){if(e.Utils.isNullOrUndefined(i))return"";e.Assert.isNumber(i),n=(new t).merge(n);var o=Globalize.culture().numberFormat.currency,s=o.symbol;e.Utils.isNonEmptyString(n.symbol)&&(o.symbol=n.symbol);var r=Globalize.format(i,"c"+n.decimals.toString());return o.symbol=s,r},i}();e.CurrencyUtils=i}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.splitSemicolonSeparatedListOfEmailAddresses=function(t){var i=t.split(/\s*;\s*/);return _.filter(i,function(t){return e.Utils.exists(t)&&e.Utils.isNonEmptyString(e.Utils.trim(t))})},t.emailAddressesToHyperlinks=function(i,n,o,s,r){"undefined"==typeof s&&(s=2),"undefined"==typeof r&&(r=!1),i=_.filter(i,function(t){return e.Utils.exists(t)&&e.Utils.isNonEmptyString(e.Utils.trim(t))});var a=_.map(i,function(i){var s=t.parseEmail(i),a=s[1],l=s[0];if(e.Utils.exists(o)&&a==o&&(l=e.Ui.l.Me()),r){var u=l.split(" ");e.Utils.isNullOrUndefined(u[1])||(l=u[0]+" "+u[1].substring(0,1)+".")}var c=a.indexOf("@")>=0?a.indexOf("@")+1:0,h=a.substr(c);return e.Utils.exists(n)&&h!=n&&(l+=" ("+h+")"),'<a title="'+i+'" href="mailto:'+a+'">'+l+"</a>"}),l=a.length-s,u=l>0?t.buildEmailAddressesAndOthers(_.last(a,l)):"";return _.first(a,s).join(", ")+u},t.buildEmailAddressesAndOthers=function(t){return"<span class='coveo-emails-excess-collapsed coveo-active' onclick='Coveo.Ui.TemplateHelpers.getHelper(\"excessEmailToggle\")(this);'> "+e.Ui.l.AndOthers(t.length.toString(),t.length)+"</span><span class='coveo-emails-excess-expanded'> , "+t.join(" , ")+"</span>"},t.parseEmail=function(e){var e,t,i=e.match(/^\s*(.*)\s+<(.*)>$/);return null!=i?(t=i[1],/^".*"|'.*'$/.test(t)&&(t=t.substr(1,t.length-2)),e=i[2]):(t=e,e=e),[t,e]},t}();e.EmailUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.getHash=function(i){"undefined"==typeof i&&(i=window),e.Assert.exists(i);var n="#"+(i.location.href.split("#")[1]||"");return t.getAjaxcrawlableHash(n)},t.getValue=function(i,n){e.Assert.isNonEmptyString(i),e.Assert.exists(n),n=t.getAjaxcrawlableHash(n);var o=t.getRawValue(i,n);return void 0!=o&&(o=t.getValueDependingOnType(o)),o},t.encodeValues=function(i){var n=[];return _.each(i,function(i,o){var s="";s=e.Utils.isNonEmptyArray(i)?t.encodeArray(i):e.Utils.isObject(i)&&e.Utils.isNonEmptyArray(_.keys(i))?t.encodeObject(i):encodeURIComponent(i.toString()),""!=s&&n.push(o+"="+s)}),n.join("&")},t.getAjaxcrawlableHash=function(e){return void 0!=e[1]&&"!"==e[1]?e.substring(0,1)+e.substring(2):e},t.getRawValue=function(t,i){e.Assert.exists(t),e.Assert.exists(i),e.Assert.check(0==i.indexOf("#")||""==i);for(var n=i.substr(1).split("&"),o=0,s=!0,r=void 0;s;){var a=n[o].split("=");a[0]==t?(s=!1,r=a[1]):(o++,o>=n.length&&(o=void 0,s=!1))}return r},t.getValueDependingOnType=function(e){var i,n=t.getValueType(e);return i="object"==n?t.decodeObject(e):"array"==n?t.decodeArray(e):decodeURIComponent(e)},t.getValueType=function(e){return e.substr(0,1)==t.Delimiter.objectStart&&e.substr(e.length-1)==t.Delimiter.objectEnd?"object":e.substr(0,1)==t.Delimiter.arrayStart&&e.substr(e.length-1)==t.Delimiter.arrayEnd?"array":"other"},t.encodeArray=function(e){var i=[];return _.each(e,function(e){i.push(encodeURIComponent(e))}),t.Delimiter.arrayStart+i.join(",")+t.Delimiter.arrayEnd},t.encodeObject=function(i){var n=t.Delimiter.objectStart,o=[];return _.each(i,function(i,n){var s="";s+='"'+encodeURIComponent(n)+'" : ',s+=e.Utils.isArray(i)?t.encodeArray(i):e.Utils.isObject(i)?t.encodeObject(i):e.Utils.isNumber(i)||e.Utils.isBoolean(i)?encodeURIComponent(i):'"'+encodeURIComponent(i)+'"',o.push(s)}),n+=o.join(" , "),n+t.Delimiter.objectEnd},t.decodeObject=function(e){return JSON.parse(decodeURIComponent(e))},t.decodeArray=function(t){t=t.substr(1),t=t.substr(0,t.length-1);for(var i=t.split(","),n=0;n<i.length;n++){var o=decodeURIComponent(i[n]),s="0"==o[0]&&o.length>1?0/0:Number(o),r=e.Utils.parseBooleanIfNotUndefined(o);i[n]=o,isNaN(s)?void 0!=r&&(i[n]=r):i[n]=s}return i},t.Delimiter={objectStart:"{",objectEnd:"}",arrayStart:"[",arrayEnd:"]",objectStartRegExp:"^{",objectEndRegExp:"}+$",arrayStartRegExp:"^[",arrayEndRegExp:"]+$"},t}();e.HashUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){function t(e,t){return _.isEmpty(t)?e:s({value:e,search:t.toLowerCase()})}var i=function(){function e(e,t,i){this.begin=e,this.size=t,this.replacementSize=i}return e}();e.Hole=i;var n=function(){function t(){}return t.replace=function(n,o,s){var r=new t;if(e.Utils.isNullOrEmptyString(n))return r;var a=n.lastIndexOf(o);if(-1==a)return r.value=n,r;for(var l=[];a>=0;){var u=new i(a,o.length,s.length);l.push(u),n=n.slice(0,a)+s+n.slice(a+o.length),a=n.lastIndexOf(o)}return r.holes=l,r.value=n,r},t.shortenPath=function(n,o){var s=n,r=new t;if(e.Utils.isNullOrEmptyString(s)||s.length<=o)return r.value=s,r;var a=[],l=-1;if(l=e.Utils.stringStartsWith(s,"\\\\")?s.indexOf("\\",l+2):s.indexOf("\\"),-1!=l){for(var u=0,c=s.indexOf("\\",l+1);-1!=c&&s.length-u+t.SHORTEN_END.length>o;)u=c-l-1,c=s.indexOf("\\",c+1);if(u>0){s=s.slice(0,l+1)+t.SHORTEN_END+s.slice(u);var h=new i(l+1,u-t.SHORTEN_END.length,t.SHORTEN_END.length);a.push(h)}}if(s.length>o){var d=s.length-o+t.SHORTEN_END.length,p=s.length-d;s=s.slice(0,p)+t.SHORTEN_END;var h=new i(p,d,t.SHORTEN_END.length);a.push(h)}return r.holes=a,r.value=s,r},t.shortenString=function(n,o,s){var r=n;s=e.Utils.toNotNullString(s);var a=new t;if(e.Utils.isNullOrEmptyString(r)||o<=s.length)return a.value=r,a;if(r.length<=o)return a.value=r,a;var l=r;if(o-=s.length,l=l.slice(0,o)," "!=r.charAt(l.length)){var u=l.lastIndexOf(" ");-1!=u&&l.length-u<t.WORD_SHORTER&&(l=l.slice(0,u))}var c=[];return c[0]=new i(l.length,r.length-l.length,s.length),l+=s,a.value=l,a.holes=c,a},t.shortenUri=function(n,o){var s=new t;if(e.Utils.isNullOrEmptyString(n)||n.length<=o)return s.value=n,s;var r=[],a=n.indexOf("//");if(-1!=a&&(a=n.indexOf("/",a+2)),-1!=a){for(var l=0,u=n.indexOf("/",a+1);-1!=u&&n.length-l+t.SHORTEN_END.length>o;)l=u-a-1,u=n.indexOf("/",u+1);if(l>0){n=n.slice(0,a+1)+t.SHORTEN_END+n.slice(a+1+l);var c=new i(a+1,l,t.SHORTEN_END.length);r.push(c)}}if(n.length>o){var h=n.length-o+t.SHORTEN_END.length,d=n.length-h;n=n.slice(0,d)+t.SHORTEN_END;var c=new i(d,h,t.SHORTEN_END.length);r.push(c)}return s.holes=r,s.value=n,s},t.SHORTEN_END="...",t.WORD_SHORTER=10,t}();e.StringAndHoles=n;var o=function(){function t(){}return t.highlightString=function(e,i,n,o){return t.buildHighlightedString(e,i,n,o)},t.buildHighlightedString=function(t,i,n,o){if(e.Assert.isNotUndefined(i),e.Assert.isNotNull(i),e.Assert.isNonEmptyString(o),e.Utils.isNullOrEmptyString(t))return t;for(var s=0,r=t.length,a="",l=0;l<i.length;l++){var u=i[l],c=u.offset,h=c+u.length;if(null!=n){for(var d=!1,p=0;p<n.length;p++){var f=n[p],m=f.begin,v=m+f.size;if(m>c&&h>=m&&v>h)h=m;else{if(c>=m&&v>h){d=!0;break}if(c>=m&&v>c&&h>=v)c=m+f.replacementSize,h-=f.size-f.replacementSize;else if(m>c&&h>=v)h-=f.size-f.replacementSize;
else if(c>=v){var g=f.size-f.replacementSize;c-=g,h-=g}}}if(d||c==h)continue}if(h>r)break;a+=_.escape(t.slice(s,c)),a+="<span class='"+o+"'>",a+=_.escape(t.slice(c,h)),a+="</span>",s=h}return s!=r&&(a+=_.escape(t.slice(s))),a},t}();e.HighlightUtils=o;var s=_.template('<% var i = 0; var lowercaseValue = value.toLowerCase(); while(i < value.length) { %><% var index = lowercaseValue.indexOf(search, i); if(index != -1) { %><% if(i != index){ %> <span><%- value.substr(i, index) %></span><% } %><span class="coveo-hightlight"><%- value.substr(index, search.length) %></span><% i = index + search.length %></span><% } else { %><span><%- value.substr(i) %></span><% i = value.length; %><% } %><% } %>');e.highlightString=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.javascriptEncode=function(t){return e.Assert.isString(t),t=t.replace(/\\/g,"\\\\"),t=t.replace(/'/g,"\\'"),t=t.replace(/"/g,'\\"')},t.htmlEncode=function(t){return e.Assert.isString(t),e.$("<div/>").text(t).html()},t.splice=function(e,t,i,n){return e.slice(0,t)+n+e.slice(t+Math.abs(i))},t.removeMiddle=function(e,i,n){if(e.length<i)return e;var o=e.length-i,s=Math.floor(i/2);return t.splice(e,s,o,n)},t.regexEncode=function(t){return e.Assert.isString(t),t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},t.wildcardsToRegex=function(i){e.Assert.isString(i);var n=t.regexEncode(i);return n=n.replace(/\\\*/,".*"),n=n.replace(/\\\?/,".")},t.getHighlights=function(e,t){for(var i,n=[];i=t.exec(e);){var o=i[2],s=i[1],r=i.index+1;if(0==i.index&&""==s&&(r=0),n.push({offset:r,length:o.length}),!t.global)break}return _.isEmpty(n)?void 0:n},t}();e.StringUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.createGuid=function(){return"undefined"!=typeof crypto&&"undefined"!=typeof crypto.getRandomValues?t.generateWithCrypto():t.generateWithRandom()},t.generateWithRandom=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})},t.generateWithCrypto=function(){var e=new Uint16Array(8);crypto.getRandomValues(e);var t=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return t(e[0])+t(e[1])+"-"+t(e[2])+"-"+t(e[3])+"-"+t(e[4])+"-"+t(e[5])+t(e[6])+t(e[7])},t.setStateObjectOnQueryResults=function(e,i){t.setPropertyOnResult(i,"state",e)},t.setIndexAndUidOnQueryResults=function(i,n,o){e.Assert.exists(i),e.Assert.exists(n);var s=i.firstResult;t.setPropertyOnResult(n,"queryUid",o),t.setPropertyOnResult(n,"index",s,function(){return++s})},t.setTermsToHighlightOnQueryResults=function(e,i){var n=[e.q].concat(i.termsToHighlight).concat(i.phrasesToHighlight);t.setPropertyOnResult(i,"termsToHighlight",n)},t.splitFlags=function(t,i){return"undefined"==typeof i&&(i=";"),e.Assert.exists(t),t.split(i)},t.isAttachment=function(e){return _.contains(t.splitFlags(e.flags),"IsAttachment")},t.containsAttachment=function(e){return _.contains(t.splitFlags(e.flags),"ContainsAttachment")},t.hasHTMLVersion=function(e){return _.contains(t.splitFlags(e.flags),"HasHtmlVersion")},t.hasThumbnail=function(e){return _.contains(t.splitFlags(e.flags),"HasThumbnail")},t.quoteAndEscapeIfNeeded=function(i){return e.Assert.isString(i),t.isAtomicString(i)||t.isRangeString(i)||t.isRangeWithoutOuterBoundsString(i)?i:t.quoteAndEscape(i)},t.quoteAndEscape=function(i){return e.Assert.isString(i),'"'+t.escapeString(i)+'"'},t.escapeString=function(t){return e.Assert.isString(t),t.replace(/"/g," ")},t.isAtomicString=function(t){return e.Assert.isString(t),/^\d+(\.\d+)?$|^[\d\w]+$/.test(t)},t.isRangeString=function(t){return e.Assert.isString(t),/^\d+(\.\d+)?\.\.\d+(\.\d+)?$|^\d{4}\/\d{2}\/\d{2}@\d{2}:\d{2}:\d{2}\.\.\d{4}\/\d{2}\/\d{2}@\d{2}:\d{2}:\d{2}$/.test(t)},t.isRangeWithoutOuterBoundsString=function(t){return e.Assert.isString(t),/^\d+(\.\d+)?$|^\d{4}\/\d{2}\/\d{2}@\d{2}:\d{2}:\d{2}$/.test(t)},t.buildFieldExpression=function(i,n,o){return e.Assert.isNonEmptyString(i),e.Assert.stringStartsWith(i,"@"),e.Assert.isNonEmptyString(n),e.Assert.isLargerOrEqualsThan(1,o.length),1==o.length?i+n+t.quoteAndEscapeIfNeeded(o[0]):i+n+"("+_.map(o,function(e){return t.quoteAndEscapeIfNeeded(e)}).join(",")+")"},t.buildFieldNotEqualExpression=function(i,n){e.Assert.isNonEmptyString(i),e.Assert.stringStartsWith(i,"@"),e.Assert.isLargerOrEqualsThan(1,n.length);var o;return o=1==n.length?i+"=="+t.quoteAndEscapeIfNeeded(n[0]):i+"==("+_.map(n,function(e){return t.quoteAndEscapeIfNeeded(e)}).join(",")+")","(NOT "+o+")"},t.mergeQueryString=function(e,t){var i=e.indexOf("?");return e+=-1!=i?"&"+t:"?"+t},t.mergePath=function(e,t){var i=e.split("?");return i[0]+t+"?"+(i[1]||"")},t.setPropertyOnResult=function(t,i,n,o){_.each(t.results,function(t){t[i]=n,_.each(t.childResults,function(e){e[i]=n}),e.Utils.isNullOrUndefined(t.parentResult)||(t.parentResult[i]=n),n=o?o():n})},t}();e.QueryUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.ESCAPE=27]="ESCAPE",e[e.SPACEBAR=32]="SPACEBAR",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.HOME=36]="HOME",e[e.LEFT_ARROW=37]="LEFT_ARROW",e[e.UP_ARROW=38]="UP_ARROW",e[e.RIGHT_ARROW=39]="RIGHT_ARROW",e[e.DOWN_ARROW=40]="DOWN_ARROW",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE"}(e.KEYBOARD||(e.KEYBOARD={}));var t=(e.KEYBOARD,function(){function t(){}return t.keysEqual=function(t,i){return e.Utils.isNullOrUndefined(t.keyCode)?e.Utils.isNullOrUndefined(t.which)?!1:t.which==i:t.keyCode==i},t.isAllowedKeyForOmniBox=function(e){var i=e.keyCode,n=t.isNumberKeyPushed(i)||32==i||13==i||t.isLetterKeyPushed(i)||i>95&&112>i||i>185&&193>i||i>218&&223>i||8==i||46==i||t.isArrowKeyPushed(i);return n},t.isDeleteOrBackspace=function(e){return t.keysEqual(e,8)||t.keysEqual(e,46)},t.isArrowKeyPushed=function(e){return 37==e||38==e||39==e||40==e},t.isNumberKeyPushed=function(e){return e>47&&58>e},t.isLetterKeyPushed=function(e){return e>64&&91>e},t}());e.KeyboardUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function e(){}return e.buildAttributeString=function(e){var t=[];return _.each(e,function(e,i){void 0!=e&&t.push(i+"="+JSON.stringify(e.toString()))}),t.join(" ")},e}();e.HTMLUtils=t;var i=function(){function e(){}return e.buildAnchor=function(e,i){var n;return i&&i.text?(n=i.text,i.text=void 0):n=e,"<a href='"+e+"'"+t.buildAttributeString(i)+">"+n+"</a>"},e}();e.AnchorUtils=i;var n=function(){function i(){}return i.buildImage=function(e,i){var n="<img ";return n+=e?"src='"+e+"' ":"",n+=t.buildAttributeString(i)+"/>"},i.selectImageFromResult=function(t){return e.$("img[data-coveo-sys-uri-hash='"+t.raw.sysurihash+"']")},i.buildImageWithDirectSrcAttribute=function(e,t){var n=new Image,o=e.getViewAsDatastreamUri(t.uniqueId,"$Thumbnail$");n.onload=function(){i.selectImageFromResult(t).attr("src",o)},n.src=o},i.buildImageWithBase64SrcAttribute=function(e,t){e.getRawDataStream(t.uniqueId,"$Thumbnail$").done(function(e){var n=String.fromCharCode.apply(null,new Uint8Array(e));i.selectImageFromResult(t).attr("src","data:image/png;base64, "+btoa(n))}).fail(function(){i.selectImageFromResult(t).remove()})},i.buildImageFromResult=function(t,n,o){var o=o?o:{},s=i.buildImage(void 0,e.$.extend(o,{"data-coveo-sys-uri-hash":t.raw.sysurihash}));return n.isJsonp()||e.Ui.Device.isIE8or9()?i.buildImageWithDirectSrcAttribute(n,t):i.buildImageWithBase64SrcAttribute(n,t),s},i}();e.ImageUtils=n}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){function t(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")}e.supportSVG=t}(e.FeatureDetectionUtils||(e.FeatureDetectionUtils={}));e.FeatureDetectionUtils}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function t(){}return t.buildMailToString=function(e){var i=e.to?"mailto:"+encodeURIComponent(e.to):"mailto:",n=t.buildMailToParametersString(e.subject,e.cc,e.bcc,e.body,i);return n&&(i+="?"+n),i},t.buildMailToParametersString=function(e,i,n,o,s){var r=[];if(e&&r.push(t.buildMailToParameter("subject",e)),i&&r.push(t.buildMailToParameter("cc",i)),n&&r.push(t.buildMailToParameter("bcc",n)),o){var a=t.getShortenBody(o,s+"?"+r.join("&"));a&&r.push(t.buildMailToParameter("body",a))}return r.join("&")},t.getShortenBody=function(i,n){var o=i;if(n.length<e.MailTo.maxLength){var s=e.MailTo.maxLength-n.length-"&body=".length;o=t.shortenString(i,s)}return o},t.buildMailToParameter=function(e,t){return t?encodeURIComponent(e)+"="+encodeURIComponent(t):""},t.shortenString=function(t,i,n){"undefined"==typeof n&&(n=!1);var o=n?encodeURIComponent(e.MailTo.shortenBodyIndicator):e.MailTo.shortenBodyIndicator;i-=e.MailTo.shortenBodyIndicator.length;var s=t.length>i?!0:!1,r=t.substring(0,i);return r+=s?o:""},t.appendShortenBodyToMailToString=function(e,i){var n=t.getShortenBody(i,e);return e.indexOf("?")>=0?e+"&body="+n:e+"?body="+n},t.removeCurrentUserEmailFromString=function(e,t){return t&&e?_.filter(t.split(";"),function(t){return-1==t.indexOf(e)}).join(";"):t},t.buildReplyMailToFromResult=function(t,i){return new e.MailTo({currentUserEmail:i,originalFrom:t.raw.sysfrom,to:t.raw.sysfrom,subject:t.raw.sysconversationsubject})},t.buildReplyAllMailToFromResult=function(t,i){return new e.MailTo({currentUserEmail:i,originalFrom:t.raw.sysfrom,to:t.raw.sysfrom+";"+t.raw.systo,subject:t.raw.sysconversationsubject,cc:t.raw.syscc})},t.buildForwardMailToFromResult=function(t,i){return new e.MailTo({currentUserEmail:i,originalFrom:t.raw.sysfrom,subject:t.raw.sysconversationsubject})},t.encodeMailToBody=function(t){var i=t.split("\n");return _.each(i,function(e,t){i[t]=encodeURIComponent(i[t])}),i.join(e.MailTo.enter)},t}();e.EmailActionsUtils=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.ajaxBasicAuth=function(i,n,o,s,r,a){e.$.ajax({type:i,timeout:5e3,url:n,beforeSend:function(i){null!=o&&null!=s&&(i.setRequestHeader("Authorization",t.getBasicAuthBase64(o,s)),e.Ui.Device.isPhonegap()&&i.setRequestHeader("Basic-Auth-Challenge-Client","Phonegap"))}}).fail(function(e){a&&a(e)}).done(function(e){r(e)})},t.getBasicAuthBase64=function(e,t){return"Basic "+btoa(e+":"+t)},t}();e.AjaxUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function i(){e.apply(this,arguments),this.currentUserEmail="",this.originalFrom="",this.to="",this.subject="",this.cc="",this.bcc="",this.body="",this.bodyIsHTML=t.Device.isPhonegap()}return __extends(i,e),i}(e.Options);t.DefaultMailToOptions=i;var n=function(){function e(e){this.options=e,this.bodyHeader="",this.options=(new i).merge(e),this.removeCurrentUserFromParameters(),t.Device.isPhonegap()&&this.setRecipientsArrays(),this.options.originalFrom&&(this.bodyHeader=this.options.bodyIsHTML?"<p><br/><br/><br/>"+t.l.From()+": "+this.options.originalFrom+"<hr></p>":"\n\n\n"+t.l.From()+": "+this.options.originalFrom+"\n_________________________________\n")}return e.prototype.removeCurrentUserFromParameters=function(){this.options.to=t.EmailActionsUtils.removeCurrentUserEmailFromString(this.options.currentUserEmail,this.options.to),this.options.cc=t.EmailActionsUtils.removeCurrentUserEmailFromString(this.options.currentUserEmail,this.options.cc),this.options.bcc=t.EmailActionsUtils.removeCurrentUserEmailFromString(this.options.currentUserEmail,this.options.bcc)},e.prototype.setRecipientsArrays=function(){this.toArray=this.options.to?this.options.to.split(";"):[],this.ccArray=this.options.cc?this.options.cc.split(";"):[],this.bccArray=this.options.bcc?this.options.bcc.split(";"):[]},e.prototype.open=function(){if(t.Device.isPhonegap()){var i=this.options.bodyIsHTML?this.body:t.EmailActionsUtils.shortenString(this.body,e.phonegapMaxLength);window.plugin.email.open(this.getEmailOpenerObject(i))}else this.ensureValueIsSet(),window.location.href=this.value},e.prototype.getEmailOpenerObject=function(e){var t={to:this.toArray,cc:this.ccArray,bcc:this.bccArray,subject:this.options.subject,body:e,isHtml:this.options.bodyIsHTML};return console.log(t),t},e.prototype.ensureValueIsSet=function(){this.value?this.valueBodyIsSet()||this.setValueBody():this.setValue()},e.prototype.setValue=function(){this.value=t.EmailActionsUtils.buildMailToString(this.options),this.value&&!this.valueBodyIsSet()&&this.setValueBody()},e.prototype.setValueBody=function(){this.value=t.EmailActionsUtils.appendShortenBodyToMailToString(this.value,this.body)},e.prototype.setMailToBodyFromText=function(e){this.body=e?this.bodyHeader+e:"",t.Device.isPhonegap()||(this.body=t.EmailActionsUtils.encodeMailToBody(this.body))},e.prototype.valueBodyIsSet=function(){return this.value.indexOf("body=")>=0},e.prototype.bodyIsSet=function(){return this.body?!0:!1},e.enter="%0D%0A",e.shortenBodyIndicator="\r\n\r\n...",e.maxLength=1e3,e.phonegapMaxLength=15e3,e}();t.MailTo=n}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(t){this.id=t,e.Assert.exists(window.localStorage)}return t.prototype.save=function(e){localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(e))},t.prototype.load=function(){var e=localStorage.getItem(this.getLocalStorageKey());return e&&JSON.parse(e)},t.prototype.remove=function(e){if(void 0==e)localStorage.removeItem(this.getLocalStorageKey());else{var t=this.load();delete t[e],this.save(t)}},t.prototype.getLocalStorageKey=function(){return"coveo-"+this.id},t}();e.LocalStorageUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function e(e){this.onEmpty=e,this.cache=[]}return e.prototype.get=function(){return 0==this.cache.length?this.onEmpty():this.cache.pop()},e.prototype.push=function(e){this.cache.push(e)},e}();e.Cache=t}(Coveo||(Coveo={}));var Coveo;!function(e){function t(t,i,n){var a=i.sort().reverse(),l=(new r).merge(n),u=s(t);return u.find("*").each(function(t,i){var n=e.$(i).text();e.$(i).html(e.HighlightUtils.highlightString(n,o(n,a,l),[],l.cssClass))}),u.html()}function i(t,i,n){var s=i.sort(function(e,t){return t.length-e.length}),a=(new r).merge(n);return e.HighlightUtils.highlightString(t,o(t,s,a),[],a.cssClass)}function n(e,t){return new RegExp("([^a-zA-Z]|^)("+e+"(?![a-zA-Z]))",t.regexFlags)}function o(t,i,o){var s=[];return i=_.compact(i),_.each(i,function(i){s.push(e.StringUtils.getHighlights(t,n(i,o)))}),_.flatten(_.compact(s)).sort(function(e,t){return e.offset-t.offset})}function s(t){var i=e.$("<div />");return i.get(0).innerHTML=t,i}var r=function(e){function t(t,i,n){"undefined"==typeof t&&(t="coveo-highlight"),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n="gi"),e.call(this),this.cssClass=t,this.shorten=i,this.regexFlags=n}return __extends(t,e),t}(e.Options);e.highlightStreamHTML=t,e.highlightStreamText=i}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(t,i){this.message=t,this.status=i,e.Assert.exists(t),e.Assert.exists(i),this.type="Ajax Error (status: "+i+")"}return t}();t.AjaxError=i}(e.Rest||(e.Rest={}));e.Rest}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(e){this.provider=e,this.isMissingAuthentication=!0,this.type=this.message="Missing Authentication (provider: "+e+")"}return e}();e.MissingAuthenticationError=t}(e.Rest||(e.Rest={}));e.Rest}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(t){this.status=t.statusCode,this.message=t.data.message,this.type=t.data.type,this.queryExecutionReport=t.data.executionReport,e.Assert.isNumber(this.status),e.Assert.isNonEmptyString(this.message),e.Assert.isNonEmptyString(this.type)}return t}();t.QueryError=i}(e.Rest||(e.Rest={}));e.Rest}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i;!function(e){e[e.OPENED=XMLHttpRequest.OPENED||1]="OPENED",e[e.DONE=XMLHttpRequest.DONE||4]="DONE"}(i||(i={}));var n=function(){function t(t){"undefined"==typeof t&&(t={}),this.options=t,this.useJsonp=!1,this.logger=new e.Logger(this)}return t.prototype.call=function(i){e.Assert.isNonEmptyString(i.url);var n={url:i.url,queryString:i.errorsAsSuccess?i.queryString.concat(["errorsAsSuccess=1"]):i.queryString,requestData:i.requestData,deferred:e.$.Deferred(),begun:new Date,method:i.method};this.logger.trace("Performing REST request",n);var o=t.parseURL(n.url),s=window.location.hostname===o.hostname||""===o.hostname,r=""!=window.location.port?window.location.port:"https:"==window.location.protocol?"443":"80",a=r==o.port,l=!(s&&a);return this.useJsonp?this.callUsingAjaxJsonP(n):this.isCORSSupported()||!l?this.callUsingXMLHttpRequest(n,i.responseType):this.isXDomainRequestSupported()?this.callUsingXDomainRequest(n):this.callUsingAjaxJsonP(n),n.deferred},t.parseURL=function(e){var t=document.createElement("a");return t.href=e,t},t.convertJsonToQueryString=function(t){e.Assert.exists(t);var i=[];return _.each(t,function(e,t){null!=e&&(_.isObject(e)?i.push(t+"="+encodeURIComponent(JSON.stringify(e))):i.push(t+"="+encodeURIComponent(e.toString())))}),i},t.convertJsonToFormBody=function(e){return t.convertJsonToQueryString(e).join("&")},t.prototype.callUsingXMLHttpRequest=function(n,o){var s=this;"undefined"==typeof o&&(o="text");var r=new XMLHttpRequest,a=!1;r.onreadystatechange=function(){if(r.readyState!=i.OPENED||a){if(r.readyState==i.DONE){var l,u=r.status;l="text"==o?s.tryParseResponseText(r.responseText,r.getResponseHeader("Content-Type")):r.response,s.isSuccessHttpStatus(u)?s.handleSuccessfulResponseThatMightBeAnError(n,l):s.handleError(n,r.status,void 0)}}else a=!0,s.options.anonymous===!1&&(r.withCredentials=!0),s.options.accessToken?r.setRequestHeader("Authorization","Bearer "+s.options.accessToken):s.options.username&&s.options.password&&r.setRequestHeader("Authorization","Basic "+btoa(s.options.username+":"+s.options.password)),e.Ui.Device.isPhonegap()&&r.setRequestHeader("Basic-Auth-Challenge-Client","Phonegap"),"GET"==n.method?r.send():(r.setRequestHeader("Content-Type",'application/x-www-form-urlencoded; charset="UTF-8"'),r.send(t.convertJsonToFormBody(n.requestData))),r.responseType=o};var l=n.queryString;"GET"==n.method&&(l=l.concat(t.convertJsonToQueryString(n.requestData))),r.open(n.method,this.combineUrlAndQueryString(n.url,l))},t.prototype.callUsingXDomainRequest=function(e){var i=this,n=e.queryString.concat([]);this.options.accessToken&&n.push("access_token="+encodeURIComponent(this.options.accessToken));var o=new XDomainRequest;"GET"==e.method&&(n=n.concat(t.convertJsonToQueryString(e.requestData))),o.open(e.method,this.combineUrlAndQueryString(e.url,n)),o.onload=function(){var t=i.tryParseResponseText(o.responseText,o.contentType);i.handleSuccessfulResponseThatMightBeAnError(e,t)},o.onerror=function(){var t=i.tryParseResponseText(o.responseText,o.contentType);i.handleError(e,0,t)},o.ontimeout=function(){return i.logger.error("Request timeout",o,e.requestData)},o.onprogress=function(){return i.logger.trace("Request progress",o,e.requestData)},_.defer(function(){"GET"==e.method?o.send():o.send(t.convertJsonToFormBody(e.requestData))})},t.prototype.callUsingAjaxJsonP=function(i){var n=this,o=i.queryString.concat(t.convertJsonToQueryString(i.requestData));this.options.accessToken&&o.push("access_token="+encodeURIComponent(this.options.accessToken)),o.push("callback=?"),e.$.jsonp({url:this.combineUrlAndQueryString(i.url,o),success:function(e){return n.handleSuccessfulResponseThatMightBeAnError(i,e)},error:function(){return n.handleError(i,0,void 0)}})},t.prototype.handleSuccessfulResponseThatMightBeAnError=function(e,t){this.isErrorResponseBody(t)?this.handleError(e,t.statusCode,t):this.handleSuccess(e,t)},t.prototype.handleSuccess=function(t,i){var n={duration:e.TimeSpan.fromDates(t.begun,new Date).getMilliseconds(),data:i};this.logger.trace("REST request successful",i,t),t.deferred.resolve(n)},t.prototype.handleError=function(e,t,i){var n={statusCode:t,data:i};this.logger.error("REST request failed",t,i,e),e.deferred.reject(n)},t.prototype.combineUrlAndQueryString=function(e,t){return e+(t.length>0?"?"+t.join("&"):"")},t.prototype.isXDomainRequestSupported=function(){return"XDomainRequest"in window},t.prototype.isCORSSupported=function(){return"withCredentials"in new XMLHttpRequest},t.prototype.isSuccessHttpStatus=function(e){return e>=200&&300>e||304===e},t.prototype.tryParseResponseText=function(t,i){if(null==i||-1==i.indexOf("application/json"))return t;if(!e.Utils.isNonEmptyString(t))return void 0;try{return JSON.parse(t)}catch(n){return void 0}},t.prototype.isErrorResponseBody=function(e){return e&&e.statusCode?!this.isSuccessHttpStatus(e.statusCode):!1},t}();t.EndpointCaller=n}(e.Rest||(e.Rest={}));e.Rest}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function e(){this.queryStringArguments={},this.anonymous=!1,this.isOldRestAPI=!1}return e}();t.DefaultSearchEndpointOptions=i;var n=function(){function n(t){this.options=t,this._batchListFieldValues=[],e.Assert.exists(t);var n=new i;n.anonymous=e.Utils.isNonEmptyString(t.accessToken),this.options=e.$.extend({},n,t),e.$(window).on("beforeunload",e.$.proxy(this.handleUnload,this)),this.logger=new e.Logger(this),this.createEndpointCaller()}return n.configureSampleEndpoint=function(){n.endpoints["default"]=new n({restUri:"https://cloudplatform.coveo.com/rest/search",accessToken:"52d806a2-0f64-4390-a3f2-e0f41a4a73ec"})},n.configureCloudEndpoint=function(e,t,i,o){"undefined"==typeof i&&(i="https://cloudplatform.coveo.com/rest/search");var s=n.mergeConfigOptions({restUri:i,accessToken:t,queryStringArguments:{workgroup:e}},o);n.endpoints["default"]=new n(n.removeUndefinedConfigOption(s))},n.configureOnPremiseEndpoint=function(e,t,i){var o=n.mergeConfigOptions({restUri:e,accessToken:t},i);n.endpoints["default"]=new n(n.removeUndefinedConfigOption(o))},n.removeUndefinedConfigOption=function(e){return _.each(_.keys(e),function(t){void 0==e[t]&&delete e[t]}),e},n.mergeConfigOptions=function(t,i){return t=n.removeUndefinedConfigOption(t),i=n.removeUndefinedConfigOption(i),e.$.extend({},t,i)},n.prototype.handleUnload=function(){this.isRedirecting=!0},n.prototype.getBaseUri=function(){return this.options.restUri},n.prototype.getAuthenticationProviderUri=function(t,i,n){var o=this.buildBaseUri("/login/"+t)+"?";return e.Utils.isNonEmptyString(i)?o+="redirectUri="+encodeURIComponent(i):e.Utils.isNonEmptyString(n)&&(o+="message="+encodeURIComponent(n)),o},n.prototype.isJsonp=function(){return this.caller.useJsonp},n.prototype.search=function(t,i){var n=this;e.Assert.exists(t),this.logger.info("Performing REST query",t),i=_.extend({},i);var o={url:this.buildBaseUri("/"),queryString:this.buildBaseQueryString(i),requestData:t,errorsAsSuccess:!0,responseType:"text",method:"POST"},s=this.callWithErrorHandling(o);return s.done(function(e){return n.logger.info("REST query successful",e,t)}),s},n.prototype.getRawDataStream=function(t,i,n){var o=this;e.Assert.exists(t),n=_.extend({},n);var s={url:this.buildBaseUri("/datastream"),queryString:this.buildViewAsHtmlQueryString(t,n).concat(["dataStream="+i]),requestData:{},errorsAsSuccess:!1,method:"GET",responseType:"arraybuffer"},r=this.callWithErrorHandling(s);return this.logger.info("Performing REST query for datastream "+i+" on document uniqueID"+t),r.done(function(e){return o.logger.info("REST query successful",e,t)}),r},n.prototype.getDocumentText=function(e,t){t=_.extend({},t);var i={url:this.buildBaseUri("/text"),queryString:this.buildViewAsHtmlQueryString(e,t),method:"GET",requestData:{},responseType:"text",errorsAsSuccess:!0};return this.callWithErrorHandling(i)},n.prototype.getDocumentHtml=function(e,t){t=_.extend({},t);var i={url:this.buildBaseUri("/html"),queryString:this.buildViewAsHtmlQueryString(e,t),method:"GET",requestData:{},responseType:"document",errorsAsSuccess:!0};return this.callWithErrorHandling(i)},n.prototype.getViewAsHtmlUri=function(e,t){return t=_.extend({},t),this.buildViewAsHtmlUri("/html",e,t)},n.prototype.getViewAsDatastreamUri=function(e,t,i){return i=_.extend({},i),this.buildViewAsHtmlUri("/datastream",e,i)+"&dataStream="+encodeURIComponent(t)},n.prototype.batchFieldValues=function(t,i){var n=this;e.Assert.exists(t),i=_.extend({},i),this.logger.info("Listing field values",t);var o=e.$.Deferred(),s={url:this.buildBaseUri("/values"),queryString:this.buildBaseQueryString(i),method:"POST",requestData:t,errorsAsSuccess:!0,responseType:"text"};return this.callWithErrorHandling(s).done(function(e){return o.resolve(e.values)}).fail(function(e,t){return o.reject(null,t)}),o.done(function(e){return n.logger.info("REST list field values successful",e,t)}),o},n.prototype.listFieldValues=function(t,i){var n=this;e.Assert.exists(t),i=_.extend({},i),this.logger.info("Listing field values",t);var o=e.$.Deferred(),s={url:this.buildBaseUri("/values"),queryString:this.buildBaseQueryString(i),method:"POST",requestData:t,errorsAsSuccess:!0,responseType:"text"};return this.callWithErrorHandling(s).done(function(e){return o.resolve(e.values)}).fail(function(e,t){return o.reject(null,t)}),o.done(function(e){return n.logger.info("REST list field values successful",e,t)}),o},n.prototype.listFields=function(t){t=_.extend({},t),this.logger.info("Listing fields");var i=e.$.Deferred(),n={url:this.buildBaseUri("/fields"),queryString:this.buildBaseQueryString(t),requestData:{},method:"GET",responseType:"text",errorsAsSuccess:!0};return this.callWithErrorHandling(n).done(function(e){return i.resolve(e.fields)}).fail(function(e,t){return i.reject(null,t)}),i},n.prototype.tagDocument=function(t,i){i=_.extend({},i),this.logger.info("Tagging a document",t);var n=e.$.Deferred(),o={url:this.buildBaseUri("/tag"),queryString:this.buildBaseQueryString(i),method:"POST",requestData:t,errorsAsSuccess:!1,responseType:"text"};return this.callWithErrorHandling(o).done(function(){return n.resolve(!0)}).fail(function(){return n.reject(!1)}),n},n.prototype.createEndpointCaller=function(){this.caller=new t.EndpointCaller(this.options)},n.prototype.buildBaseUri=function(t){e.Assert.isString(t);var i=this.options.restUri;return i=this.removeTrailingSlash(i),i+=t,this.options.isOldRestAPI&&(i=this.addTrailingSlash(i)),i},n.prototype.buildBaseQueryString=function(e){var t=[];for(var i in this.options.queryStringArguments)t.push(i+"="+encodeURIComponent(this.options.queryStringArguments[i]));return _.isArray(e.authentication)&&0!=e.authentication.length&&t.push("authentication="+e.authentication.join(",")),t},n.prototype.buildViewAsHtmlUri=function(t,i,n){e.Assert.isNonEmptyString(i);var o=this.buildViewAsHtmlQueryString(i,n);e.Utils.isNonEmptyString(this.options.accessToken)&&o.push("access_token="+encodeURIComponent(this.options.accessToken));var s=this.buildBaseUri(t);return s+"?"+o.join("&")},n.prototype.buildViewAsHtmlQueryString=function(e,t){var i=this.buildBaseQueryString(t);return i.push("uniqueId="+encodeURIComponent(e)),null!=t.query&&(i.push("q="+encodeURIComponent(t.query)),i.push("enableNavigation=true")),t.requestedOutputSize&&i.push("requestedOutputSize="+encodeURIComponent(t.requestedOutputSize.toString())),i},n.prototype.callWithErrorHandling=function(t){var i=e.$.Deferred();return this.performOneCall(t,i,!0),i},n.prototype.performOneCall=function(e,t,i){var n=this;this.caller.call(e).done(function(i){i.data.clientDuration=i.duration,t.resolve(i.data,e.requestData)}).fail(function(o){i&&n.canRenewAccessToken()&&n.isAccessTokenExpiredStatus(o.statusCode)?n.renewAccessToken().done(function(){return n.performOneCall(e,t,!1)}).fail(function(){return n.handleErrorResponse(o,t)}):0==o.statusCode&&n.isRedirecting?_.defer(function(){t.resolve()}):n.handleErrorResponse(o,t)})},n.prototype.handleErrorResponse=function(e,i){this.isMissingAuthenticationProviderStatus(e.statusCode)?i.reject(null,new t.MissingAuthenticationError(e.data.provider)):e.data&&e.data.message?i.reject(null,new t.QueryError(e)):i.reject(null,new t.AjaxError("Request Error",e.statusCode))},n.prototype.canRenewAccessToken=function(){return e.Utils.isNonEmptyString(this.options.accessToken)&&_.isFunction(this.options.renewAccessToken)},n.prototype.isAccessTokenExpiredStatus=function(e){return 419==e},n.prototype.renewAccessToken=function(){var t=this;return this.logger.info("Renewing expired access token"),this.options.renewAccessToken().done(function(i){e.Assert.isNonEmptyString(i),t.options.accessToken=i,t.createEndpointCaller()}).fail(function(e){t.logger.error("Failed to renew access token",e)})},n.prototype.isMissingAuthenticationProviderStatus=function(e){return 402==e},n.prototype.addTrailingSlash=function(e){return this.hasTrailingSlash(e)||(e+="/"),e},n.prototype.removeTrailingSlash=function(e){return this.hasTrailingSlash(e)&&(e=e.substr(0,e.length-1)),e},n.prototype.hasTrailingSlash=function(e){return"/"==e.charAt(e.length-1)},n.endpoints={},n}();t.SearchEndpoint=n}(e.Rest||(e.Rest={}));e.Rest}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(e,t){this.endpoint=e,this.callOptions=t,this.options=e.options}return e.prototype.getBaseUri=function(){return this.endpoint.getBaseUri()},e.prototype.getAuthenticationProviderUri=function(e,t,i){return this.endpoint.getAuthenticationProviderUri(e,t,i)},e.prototype.isJsonp=function(){return this.endpoint.isJsonp()},e.prototype.search=function(e,t){return this.endpoint.search(e,this.enrichCallOptions(t))},e.prototype.tagDocument=function(e){return this.endpoint.tagDocument(e,this.enrichCallOptions(e))},e.prototype.getRawDataStream=function(e,t,i){return this.endpoint.getRawDataStream(e,t,this.enrichCallOptions(i))},e.prototype.getDocumentText=function(e,t){return this.endpoint.getDocumentText(e,this.enrichCallOptions(t))},e.prototype.getDocumentHtml=function(e,t){return this.endpoint.getDocumentHtml(e,this.enrichCallOptions(t))},e.prototype.getViewAsHtmlUri=function(e,t){return this.endpoint.getViewAsHtmlUri(e,this.enrichCallOptions(t))},e.prototype.getViewAsDatastreamUri=function(e,t,i){return this.endpoint.getViewAsDatastreamUri(e,t,this.enrichCallOptions(i))},e.prototype.listFieldValues=function(e,t){return this.endpoint.listFieldValues(e,this.enrichCallOptions(t))},e.prototype.listFields=function(e){return this.endpoint.listFields(this.enrichCallOptions(e))},e.prototype.enrichCallOptions=function(e){return _.extend({},e,this.callOptions)},e}();e.SearchEndpointWithDefaultCallOptions=t}(e.Rest||(e.Rest={}));e.Rest}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(t){this.options=t,this.logger=new e.Logger(this)}return t.prototype.sendSearchEvents=function(e){e.length>0&&(this.logger.info("Logging analytics search events",e),this.sendEventToApi(e,"searches","searchEvents"))},t.prototype.sendDocumentViewEvent=function(t){e.Assert.exists(t),this.logger.info("Logging analytics document view",t),this.sendEventToApi(t,"click","clickEvent")},t.prototype.sendCustomEvent=function(t){e.Assert.exists(t),this.logger.info("Logging analytics custom event",t),this.sendEventToApi(t,"custom","customEvent")},t.prototype.getTopQueries=function(i){var n=e.QueryUtils.mergePath(this.options.serviceUrl,"/rest/"+(t.CUSTOM_ANALYTICS_VERSION||t.DEFAULT_ANALYTICS_VERSION)+"/stats/topQueries");return this.getFromService(n,i)},t.prototype.sendEventToApi=function(i,n,o){var s=e.QueryUtils.mergePath(this.options.serviceUrl,"/rest/"+(t.CUSTOM_ANALYTICS_VERSION||t.DEFAULT_ANALYTICS_VERSION)+"/analytics/"+n);return s=this.appendUrlParamSign(s),s+=o+"="+encodeURIComponent(JSON.stringify(i)),this.options.token&&""!=this.options.token&&(s+="&access_token="+encodeURIComponent(this.options.token)),e.Utils.isNonEmptyString(this.options.userId)&&(s+="&user="+encodeURIComponent(this.options.userId)),e.$.ajax({url:s,dataType:"jsonp"})},t.prototype.appendUrlParamSign=function(e){return"?"==e.charAt(e.length-1)?e:e+"?"},t.prototype.getFromService=function(t,i){var n=this.options.token&&""!=this.options.token?e.$.extend({access_token:this.options.token},i):i;
return e.$.ajax({url:this.appendUrlParamSign(t)+this.buildQueryStringFromParam(n),dataType:"jsonp"})},t.prototype.buildQueryStringFromParam=function(e){var t=_.map(_.pairs(e),function(e){return e[0]+"="+e[1]});return t.join("&")},t.DEFAULT_ANALYTICS_URI="https://usageanalytics.coveo.com",t.DEFAULT_ANALYTICS_VERSION="v9",t.CUSTOM_ANALYTICS_VERSION=void 0,t}();t.AnalyticsEndpoint=i}(e.Rest||(e.Rest={}));e.Rest}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.convertSearchEventToAPI=function(t){var i={};i.customMetadata1=t.customMetadata1,i.customMetadata2=t.customMetadata2,i.customMetadata3=t.customMetadata3,i.customMetadata4=t.customMetadata4,i.customMetadata5=t.customMetadata5;var n={advancedQuery:t.advancedQuery,customMetadatas:i,device:t.device,didYouMean:t.didYouMean,facets:e.convertFacetToAPI(t.facets),language:t.language,pageNumber:t.pageNumber,queryText:t.queryText,responseTime:t.responseTime,results:e.convertResultsToAPI(t.results),resultsPerPage:t.resultsPerPage,searchHub:t.originLevel1,searchInterface:t.originLevel2,searchQueryUid:t.searchQueryUid,type:t.actionType,actionCause:t.actionCause};return n},e.convertFacetToAPI=function(t){var i=_.map(t,function(t){return{fieldName:t.fieldName,mode:t.mode,name:t.name,selections:e.convertFacetSelectionToAPI(t.selections),sort:t.sort}});return i},e.convertFacetSelectionToAPI=function(e){var t=_.map(e,function(e){return{entryName:e.entryName,status:e.status}});return t},e.convertResultsToAPI=function(e){var t=_.map(e,function(e){return{clickUri:e.clickUri,documentUri:e.documentUri,documentUriHash:e.documentUriHash}});return t},e.convertDocumentViewToAPI=function(e){var t={};t.customMetadata1=e.customMetadata1,t.customMetadata2=e.customMetadata2,t.customMetadata3=e.customMetadata3,t.customMetadata4=e.customMetadata4,t.customMetadata5=e.customMetadata5;var i={collectionName:e.collectionName,device:e.device,documentPosition:e.documentPosition,title:e.customMetadata1,documentClickUri:e.customMetadata2,documentUri:e.documentUri,documentUriHash:e.documentUriHash,language:e.language,responseTime:e.responseTime,searchHub:e.originLevel1,searchInterface:e.originLevel2,searchQueryUid:e.searchQueryUid,sourceName:e.sourceName,viewMethod:e.viewMethod,customMetadatas:t,actionCause:e.actionCause};return i},e.convertCustomEventToAPI=function(e){var t={};t.customMetadata1=e.customMetadata1,t.customMetadata2=e.customMetadata2,t.customMetadata3=e.customMetadata3,t.customMetadata4=e.customMetadata4,t.customMetadata5=e.customMetadata5;var i={actionCause:e.actionCause,actionType:e.actionType,device:e.device,language:e.language,responseTime:e.responseTime,searchHub:e.originLevel1,searchInterface:e.originLevel2,customMetadatas:t};return i},e}();e.APIAnalyticsBuilder=t}(e.Rest||(e.Rest={}));e.Rest}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(t){this.template=t,e.Assert.check(i.isLibraryAvailable(),"The JsRender library must be loaded within the page"),e.Assert.exists(t),this.logger=new e.Logger(this)}return i.prototype.instantiateToString=function(t){return e.$(this.template).render(t)},i.prototype.instantiateToElement=function(i){var n=e.$(this.template).render(i),o=t.JQueryUtils.htmlToDom(n);return this.logger.trace("Instantiated result template",i,o),o},i.create=function(t){return e.Assert.exists(t),new i(t)},i.isLibraryAvailable=function(){return e.Utils.exists(e.$.views)},i.mimeTypes=["text/jsrender","text/jsrender-template","text/x-jsrender","text/x-jsrender-template"],i}();t.JsRenderTemplate=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){_.templateSettings={evaluate:/(?:<%|{{)([\s\S]+?)(?:%>|}})/g,interpolate:/(?:<%|{{)=([\s\S]+?)(?:%>|}})/g,escape:/(?:<%|{{)-([\s\S]+?)(?:%>|}})/g};var i=function(){function i(t){if(this.logger=new e.Logger(this),e.Utils.isHtmlElement(t)){e.Assert.exists(t);var i=e.$(t).html();this.template=_.template(i)}else t instanceof Function&&(this.template=t)}return i.prototype.instantiateToString=function(e){var t=_.extend({},e,i.templateHelpers);return this.template(t)},i.prototype.instantiateToElement=function(e){var i=this.instantiateToString(e),n=t.JQueryUtils.htmlToDom(i);return this.logger.trace("Instantiated result template",e,n),n},i.create=function(t){return e.Assert.exists(t),new i(t)},i.registerTemplateHelper=function(e,t){i.templateHelpers[e]=t},i.isLibraryAvailable=function(){return e.Utils.exists(window._)},i.templateHelpers={},i.mimeTypes=["text/underscore","text/underscore-template","text/x-underscore","text/x-underscore-template"],i}();t.UnderscoreTemplate=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(t){e.Assert.check(i.isLibraryAvailable(),"The Handlebars library must be loaded within the page"),e.Assert.exists(t),this.logger=new e.Logger(this);var n=e.$(t).html();this.template=Handlebars.compile(n)}return i.prototype.instantiateToString=function(e){return this.template(e)},i.prototype.instantiateToElement=function(e){var i=this.template(e),n=t.JQueryUtils.htmlToDom(i);return this.logger.trace("Instantiated result template",e,n),n},i.create=function(t){return e.Assert.exists(t),new i(t)},i.isLibraryAvailable=function(){return e.Utils.exists(window.Handlebars)},i.mimeTypes=["text/handlebars","text/handlebars-template","text/x-handlebars","text/x-handlebars-template"],i}();t.HandlebarsTemplate=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(){this.logger=new e.Logger(this)}return t.prototype.instantiateToString=function(t){e.Assert.exists(t);var i=this.instantiateToElement(t);return e.$(i).html()},t.prototype.instantiateToElement=function(t){e.Assert.exists(t);var i=e.$("<div></div>"),n=e.$('<div class="coveo-header"></div>').appendTo(i);e.$('<a class="coveo-title"></a>').text(t.title).attr("href",t.clickUri).appendTo(n);var o=i.get(0);return this.logger.trace("Instantiated default result template",o),o},t}();t.DefaultResultTemplate=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(){}return i.registerTemplate=function(t,n){e.Assert.isNonEmptyString(t),e.Assert.exists(n),i.templates[t]=n},i.getTemplate=function(t){return e.Assert.exists(i.templates[t]),i.templates[t]},i.scanAndRegisterTemplates=function(){t.UnderscoreTemplate.isLibraryAvailable()&&i.scanAndRegisterUnderscoreTemplates(),t.JsRenderTemplate.isLibraryAvailable()&&i.scanAndRegisterJsRenderTemplates(),t.HandlebarsTemplate.isLibraryAvailable()&&i.scanAndRegisterHandlebarsTemplates()},i.scanAndRegisterUnderscoreTemplates=function(){_.each(t.UnderscoreTemplate.mimeTypes,function(n){e.$("script[id][type='"+n+"']").each(function(n,o){var s=new t.UnderscoreTemplate(o);i.registerTemplate(e.$(o).attr("id"),function(e){return s.instantiateToString(e)})})})},i.scanAndRegisterJsRenderTemplates=function(){_.each(t.JsRenderTemplate.mimeTypes,function(n){e.$("script[id][type='"+n+"']").each(function(n,o){var s=new t.JsRenderTemplate(o);i.registerTemplate(e.$(o).attr("id"),function(e){return s.instantiateToString(e)})})})},i.scanAndRegisterHandlebarsTemplates=function(){_.each(t.HandlebarsTemplate.mimeTypes,function(n){e.$("script[id][type='"+n+"']").each(function(n,o){var s=new t.HandlebarsTemplate(o);i.registerTemplate(e.$(o).attr("id"),function(e){return s.instantiateToString(e)})})})},i.templates={},i}();t.TemplateCache=i,e.$(function(){i.scanAndRegisterTemplates()})}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(){}return i.registerTemplateHelper=function(n,o){e.Assert.isNonEmptyString(n),e.Assert.exists(o),t.UnderscoreTemplate.isLibraryAvailable()&&i.registerTemplateHelperInUnderscore(n,o),t.JsRenderTemplate.isLibraryAvailable()&&i.registerTemplateHelperInJsRender(n,o),t.HandlebarsTemplate.isLibraryAvailable()&&i.registerTemplateHelperInHandlebars(n,o),i.helpers[n]=o},i.getHelper=function(e){return i.helpers[e]},i.registerTemplateHelperInJsRender=function(t,i){e.Assert.isNonEmptyString(t),e.Assert.exists(i);var n={};n[t]=function(){for(var e=[],t=0;t<arguments.length-0;t++)e[t]=arguments[t+0];return i.apply(this.data,e)},e.$.views.helpers(n)},i.registerTemplateHelperInHandlebars=function(i,n){e.Assert.isNonEmptyString(i),e.Assert.exists(n),e.Assert.check(t.HandlebarsTemplate.isLibraryAvailable()),Handlebars.registerHelper(i,function(){for(var t=[],i=0;i<arguments.length-0;i++)t[i]=arguments[i+0];var o=t[t.length-1];return _.isObject(o)&&e.Utils.exists(o.hash)&&(t[t.length-1]=o.hash),new Handlebars.SafeString(n.apply(this,t))})},i.registerTemplateHelperInUnderscore=function(i,n){e.Assert.isNonEmptyString(i),e.Assert.exists(n),e.Assert.check(t.UnderscoreTemplate.isLibraryAvailable()),t.UnderscoreTemplate.registerTemplateHelper(i,n)},i.helpers={},i}();t.TemplateHelpers=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){function i(){for(var e=arguments.callee.caller,t=e.arguments[0],i=0;void 0!=e&&(void 0==t||void 0==t.uri)&&100>i;)t=e.arguments[0],e=e.caller,i++;return t}t.TemplateHelpers.registerTemplateHelper("javascriptEncode",function(t){return e.Utils.exists(t)?e.StringUtils.javascriptEncode(t):void 0}),t.TemplateHelpers.registerTemplateHelper("shorten",function(t,i,n,o){var s=e.StringAndHoles.shortenString(t,i,"...");return e.Utils.exists(n)?e.HighlightUtils.highlightString(s.value,n,s.holes,o||"highlight"):s.value}),t.TemplateHelpers.registerTemplateHelper("shortenPath",function(t,i,n,o){var s=e.StringAndHoles.shortenPath(t,i);return e.Utils.exists(n)?e.HighlightUtils.highlightString(s.value,n,s.holes,o||"highlight"):s.value}),t.TemplateHelpers.registerTemplateHelper("shortenUri",function(t,i,n,o){var s=e.StringAndHoles.shortenUri(t,i);return e.Utils.exists(n)?e.HighlightUtils.highlightString(s.value,n,s.holes,o||"highlight"):s.value}),t.TemplateHelpers.registerTemplateHelper("highlight",function(t,i,n){return e.Utils.exists(t)?e.Utils.exists(i)?e.HighlightUtils.highlightString(t,i,null,n||"highlight"):t:void 0}),t.TemplateHelpers.registerTemplateHelper("highlightStreamText",function(t,n,o){return"undefined"==typeof n&&(n=i().termsToHighlight),e.Utils.exists(t)?e.Utils.isNonEmptyArray(n)?e.highlightStreamText(t,n,o):t:void 0}),t.TemplateHelpers.registerTemplateHelper("highlightStreamHTML",function(t,n,o){return"undefined"==typeof n&&(n=i().termsToHighlight),e.Utils.exists(t)?e.Utils.isNonEmptyArray(n)?e.highlightStreamHTML(t,n,o):t:void 0}),t.TemplateHelpers.registerTemplateHelper("number",function(t,i){return e.Utils.exists(t)?_.isString(i)?e.StringUtils.htmlEncode(Globalize.format(t,i)):e.StringUtils.htmlEncode(t.toString()):void 0}),t.TemplateHelpers.registerTemplateHelper("date",function(t,i){return e.DateUtils.dateToString(e.DateUtils.convertFromJsonDateIfNeeded(t),i)}),t.TemplateHelpers.registerTemplateHelper("time",function(t,i){return e.DateUtils.timeToString(e.DateUtils.convertFromJsonDateIfNeeded(t),i)}),t.TemplateHelpers.registerTemplateHelper("dateTime",function(t,i){return e.DateUtils.dateTimeToString(e.DateUtils.convertFromJsonDateIfNeeded(t),i)}),t.TemplateHelpers.registerTemplateHelper("emailDateTime",function(t,i){var n={};n.includeTimeIfThisWeek=!0;var o=e.$.extend({},n,i);return t?e.DateUtils.dateTimeToString(e.DateUtils.convertFromJsonDateIfNeeded(t),o):void 0}),t.TemplateHelpers.registerTemplateHelper("currency",function(t,i){return e.CurrencyUtils.currencyToString(t,i)}),t.TemplateHelpers.registerTemplateHelper("email",function(t,i,n,o,s){if("undefined"==typeof o&&(o=2),"undefined"==typeof s&&(s=!1),_.isString(t)){var r=e.EmailUtils.splitSemicolonSeparatedListOfEmailAddresses(t);return e.EmailUtils.emailAddressesToHyperlinks(r,i,n,o,s)}return _.isArray(t)?e.EmailUtils.emailAddressesToHyperlinks(t,i,n,o,s):void 0}),t.TemplateHelpers.registerTemplateHelper("excessEmailToggle",function(t){return e.$(t).removeClass("coveo-active"),e.$(t).hasClass("coveo-emails-excess-collapsed")?e.$(t).siblings(".coveo-emails-excess-expanded").addClass("coveo-active"):e.$(t).hasClass("coveo-hide-expanded")&&(e.$(t).parent().addClass("coveo-inactive"),e.$(t).parent().siblings(".coveo-emails-excess-collapsed").addClass("coveo-active")),void 0}),t.TemplateHelpers.registerTemplateHelper("anchor",function(t,i){return e.AnchorUtils.buildAnchor(t,i)}),t.TemplateHelpers.registerTemplateHelper("image",function(t,i){return e.ImageUtils.buildImage(t,i)}),t.TemplateHelpers.registerTemplateHelper("thumbnail",function(t,n,o){return"undefined"==typeof t&&(t=i()),"undefined"==typeof n&&(n="default"),e.QueryUtils.hasThumbnail(t)?e.ImageUtils.buildImageFromResult(t,e.Rest.SearchEndpoint.endpoints[n],o):void 0}),t.TemplateHelpers.registerTemplateHelper("fromFileTypeToIcon",function(e,t){"undefined"==typeof e&&(e=i()),"undefined"==typeof t&&(t={});var n="coveo-icon";if(t.classToUse)n+=" "+t.classToUse;else if(t.fileTypeToUse)n+=" sysfiletype "+t.fileTypeToUse;else{var o=e.raw.sysfiletype;o&&o[0]&&"."==o[0]&&(o=o.substring(1)),n+=" sysfiletype "+(o?o:"")}return"<span class='"+n+"'></span>"}),t.TemplateHelpers.registerTemplateHelper("attrEncode",function(e){return(""+e).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),t.TemplateHelpers.registerTemplateHelper("loadTemplates",function(e,n){"undefined"==typeof n&&(n=!0);var o,s="",r=i(),a=!1,l=e;return _.each(e,function(e,t){"default"==e&&(o=t)}),void 0!=o&&(l=_.omit(e,o)),_.each(l,function(e,i){a&&n||(a=a||e,s+=t.TemplateHelpers.getHelper("loadTemplate")(i,e,r))}),a||void 0==o||(s+=t.TemplateHelpers.getHelper("loadTemplate")(o,!0,r)),s}),t.TemplateHelpers.registerTemplateHelper("loadTemplate",function(n,o,s){return"undefined"==typeof o&&(o=!0),e.Utils.isNullOrUndefined(s)&&(s=i()),o?t.TemplateCache.getTemplate(n)(s):""})}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(){}return i.registerDefaultOptions=function(t,i){var n=e.$(t).data("CoveoDefaultOptions")||{},o=e.$.extend(!0,{},n,i);e.$(t).data("CoveoDefaultOptions",o)},i.resolveDefaultOptions=function(t,n){var o,s=e.$(t).data("CoveoDefaultOptions");return o=e.Utils.exists(s)?e.$.extend(!0,{},s,n):n,t.parentElement?i.resolveDefaultOptions(t.parentElement,o):o},i.registerAutoCreateComponent=function(t){e.Assert.exists(t),e.Assert.exists(t.ID),e.Assert.doesNotExists(i.autoCreateComponents[t.ID]),e.Assert.doesNotExists(i.namedMethods[t.ID]),i.autoCreateComponents[t.ID]=t},i.isComponentClassIdRegistered=function(t){return e.Utils.exists(i.autoCreateComponents[t])},i.initializeSearchInterface=function(n,o){e.Assert.exists(n),this.logger.info("Internal Coveo JQuery version",e.$.fn.jquery),t.Device.isIE8or9()&&e.$("html").addClass("ie8or9"),o=i.resolveDefaultOptions(n,o),i.performInitFunctionsOption(o,e.Events.InitializationEvents.beforeInitialization),e.$(n).trigger(e.Events.InitializationEvents.beforeInitialization),i.initComponents(n,o),i.initExternalComponents(n,o),i.performInitFunctionsOption(o,e.Events.InitializationEvents.afterComponentsInitialization),e.$(n).trigger(e.Events.InitializationEvents.afterComponentsInitialization),e.$(n).trigger(e.Events.InitializationEvents.restoreHistoryState),i.performInitFunctionsOption(o,e.Events.InitializationEvents.afterInitialization),e.$(n).trigger(e.Events.InitializationEvents.afterInitialization);var s=t.Component.get(n,t.SearchInterface);e.$(".coveo-hide-until-loaded").removeClass("coveo-hide-until-loaded").addClass("coveo-show-after-loaded"),s.options.autoTriggerQuery&&t.Component.get(n,e.Controllers.QueryController).executeQuery()},i.initializeSearchInterfaceForSearchBox=function(t,n,o){e.Assert.isNonEmptyString(n);var s={};s.searchPageUri=n,s.autoTriggerQuery=!1,s.hideUntilFirstQuery=!1,s.enableHistory=!1,o=_.extend({},o,{SearchInterface:s}),i.initializeSearchInterface(t,o)},i.performInitFunctionsOption=function(t,n){e.Utils.exists(t)&&i.performFunctions(t[n])},i.performPreInitFunctions=function(t){e.Utils.exists(t)&&i.performFunctions(t[e.Events.InitializationEvents.beforeInitialization])},i.performPostInitFunction=function(t){e.Utils.exists(t)&&i.performFunctions(t[e.Events.InitializationEvents.afterInitialization])},i.performFunctions=function(t){e.Utils.exists(t)&&_.each(t,function(e){"function"==typeof e&&e()})},i.initComponents=function(n,o){"undefined"==typeof o&&(o={}),o.SearchInterface=o.SearchInterface||{},o.SearchInterface.initOptions=o;var s=new t.SearchInterface(n,o.SearchInterface,o.Analytics),r=e.$.extend({},{options:o},s.getBindings());i.automaticallyCreateComponentsInside(n,r)},i.initExternalComponents=function(t,n){if(n&&n.externalComponents){var o=e.$(t).coveo(e.Ui.SearchInterface),s=e.$(t).coveo(e.Models.QueryStateModel),r=e.$(t).coveo(e.Models.ComponentStateModel),a=e.$(t).coveo(e.Controllers.QueryController),l=e.$(t).coveo(e.Models.ComponentOptionsModel),u=o.usageAnalytics;e.Assert.exists(o),e.Assert.exists(s),e.Assert.exists(a),e.Assert.exists(r),e.Assert.exists(u);var c={options:n,searchInterface:o,queryStateModel:s,queryController:a,usageAnalytics:u,componentStateModel:r,componentOptionsModel:l,root:t};_.each(n.externalComponents,function(t){var n=t;n instanceof e.$&&(n=e.$(n).get(0)),e.Utils.isHtmlElement(n)&&i.automaticallyCreateComponentsInside(n,c)})}},i.automaticallyCreateComponentsInside=function(n,o,s){e.Assert.exists(n);var r=[];for(var a in i.autoCreateComponents)if(!_.contains(s,a)){var l=i.autoCreateComponents[a],u=t.Component.computeCssClassNameForType(l.ID),c=e.$(n).find("."+u);e.$(n).hasClass(u)&&(c=c.add(n)),0!=c.length&&r.push(i.createFunctionThatInitializesComponentOnElements(c,a,l,o))}_.each(r,function(e){return e()})},i.createFunctionThatInitializesComponentOnElements=function(t,n,o,s){return function(){t.each(function(t,r){var a=void 0;if(e.Utils.exists(s.options)){var l=s.options[n],u=s.options[r.id],c=s.options.initOptions?s.options.initOptions[n]:{};a=e.$.extend({},l,u,c)}var h=e.$.extend({},s,{options:a});i.createComponentOfThisClassOnElement(o.ID,r,h)})}},i.createComponentOfThisClassOnElement=function(t,n,o){e.Assert.isNonEmptyString(t),e.Assert.exists(n);var s=i.autoCreateComponents[t];e.Assert.exists(s);var r={},a={},l=void 0;return void 0!=o&&(r={queryController:o.queryController,queryStateModel:o.queryStateModel,componentStateModel:o.componentStateModel,root:o.root,searchInterface:o.searchInterface,usageAnalytics:o.usageAnalytics,componentOptionsModel:o.componentOptionsModel},a=o.options,l=o.result),i.logger.trace("Creating component of class "+t,n,a),new s(n,a,r,l)},i.registerNamedMethod=function(t,n){e.Assert.isNonEmptyString(t),e.Assert.doesNotExists(i.autoCreateComponents[t]),e.Assert.doesNotExists(i.namedMethods[t]),e.Assert.exists(n),i.namedMethods[t]=n},i.isNamedMethodRegistered=function(t){return e.Utils.exists(i.namedMethods[t])},i.dispatchNamedMethodCall=function(t,n,o){e.Assert.isNonEmptyString(t),e.Assert.exists(n);var s=i.namedMethods[t];return e.Assert.exists(s),i.logger.trace("Dispatching named method call of "+t,n,o),s.apply(null,[n].concat(o))},i.isThereASingleComponentBoundToThisElement=function(i){return e.Assert.exists(i),e.Utils.exists(t.Component.get(i))},i.dispatchMethodCallOnBoundComponent=function(i,n,o){e.Assert.isNonEmptyString(i),e.Assert.exists(n);var s=t.Component.get(n);e.Assert.exists(s);var r=s[i];return e.Utils.exists(r)?r.apply(s,o):(e.Assert.fail("No method named "+i+" exist on component "+s.type),void 0)},i.dispatchNamedMethodCallOrComponentCreation=function(t,n,o){return e.Assert.isNonEmptyString(t),e.Assert.exists(n),i.isNamedMethodRegistered(t)?i.dispatchNamedMethodCall(t,n,o):i.isComponentClassIdRegistered(t)?i.createComponentOfThisClassOnElement(t,n,o[0]):i.isThereASingleComponentBoundToThisElement(n)?i.dispatchMethodCallOnBoundComponent(t,n,o):(e.Assert.fail("No method or component named "+t+" are registered."),void 0)},i.monkeyPatchComponentMethod=function(i,n,o){e.Assert.isNonEmptyString(i),e.Assert.exists(o);var s;if(i.indexOf(".")>0){var r=i.split(".");e.Assert.check(2==r.length,"Invalid method name, correct syntax is CoveoComponent.methodName."),s=r[0],i=r[1]}var a=t.Component.get(n,s);e.Assert.exists(a),e.Assert.exists(a[i]);var l="__"+i;e.Utils.exists(a[l])||(a[l]=a[i]),a[i]=o},i.noConflict=function(){e.$=jQuery.noConflict(!0),window.$.fn.coveo=e.$.fn.coveo},i.logger=new e.Logger("JQuery"),i.autoCreateComponents={},i.namedMethods={},i}();t.CoveoJQuery=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={})),$.fn.coveo=function(){for(var e=[],t=0;t<arguments.length-0;t++)e[t]=arguments[t+0];var i;return this.each(function(t,n){var o;if(Coveo.Utils.isString(e[0])){var s=e[0];o=Coveo.Ui.CoveoJQuery.dispatchNamedMethodCallOrComponentCreation(s,n,e.slice(1))}else o=Coveo.Ui.CoveoJQuery.dispatchNamedMethodCall("get",n,e);i=i||o}),Coveo.Utils.exists(i)?i:this},Coveo.$.fn.getCursorPosition=function(){var e=this.get(0);if(e){if("selectionStart"in e)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),i=document.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-i}}},Coveo.Ui.CoveoJQuery.registerNamedMethod("options",function(e,t){Coveo.Ui.CoveoJQuery.registerDefaultOptions(e,t)}),Coveo.Ui.CoveoJQuery.registerNamedMethod("init",function(e,t){Coveo.Ui.CoveoJQuery.initializeSearchInterface(e,t)}),Coveo.Ui.CoveoJQuery.registerNamedMethod("initSearchBox",function(e,t,i){Coveo.Ui.CoveoJQuery.initializeSearchInterfaceForSearchBox(e,t,i)}),Coveo.Ui.CoveoJQuery.registerNamedMethod("patch",function(e,t,i){Coveo.Ui.CoveoJQuery.monkeyPatchComponentMethod(t,e,i)}),Coveo.Ui.CoveoJQuery.registerNamedMethod("noConflict",function(){Coveo.Ui.CoveoJQuery.noConflict()});var Coveo;!function(e){!function(t){var i=function(){function i(e,i,n,o){"undefined"==typeof n&&(n=10),"undefined"==typeof o&&(o=500),this.element=e,this.handler=i,this.distanceThreshold=n,this.timeThreshold=o,e.hasClass(t.Component.computeCssClassNameForType(t.SearchInterface.ID))?e.click(i):(this.setTouchHandlers(),this.preventMouseHandlers())}return i.prototype.setTouchHandlers=function(){var e=this;this.element.on("touchstart",function(t){return e.handleTouchStart(t)}),this.element.on("touchmove",function(t){return e.handleTouchMove(t)})},i.prototype.preventMouseHandlers=function(){this.element.on("mousedown",function(e){return e.preventDefault()}),this.element.on("mouseup",function(e){return e.preventDefault()}),this.element.on("click",function(e){return e.preventDefault()})},i.prototype.handleTouchStart=function(e){var t=this;this.reset(),this.initStartVariables(e),this.startTarget=e.target,this.startElement=this.getStartElement(),this.element.one("touchend",function(e){return t.handleTouchEnd(e)})},i.prototype.handleTouchMove=function(e){this.endX=e.originalEvent?e.originalEvent.touches[0].clientX:0,this.endY=e.originalEvent?e.originalEvent.touches[0].clientY:0,this.moved=!0},i.prototype.handleTouchEnd=function(e){this.mustCallHandler(e)&&(this.hideIOSKeyboardIfNecessary(e.target),this.isGhostClick(e)||t.MobileUtils.showClickFeedback(this.element,400),t.MobileUtils.showClickCancelingOverlay(400),e.clientX=this.startX,e.clientY=this.startY,this.handler.call(this,e))},i.prototype.isGhostClick=function(e){return e.originalEvent?!1:!0},i.prototype.initStartVariables=function(e){this.startTime=(new Date).getTime(),this.startX=e.originalEvent?e.originalEvent.touches[0].clientX:0,this.startY=e.originalEvent?e.originalEvent.touches[0].clientY:0,this.endX=this.startX,this.endY=this.startY},i.prototype.getStartElement=function(){return document.elementFromPoint(this.startX,this.startY)},i.prototype.mustCallHandler=function(e){return!this.scrolled(e)&&!this.held()},i.prototype.scrolled=function(e){var t=e.target,i=Math.abs(this.endX-this.startX),n=Math.abs(this.endY-this.startY),o=document.elementFromPoint(this.endX,this.endY);return!(this.startElement==o&&this.startTarget==t&&(!this.moved||i<this.distanceThreshold&&n<this.distanceThreshold))},i.prototype.held=function(){this.endTime=(new Date).getTime();var e=this.endTime-this.startTime;return e>=this.timeThreshold},i.prototype.reset=function(){this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.startTime=0,this.endTime=0,this.moved=!1},i.prototype.hideIOSKeyboardIfNecessary=function(i){t.Device.isMobileDevice()&&!e.$(i).is("input[type=text]")&&e.$(document.activeElement).is("input[type=text]")&&t.MobileUtils.hideIOSKeyboard(document.activeElement)},i}();t.FastClick=i,e.$.fn.fastClick=function(n){if(n){if(t.Device.isMobileDevice()){var o=e.$(this);return new i(o,n),o}return this.filter("a").data("href",this.filter("a").attr("href")).attr("href","javascript:"),this.click(n)}return t.Device.isMobileDevice()?(this.trigger("touchstart"),this.trigger("touchend")):this.click()}}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(n,o,s){"undefined"==typeof s&&(s={});var r=this;this.element=n,this.type=o,this.disabled=!1,this.bind=new t.ComponentEvents(this),e.Assert.exists(n),e.Assert.isNonEmptyString(o),i.bindComponentToElement(this.element,this),this.logger=new e.Logger(this),this.root=s.root||this.resolveRoot(),this.queryStateModel=s.queryStateModel||this.resolveQueryStateModel(),this.componentStateModel=s.componentStateModel||this.resolveComponentStateModel(),this.queryController=s.queryController||this.resolveQueryController(),this.searchInterface=s.searchInterface||this.resolveSearchInterface(),this.usageAnalytics=s.usageAnalytics||this.resolveUA(),this.componentOptionsModel=s.componentOptionsModel||this.resolveComponentOptionsModel(),this.ensureDom=_.once(function(){return r.createDom()}),null!=this.searchInterface&&this.searchInterface.attachComponent(o,this)}return i.prototype.getBindings=function(){return{root:this.root,queryStateModel:this.queryStateModel,queryController:this.queryController,searchInterface:this.searchInterface,componentStateModel:this.componentStateModel,componentOptionsModel:this.componentOptionsModel,usageAnalytics:this.usageAnalytics}},i.prototype.enable=function(){this.disabled=!1},i.prototype.disable=function(){this.disabled=!0},i.prototype.createDom=function(){},i.prototype.resolveSearchInterface=function(){return i.resolveBinding(this.element,t.SearchInterface)},i.prototype.resolveRoot=function(e){var n=i.resolveBinding(this.element,t.SearchInterface);return n?n.element:e},i.prototype.resolveQueryController=function(t){return i.resolveBinding(this.element,e.Controllers.QueryController)||t},i.prototype.resolveComponentStateModel=function(t){return i.resolveBinding(this.element,e.Models.ComponentStateModel)||t},i.prototype.resolveQueryStateModel=function(t){return i.resolveBinding(this.element,e.Models.QueryStateModel)||t},i.prototype.resolveComponentOptionsModel=function(t){return i.resolveBinding(this.element,e.Models.ComponentOptionsModel)||t},i.prototype.resolveUA=function(){var e=this.resolveSearchInterface();return e&&e.usageAnalytics?e.usageAnalytics:new t.NoopAnalyticsClient},i.prototype.resolveResult=function(){var t=e.$(this.element).closest(".CoveoResult");return e.Assert.check(1==t.length),t.get(0).CoveoResult},i.get=function(t,n,o){if(e.Assert.exists(t),e.Utils.isString(n))return t[i.computeMemberNameForType(n)];if(e.Utils.exists(n))return e.Assert.exists(n.ID),t[i.computeMemberNameForType(n.ID)];var s=i.getBoundComponentsForElement(t);return o||e.Assert.check(s.length<=1,"More than one component is bound to this element. You need to specify the component type."),s[0]},i.bindComponentToElement=function(t,n){e.Assert.exists(t),e.Assert.exists(n),e.Assert.isNonEmptyString(n.type),t[i.computeMemberNameForType(n.type)]=n,e.$(t).addClass(i.computeCssClassNameForType(n.type)),i.getBoundComponentsForElement(t).push(n)},i.bindResultToElement=function(t,i){e.Assert.exists(t),e.Assert.exists(i),e.$(t).addClass("CoveoResult"),t.CoveoResult=i},i.resolveBinding=function(t,n){e.Assert.exists(t),e.Assert.exists(n),e.Assert.exists(n.ID);var o=e.$(t).closest("."+i.computeCssClassNameForType(n.ID));return 0==o.length?void 0:o.get(0)[i.computeMemberNameForType(n.ID)]},i.computeCssClassNameForType=function(t){return e.Assert.isNonEmptyString(t),"Coveo"+t},i.computeSelectorForType=function(t){return e.Assert.isNonEmptyString(t),"."+i.computeCssClassNameForType(t)},i.computeMemberNameForType=function(t){return e.Assert.isNonEmptyString(t),"Coveo"+t},i.pointElementsToDummyForm=function(e){e.add(e.find("*")).filter("input").attr("form","coveo-dummy-form")},i.getBoundComponentsForElement=function(t){return e.Assert.exists(t),null==t.CoveoBoundComponents&&(t.CoveoBoundComponents=[]),t.CoveoBoundComponents},i}();t.Component=i,t.CoveoJQuery.registerNamedMethod("get",function(t,n){return e.Assert.exists(t),i.get(t,n)})}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(t){this.owner=t,e.Assert.exists(t)}return t.prototype.on=function(e,t,i){e.on(t,this.wrapToCallIfEnabled(i))},t.prototype.onRoot=function(t,i){this.on(e.$(this.owner.root),t,i)},t.prototype.fastClick=function(e,t){e.fastClick(this.wrapToCallIfEnabled(t))},t.prototype.trigger=function(e,t,i){this.wrapToCallIfEnabled(function(){e.trigger(t,i)})},t.prototype.wrapToCallIfEnabled=function(e){var t=this;return function(){for(var i=[],n=0;n<arguments.length-0;n++)i[n]=arguments[n+0];return t.owner.disabled?void 0:e.apply(t.owner,i)}},t}();t.ComponentEvents=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(i){function n(t){i.call(this),this.element=t,e.Assert.exists(t)}return __extends(n,i),n.prototype.loadStringFromAttribute=function(t,i){e.Assert.isNonEmptyString(t);var n=e.$(this.element).attr(t);return n||i},n.prototype.loadLocalizedStringFromAttribute=function(t,i){e.Assert.isNonEmptyString(t);var n=e.$(this.element).attr(t);return n?n.toLocaleString():i},n.prototype.loadNumberFromAttribute=function(t,i){e.Assert.isNonEmptyString(t);var n=e.Utils.parseIntIfNotUndefined(e.$(this.element).attr(t));return void 0==n?i:n},n.prototype.loadFloatFromAttribute=function(t,i){e.Assert.isNonEmptyString(t);var n=e.Utils.parseFloatIfNotUndefined(e.$(this.element).attr(t));return n||i},n.prototype.loadBooleanFromAttribute=function(t,i){e.Assert.isNonEmptyString(t);var n=e.Utils.parseBooleanIfNotUndefined(e.$(this.element).attr(t));return e.Utils.isNullOrUndefined(n)?i:n},n.prototype.loadStringArrayFromAttribute=function(t,i,n){"undefined"==typeof n&&(n=" "),e.Assert.isNonEmptyString(t);var o=e.$(this.element).attr(t);return e.Utils.isNonEmptyString(o)?o.split(n)||i:i},n.prototype.loadEnumFromAttribute=function(e,t,i){var n=this.loadStringFromAttribute(e,i);return t[n]},n.prototype.loadJsonFromAttribute=function(t,i){e.Assert.isNonEmptyString(t);var n=e.$(this.element).attr(t);if(e.Utils.isNonEmptyString(n))try{return JSON.parse(n)}catch(o){return i}return i},n.prototype.loadHtmlElementFromSelectorAttribute=function(t,i){e.Assert.isNonEmptyString(t);var n=e.$(this.element).attr(t);return e.Utils.isNonEmptyString(n)?e.$(n).get(0):i},n.prototype.loadChildHtmlElementFromSelector=function(t,i){e.Assert.isNonEmptyString(t);var n=e.$(this.element).find("*").add(this.element).filter(t).get(0);return e.Utils.exists(n)?n:i},n.prototype.loadResultTemplateFromSelectorAttribute=function(t,i){e.Assert.isNonEmptyString(t);var o=this.loadHtmlElementFromSelectorAttribute(t);return e.Utils.exists(o)?n.createResultTemplateFromElement(o):i},n.prototype.loadResultTemplateFromIdAttribute=function(i,n){e.Assert.isNonEmptyString(i);var o=this.loadStringFromAttribute(i);return e.Utils.isNonEmptyString(o)?new t.UnderscoreTemplate(t.TemplateCache.getTemplate(o)):n},n.prototype.loadChildResultTemplateFromSelector=function(t,i){e.Assert.isNonEmptyString(t);var o=e.$(this.element).find("*").add(this.element).filter(t).get(0);return e.Utils.exists(o)?n.createResultTemplateFromElement(o):i
},n.createResultTemplateFromElement=function(i){e.Assert.exists(i);var n=e.$(i).attr("type");return e.Assert.check(e.Utils.isNonEmptyString(n),"You must specify the type of template"),-1!=_.indexOf(t.UnderscoreTemplate.mimeTypes,n)?t.UnderscoreTemplate.create(i):-1!=_.indexOf(t.JsRenderTemplate.mimeTypes,n)?t.JsRenderTemplate.create(i):-1!=_.indexOf(t.HandlebarsTemplate.mimeTypes,n)?t.HandlebarsTemplate.create(i):(e.Assert.fail("Cannot guess template type from attribute: "+n),void 0)},n}(e.Options);t.ComponentOptions=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(){this.expression=new t.ExpressionBuilder,this.advancedExpression=new t.ExpressionBuilder,this.constantExpression=new t.ExpressionBuilder,this.disjunctionExpression=new t.ExpressionBuilder,this.firstResult=0,this.numberOfResults=10,this.enableDidYouMean=!1,this.enableDebug=!0,this.sortCriteria="relevancy",this.retrieveFirstSentences=!0,this.queryUid=e.QueryUtils.createGuid(),this.queryFunctions=[],this.rankingFunctions=[],this.groupByRequests=[],this.enableDuplicateFiltering=!1}return i.prototype.build=function(){var e={q:this.expression.build(),aq:this.advancedExpression.build(),cq:this.constantExpression.build(),dq:this.disjunctionExpression.build(),wildcards:this.enableWildcards,questionMarks:this.enableQuestionMarks,lowercaseOperators:this.enableLowercaseOperators,partialMatch:this.enablePartialMatch,partialMatchKeywords:this.partialMatchKeywords,partialMatchThreshold:this.partialMatchThreshold,firstResult:this.firstResult,numberOfResults:this.numberOfResults,excerptLength:this.excerptLength,filterField:this.filterField,filterFieldRange:this.filterFieldRange,parentField:this.parentField,childField:this.childField,fieldsToInclude:this.fieldsToInclude,fieldsToExclude:this.fieldsToExclude,enableDidYouMean:this.enableDidYouMean,sortCriteria:this.sortCriteria,sortField:this.sortField,queryFunctions:this.queryFunctions,rankingFunctions:this.rankingFunctions,groupBy:this.groupByRequests,retrieveFirstSentences:this.retrieveFirstSentences,timezone:this.timezone,enableDuplicateFiltering:this.enableDuplicateFiltering};return e},i.prototype.computeCompleteExpression=function(){return this.computeCompleteExpressionParts().full},i.prototype.computeCompleteExpressionParts=function(){var e=t.ExpressionBuilder.merge(this.expression,this.advancedExpression);return{full:t.ExpressionBuilder.mergeUsingOr(t.ExpressionBuilder.merge(e,this.constantExpression),this.disjunctionExpression).build(),withoutConstant:t.ExpressionBuilder.mergeUsingOr(e,this.disjunctionExpression).build(),constant:t.ExpressionBuilder.mergeUsingOr(this.constantExpression,this.disjunctionExpression).build()}},i.prototype.computeCompleteExpressionExcept=function(e){return this.computeCompleteExpressionPartsExcept(e).full},i.prototype.computeCompleteExpressionPartsExcept=function(e){var i=t.ExpressionBuilder.merge(this.expression,this.advancedExpression);return i.remove(e),{full:t.ExpressionBuilder.mergeUsingOr(t.ExpressionBuilder.merge(i,this.constantExpression),this.disjunctionExpression).build(),withoutConstant:t.ExpressionBuilder.mergeUsingOr(i,this.disjunctionExpression).build(),constant:t.ExpressionBuilder.mergeUsingOr(this.constantExpression,this.disjunctionExpression).build()}},i}();t.QueryBuilder=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(){this.parts=[],this.wrapParts=!0}return t.prototype.add=function(t){e.Assert.isNonEmptyString(t),this.parts.push(t)},t.prototype.addFieldExpression=function(t,i,n){e.Assert.isNonEmptyString(t),e.Assert.stringStartsWith(t,"@"),e.Assert.isNonEmptyString(i),e.Assert.isLargerOrEqualsThan(1,n.length),this.add(e.QueryUtils.buildFieldExpression(t,i,n))},t.prototype.addFieldNotEqualExpression=function(t,i){e.Assert.isNonEmptyString(t),e.Assert.stringStartsWith(t,"@"),e.Assert.isLargerOrEqualsThan(1,i.length),this.add(e.QueryUtils.buildFieldNotEqualExpression(t,i))},t.prototype.remove=function(t){e.Assert.isNonEmptyString(t);var i=_.indexOf(this.parts,t);-1!=i&&this.parts.splice(_.indexOf(this.parts,t),1)},t.prototype.isEmpty=function(){return 0==this.parts.length},t.prototype.build=function(){return 0==this.parts.length?void 0:1==this.parts.length?this.parts[0]:this.wrapParts?"("+this.parts.join(") (")+")":this.parts.join(" ")},t.merge=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];var n=new t;return _.each(e,function(e){n.parts=n.parts.concat(e.parts)}),n},t.mergeUsingOr=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];var n=_.filter(e,function(e){return!e.isEmpty()}),o=new t;if(1==n.length)o.parts=[].concat(n[0].parts);else if(n.length>1){var s=_.map(n,function(e){return e.build()});o.add("("+s.join(") OR (")+")")}return o},t}();t.ExpressionBuilder=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.WaitAnimation="data:image/gif;base64,R0lGODlhIAAgAKUAAAQCBISChMTCxERCROTi5KSipGRiZCwqLNTS1PTy9LSytHRydJSWlFRSVBQSFDQ2NIyKjMzKzOzq7KyqrGxqbNza3Pz6/Ly6vHx6fFxaXExKTDQyNJyenBwaHAQGBISGhMTGxOTm5KSmpGRmZCwuLNTW1PT29LS2tHR2dJyanFRWVDw6PIyOjMzOzOzu7KyurGxubNze3Pz+/Ly+vHx+fFxeXExOTBweHP///wAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCQA4ACwAAAAAIAAgAAAG/kCccEgkOgAAR3HJJFYWsuEKuRrKWonmMkHrdGZDA9IwlCgUCIt2WPB2RkMIEjKMvE6K2HoI6zhuLkIKSApCJngKLXtDJhpeKUIlSBVCMQovIGpNCQVRQiEkHQNCMh4emjMKFyZWMZpCLA8oWUIRNx2KOAcHQi4KJ4FCFhEKJUMEDxsbKgRsHXRFJXmMqXe0H8obDwMgQyCeRDLBOBKIZwhDLTQryg8Fi0IVZ78t44wvNcrdexJ3Aq57YnAAp0VGBVrwEq7JAIOFiH+vFMpIEKJCBAEnbNjQoJHjiIhrZFy4dObFmQYcNXBsAANkwRnmzpwwgIFBIgkEE8owISFGxwsQFxQKbRLjhcslMkrYY5LgAo0RFNDxOzOjAkgZCBhQGAFVQEJL8yKE8FSAK9cFlCLlxCEjxBAXF+6c67WVwgeEAmiAwWFBkzw9hgRcOsFKyAsKHF5VoBHALY4JE3qdkWClxQljQyx4ffshAANSKVJ4EnCnsBACRw0xCEAjQq8UDGjFwDMjdREZE2gwLkyAQQrAFsKuXRKBMY0XQxDAloqjxWDAayzMCBAA+ozQe8n9KmG7iIsT4BT4Rk4KgemhQgpw4PAOXhAAIfkECQkANgAsAAAAACAAIACFBAIEhIKExMLEREJE5OLkpKakZGJkLCoslJKU1NLU9PL0dHJ0tLa0VFZUNDY0HBocjIqMzMrM7OrsrK6sbGpsnJqc3Nrc/Pr8fHp8TE5MNDI0vL68XF5cBAYEhIaExMbEREZE5ObkrKqsZGZkLC4slJaU1NbU9Pb0dHZ0vLq8XFpcPDo8HB4cjI6MzM7M7O7stLK0bG5snJ6c3N7c/P78fH58////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABv5Am3BIJB4ej0NxySTOArRhBpkZ0gym5lLRcmg+wwUyNkwBALGXdjjRuFHDErI0bJwB9LUwoHE4FEIpSAxCEh1nHHpDJxxuBUIzSDNCLWcOJ1onE1GFIBoqQhcsLBdCJAAPBFYzpUMVGR6YQgleWTYrA0IfZxtWETC2NiEZxBQhbBoVSzV4ixswEwyANq/EGQ0uQy6cRDQCQxIMMOMwCUMJCNYZE4pCFuPRLmpFFzALxBGKEtAfBNxNBET8a0LDwrR2CNcsCCADRgQCrRLaoKEghIUIAhhQGMGRIwUMEfXQSAEN3riNI1BSqDFQC40N4sjBYIChRYEUJiS0VETjhMuEGS4+pJBIdAmBFDuL0DAxT4uCDwhq1LCgb9wGCyEnWigQoEaAAPnazYjpMAQnGF6lQpgkxN8SGseEvEgRbZw5Gy+6BqjQ1ESJsDRavWNr44QAaAxk2dgQYELEEBUqSBCyoZcNBRNgTBZCwwWDYDYuhJUrowK7ieM4HU5MBKKWCyIqlLClYNy0GVazEkxRooKMViGgbb4QM0JSIgkil7Bs4x0DqkJcZJ5A+HWE0nFtuIB218a+57qbPOV2GMY3zgkUF7WRggGDoe2CAAAh+QQJCQA3ACwAAAAAIAAgAIUEAgSEgoTEwsREQkSkoqTk4uRkYmQsKiyUkpTU0tS0srT08vQUEhRUUlR0cnQ0NjSMiozMysysqqzs6uxsamycmpzc2ty8urz8+vwMCgxMSkw0MjQcGhxcXlwEBgSEhoTExsSkpqTk5uRkZmQsLiyUlpTU1tS0trT09vRUVlR8fnw8OjyMjozMzsysrqzs7uxsbmycnpzc3ty8vrz8/vxMTkwcHhz///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/sCbcEgkDjabQXHJJBYQtKFh8zAMaQ5Lc7mo1GqtYYD0CAxnHI5qsR2eahoNZEh4bAjDUZoTaw9ZcA0vQgJIAkIvNgwcMH5DGA4aNQpCBWQFQhVpGihbKBdRQhMdGhRCNA8PoQMcJCJXLGxDEiMVnUImX1o3KSlCCQw2EUMvDQAOQxMjywETbhohSywc0UIyBwDZuyEUyyMOJkMJoUQ0IG4M2dkjQxYx3SMUJ45CEOoeBgLkQhgCH8sJHJ3I9qCCrC0iQDnC8CEcvYd+PlSQMMPEBAwQrywQYSGCgBMBVKgIOZLFvjY0LihwoWBly5AwR5Y4uQXDjBMtc55gQUABzQgLL2g6ooFigowWIC5kXLpkAgihRWiYGNQGRYIQFSpg8jOh5QwLGMsVuJC1QgmHjmTgbBlBRCgBJcyWCPFKFE0adW+8uOBibcAbC2JkdXFQhgKHNMJaUCBjCAoBK0/cuhGhxAxyXRVQnTFDyAKWzk61OIH2BobSKHB2vkGj5VsFkp2EZWKzZeMbKFrKMqxgxmyUEVqeCCuiZV0MayNAJcLbRRghixXsutGir4vbbU7jDE195d8bXU+AfWiV3EcFh04lmMz0xoUTJ5TSCwIAIfkECQkAOQAsAAAAACAAIACFBAIEhIKExMLEREJEpKKk5OLkZGJkJCIklJKU1NLUtLK09PL0VFJUdHJ0FBIUNDI0jIqMzMrMrKqs7OrsnJqc3NrcvLq8/Pr8XFpcfHp8DAoMTE5MbGpsHBocPDo8BAYEhIaExMbEREZEpKak5ObkZGZkJCYklJaU1NbUtLa09Pb0VFZUdHZ0NDY0jI6MzM7MrK6s7O7snJ6c3N7cvL68/P78XF5cfH58HB4c////AAAAAAAAAAAAAAAAAAAAAAAABv7AnHBIJGI2G0xxySSSCLUhC9kY1gKz5lIlKZVQQwQSMQw9Wq6FdkgrcUqUoWQjUkgfeNh6KPNy1DkRSBFCEx5nN3tDFxAGJTRCBUgFQiN4NhdaKiFRQjENJQFCNQwbnSsPIhNWJ4BCFgEjmUIVb5Q5bkIJDx4vQwsGHYmeATc3JzFDAiV2RRQPekIzAx0dOFk5CjfFASDYORWdRDWEQjQm1R0OGUMFMNw3IYpCJzjVOA3yRRcRFNsVimhU20BAxZ4JNMRpqYEAzLyHe2TAoPFiRoxZEHOoSCAhAIYHDiiIHHlihMI1Fw4AWMnyA4UTL19KxLjnwoMPLFd+GKFAQMSCAgtOzqsxIwWCEgNwZFy6JAYKoUtqoEiGsgINBQpWHcRKowLNHDUmRMCK9dueAlhhpIhAolMCGArUpqCao21UrTlipEhBNoEQFXwV0MBYQYHDGrMKf1MhIG4Kg0JQKHghbgJWqjQg5VgAF2+NFykcCrlgFrDgUXw7NX5MpMDXcVcVYFOBFdAMrq+ZkMOaYhYJrCRGB44AtcjtuL5oYQUo5IVaGGabXEDBF++LuH4LKUjh9eFGcQL4CrCSADLTV3stPAwCACH5BAkJADcALAAAAAAgACAAhQQCBISChMTCxERCRKSipOTi5GRiZCQiJJSSlNTS1LSytPTy9HRydFRSVDQyNBwaHIyKjMzKzKyqrOzq7JyanNza3Ly6vPz6/Hx6fExOTGxqbCwqLFxeXDw6PAQGBISGhMTGxERGRKSmpOTm5GRmZCQmJJSWlNTW1LS2tPT29HR2dFRWVDQ2NBweHIyOjMzOzKyurOzu7JyenNze3Ly+vPz+/Hx+fP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+wJtwSCQySCRGcckkThS14UdDggxriEJzmbLYbJUhAUkYRjIZymJrtgVskqEFaZGiMyj2EPYOpIQJSAlCC3dWekIXJm8gQhNIE0IwaAwXWxcvUYQQNiZCNRoamhoZK5GfBGtDIBQWlkIzbyNCX0IVGQ2DQikMLC5DCxQmFBIxQy8BNEsiGQpDBSsODixaNwLDwzLVNzOaRDW6NxED0tKHNyMCMhTC4XoE0iwdNu67JzDs21sg0hwwf2xiZEJUQ8YMRAgTohAQocKIBd4S3rhwQoELDSE2KNgIY6MCCxHZXGDxoKTJFgpgoOCIgkbISyEOmCzZggaIBDNGpHhJsAC+DRMqVrCQSLRJjBM8i1xQ0UhkBRobT7FBAQBACQizvk2I4FHBQYQUqlbF8ypBR5UojAkZ8bKGVBAPxAIgsWulAhqvblRQcOLTq71fbxRgUdVD4IoDHW1US0PZjQUdpaYwAAADkQuBb6RY6bjGSk0CFKAAKIQC6SU1oHrdtVHVjI14EdbgKvrViI1ZL9iNkJTI65QvhuxVEEbIC5UwMjehuFLqi5ThnqCokFdPigTeBKwUcCXB6aI3LKBAUQdhEAAh+QQJCQA4ACwAAAAAIAAgAIUEAgSEgoTEwsREQkSkoqTk4uRkYmQsLiyUkpTU0tS0srT08vR0cnQUEhRUVlQ8OjyMiozMysysqqzs6uycmpzc2ty8urz8+vx8enwMCgxMSkxsamw0NjQcGhxcXlwEBgSEhoTExsSkpqTk5uRkZmQ0MjSUlpTU1tS0trT09vR0dnRcWlw8PjyMjozMzsysrqzs7uycnpzc3ty8vrz8/vx8fnxMTkwcHhz///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCccEgkQmo1SHHJJMIEtCGlFqAMaYRRc3kJUUyFoQKpGCZIG1FqOzx9KZZhKFALSUnoGXs4o/jXOBVUJ0ILG3gxe0MXLyYUCUIwSDBCFngQF1sXMlFCKQQUEkI0AQGdASQMlKMvgEInChGZQiN+E0IIJkIyaBVDKSAaiYUKCi8zricmLksKJAJDIxsaNjZaOAkvKMUot7SdRDS+QhEONtQaVpEu28Xjii/VGg4IkEWbAsXXbC7UDBYL9sDgpIiGhDCKEiZEISBChRELwCnEcaGCBQoYVgwoZoyjBYlsLtgoUYLDAQ4ljbXTNgOkphUsTqLk8GBGiAQyRqRwWXBCxAgRIEjYmEi0CYwTPO8FiLCn4oxi3tjM6NCBhYmooyZE4KhAhkIRN6h2MGBhVjaVKFbhGOGS0RAXB8R2UOGp3YxZgRQQwkFjVg0ASmhpoHoDIQ5YLsBNKLZqhh5sAACg+MWgAQgim4ik2PaYxrZOJQA08DpEzRYaT7t6KhYQh4nIB1rvobFVAYpZI/RF+hDZQVIiMoq9YCakgrshHiIDQKDowoltUV0Ys4djBoAPNVztSZEAnIBt0EYxIF10iAUUKOIkDAIAIfkECQkAOAAsAAAAACAAIACFBAIEhIKExMLEREJEpKKk5OLkZGJkJCIklJKU1NLUtLK09PL0VFJUdHJ0HBocNDI0jIqMzMrMTEpMrKqs7OrsbGpsnJqc3NrcvLq8/Pr8DAoMXFpcfHp8PDo8BAYEhIaExMbEREZEpKak5ObkZGZkLCoslJaU1NbUtLa09Pb0HB4cNDY0jI6MzM7MTE5MrK6s7O7sbG5snJ6c3N7cvL68/P78XF5cfH58////AAAAAAAAAAAAAAAAAAAAAAAAAAAABv5AnHBIJBIsJkJxySQuWrWhwmR5DWsKSnOZSaCyQ5rFQhvObgFUZmtWKF6tYYKaGE7Qtwh72HIr1jgzSAVCCwE3Nwp7VwIvKDOFJjILQiBoFoBMGTNRQikYCmU4NWOdJjcQMFcYKUQnChGZMG6qOBMTQgVohJ4WJLiFbi80rUIzChdLNAF6QhQ3JCQVWjgJjm4o1DgUnUQ1kEInMRXSBiJDMC1fbsmLOBjR0jLtRJsCbiOLJ9EQAplNMDgtqoGBl7uDbFAIiHBhxIJuCO2JYBFjg58XfjBAZJPBgAsXEkC6YPBmnSMaG7dkiMFApISQNEAkmDEiRcqBFPqY4GAAocNPgCduFqmBIA7HCzTcaNsC4sEDBgRqXaEQwY8CcItedHC6ooGATtZKopA6ImUGFHJCPFjh9IOndTQyXVBwwlMxCA5MDKFgY+2KfOEUQNlLS0iJEuEcOBAwJEWAB3qHbCKS4ouoGh48AArhoARWHC+KMamR9KqQCwAA1MVBQPEASgOrKlAj5EVqKzhgqFBsQCiRY2+M4oCQ2q2QGIodyFiU4cQXbTZS2xgCwoGKD6L3pEjQrUPqFVduAP45RIUGDSoOBgEAIfkECQkAOQAsAAAAACAAIACFBAIEhIKExMLEREJEpKKk5OLkZGZkJCYklJKU1NLUtLK09PL0dHZ0FBIUVFJUNDY0jIqMzMrMrKqs7OrsbG5snJqc3NrcvLq8/Pr8XFpcDAoMLC4sfH58HBocPD48BAYEhIaExMbETE5MpKak5ObkbGpslJaU1NbUtLa09Pb0fHp8VFZUPDo8jI6MzM7MrK6s7O7sdHJ0nJ6c3N7cvL68/P78XF5cNDI0HB4c////AAAAAAAAAAAAAAAAAAAAAAAABv7AnHBIJKIUClRxySQuXLWhACkY1miw5hKTOE6GLsUrMSxUKiGMdjhDvlxDS9IyvJgqptMajFSocyRiXzkpZyZVe0I1Ai8oM0ILSClCCSYyL39MGDNRQikXCjSKR50SFTKTimlEJwoRmTBIWTk0ojkTdyRDGBIcF0ORYjSpOW10RREVekIwCBwcAbMJjUgog7edRDW6QhYQ0M9KzC5HSMeJIc8BAS8FWzNTCtxrM9AVLsRNMJyJi9eJAPegEBDBAokF2QLmwFAgAooKIGL0edHnQsI1GFQY2MixhJhyjWhc1IIhAAUDJVCipBEiwQwSKUb2g5HgAoEWKhTq1HdCZr+RGjKWkbRAA8m/Ji5EiCghYZaVCRH6KHgE8IJSpSAidJr2EYVTP1ts5bCQ4aoIBJ7K0cjUAkBOQqkq3CAwZAIFEQMcXGsFpQ4AAHByePDQ7caDELsQiKC7i6qQGQ0AbBCCAQeOPzZuDHBXJ1+RFBv+mujWocMxCTdurPDcpIaDvx9mXWjQQVwKFoYZ+CSC4C+ADEMQlEYrhEPqGyMSpeDwAYBYCqUpgDFcgXWTAhSyiSgtwkqLeTuF3Dhw4EbAIAAh+QQJCQA2ACwAAAAAIAAgAIUEAgSEgoTEwsREQkTk4uSkoqRkYmQkIiTU0tT08vS0srSUlpRUUlR0cnQ0MjQcGhyMiozMysxMSkzs6uysqqzc2tz8+vy8urx8enxsamycnpxcXlw8PjwEBgSEhoTExsRERkTk5uSkpqRkZmQsKizU1tT09vS0trScmpxUVlR0dnQ0NjQcHhyMjozMzsxMTkzs7uysrqzc3tz8/vy8vrx8fnz///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCbcEgknhSKU3HJJCZcs6EAKRjOXInm0oI4ToYuRQwxnCARFu1Qhoy5hpVkZRiJHWVqMFKRtoXEXzYmRwpveUIzAnZ4NglIJkJsMR99TBYyUUImFwo0iEeZNAoXkIgIpUIlChGVMEgwQjSeNq4KsEIWFwsfQ45iNKhsc0WqjI0iKMm3CHZIJ4E2E5lEM7c2BBooC9q8QjAuhArDhy7JKBoCIVsyUwrqeQTaMSWVTTCYh1dZh/z8JwIRKoRIMK2fDQsTENCIsQDCnhh7LhRUM6NFgBo1LgYIIIaQHRoTtVhYoDFjRhofEMgIYSJkvgQVPijQ0MKgzSYfMNRrMoPCzLgmEyCQAABASZ4SI0bUuLBviIUTDIgSXdDvQ4akGRYgyDRCKoAHs2xc2GljRjcbMlRkMJC0QKQORFcQGLLggQdcpQq8iNErwIgMGaBhALABlQAWD8jYSMEgkoQXhg5qGMF3iAkURGSQeAAC14oVfRq8SPFOiACylgc8eKAh0goHc22ceJwBFUUDq1ncEuDAwSwTDB57cFlEw+oHI4YUcLCitZAWLx4rOGQCAuKzNV7XGILgBYMCqJmEqDFtA/MNVlBAuynkBQcOEvoFAQAh+QQJCQA3ACwAAAAAIAAgAIUEAgSEgoTEwsREQkSkoqTk4uQkIiRkYmSUkpTU0tS0srT08vQUEhQ0MjR0cnRUVlSMiozMysysqqzs6uycmpzc2ty8urz8+vw8OjwMCgxMSkxsamwcGhx8fnwEBgSEhoTExsSkpqTk5uQsLixkZmSUlpTU1tS0trT09vQ0NjR0dnRcWlyMjozMzsysrqzs7uycnpzc3ty8vrz8/vw8PjxMTkwcHhz///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/sCbcEgknhSKU3HJJC5as6EAKRjOWovm8pI4ToYthSsxnCATF+0whnS1hpVkZRhxHWNqMFKRvonEXzcoRwpveUIzAnZ4NwtIKEJsLiB9TBcxUUIoFgoyiEeZMgoWkIgxlTcmChGVL0gvQjKeN64KsEIXEQomQ45iMqU3bHNFqoyCokhZNwl2SCeBNxOZRDO30oR2ZEIvLYQKxIdxzy3XQ5dTCiKHZpOYeS/veTMVwYf3eQwNKwESCfb4LsRrIcMFDA8AEio0AFDLjBAUIkqkgFAhAA8jUKmZIQFGCQolPlIwQIMEixMFqOG7MWNBAROKQqyc2STCB41MZlgokGdCzAkaHDjMUlOhQwcEIJadk3HARlAbBPC1CNCBqgQTmVQE5cBgRIQhMlTiMnSjAISqVRUIKeCUg4Z1QkI0KIGrlAISFoa8oGA0wDUIHDYEi5CiAa8bG0gIEUFiw+EbFxR0GNpI5hARNFKsQFSjRqYAJBxEu9EC5xAUDwpLWFtDA88bAkiQCNAwp4oGDVIsA9H5a6PEJCiIZSIhd4MOQyS0Xi0EhmwSlJugoIChge8bLFojGGJiwwY++ESwoKZCQw0HViSMpnnjwIMHB/AFAQAh+QQJCQA2ACwAAAAAIAAgAIUEAgSEgoTEwsRERkSkoqTk4uQkIiRkZmSUkpTU0tS0srT08vQUEhR0dnRUVlQ0MjSMiozMysysqqzs6uycmpzc2ty8urz8+vwMCgxMTkxsbmwcGhx8fnw8OjwEBgSEhoTExsSkpqTk5uQsKixsamyUlpTU1tS0trT09vR8enxcXlw0NjSMjozMzsysrqzs7uycnpzc3ty8vrz8/vxUUlQcHhz///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCbcEgknhSKU3HJJC5as6EAKRjOWovm8pI4ToYthSsxnCATF+0whnS1hpVkZRhxHWNqMFKRtonEXzYoRwpveUIzAnZ4NgtIKEJsLiB9TAssUUIoFgoyiEeZMgoWkIgxlTYNABmlNmYKL0IynjYvSLFCFxEKJnAAvyOMNmxzRSYKwiiiSFk2JL+/GLSumUQzuK6EdmQ2iSoY0CyHQnFIJy3YQy8UK79KeWaTMdVNCR/0TTMVzeP9aiMDSLDgharfhQUiKrQQcKLGhocQVxTUMoOTizZIHELcUGPAxHwyCO05sYJGgxIy5vmzgmJCjBYgLKycuSQBAnxMZoAIpOUFvgEHDx6AOFSAAoUQCVohEtBgRdAVLvqZMFqCggWVNj4EDTqAmw0QOC/0EjIBBgwKVav46fBghQqeLjIQyFVKAIehmlwYhcGvxAMOlVpkyMCIAweyHAIUs3FBBgW8eYmIcJBBQy4SJPqU4AAhnYmPlwcrIHvgQKAIhkuALjLjw2AazVqU5obiQwAOEnAuUTA4A4QhFkrLFCIhMYcIhy4QoJHBK4UDJGCsCRBAxuoiEyhUg1D6d64T6Wg2wJyiXxAAIfkECQkANwAsAAAAACAAIACFBAIEhIKExMLEREJE5OLkpKKkZGJkJCIk1NLU9PL0tLK0lJKUVFJUdHJ0NDI0HBoczMrM7OrsrKqsbGps3Nrc/Pr8vLq8nJqcXFpcjI6MTEpMLCosfHp8PDo8BAYEhIaExMbE5ObkpKakZGZk1NbU9Pb0tLa0lJaUVFZUNDY0HB4czM7M7O7srK6sbG5s3N7c/P78vL68nJ6cXF5cTE5MLC4sfH58////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABv7Am3BIJJoUClNxySSSDLChACkYwlaJ5pLVAACUwpWihRhGkIiKdnjyAlBDSpIyhLSOr/Vw5vVEhCFIIUIlRworekMlKV4ZhEglQi9IMVFNCSeWNwQPADVCMEiWMUlqoC+mQjYPBllCAl4QQjExQixJLEMVEAokQy8qDw8DeUIXAAFLJArFNyWkd64cwsIbtbOaVrlCEYZoQyAuwcIniUJySCYr20QJMjTC12tnLSAv2UwkC/hMMBSu5gKuGYCBwwULFCIJBJUgBIUVAkykSOGAYkUaqfTAsIBkTMcODhzUoNgBQ8Y1MKbcQXKHxogPEkCE4JcIRokIL1aAkLew58IQEgVO9iPB7lKLCRpoINJzRkEMCidhQPhAIykNCwEndYQwU8iJqlVn+BKSZgmMZiwsrFRQ5kYEBkkb/BFiYYQCQqZWXFh6o4KAlQpvFKCRIRWJESMICFmwgNuFE4NAiRlLCOuQEA1eCqkQIIClFhdkANwkVJeNEROusbBhYxuCCxcklDZ7YgJqhSQC2KDj7PEFEzSLxEA84oIUGwGqzHoso+2aCgps877RQneLy6EhzN4iQdMF5MZBgRjtM0NnR+aCAAA7",e}();e.Images=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){!function(i){function n(e,t,i,l,h,d){"undefined"==typeof d&&(d=0),e.appendTo(i),h.verticalOffset=h.verticalOffset?h.verticalOffset:0,h.horizontalOffset=h.horizontalOffset?h.horizontalOffset:0;var p=t.offset();s(p,e,t,h),r(p,e,t,h),o(e.offset(),p,e,h);var f=u(e),m=u(l);if(2>d){var v=c(f,m);if("ok"!=v.vertical||"ok"!=v.horizontal){var g=a(h,v);n(e,t,i,l,g,d+1)}}}function o(e,t,i,n){var o=i.position();i.css({position:"absolute",top:o.top+n.verticalOffset-(e.top-t.top)+"px",left:o.left+n.horizontalOffset-(e.left-t.left)+"px"})}function s(e,t,i,n){switch(n.vertical){case 0:e.top-=t.outerHeight();break;case 2:e.top+=i.outerHeight();break;case 1:e.top-=t.outerHeight()/3;case 3:break;case 4:e.top-=t.outerHeight()-i.outerHeight()}}function r(e,t,i,n){switch(n.horizontal){case 0:e.left-=t.outerWidth();break;case 2:e.left+=i.outerWidth();break;case 1:e.left+=l(t,i);break;case 3:break;case 4:e.left-=t.outerWidth()-i.outerWidth()}}function a(e,t){var i=e;return"left"==t.horizontal&&(i.horizontal=2),"right"==t.horizontal&&(i.horizontal=0),"top"==t.vertical&&(i.vertical=2),"bottom"==t.vertical&&(i.vertical=0),i}function l(e,t){return(t.outerWidth()-e.outerWidth())/2}function u(e){var t=e.offset();return{top:t.top,left:t.left,right:t.left+e.outerWidth(),bottom:t.top+e.outerHeight()}}function c(e,t){var i={vertical:"ok",horizontal:"ok"};return e.top<t.top&&(i.vertical="top"),e.bottom>t.bottom&&(i.vertical="bottom"),e.left<t.left&&(i.horizontal="left"),e.right>t.right&&(i.horizontal="right"),i}function h(e,t){return"<span class='coveo-close-button'><span class='coveo-icon coveo-sprites-quickView-close'></span>"+e+"</span><span class='coveo-pop-up-reminder' >"+t+"</span>"}function d(){var t="coveo-loading-dot";return e.$("<div class='coveo-first-loading-animation' ><div class='coveo-logo' ></div><div class='coveo-loading-container'><div class='"+t+"' ></div><div class='"+t+"' ></div><div class='"+t+"' ></div><div class='"+t+"' ></div></div></div>")}function p(){var t="coveo-loading-dot";return e.$("<div class='coveo-generic-loading-animation coveo-loading-animation'><div class='coveo-loading-container'><div class='"+t+"' ></div><div class='"+t+"' ></div><div class='"+t+"' ></div><div class='"+t+"' ></div></div></div>")}function f(n,o){"undefined"==typeof o&&(o=!1);var s="."+t.Component.computeCssClassNameForType(t.SearchInterface.ID);e.$(s+",.coveo-glass").addClass("coveo-"+n),e.$(".coveo-glass").addClass("coveo-active-glass"),o&&"Android"==t.Device.getDeviceName()&&e.$(document).on("backbutton",e.$.proxy(i.removeToggleClassOnSearchInterface,this,!0))}function m(i){"undefined"==typeof i&&(i=!1);var n="."+t.Component.computeCssClassNameForType(t.SearchInterface.ID);e.$(n+",.coveo-glass").removeClass("coveo-slide-right").removeClass("coveo-slide-left").removeClass("coveo-active-glass"),e.$(".coveo-tab-section").removeClass("coveo-opened-by-current-tab"),e.$("."+t.Component.computeCssClassNameForType(t.CurrentTab.ID)).removeClass("coveo-opening-tab-section"),i&&"Android"==t.Device.getDeviceName()&&e.$(document).off("backbutton")}function v(t,i){var n=new RegExp(e.Utils.escapeRegexCharacter(i),"i"),o=t.search(n),s=o+i.length;return e.StringUtils.htmlEncode(t.slice(0,o))+"<span class='coveo-highlight'>"+e.StringUtils.htmlEncode(t.slice(o,s))+"</span>"+e.StringUtils.htmlEncode(t.slice(s))}function g(t){for(var i=e.$(t);!i.is(document)&&0!=i.length;){if(y(i))return i.is("body")?e.$(window).get(0):i.get(0);i=i.parent()}return e.$(window).get(0)}function y(e){return"scroll"==e.css("overflow-y")}function C(t){var i=e.$("<div>").html(t);return 1==i.children().length?i.children().get(0):i.get(0)}!function(e){e[e.top=0]="top",e[e.middle=1]="middle",e[e.bottom=2]="bottom",e[e.innerTop=3]="innerTop",e[e.innerBottom=4]="innerBottom"}(i.VerticalAlignment||(i.VerticalAlignment={}));i.VerticalAlignment;!function(e){e[e.left=0]="left",e[e.center=1]="center",e[e.right=2]="right",e[e.innerLeft=3]="innerLeft",e[e.innerRight=4]="innerRight"}(i.HorizontalAlignment||(i.HorizontalAlignment={}));i.HorizontalAlignment;i.positionPopup=n,i.getPopUpCloseButton=h,i.getBasicLoadingAnimation=d,i.getBasicLoadingDots=p,i.addToggleClassOnSearchInterface=f,i.removeToggleClassOnSearchInterface=m,i.highlightElement=v,i.findScrollingParent=g,e.$.fn.fastToggle=function(e){return this.css("display",e?"":"none")},i.htmlToDom=C}(t.JQueryUtils||(t.JQueryUtils={}));t.JQueryUtils}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){!function(e){function t(){var e=navigator.userAgent;return e.match(/Android/i)?"Android":e.match(/BlackBerry/i)?"BlackBerry":e.match(/iPhone/i)?"iPhone":e.match(/iPad/i)?"iPad":e.match(/iPod/i)?"iPod":e.match(/Opera Mini/i)?"Opera Mini":e.match(/IEMobile/i)?"IE Mobile":e.match(/Chrome/i)?"Chrome":e.match(/MSIE/i)||e.match(/Trident/i)?"IE":e.match(/Opera/i)?"Opera":e.match(/Firefox/i)?"Firefox":e.match(/Safari/i)?"Safari":"Others"}function i(){return"Android"==t()}function n(){var e=t();return"iPhone"==e||"iPad"==e||"iPod"==e}function o(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("msie")?!1:parseInt(e.split("msie")[1])<10}function s(){return u}function r(){return c}function a(){return screen.width<=480}function l(){return screen.height<=640}var u=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),c=/^file:\/\/\/.*_asset/i.test(document.URL)||/^file:\/\/\/.*var\/mobile/i.test(document.URL);e.getDeviceName=t,e.isAndroid=i,e.isIos=n,e.isIE8or9=o,e.isMobileDevice=s,e.isPhonegap=r,e.isSmallScreenWidth=a,e.isSmallScreenHeight=l}(e.Device||(e.Device={}));e.Device}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){!function(e){function t(e){"undefined"==typeof e&&(e=navigator);var t;return t=-1!=e.appVersion.indexOf("Win")?0:-1!=e.appVersion.indexOf("Mac")?1:-1!=e.appVersion.indexOf("X11")?2:-1!=e.appVersion.indexOf("Linux")?3:4}!function(e){e[e.WINDOWS=0]="WINDOWS",e[e.MACOSX=1]="MACOSX",e[e.UNIX=2]="UNIX",e[e.LINUX=3]="LINUX",e[e.UNKNOWN=4]="UNKNOWN"}(e.NAME||(e.NAME={}));e.NAME;e.get=t}(e.OS||(e.OS={}));e.OS}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){!function(i){function n(t){return new RegExp(e.Utils.escapeRegexCharacter(t),"i")}function o(e,i){var n=[e],o=this.getRegexToUseForFacetSearch(e);return i.options.valueCaption&&_.each(_.filter(_.pairs(i.options.valueCaption),function(e){return o.test(e[1])}),function(e){n.push(e[0])}),"@sysfiletype"==i.options.field&&_.each(_.filter(_.pairs(t.TranslatedFacetValues),function(e){return o.test(e[1])}),function(e){n.push(e[0])}),n}function s(t){return t=_.map(t,function(t){return e.Utils.escapeRegexCharacter(t)}),t[0]=".*"+t[0]+".*",t.join("|")}function r(e,t,i,n){return t>e&&n>e&&t!=i}function a(t,i){if(0!=t.values.getSelected().length){var n=i.find("li").not(".coveo-selected");_.each(n,function(t){e.$(t).addClass("coveo-no-state")})}}function l(e){return void 0!=t.TranslatedFacetValues[e]?t.TranslatedFacetValues[e]:e}function u(i,n){if(!(i instanceof t.HierarchicalFacet)||n){i.logger.trace("Clipping captions");for(var o=e.$(i.element).show(),s=o.find(".coveo-caption"),r=0;r<s.length;r++)""!=s[r].style.width&&(s[r].style.width="");for(var a=o.find(".coveo-label"),l=[],r=0;r<a.length;r++){var u=a.get(r),c=e.$(u),h=c.find(".coveo-caption"),d=h.get(0),p=u.scrollWidth,f=u.clientWidth,m=d.scrollWidth,v=Math.max(0,p-f);v&&l.push({element:h,width:m,crop:v,label:c})}o.css("display","");for(var r=0;r<l.length;r++){var g=l[r],y=g.element.get(0);y.style.width=g.width-g.crop+"px";{g.element[0]}g.crop>0?g.label.attr("title",g.element.text()):g.label.attr("title",null)}}}i.getRegexToUseForFacetSearch=n,i.getValuesToUseForSearchInFacet=o,i.buildFacetSearchPattern=s,i.needAnotherFacetSearch=r,i.addNoStateCssClassToFacetValues=a,i.tryToGetTranslatedCaption=l,i.clipCaptionsToAvoidOverflowingTheirContainer=u}(t.FacetUtils||(t.FacetUtils={}));t.FacetUtils}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){!function(t){function i(i,n){e.$(i).fastClick(function(e){e.preventDefault(),n&&n.indexOf("javascript:")<0&&t.openInPhonegap(n)})}function n(e){window.open(e,"_system","location=yes")}t.bindOpenLinkInPhonegap=i,t.openInPhonegap=n}(t.PhonegapUtils||(t.PhonegapUtils={}));t.PhonegapUtils}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){!function(i){function n(e){u.addClass("active"),setTimeout(function(){u.removeClass("active")},e)}function o(e,t){e.addClass("coveo-clicked"),setTimeout(function(){e.removeClass("coveo-clicked")},t)}function s(){e.$("."+t.Component.computeCssClassNameForType(t.SearchInterface.ID)).append(u)}function r(t){e.$(window).focus(),e.$(t).blur()}function a(){e.$(window).on("touchstart",function(t){!e.$(t.target).is("input")&&e.$(document.activeElement).is("input")&&i.hideIOSKeyboard(document.activeElement)})}function l(){e.Ui.Device.isMobileDevice()&&(e.$(function(){return s()}),a())}var u=e.$(document.createElement("div")).addClass("coveo-click-canceling-overlay");i.showClickCancelingOverlay=n,i.showClickFeedback=o,i.hideIOSKeyboard=r,l()}(t.MobileUtils||(t.MobileUtils={}));t.MobileUtils}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(i,n,o){this.searchInterface=i,this.result=o,this.element=n.instantiateToElement(o),e.$(this.element).data("CoveoResult",o),t.Component.bindResultToElement(this.element,o)}return i.prototype.initialize=function(){var i=this.searchInterface.options,n=e.$.extend({},{options:i},this.searchInterface.getBindings(),{result:this.result});t.CoveoJQuery.automaticallyCreateComponentsInside(this.element,n)},i}();t.StandaloneResult=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(t){function i(i,n,o,s){var r=this;t.call(this,i,n,s),this.eventNameSpace=n,this.defaultAttributes=e.$.extend(!0,{},this.defaultAttributes,o),this.attributes=o,this.logger.debug("Creating model"),this.bind.onRoot(e.Events.InitializationEvents.afterComponentsInitialization,function(){r.setMultiple({})})}return __extends(i,t),i.prototype.set=function(e,t,i){var n={};n[e]=t,this.setMultiple(n,i)},i.prototype.setMultiple=function(e,t){var i=this,n=!1;this.preprocessEvent(e),_.each(e,function(e,o){t&&t.customAttribute||i.checkIfAttributeExists(o),e=i.parseToCorrectType(o,e),(!t||t.validateType)&&i.validateType(o,e),(i.checkIfAttributeChanged(o,e)||(t?t.silent===!1:!1))&&(i.attributes[o]=e,n=!0,null!=t&&t.silent||i.attributeHasChangedEvent(o))}),!n||null!=t&&t.silent||(this.attributesHasChangedEvent(),this.anyEvent())},i.prototype.setNewDefault=function(e,t,i){i&&i.customAttribute||this.checkIfAttributeExists(e),this.defaultAttributes[e]=t},i.prototype.setDefault=function(e){this.set(e,this.defaultAttributes[e])},i.prototype.get=function(e){return void 0==e?this.attributes:this.attributes[e]},i.prototype.getDefault=function(e){return void 0==e?this.defaultAttributes:this.defaultAttributes[e]},i.prototype.reset=function(){this.setMultiple(this.defaultAttributes),this.modelWasResetEvent()},i.prototype.registerNewAttribute=function(e,t){this.defaultAttributes[e]=t,this.attributes[e]=t},i.prototype.getEventName=function(e){return this.eventNameSpace+":"+e},i.prototype.attributesHasChangedEvent=function(){e.$(this.element).trigger(this.getEventName(i.eventTypes.change),this.createAttributesChangedArgument())},i.prototype.attributeHasChangedEvent=function(t){e.$(this.element).trigger(this.getEventName(i.eventTypes.changeOne)+t,this.createAttributeChangedArgument(t))},i.prototype.preprocessEvent=function(t){e.$(this.element).trigger(this.getEventName(i.eventTypes.preprocess),t)},i.prototype.modelWasResetEvent=function(){e.$(this.element).trigger(this.getEventName(i.eventTypes.reset),this.createModelChangedArgument())},i.prototype.anyEvent=function(){e.$(this.element).trigger(this.getEventName(i.eventTypes.all),this.createModelChangedArgument())},i.prototype.createAttributeChangedArgument=function(e){return{attribute:e,value:this.attributes[e]}},i.prototype.createAttributesChangedArgument=function(){return{attributes:this.attributes}},i.prototype.createModelChangedArgument=function(){return{model:this}},i.prototype.checkIfAttributeExists=function(t){e.Assert.check(_.has(this.attributes,t))},i.prototype.validateType=function(t,i){e.Utils.isNullOrUndefined(this.attributes[t])||e.Utils.isUndefined(i)||(e.Utils.isNumber(this.attributes[t])?e.Assert.check(e.Utils.isNumber(i)&&!isNaN(i),"Non-matching type"):e.Utils.isBoolean(this.attributes[t])?e.Assert.check(e.Utils.isBoolean(i)||void 0!==e.Utils.parseBooleanIfNotUndefined(i),"Non-matching type"):e.Utils.isNullOrUndefined(this.defaultAttributes[t])||e.Assert.check(typeof i==typeof this.defaultAttributes[t],"Non-matching type"))},i.prototype.parseToCorrectType=function(t,i){return e.Utils.isNumber(this.attributes[t])?parseInt(i,10):e.Utils.isBoolean(this.attributes[t])?e.Utils.isBoolean(i)?i:e.Utils.parseBooleanIfNotUndefined(i):i},i.prototype.checkIfAttributeChanged=function(t,i){var n=this.attributes[t];return e.Utils.isNumber(n)||e.Utils.isString(n)||e.Utils.isBoolean(n)?n!==i:e.Utils.isArray(n)?!e.Utils.arrayEqual(n,i):e.Utils.isObject(n)?!e.Utils.objectEqual(n,i):!0},i.eventTypes={preprocess:"preprocess",changeOne:"change:",change:"change",reset:"reset",all:"all"},i}(e.Ui.Component);t.Model=i}(e.Models||(e.Models={}));e.Models}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(t){function i(e,n,o){var s=_.extend({},i.defaultAttributes,n);t.call(this,e,i.ID,s,o)}return __extends(i,t),i.getFacetId=function(e,t){return"undefined"==typeof t&&(t=!0),"f:"+e+(t?"":":not")},i.getFacetOperator=function(e){return"f:"+e+":operator"},i.getFacetLookupValue=function(e){return i.getFacetId(e)+":lookupvalues"},i.prototype.set=function(e,i,n){this.validate(e,i),t.prototype.set.call(this,e,i,n)},i.prototype.validate=function(t,n){t==i.attributesEnum.first&&e.Assert.isLargerOrEqualsThan(0,n)},i.prototype.getAttributes=function(){var t=this,i={};return _.each(this.queryStateModel.attributes,function(n,o){_.isObject(n)?e.Utils.objectEqual(n,t.queryStateModel.defaultAttributes[o])||(i[o]=n):n!=t.queryStateModel.defaultAttributes[o]&&(i[o]=n)}),i},i.ID="state",i.defaultAttributes={q:"",first:0,t:"",hd:"",hq:"",sort:"",tg:""},i.attributesEnum={q:"q",first:"first",t:"t",sort:"sort",hd:"hd",hq:"hq",tg:"tg"},i}(t.Model);t.QueryStateModel=i,e.Ui.CoveoJQuery.registerNamedMethod("state",function(t){for(var n=[],o=0;o<arguments.length-1;o++)n[o]=arguments[o+1];e.Assert.exists(t);var s=e.Ui.Component.resolveBinding(t,i);if(e.Assert.exists(s),0==n.length)return s;if(1==n.length&&e.Utils.isNonEmptyString(n[0]))return s.get(n[0]);if(e.Utils.isObject(n[0])){var r=n[0],a=e.$.extend({customAttribute:!0},n[1]);return s.setMultiple(r,a)}if(n.length>1){var l=n[0],u=n[1],a=e.$.extend({customAttribute:!0},n[2]);return e.Assert.isNonEmptyString(l),s.set(l,u,a)}})}(e.Models||(e.Models={}));e.Models}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(e){function t(i){e.call(this,i,t.ID,{})}return __extends(t,e),t.prototype.registerComponent=function(e,t){var i=this.attributes[e];void 0==i?this.attributes[e]=[t]:this.attributes[e].push(t)},t.ID="ComponentState",t}(e.Model);e.ComponentStateModel=t}(e.Models||(e.Models={}));e.Models}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(e){function t(i,n){var o=_.extend({},t.defaultAttributes,n);e.call(this,i,t.ID,o)}return __extends(t,e),t.ID="ComponentOptions",t.defaultAttributes={resultLink:void 0},t.attributesEnum={resultLink:"resultLink"},t}(e.Model);e.ComponentOptionsModel=t}(e.Models||(e.Models={}));e.Models}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(t){function i(n,o,s,r){var a=this;t.call(this,n,i.ID),this._window=o,this.queryStateModel=s,this.queryController=r,this.ignoreNextHashChange=!1,this.initialHashChange=!1,this.willUpdateHash=!1,this._window=this._window||window,this.queryStateModel=s||this.resolveQueryStateModel(),this.queryController=r||this.resolveQueryController(),e.Assert.exists(this.queryStateModel),e.Assert.exists(this.queryController),e.$(this.element).on(e.Events.InitializationEvents.restoreHistoryState,function(){return a.updateModelFromHash()
}),e.$(this.element).on(this.queryStateModel.getEventName(e.Models.Model.eventTypes.all),function(){return a.updateHashFromModel()}),e.$(this._window).on("hashchange",e.$.proxy(this.handleHashChange,this))}return __extends(i,t),i.prototype.handleHashChange=function(){return this.ignoreNextHashChange?(this.ignoreNextHashChange=!1,void 0):(this.updateModelFromHash(),this.queryController.executeQuery(),void 0)},i.prototype.updateHashFromModel=function(){var t=this;this.willUpdateHash||(e.Defer.defer(function(){var e=t.queryStateModel.getAttributes();t.setHashValues(e),t.logger.debug("Saving state to hash",e),t.willUpdateHash=!1}),this.willUpdateHash=!0)},i.prototype.updateModelFromHash=function(){var e=this,t={};_.each(this.queryStateModel.attributes,function(i,n){var o=e.getHashValue(n);void 0==o&&(o=e.queryStateModel.defaultAttributes[n]),t[n]=o});try{this.initialHashChange=!0,this.queryStateModel.setMultiple(t)}catch(i){this.logger.error("Error while setting attribute for the query state !",i)}},i.prototype.getHashValue=function(t){return e.Assert.isNonEmptyString(t),e.HashUtils.getValue(t,e.HashUtils.getHash(this._window))},i.prototype.setHashValues=function(t){var i="#"+e.HashUtils.encodeValues(t);this.ignoreNextHashChange=this._window.location.hash!=i,this.ignoreNextHashChange&&(this.initialHashChange?(this.initialHashChange=!1,this._window.location.replace(i)):this._window.location.hash=i)},i.ID="HistoryController",i}(e.Ui.Component);t.HistoryController=i}(e.Controllers||(e.Controllers={}));e.Controllers}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function e(){this.searchAsYouType=!1}return e}(),n=function(t){function n(i,o){t.call(this,i,n.ID),this.options=o,this.searchUidCache=new e.Cache(function(){return e.QueryUtils.createGuid()}),this.showingExecutingQueryAnimation=!1,e.Assert.exists(i),e.Assert.exists(o),this.firstQuery=!0}return __extends(n,t),n.prototype.setEndpoint=function(e){this.overrideEndpoint=e,this.logger.debug("Endpoint set",e)},n.prototype.getEndpoint=function(){var t=this.overrideEndpoint||this.options.endpoint;return new e.Rest.SearchEndpointWithDefaultCallOptions(t,this.getCallOptions())},n.prototype.executeQuery=function(t){var n=this;e.ModalBox.close(!0),this.logger.debug("Executing new query",r);var t=_.extend(new i,t);if(this.cancelAnyCurrentPendingQuery(),null!=t.beforeExecuteQuery&&t.beforeExecuteQuery(),this.isStandaloneSearchBox())return this.redirectToSearchPage(),e.$.Deferred();this.showExecutingQueryAnimation();var o=e.$.Deferred();this.currentPendingQuery=o;var s=this.createQueryBuilder(t),r=s.build();if(this.firstQuery){var a=e.HashUtils.getValue("firstQueryCause",e.HashUtils.getHash());if(null!=a){var l=e.HashUtils.getValue("firstQueryMeta",e.HashUtils.getHash())||{};this.usageAnalytics.logSearchEvent(e.Ui.AnalyticsActionCauseList[a],l)}else this.usageAnalytics.logSearchEvent(e.Ui.AnalyticsActionCauseList.interfaceLoad,{})}e.$(this.element).trigger(e.Events.QueryEvents.newQuery,{deferred:o});var u=this.getEndpoint(),c=u.search(r);c.done(function(i){if(e.Assert.exists(i),n.firstQuery&&(n.firstQuery=!1),o===n.currentPendingQuery){n.logger.debug("Query results received",r,i),e.Utils.isNullOrEmptyString(i.searchId)||n.searchUidCache.push(i.searchId),e.QueryUtils.setIndexAndUidOnQueryResults(r,i,n.getSearchUid()),e.QueryUtils.setStateObjectOnQueryResults(n.queryStateModel.get(),i),e.QueryUtils.setTermsToHighlightOnQueryResults(r,i);var a={queryBuilder:s,query:r,results:i,searchAsYouType:t.searchAsYouType};n.preprocessResultsEvent(a);var l={queryBuilder:s,query:r,results:i,searchAsYouType:t.searchAsYouType,retryTheQuery:!1};if(0==i.results.length&&n.noResultEvent(l),l.retryTheQuery)n.executeQuery().done(function(e){o.resolve(e)}).fail(function(e,t){o.reject(e,t)});else{n.lastQueryBuilder=s,n.currentPendingQuery.resolve(i),n.currentPendingQuery=void 0;var u={queryBuilder:s,query:r,results:i,searchAsYouType:t.searchAsYouType};n.querySuccessEvent(u),e.Defer.defer(function(){n.deferredQuerySuccessEvent(u),n.hideExecutingQueryAnimation()})}}}),c.fail(function(e,i){if(o===n.currentPendingQuery){n.logger.error("Query triggered an error",r,i),n.currentPendingQuery.reject(i),n.currentPendingQuery=void 0;var a={queryBuilder:s,endpoint:u,query:r,error:i,searchAsYouType:t.searchAsYouType};n.queryError(a),n.hideExecutingQueryAnimation()}});var h={queryBuilder:s,query:r,deferred:o,searchAsYouType:t.searchAsYouType};return this.duringQueryEvent(h),o},n.prototype.deferExecuteQuery=function(t){var i=this;this.showExecutingQueryAnimation(),e.Defer.defer(function(){return i.executeQuery(t)})},n.prototype.fetchMore=function(t){var i=this;if(void 0!=this.currentPendingQuery)return void 0;var n=this.currentPendingQuery=e.$.Deferred(),o=new e.Ui.QueryBuilder;this.continueLastQueryBuilder(o,t);var s=o.build();n=this.getEndpoint().search(s);var r={queryBuilder:o,query:s,deferred:n,searchAsYouType:!1};return e.$(this.element).trigger(e.Events.QueryEvents.duringFetchMoreQuery,r),this.lastQueryBuilder=o,n.done(function(t){e.QueryUtils.setIndexAndUidOnQueryResults(s,t,i.getSearchUid()),e.QueryUtils.setStateObjectOnQueryResults(i.queryStateModel.get(),t),e.QueryUtils.setTermsToHighlightOnQueryResults(s,t),i.currentPendingQuery=void 0}),n},n.prototype.isStandaloneSearchBox=function(){return e.Utils.isNonEmptyString(this.options.searchPageUri)},n.prototype.newSearchUid=function(){return this.searchUid=this.searchUidCache.get(),this.searchUid},n.prototype.getSearchUid=function(){return this.searchUid},n.prototype.continueLastQueryBuilder=function(t,i){e.$.extend(t,this.lastQueryBuilder),t.firstResult=t.firstResult+t.numberOfResults,t.numberOfResults=i},n.prototype.createQueryBuilder=function(t){e.Assert.exists(t);var i=new e.Ui.QueryBuilder;i.firstResult=i.firstResult||0,i.numberOfResults=this.options.resultsPerPage,i.filterField=this.options.filterField,i.excerptLength=this.options.excerptLength,e.Utils.isNonEmptyString(this.options.hiddenExpression)&&i.advancedExpression.add(this.options.hiddenExpression),e.Utils.isNonEmptyString(this.options.timezone)&&(i.timezone=this.options.timezone);var n={queryBuilder:i,searchAsYouType:t.searchAsYouType};this.buildingQueryEvent(n);var o={queryBuilder:i,searchAsYouType:t.searchAsYouType};return this.doneBuildingQueryEvent(o),i},n.prototype.cancelAnyCurrentPendingQuery=function(){return e.Utils.exists(this.currentPendingQuery)?(this.logger.debug("Cancelling current pending query"),this.currentPendingQuery.reject(),this.currentPendingQuery=void 0,!0):!1},n.prototype.showExecutingQueryAnimation=function(){this.showingExecutingQueryAnimation||(e.$(this.root).addClass("coveo-executing-query"),this.showingExecutingQueryAnimation=!0)},n.prototype.hideExecutingQueryAnimation=function(){this.showingExecutingQueryAnimation&&(e.$(this.root).removeClass("coveo-executing-query"),this.showingExecutingQueryAnimation=!1)},n.prototype.redirectToSearchPage=function(){var t=this.queryStateModel.getAttributes(),i=this.usageAnalytics.getCurrentEventCause();null!=i&&(t.firstQueryCause=i);var n=this.usageAnalytics.getCurrentEventMeta();null!=n&&(t.firstQueryMeta=n),window.location.href=this.options.searchPageUri+"#"+e.HashUtils.encodeValues(t)},n.prototype.getCallOptions=function(){var t={options:{authentication:[]}};return e.$(this.element).trigger(e.Events.QueryEvents.buildingCallOptions,t),t.options},n.prototype.buildingQueryEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.buildingQuery,t)},n.prototype.doneBuildingQueryEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.doneBuildingQuery,t)},n.prototype.duringQueryEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.duringQuery,t)},n.prototype.querySuccessEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.querySuccess,t)},n.prototype.deferredQuerySuccessEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.deferredQuerySuccess,t)},n.prototype.queryError=function(t){e.$(this.element).trigger(e.Events.QueryEvents.queryError,t)},n.prototype.preprocessResultsEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.preprocessResults,t)},n.prototype.noResultEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.noResults,t)},n.ID="QueryController",n}(e.Ui.Component);t.QueryController=n,e.Ui.CoveoJQuery.registerNamedMethod("executeQuery",function(t){e.Assert.exists(t);var i=e.Ui.Component.resolveBinding(t,n);e.Assert.exists(i),i.executeQuery()})}(e.Controllers||(e.Controllers={}));e.Controllers}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(e){this.facet=e}return t.prototype.prepareForNewQuery=function(){this.lastGroupByRequestIndex=void 0,this.expressionToUseForFacetSearch=void 0},t.prototype.computeOurFilterExpression=function(){var t=this;e.Assert.check(this.facet.values.hasSelectedOrExcludedValues());var i=new e.Ui.ExpressionBuilder,n=this.facet.values.getSelected();n.length>0&&(this.facet.options.useAnd?_.each(n,function(e){i.addFieldExpression(t.facet.options.field,"==",[e.value])}):i.addFieldExpression(this.facet.options.field,"==",_.map(n,function(e){return e.value})));var o=this.facet.values.getExcluded();return o.length>0&&i.addFieldNotEqualExpression(this.facet.options.field,_.map(o,function(e){return e.value})),i.build()},t.prototype.putGroupByIntoQueryBuilder=function(t){e.Assert.exists(t);var i=this._createGroupByAllowedValues(),n=this._createBasicGroupByRequest(i),o=this.createGroupByQueryOverride(t);e.Utils.isNullOrUndefined(o)?(this.expressionToUseForFacetSearch=t.computeCompleteExpression(),null==this.expressionToUseForFacetSearch&&(this.expressionToUseForFacetSearch="@sysuri")):(n.queryOverride=o.withoutConstant,n.constantQueryOverride=o.constant,this.expressionToUseForFacetSearch=o.withoutConstant+(o.constant?" "+o.constant:"")),this.lastGroupByRequestIndex=t.groupByRequests.length,t.groupByRequests.push(n)},t.prototype.searchInFacet=function(e,t,i){"undefined"==typeof i&&(i=!0);var n=this.buildListFieldValuesRequest(e,t,!1);return this.createListFieldDeferer(n)},t.prototype.searchInFacetWithLookupField=function(e,t,i){"undefined"==typeof i&&(i=!0);var n=this.buildGroupByQuery(),o=n.groupBy[0];o.maximumNumberOfValues=e,o.allowedValues=_.map(t,function(e){return"*"+e+"*"});var s=this.buildSearchQueryForFacetWithLookupField(t);return null==n.aq?n.aq=s:n.aq+=" "+s,this.createSearchDeferer(n)},t.prototype.recursiveFacetSearch=function(t,i,n,o){var s=this;"undefined"==typeof o&&(o=e.$.Deferred());var r,a=e.Ui.FacetUtils.getValuesToUseForSearchInFacet(t,this.facet),l=function(r){var a=r.length;r=s.checkForFacetSearchValuesToRemove(r,t),e.Ui.FacetUtils.needAnotherFacetSearch(r.length,a,n,5)?s.recursiveFacetSearch(t,i+i,a,o):o.resolve(r)};return null==this.facet.options.lookupField&&null==this.facet.options.computedField?(r=this.facet.facetQueryController.searchInFacet(i,a,!1),r.done(l)):(r=this.facet.facetQueryController.searchInFacetWithLookupField(i,a,!1),r.done(function(e){var t=e.groupByResults.length>0?e.groupByResults[0].values:[];l(t)})),r.fail(function(e,t){o.reject(e,t)}),o.fail(function(){r.reject()}),o},t.prototype.fetchMore=function(){var e=this.buildGroupByQuery();return this.facet.values.size()>0&&e.groupBy.push(this._createBasicGroupByRequest(_.map(this.facet.values.getAll(),function(e){return e.value}))),this.createSearchDeferer(e)},t.prototype.searchInFacetToUpdateDelta=function(e){var t=this.buildGroupByQuery();return t.aq=this.computeOurFilterExpression(),_.each(e,function(e){e.waitingForDelta=!0}),t.groupBy=[this._createBasicGroupByRequest(_.map(e,function(e){return e.value}))],t.groupBy[0].completeFacetWithStandardValues=!1,this.createSearchDeferer(t)},t.prototype.createSearchDeferer=function(e){return this.facet.getEndpoint().search(e)},t.prototype.createListFieldDeferer=function(e){return this.facet.queryController.getEndpoint().listFieldValues(e)},t.prototype.buildSearchQueryForFacetWithLookupField=function(t){var i=this.facet.options.lookupField?this.facet.options.lookupField:this.facet.options.field;return"("+t.map(function(t){return e.QueryUtils.buildFieldExpression(i,"*=",["*"+t+"*"])}).join(" OR ")+")"},t.prototype.buildListFieldValuesRequest=function(e,i,n,o){"undefined"==typeof n&&(n=!0);var s={field:this.facet.options.field,ignoreAccents:n,sortCriteria:"occurrences",maximumNumberOfValues:e,queryOverride:o||this.expressionToUseForFacetSearch};return null!=i&&(s.pattern=t.makeFacetSearchPattern(i),s.patternType="RegularExpression"),s},t.prototype.buildGroupByQuery=function(e){var t=[this._createBasicGroupByRequest(e)];return{q:this.expressionToUseForFacetSearch,enableDidYouMean:!1,firstResult:0,numberOfResults:0,groupBy:t}},t.prototype._createGroupByAllowedValues=function(){var e;if(void 0!=this.facet.options.allowedValues)return this.facet.options.allowedValues;if(void 0!=this.facet.options.customSort)return this.facet.options.customSort;if(this.facet.options.useAnd||!this.facet.keepDisplayedValuesNextTime){var t=this.facet.values.getSelected();if(0==t.length)return void 0;e=this.facet.values.getSelected()}else e=this.facet.values.getAll();return _.map(e,function(e){return e.value})},t.prototype.createGroupByQueryOverride=function(e){if(!this.facet.values.hasSelectedOrExcludedValues()||this.facet.options.useAnd)return void 0;var t=_.defaults(e.computeCompleteExpressionPartsExcept(this.computeOurFilterExpression()),{withoutConstant:"@sysuri"});return t},t.prototype._createBasicGroupByRequest=function(t,i){"undefined"==typeof i&&(i=!0);var n=(this.facet.numberOfValues+(this.facet.options.enableMoreLess?1:0),{field:this.facet.options.field,maximumNumberOfValues:this.facet.numberOfValues+(this.facet.options.enableMoreLess?1:0),sortCriteria:this.facet.options.sortCriteria,injectionDepth:this.facet.options.injectionDepth,completeFacetWithStandardValues:void 0==this.facet.options.allowedValues?!0:!1});return this.facet.options.lookupField&&(n.lookupField=this.facet.options.lookupField),null!=t&&(n.allowedValues=t,n.maximumNumberOfValues=Math.max(n.maximumNumberOfValues,t.length)),i&&e.Utils.isNonEmptyString(this.facet.options.computedField)&&(n.computedFields=[{field:this.facet.options.computedField,operation:this.facet.options.computedFieldOperation}]),n},t.prototype.checkForFacetSearchValuesToRemove=function(t,i){var n=this,o=e.Ui.FacetUtils.getRegexToUseForFacetSearch(i);return _.filter(t,function(e){return o.test(n.facet.getValueCaption(e))})},t.makeFacetSearchPattern=function(t){return t=_.map(t,function(t){return e.Utils.escapeRegexCharacter(t)}),t[0]=".*"+t[0]+".*",t.join("|")},t}();t.FacetQueryController=i}(e.Controllers||(e.Controllers={}));e.Controllers}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(t){function i(i){var n=this;t.call(this,i),this.facet=i,this.facet.bind.onRoot(e.Events.QueryEvents.querySuccess,function(e,t){return n.handleQuerySuccess(e,t)})}return __extends(i,t),i.prototype.putGroupByIntoQueryBuilder=function(e){this.facet.options.slider&&this.facet.options.slider.graph&&this.putGroupByForGraphIntoQueryBuilder(e),this.facet.options.slider?this.putGroupByForSliderIntoQueryBuilder(e):t.prototype.putGroupByIntoQueryBuilder.call(this,e)},i.prototype._createBasicGroupByRequest=function(i,n){"undefined"==typeof n&&(n=!0);var o=t.prototype._createBasicGroupByRequest.call(this,null,n);return o.allowedValues=void 0,o=this.facet.options.slider&&this.facet.options.slider.graph?this.buildGroupByQueryForSlider(o):this.facet.options.slider?this.buildGroupByQueryForAutomaticRanges(o):e.Utils.isNonEmptyArray(this.facet.options.ranges)?this.buildGroupByQueryForPredefinedRanges(o):this.facet.values.hasSelectedOrExcludedValues()?this.buildGroupByQueryForSelectedAndExcludedValues(o):this.buildGroupByQueryForAutomaticRanges(o)},i.prototype._createGroupByAllowedValues=function(){return void 0},i.prototype.computeOurFilterExpression=function(i){if("undefined"==typeof i&&(i=[this.facet.startOfSlider,this.facet.endOfSlider]),this.facet.options.slider){var n=new e.Ui.ExpressionBuilder;return void 0!=i[0]&&void 0!=i[1]&&(this.facet.options.slider.excludeOuterBounds?this.addFilterExpressionWithOuterBoundsExcluded(i[0],i[1],n):this.addFilterExpressionWithOuterBoundsIncluded(i[0],i[1],n)),n.build()}return t.prototype.computeOurFilterExpression.call(this)},i.prototype.handleQuerySuccess=function(e,t){var i=this;if(this.facet.options.slider&&this.facet.options.slider.graph&&void 0==this.rangeValuesForGraphToUse){this.rangeValuesForGraphToUse=[];var n=t.results.groupByResults[this.graphGroupByQueriesIndex].values;_.each(n,function(e){var t=e.value.split("..");i.rangeValuesForGraphToUse.push({start:i.facet.options.dateField?i.getISOFormat(t[0].replace("@"," ")):parseInt(t[0],10),end:i.facet.options.dateField?i.getISOFormat(t[1].replace("@"," ")):parseInt(t[1],10)})})}},i.prototype.addFilterExpressionWithOuterBoundsIncluded=function(e,t,i){(e!=this.facet.options.slider.start||t!=this.facet.options.slider.end)&&(this.facet.options.dateField&&(e=this.getFilterDateFormat(e),t=this.getFilterDateFormat(t)),i.addFieldExpression(this.facet.options.field,"==",[e+".."+t]))},i.prototype.addFilterExpressionWithOuterBoundsExcluded=function(e,t,i){var n=this.facet.options.slider.start,o=this.facet.options.slider.end,s=e,r=t;this.facet.options.dateField?(s=this.getFilterDateFormat(e),r=this.getFilterDateFormat(t),n=this.getFilterDateFormat(n),o=this.getFilterDateFormat(o)):(s+="",r+="",n+="",o+=""),s!=n&&r==o?i.addFieldExpression(this.facet.options.field,">=",[s]):s==n&&r!=o?i.addFieldExpression(this.facet.options.field,"<=",[r]):this.addFilterExpressionWithOuterBoundsIncluded(e,t,i)},i.prototype.buildGroupByQueryForSlider=function(e){if(void 0!=this.facet.options.slider.start&&void 0!=this.facet.options.slider.end){var t=this.facet.options.slider.start,i=this.facet.options.slider.end;return(this.facet.options.dateField||this.facet.options.dateField)&&(t=this.getISOFormat(t),i=this.getISOFormat(i)),e.rangeValues=[{start:t,end:i,endInclusive:!0,label:"Slider"}],e}return this.buildGroupByQueryForAutomaticRanges(e)},i.prototype.buildGroupByQueryForAutomaticRanges=function(e){return e.generateAutomaticRanges=!0,e},i.prototype.buildGroupByQueryForPredefinedRanges=function(e){return e.rangeValues=this.facet.options.ranges,e.maximumNumberOfValues=this.facet.options.ranges.length,e},i.prototype.putGroupByForGraphIntoQueryBuilder=function(e){this.graphGroupByQueriesIndex=e.groupByRequests.length;var t=this._createBasicGroupByRequest();if(t.rangeValues){var i=t.rangeValues[0];t.rangeValues=this.createRangeValuesForGraph(i)}var n=this.computeOurFilterExpression(this.facet.getSliderBoundaryForQuery());if(void 0!=n){var o=e.computeCompleteExpressionPartsExcept(n);t.queryOverride=o.withoutConstant,t.constantQueryOverride=o.constant,void 0==t.queryOverride&&(t.queryOverride="@sysuri")}t.sortCriteria="nosort",t.maximumNumberOfValues=this.facet.options.slider.graph.steps,e.groupByRequests.push(t)},i.prototype.putGroupByForSliderIntoQueryBuilder=function(e){this.lastGroupByRequestIndex=e.groupByRequests.length;var t=this._createBasicGroupByRequest();t.maximumNumberOfValues=1,t.queryOverride="@sysuri",t.sortCriteria="nosort",t.generateAutomaticRanges=!0,t.rangeValues=void 0,e.groupByRequests.push(t)},i.prototype.createRangeValuesForGraph=function(e){return void 0==this.facet.options.slider.graph.steps&&(this.facet.options.slider.graph.steps=10),this.facet.options.dateField&&isNaN(this.facet.options.slider.start)&&(this.facet.options.slider.start=new Date(this.facet.options.slider.start).getTime()),this.facet.options.dateField&&isNaN(this.facet.options.slider.end)&&(this.facet.options.slider.end=new Date(this.facet.options.slider.end).getTime()),void 0!=this.rangeValuesForGraphToUse?this.usePrebuiltRange(e):this.buildRange(e)},i.prototype.usePrebuiltRange=function(e){return _.map(this.rangeValuesForGraphToUse,function(t){return{start:t.start,end:t.end,endInclusive:e.endInclusive,label:e.label}})},i.prototype.buildRange=function(e){var t=this,i=this.facet.options.slider.start,n=(this.facet.options.slider.end,(this.facet.options.slider.end-this.facet.options.slider.start)/this.facet.options.slider.graph.steps);return _.map(_.range(0,this.facet.options.slider.graph.steps,1),function(o){var s=i+o*n,r=i+(o+1)*n;return t.facet.options.dateField&&(s=t.getISOFormat(s),r=t.getISOFormat(r)),{endInclusive:e.endInclusive,label:e.label,start:s,end:r}})},i.prototype.buildGroupByQueryForSelectedAndExcludedValues=function(e){var t=this;return e.rangeValues=_.map(this.facet.values.getAll(),function(e){var i=e.value.split(".."),n=i[0],o=i[1];return t.facet.options.dateField&&(n=t.getISOFormat(n),o=t.getISOFormat(o)),{start:n,end:o,endInclusive:!0,label:e.lookupValue}}),e},i.prototype.getISOFormat=function(e){return e?new Date(e).toISOString():void 0},i.prototype.getFilterDateFormat=function(e){return e?this.getISOFormat(e).replace("T","@").replace(".000Z","").replace(/-/g,"/"):void 0},i}(t.FacetQueryController);t.FacetRangeQueryController=i}(e.Controllers||(e.Controllers={}));e.Controllers}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(t){function i(i){var n=this;t.call(this,i),this.facet=i,e.$(this.facet.root).on(e.Events.QueryEvents.querySuccess,function(e,t){void 0!=n.lastGroupByIndexForCountOf&&n.facet.options.useAnd&&(n.lastGroupByForCountOf=t.results.groupByResults[n.lastGroupByIndexForCountOf])}),e.$(this.facet.root).on(e.Events.QueryEvents.buildingQuery,function(){n.lastGroupByIndexForCountOf=void 0})}return __extends(i,t),i.prototype.putGroupByIntoQueryBuilder=function(e){t.prototype.putGroupByIntoQueryBuilder.call(this,e);var i=t.prototype._createBasicGroupByRequest.call(this);i.queryOverride="@sysuri",this.lastGroupByIndexForCountOf=e.groupByRequests.length,e.groupByRequests.push(i)},i}(t.FacetQueryController);t.HierarchicalFacetQueryController=i}(e.Controllers||(e.Controllers={}));e.Controllers}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.searchEvent="analyticsSearchEvent",e.documentViewEvent="analyticsDocumentViewEvent",e.customEvent="analyticsCustomEvent",e.changeAnalyticsCustomData="changeAnalyticsCustomData",e}();e.AnalyticsEvents=t}(e.Events||(e.Events={}));e.Events}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.newQuery="newQuery",e.buildingQuery="buildingQuery",e.doneBuildingQuery="doneBuildingQuery",e.duringQuery="duringQuery",e.duringFetchMoreQuery="duringFetchMoreQuery",e.querySuccess="querySuccess",e.deferredQuerySuccess="deferredQuerySuccess",e.queryError="queryError",e.preprocessResults="preprocessResults",e.noResults="noResults",e.buildingCallOptions="buildingCallOptions",e}();e.QueryEvents=t}(e.Events||(e.Events={}));e.Events}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.beforeInitialization="beforeInitialization",e.afterComponentsInitialization="afterComponentsInitialization",e.restoreHistoryState="restoreHistoryState",e.afterInitialization="afterInitialization",e}();e.InitializationEvents=t}(e.Events||(e.Events={}));e.Events}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.newResultsDisplayed="newResultsDisplayed",e.newResultDisplayed="newResultDisplayed",e}();e.ResultListEvents=t}(e.Events||(e.Events={}));e.Events}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.imageResultsLayoutComplete="imageResultsLayoutComplete",e}();e.ImageResultListEvents=t}(e.Events||(e.Events={}));e.Events}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.populateBreadcrumb="populateBreadcrumb",e.clearBreadcrumb="clearBreadcrumb",e}();e.BreadcrumbEvents=t}(e.Events||(e.Events={}));e.Events}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.populateOmniBox="populateOmniBox",e.openOmniBox="openOmniBox",e.closeOmniBox="closeOmniBox",e}();e.OmniBoxEvents=t}(e.Events||(e.Events={}));e.Events}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.enterOnSearchBox="enterOnSearchBox",e.quickViewLoaded="quickViewLoaded",e}();e.UserActionEvents=t}(e.Events||(e.Events={}));e.Events}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.startSlide="startSlide",e.duringSlide="duringSlide",e.endSlide="endSlide",e.graphValueSelected="graphValueSelected",e}();e.SliderEvents=t}(e.Events||(e.Events={}));e.Events}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(){}return e.savePreferences="savePreferences",e.exitPreferencesWithoutSave="exitPreferencesWithoutSave",e}();e.PreferencesPanelEvents=t}(e.Events||(e.Events={}));e.Events}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(i){function n(n){i.call(this,n),this.searchPageUri=this.loadStringFromAttribute("data-search-page-uri",void 0),this.enableHistory=this.loadBooleanFromAttribute("data-enable-history",!1),this.resultsPerPage=this.loadNumberFromAttribute("data-results-per-page",10),this.excerptLength=this.loadNumberFromAttribute("data-excerpt-length",200),this.hiddenExpression=this.loadStringFromAttribute("data-hidden-expression",""),this.filterField=this.loadStringFromAttribute("data-filter-field",""),this.hideUntilFirstQuery=this.loadBooleanFromAttribute("data-hide-until-first-query",!0),this.firstLoadingAnimation=this.loadHtmlElementFromSelectorAttribute("data-first-loading-animation-selector"),this.firstLoadingAnimation=this.loadChildHtmlElementFromSelector(".coveo-first-loading-animation",this.firstLoadingAnimation),this.firstLoadingAnimation=this.firstLoadingAnimation||t.JQueryUtils.getBasicLoadingAnimation().get(0),this.autoTriggerQuery=this.loadBooleanFromAttribute("data-auto-trigger-query",!0);var o=this.loadStringFromAttribute("data-endpoint","default");this.endpoint=e.Rest.SearchEndpoint.endpoints[o],this.timezone=this.loadStringFromAttribute("data-timezone",jstz.determine().name()),this.enableDebugInfo=this.loadBooleanFromAttribute("data-enable-debug-info",!0)}return __extends(n,i),n}(t.ComponentOptions);t.DefaultSearchInterfaceOptions=i;var n=function(n){function o(s,r,a,l){"undefined"==typeof l&&(l=window);var u=this;n.call(this,s,o.ID),this.element=s,this.options=r,this.analyticsOptions=a,this.options=new i(s).merge(r),e.Assert.exists(s),e.Assert.exists(this.options),this.options.hideUntilFirstQuery&&this.showAndHideFirstQueryAnimation(),this.root=s,this.usageAnalytics=this.initializeAnalytics(),this.queryStateModel=new e.Models.QueryStateModel(s),this.componentStateModel=new e.Models.ComponentStateModel(s),this.componentOptionsModel=new e.Models.ComponentOptionsModel(s),this.queryController=new e.Controllers.QueryController(s,this.options),this.searchInterface=this;var c=this.queryStateModel.getEventName(e.Models.Model.eventTypes.preprocess);if(e.$(this.element).on(c,function(e,t){return u.handlePreprocessQueryStateModel(t)}),this.options.enableHistory&&new e.Controllers.HistoryController(s,l,this.queryStateModel,this.queryController),this.options.enableDebugInfo&&setTimeout(function(){return new t.Debug(s)}),t.Device.isMobileDevice()){var h=function(){e.$("html, body").height(l.innerHeight),e.$("html, body").width(l.innerWidth),e.$("body").removeClass("coveo-portrait coveo-landscape"),setTimeout(function(){l.innerHeight>l.innerWidth?e.$("body").addClass("coveo-portrait"):e.$("body").addClass("coveo-landscape")})};e.$(l).one("orientationchange",function(){e.$(l).on("resize",h),h()}),h()}}return __extends(o,n),o.prototype.initializeAnalytics=function(){var i=this,n=t.Component.computeSelectorForType(t.Analytics.ID),o=e.$(this.element).find(n);return 1==o.length?this.initializeAnalyticsFromComponent(o.get(0)):o.length>1?new t.MultiAnalyticsClient(_.map(o,function(e){return i.initializeAnalyticsFromComponent(e)})):(o=e.$(this.element).closest(n),1==o.length?this.initializeAnalyticsFromComponent(o.get(0)):o.length>1?new t.MultiAnalyticsClient(_.map(o,function(e){return i.initializeAnalyticsFromComponent(e)})):new t.NoopAnalyticsClient)},o.prototype.initializeAnalyticsFromComponent=function(i){e.Assert.exists(i);var n=t.Component.get(i,t.Analytics,!0)||new t.Analytics(i,this.analyticsOptions,this);return n.client},o.prototype.showAndHideFirstQueryAnimation=function(){var t=this;this.displayFirstQueryWaitAnimation(),e.$(this.element).one(e.Events.QueryEvents.querySuccess,function(){_.defer(function(){return t.hideFirstQueryWaitAnimation()})}),e.$(this.element).on(e.Events.QueryEvents.queryError,function(){_.defer(function(){return t.hideFirstQueryWaitAnimation()})})},o.prototype.displayFirstQueryWaitAnimation=function(){e.$(this.options.firstLoadingAnimation).remove(),e.$(this.element).addClass("coveo-waiting-for-first-query"),e.$(this.element).append(this.options.firstLoadingAnimation)},o.prototype.hideFirstQueryWaitAnimation=function(){e.$(this.options.firstLoadingAnimation).remove(),e.$(this.element).removeClass("coveo-waiting-for-first-query")},o.prototype.handlePreprocessQueryStateModel=function(t){var i=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.tg),n=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.t);void 0!==t.tg||void 0==i?(t.tg!=i&&(t.t=t.t||e.Models.QueryStateModel.defaultAttributes.t),t.tg=this.getTabGroupId(t.tg)):t.tg=i,(void 0==t.tg||""==t.tg)&&(t.tg=this.getTabGroupId(t.tg)),void 0!==t.t||void 0==n?(t.t==n&&(t.sort=t.sort||e.Models.QueryStateModel.defaultAttributes.sort),t.t=this.getTabId(t.tg,t.t)):t.t=n,(void 0==t.t||""==t.t)&&(t.t=this.getTabId(t.tg,t.t)),void 0!==t.sort&&(t.sort=this.getSort(t.t,t.sort))},o.prototype.getTabGroupId=function(i){var n=this.searchInterface.components(t.TabGroup.ID);return i!=e.Models.QueryStateModel.defaultAttributes.tg&&_.any(n,function(e){return!e.disabled&&i==e.options.id})?i:n.length>0?n[0].options.id:e.Models.QueryStateModel.defaultAttributes.tg},o.prototype.getTabId=function(i,n){var o=this.searchInterface.components(t.Tab.ID);if(i!=e.Models.QueryStateModel.defaultAttributes.tg){var s=this.searchInterface.components(t.TabGroup.ID),r=_.find(s,function(e){return i==e.options.id});if(n!=e.Models.QueryStateModel.defaultAttributes.t&&_.any(o,function(e){return n==e.options.uniqueId&&r.isElementIncludedInTabGroup(e.element)}))return n;var a=_.find(o,function(e){return r.isElementIncludedInTabGroup(e.element)});return null!=a?a.options.uniqueId:e.Models.QueryStateModel.defaultAttributes.t}return n!=e.Models.QueryStateModel.defaultAttributes.t&&_.any(o,function(e){return n==e.options.uniqueId})?n:o.length>0?o[0].options.uniqueId:e.Models.QueryStateModel.defaultAttributes.t},o.prototype.getSort=function(i,n){var o=this.searchInterface.components(t.Sort.ID);if(i!=e.Models.QueryStateModel.defaultAttributes.t){var s=this.searchInterface.components(t.Tab.ID),r=_.find(s,function(e){return i==e.options.uniqueId}),a=r.options.sort;if(n!=e.Models.QueryStateModel.defaultAttributes.sort&&_.any(o,function(e){return r.isElementIncludedInTab(e.element)&&e.match(n)}))return n;if(null!=a)return a.toString();var l=_.find(o,function(e){return r.isElementIncludedInTab(e.element)});return null!=l?l.options.sortCriterias[0].toString():e.Models.QueryStateModel.defaultAttributes.sort}return n!=e.Models.QueryStateModel.defaultAttributes.sort&&_.any(o,function(e){return e.match(n)})?n:o.length>0?o[0].options.sortCriterias[0].toString():e.Models.QueryStateModel.defaultAttributes.sort},o.prototype.attachComponent=function(e,t){this.components(e).push(t)},o.prototype.detachComponent=function(e,t){var i=this.components(e),n=_.indexOf(i,t);n>-1&&i.splice(n,1)},o.prototype.components=function(e){return null==this.attachedComponents&&(this.attachedComponents={}),e in this.attachedComponents||(this.attachedComponents[e]=[]),this.attachedComponents[e]},o.ID="SearchInterface",o
}(t.Component);t.SearchInterface=n}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.enableSearchAsYouType=this.loadBooleanFromAttribute("data-enable-search-as-you-type",!1),this.searchAsYouTypeDelay=this.loadNumberFromAttribute("data-search-as-you-type-delay",500),this.disableQuerySyntax=this.loadBooleanFromAttribute("data-disable-query-syntax",!1),this.enableWildcards=this.loadBooleanFromAttribute("data-enable-wildcards",!1),this.enableQuestionMarks=this.loadBooleanFromAttribute("data-enable-question-marks",!1),this.enableLowercaseOperators=this.loadBooleanFromAttribute("data-enable-lowercase-operators",!1),this.enablePartialMatch=this.loadBooleanFromAttribute("data-enable-partial-match",!1),this.partialMatchKeywords=this.loadNumberFromAttribute("data-partial-match-keywords",5),this.partialMatchThreshold=this.loadStringFromAttribute("data-partial-match-threshold","50%"),this.autoFocus=this.loadBooleanFromAttribute("data-auto-focus",!0)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultQueryBoxOptions=i;var n=function(n){function o(s,r,a){var l=this;n.call(this,s,o.ID,a),this.element=s,this.options=r,this.options=new i(s).merge(r),t.Component.pointElementsToDummyForm(e.$(s)),e.$(s).change(function(e){l._handleChange(e)}),e.$(s).keyup(function(e){l._handleKeyUp(e)});var u=e.Models;e.$(this.root).on(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQuery,this)),e.$(this.root).on(e.Events.QueryEvents.newQuery,e.$.proxy(this._handleNewQuery,this));var c=this.queryStateModel.getEventName(u.Model.eventTypes.changeOne+u.QueryStateModel.attributesEnum.q);e.$(this.queryStateModel.element).on(c,e.$.proxy(this._handleQueryStateChanged,this)),this._clearElement=e.$("<span></span>").addClass("coveo-query-box-clear").hide();e.$("<span></span>").addClass("coveo-icon").appendTo(this._clearElement);if(this._clearElement.fastClick(function(){l.clear(),l._hideClearElement(),l.updateQueryState(),t.Device.isMobileDevice()||e.$(l.element).focus(),l.queryController.isStandaloneSearchBox()||l.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return l.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.searchboxClear,{})}})}),t.Device.isSmallScreenWidth()&&e.$(this.element).focus(function(){t.JQueryUtils.removeToggleClassOnSearchInterface()}),e.$(this.element).after(this._clearElement),this.options.autoFocus)try{e.$(this.element).focus()}catch(h){}}return __extends(o,n),o.prototype.clear=function(){e.$(this.element).val(""),this.updateQueryState()},o.prototype.replace=function(t,i){e.$(this.element).val(e.$(this.element).val().replace(t,i)),this.updateQueryState()},o.prototype.replaceCurrentExpression=function(e){this.replace(this.getCurrentQueryExpression(),e),this.updateQueryState()},o.prototype.clearCurrentExpression=function(){this.replace(this.getCurrentQueryExpression(),""),this.updateQueryState()},o.prototype.getCurrentQueryExpression=function(){var t=e.$(this.element).getCursorPosition(),i=e.$(this.element).val(),n=i.length,o=t,s=t;for(" "==i[o]&&o--;o>0&&" "!=i[o];)o--;for(;n>s&&" "!=i[s];)s++;return i.substring(o,s)},o.prototype.insertAt=function(t,i){var n=e.$(this.element).val(),o=[n.slice(0,t),i,n.slice(t)].join("");e.$(this.element).val(o),this.updateQueryState()},o.prototype._handleChange=function(){return this._addClearElement(),this.updateQueryState(),void 0},o.prototype._handleQueryStateChanged=function(t,i){e.Assert.exists(i);var n=i.value;e.$(this.element).val(n),this._addClearElement()},o.prototype._handleKeyUp=function(i){e.Assert.exists(i),this._addClearElement(),13==i.which?(this.logger.debug("Performing query because user pressed Enter"),this.updateQueryState(),this.enterOnSearchBox(),i.stopPropagation(),t.Device.isMobileDevice()&&e.$(this.element).blur()):this.options.enableSearchAsYouType&&e.KeyboardUtils.isAllowedKeyForOmniBox(i)&&this.startNewSearchAsYouTypeTimeout()},o.prototype._addClearElement=function(){""==e.$(this.element).val()?this._hideClearElement():this._showClearElement()},o.prototype._hideClearElement=function(){this._clearElement.hide()},o.prototype._showClearElement=function(){this._clearElement.show()},o.prototype.startNewSearchAsYouTypeTimeout=function(){var e=this;this.cancelAnyPendingSearchAsYouTypeTimeout(),this.searchAsYouTypeTimeout=setTimeout(function(){e.triggerNewQuery(function(){return e.usageAnalytics.logSearchAsYouType(t.AnalyticsActionCauseList.searchboxAsYouType,{})},!0)},this.options.searchAsYouTypeDelay)},o.prototype._handleNewQuery=function(){o.queryBoxIsAlreadyAddedToQuery=!1},o.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i),e.Assert.exists(i.queryBuilder);var n=e.$(this.element).val();this.options.enableWildcards&&(i.queryBuilder.enableWildcards=!0),this.options.enableQuestionMarks&&(i.queryBuilder.enableQuestionMarks=!0),this.options.enableLowercaseOperators&&(i.queryBuilder.enableLowercaseOperators=!0),this.options.enablePartialMatch&&(i.queryBuilder.enablePartialMatch=!0,i.queryBuilder.partialMatchKeywords=this.options.partialMatchKeywords,i.queryBuilder.partialMatchThreshold=this.options.partialMatchThreshold),e.Utils.isNonEmptyString(n)&&!o.queryBoxIsAlreadyAddedToQuery&&(this.options.disableQuerySyntax?i.queryBuilder.expression.add("<@- "+n+" -@>"):i.queryBuilder.expression.add(n),this.logger.trace("Adding query to QueryBuilder",n),o.queryBoxIsAlreadyAddedToQuery=!0)},o.prototype.enterOnSearchBox=function(){var i=this;e.$(this.element).trigger(e.Events.UserActionEvents.enterOnSearchBox),this.triggerNewQuery(function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.searchboxSubmit,{})},!1)},o.prototype.triggerNewQuery=function(e,t){this.cancelAnyPendingSearchAsYouTypeTimeout(),this.queryController.deferExecuteQuery({beforeExecuteQuery:e,searchAsYouType:t})},o.prototype.updateQueryState=function(){var t=e.$(this.element).val();this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,t)},o.prototype.cancelAnyPendingSearchAsYouTypeTimeout=function(){e.Utils.exists(this.searchAsYouTypeTimeout)&&(clearTimeout(this.searchAsYouTypeTimeout),this.searchAsYouTypeTimeout=void 0)},o.ID="QueryBox",o.queryBoxIsAlreadyAddedToQuery=!1,o}(e.Ui.Component);t.QueryBox=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.omniBoxDelay=this.loadNumberFromAttribute("data-omnibox-delay",500),this.omniBoxTimeout=this.loadNumberFromAttribute("data-omnibox-timeout",2e3),this.omniBoxChangeLimit=this.loadNumberFromAttribute("data-omnibox-change-limit",3),this.omniBoxMinimumLetters=this.loadNumberFromAttribute("data-omnibox-minimum-letters",1)}return __extends(t,e),t}(t.DefaultQueryBoxOptions);t.DefaultOmniBoxOptions=i;var n=function(n){function o(o,s,r){var a=this;n.call(this,o,s,r),this.element=o,this.options=s,this.omniBoxHeaderSearchForTemplate=_.template("<div class='coveo-omnibox-selectable coveo-omnibox-section coveo-omnibox-header'><div class='coveo-text'>"+t.l.SearchFor("<strong><%- data %></strong>")+"</div></div>"),this.omniBoxIsOpen=!1,this.isLoadingData=!1,this.options=new i(o).merge(s),e.$(o).keyup(function(e){return a._handleKeyUp(e)}),this.renderOmniBoxDiv(),this.omniBoxDiv.hide(),this.prepareThrottledCall(),e.$(this.root).fastClick(function(t){a.omniBoxIsOpen&&!e.$.contains(a.omniBoxDiv.get(0),e.$(t.target).get(0))&&a.escapeEvent()});var l=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.q);e.$(this.queryStateModel.element).on(l,e.$.proxy(this._handleQueryStateChanged,this)),e.$(window).on("resize",function(){a.omniBoxIsOpen&&a.setWidthOnOmniBoxDiv()})}return __extends(o,n),o.prototype.close=function(){e.$(this.root).trigger(e.Events.OmniBoxEvents.closeOmniBox),this.omniBoxDiv&&(this.omniBoxDiv.children().remove(),this.omniBoxDiv.hide()),this.clearLastOmniBoxRows(),e.Utils.isNullOrUndefined(this.lastOmniBoxData)||this.rejectAllPendingDeferred(this.lastOmniBoxData),this.resetOmniBoxInternalData(),this.omniBoxIsOpen=!1},o.prototype.open=function(){""!=e.$(this.element).val()&&(null==this.options.omniBoxMinimumLetters||this.options.omniBoxMinimumLetters<=e.$(this.element).val().length)?(this.renderOmniBoxHeader(),this.setWidthOnOmniBoxDiv(),this.omniBoxDiv.show(),this.throttledCallForOmniBoxBody(),this.findSelectable().first().addClass("coveo-omnibox-selected"),e.$(this.root).trigger(e.Events.OmniBoxEvents.openOmniBox)):this.escapeEvent()},o.prototype.getDataForOmniboxBody=function(){if(this.addSearchAnimation(),this.isCurrentlyBeingRendered)this.throttledCallForOmniBoxBody();else{var e=this.buildOmniBoxRequestObject(),t=this.requestOmniBoxData(e);this.processNewOmniBoxData(t)}},o.prototype.buildOmniBoxRequestObject=function(){var t=this,i=this.getCurrentQueryExpression(),n={completeQueryExpression:{word:e.$(this.element).val(),regex:this.getRegexToSearch()},currentQueryExpression:{word:i,regex:this.getRegexToSearch(i)},allQueryExpressions:this.getQueryExpressionBreakDown(),cursorPosition:e.$(this.element).getCursorPosition(),clear:function(){return t.clear()},clearCurrentExpression:function(){return t.clearCurrentExpression()},replace:function(e,i){return t.replace(e,i)},replaceCurrentExpression:function(e){return t.replaceCurrentExpression(e)},insertAt:function(e,i){return t.insertAt(e,i)},closeOmniBox:function(){return t.close()}};return n},o.prototype.prepareThrottledCall=function(){this.throttledCallForOmniBoxBody=e.Utils.throttle(this.getDataForOmniboxBody,this.options.omniBoxDelay,void 0,this)},o.prototype.requestOmniBoxData=function(t){e.Assert.exists(t),this.logger.info("Requesting omnibox data to all components");var i=e.$.extend({rows:[]},t);return e.$(this.root).trigger(e.Events.OmniBoxEvents.populateOmniBox,i),i},o.prototype.getQueryExpressionBreakDown=function(){var t=this,i=[],n=e.$(this.element).val().split(" ");return _.each(n,function(e){i.push({word:e,regex:t.getRegexToSearch(e)})}),i},o.prototype._handleNewQuery=function(e,t){n.prototype._handleNewQuery.call(this,e,t),this.omniBoxIsOpen&&e.stopPropagation()},o.prototype._handleKeyUp=function(i){var n=this;i.stopImmediatePropagation();var o=e.$(this.element).val().length;!e.Utils.isNullOrUndefined(this.lastOmniBoxData)&&!e.Utils.isNullOrUndefined(this.lastNumberOfLettersInOmniBox)&&Math.abs(o-this.lastNumberOfLettersInOmniBox)>this.options.omniBoxChangeLimit&&(this.rejectAllPendingDeferred(this.lastOmniBoxData),this.prepareThrottledCall(),this.throttledCallForOmniBoxBody=e.Utils.throttle(this.getDataForOmniboxBody,this.options.omniBoxDelay,void 0,this)),e.KeyboardUtils.keysEqual(i,27)&&this.omniBoxIsOpen?this.escapeEvent():e.KeyboardUtils.keysEqual(i,13)?this.omniBoxIsOpen?this.selectionEvent():(this.escapeEvent(),this.triggerNewQuery(function(){return n.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.searchboxSubmit,{})})):e.KeyboardUtils.isArrowKeyPushed(i.keyCode)&&this.omniBoxIsOpen?this.navigationEvent(i):e.KeyboardUtils.isAllowedKeyForOmniBox(i)&&(""==e.$(this.element).val()?this.escapeEvent():this.open())},o.prototype._handleChange=function(e){return e.stopImmediatePropagation(),!1},o.prototype.handleHover=function(e){var t=this.getCorrectTarget(e);t&&this.toggleSelected(t)},o.prototype.bindOmniBoxEvent=function(){this.bindHoverEvent()},o.prototype.bindHoverEvent=function(){var t=this;e.$(this.omniBoxDiv).find(".coveo-omnibox-selectable").hover(function(e){t.handleHover(e)})},o.prototype.escapeEvent=function(){this.clearLastOmniBoxRows(),this.close(),this.removeSearchAnimation()},o.prototype.selectionEvent=function(){var e=this;this.isFirstValueSelected(this.findSelected())?this.triggerNewQuery(function(){return e.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.omniboxSearch,{})}):this.keyBoardSelection()},o.prototype.navigationEvent=function(e){var t=this.findSelected();0==t.length?this.navigationEventWhenNoSelection(e):this.navigationEventWhenSelection(e,t)},o.prototype.navigationEventWhenNoSelection=function(t){e.KeyboardUtils.keysEqual(t,40)&&this.findSelectable().first().addClass("coveo-omnibox-selected")},o.prototype.navigationEventWhenSelection=function(e,t){if(!this.isLoadingData)switch(e.keyCode){case 38:this.isFirstValueSelected(t)||(this.unselectValueInOmnibox(t),this.selectValueBeforeAlreadySelected(t));break;case 40:this.isLastValueSelected(t)||(this.unselectValueInOmnibox(t),this.selectValueAfterAlreadySelected(t))}},o.prototype.keyBoardSelection=function(){this.logger.trace("Selecting facet value because of omnibox selection");var e=this.findSelected();e.trigger("keyboardSelect"),this.escapeEvent()},o.prototype.triggerNewQuery=function(t){this.logger.info("Triggering new query because of omnibox selection"),this.escapeEvent(),this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,e.$(this.element).val()),this.queryController.deferExecuteQuery({beforeExecuteQuery:t})},o.prototype.processNewOmniBoxData=function(e){this.logger.trace("Processing omnibox data"),this.isCurrentlyBeingRendered=!0,this.numberOfPendingQueries=0,this.renderOmniBoxBody(e),this.omniBoxIsOpen=!0},o.prototype.renderOmniBoxDiv=function(){this.omniBoxDiv=e.$("<div class='coveo-omnibox'></div>"),e.$(this.element).after(this.omniBoxDiv)},o.prototype.setWidthOnOmniBoxDiv=function(){this.omniBoxDiv.width(this.getWidth())},o.prototype.renderOmniBoxHeader=function(){var i=this;void 0!=this.omniBoxHeader&&this.omniBoxHeader.remove(),this.omniBoxHeader=e.$(this.omniBoxHeaderSearchForTemplate({data:e.$(this.element).val()})),this.omniBoxHeader.fastClick(function(){i.triggerNewQuery(function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.omniboxSearch,{})})}),this.omniBoxDiv.prepend(this.omniBoxHeader)},o.prototype.renderOmniBoxBody=function(t){var i=this;this.omniBoxRows=[],this.lastOmniBoxData=t,this.lastNumberOfLettersInOmniBox=e.$(this.element).val().length,_.each(t.rows,function(t){e.Utils.isNullOrUndefined(t.element)?e.Utils.isNullOrUndefined(t.deferred)||(i.numberOfPendingQueries++,i.renderOmniBoxForOneElementDeferred(t)):i.renderOmniBoxForOneElement(t)}),0==this.numberOfPendingQueries&&this.allDeferredHaveArrived(),setTimeout(function(){i.rejectAllPendingDeferred(t)},this.options.omniBoxTimeout)},o.prototype.rejectAllPendingDeferred=function(t){_.each(t.rows,function(t){e.Utils.isNullOrUndefined(t.deferred)||"pending"!=t.deferred.state()||t.deferred.reject()})},o.prototype.allDeferredHaveArrived=function(){this.appendOmniBoxSections(),this.resetOmniBoxInternalData(),this.removeSearchAnimation()},o.prototype.clearLastOmniBoxRows=function(){void 0!=this.lastOmniBoxRows&&_.each(this.lastOmniBoxRows,function(t){e.$(t.element).remove()})},o.prototype.appendOmniBoxSections=function(){this.clearLastOmniBoxRows(),this.omniBoxRows=_.sortBy(this.omniBoxRows,function(e){return e.zIndex}).reverse();for(var e=0;e<this.omniBoxRows.length;e++)this.omniBoxDiv.append(this.omniBoxRows[e].element);this.bindOmniBoxEvent(),this.resetOmniBoxInternalData()},o.prototype.resetOmniBoxInternalData=function(){this.lastOmniBoxRows=this.omniBoxRows,this.isCurrentlyBeingRendered=!1},o.prototype.renderOmniBoxForOneElement=function(t){var i=t.zIndex||-1;e.$(t.element).addClass("coveo-omnibox-section"),this.omniBoxRows.push({zIndex:i,element:t.element})},o.prototype.renderOmniBoxForOneElementDeferred=function(t){var i=this;t.deferred.done(function(t){i.numberOfPendingQueries--,e.Utils.isNullOrUndefined(t.element)||i.renderOmniBoxForOneElement(t),0==i.numberOfPendingQueries&&i.allDeferredHaveArrived()}),t.deferred.fail(function(){i.numberOfPendingQueries--,0==i.numberOfPendingQueries&&i.allDeferredHaveArrived()})},o.prototype.isFirstValueSelected=function(e){return e.get(0)==this.findSelectable().first().get(0)},o.prototype.isLastValueSelected=function(e){return e.get(0)==this.findSelectable().last().get(0)},o.prototype.unselectValueInOmnibox=function(e){e.removeClass("coveo-omnibox-selected")},o.prototype.selectValueBeforeAlreadySelected=function(t){e.$(this.findSelectable().get(this.findPosOfAlreadySelected(t)-1)).addClass("coveo-omnibox-selected")},o.prototype.selectValueAfterAlreadySelected=function(t){e.$(this.findSelectable().get(this.findPosOfAlreadySelected(t)+1)).addClass("coveo-omnibox-selected")},o.prototype.findPosOfAlreadySelected=function(e){var t=-1,i=this.findSelectable();return _.find(i,function(i){return t++,i==e.get(0)}),t},o.prototype.findSelectable=function(){return this.omniBoxDiv.find(".coveo-omnibox-selectable")},o.prototype.findSelected=function(){return this.findSelectable().closest(".coveo-omnibox-selected")},o.prototype.toggleSelected=function(e){this.omniBoxDiv.find(".coveo-omnibox-selected").removeClass("coveo-omnibox-selected"),e.addClass("coveo-omnibox-selected")},o.prototype.getWidth=function(){var t=e.$(this.element);return t.outerWidth()+this.getSearchButtonWidth()},o.prototype.getSearchButtonWidth=function(){var i=e.$(this.element).closest("."+t.Component.computeCssClassNameForType(t.SearchBox.ID));if(0!=i.length){var n=i.coveo(t.SearchBox);return void 0!=n.searchButton?e.$(n.searchButton.element).outerWidth():0}return 0},o.prototype.getRegexToSearch=function(t){return"undefined"==typeof t&&(t=e.$(this.element).val()),new RegExp(e.Utils.escapeRegexCharacter(t),"i")},o.prototype.getCorrectTarget=function(t){var i=e.$(t.target);return i.closest(".coveo-omnibox-selectable")},o.prototype.addSearchAnimation=function(){this._hideClearElement(),e.$(this.element).addClass("coveo-loading"),this.isLoadingData=!0},o.prototype.removeSearchAnimation=function(){e.$(this.element).removeClass("coveo-loading"),this._addClearElement(),this.isLoadingData=!1},o.ID="OmniBox",o}(e.Ui.QueryBox);t.OmniBox=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultSearchButtonOptions=i;var n=function(n){function o(s,r,a){n.call(this,s,o.ID,a),this.element=s,this.options=r,this.options=new i(s).merge(r),this.bind.fastClick(e.$(s),this.handleClick),""==e.$.trim(e.$(s).text())&&e.$("<span/>").text(t.l.Search()).addClass("coveo-icon").appendTo(s)}return __extends(o,n),o.prototype.handleClick=function(){var e=this;this.logger.debug("Performing query following button click"),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return e.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.searchboxSubmit,{})}})},o.ID="SearchButton",o}(t.Component);t.SearchButton=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.activateOmniBox=this.loadBooleanFromAttribute("data-activate-omnibox",!1),this.enableSearchAsYouType=this.loadBooleanFromAttribute("data-enable-search-as-you-type",!1),this.searchAsYouTypeDelay=this.loadNumberFromAttribute("data-search-as-you-type-delay",500),this.disableQuerySyntax=this.loadBooleanFromAttribute("data-disable-query-syntax",!1),this.enableWildcards=this.loadBooleanFromAttribute("data-enable-wildcards",!1),this.enableQuestionMarks=this.loadBooleanFromAttribute("data-enable-question-marks",!1),this.enableLowercaseOperators=this.loadBooleanFromAttribute("data-enable-lowercase-operators",!1),this.enablePartialMatch=this.loadBooleanFromAttribute("data-enable-partial-match",!1),this.partialMatchKeywords=this.loadNumberFromAttribute("data-partial-match-keywords",5),this.partialMatchThreshold=this.loadStringFromAttribute("data-partial-match-threshold","50%"),this.omniBoxDelay=this.loadNumberFromAttribute("data-omnibox-delay",500),this.autoFocus=this.loadBooleanFromAttribute("data-auto-focus",!0)}return __extends(t,e),t}(t.DefaultOmniBoxOptions);t.DefaultSearchBoxOptions=i;var n=function(n){function o(s,r,a){n.call(this,s,o.ID,a),this.element=s,this.options=r,this.options=new i(s).merge(r),this.searchButton=new t.SearchButton(e.$("<a/>").appendTo(this.element).get(0),void 0,a);var l=e.$("<div/>").appendTo(this.element),u=this.buildInputTag();u.appendTo(l),this.searchBox=this.options.activateOmniBox?new t.OmniBox(u.get(0),this.options,a):new t.QueryBox(u.get(0),this.options,a)}return __extends(o,n),o.prototype.buildInputTag=function(){var t=this;return e.$('<input type="text" autocapitalize="off" autocorrect="off" />').blur(function(i){t.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,e.$(i.target).val())})},o.ID="SearchBox",o}(e.Ui.Component);t.SearchBox=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(i){function n(n,o,s){"undefined"==typeof o&&(o=!0),"undefined"==typeof s&&(s=!0),i.call(this,n),o&&(this.resultContainer=this.loadHtmlElementFromSelectorAttribute("data-result-container-selector"),this.resultContainer=this.loadChildHtmlElementFromSelector(".result-container",this.resultContainer),this.resultContainer=this.resultContainer||e.$("<div/>").appendTo(n).get(0)),this.resultTemplate=this.loadResultTemplateFromSelectorAttribute("data-result-template-selector"),this.resultTemplate=this.loadResultTemplateFromIdAttribute("data-result-template-id",this.resultTemplate),this.resultTemplate=this.loadChildResultTemplateFromSelector(".result-template",this.resultTemplate),this.resultTemplate=this.resultTemplate||new t.DefaultResultTemplate,this.waitAnimation=this.loadStringFromAttribute("data-wait-animation","none"),this.waitAnimationContainer=this.loadHtmlElementFromSelectorAttribute("data-wait-animation-container-selector"),this.waitAnimationContainer=this.loadChildHtmlElementFromSelector(".waitAnimationContainer",this.waitAnimationContainer),this.waitAnimationContainer=this.waitAnimationContainer||this.resultContainer,this.enableInfiniteScroll=this.loadBooleanFromAttribute("data-enable-infinite-scroll",!1),this.infiniteScrollPageSize=this.loadNumberFromAttribute("data-infinite-scroll-page-size",10),this.infiniteScrollContainer=this.loadHtmlElementFromSelectorAttribute("data-infinite-scroll-container-selector"),this.infiniteScrollContainer=this.loadChildHtmlElementFromSelector(".infiniteScrollContainer",this.infiniteScrollContainer),this.infiniteScrollContainer=this.infiniteScrollContainer||t.JQueryUtils.findScrollingParent(n),this.showInfiniteScrollWaitingAnimation=this.loadBooleanFromAttribute("data-show-infinite-scroll-waiting-animation",s),t.Device.isMobileDevice()&&(this.mobileScrollContainer=this.loadHtmlElementFromSelectorAttribute("data-mobile-scroll-container",e.$(".coveo-results-column").get(0)))}return __extends(n,i),n}(t.ComponentOptions);t.DefaultResultListOptions=i;var n=function(n){function o(t,s,r,a){"undefined"==typeof a&&(a=o.ID);var l=this;n.call(this,t,a,r),this.element=t,this.options=s,this.bindings=r,this.currentlyDisplayedResults=[],this.reachedTheEndOfResults=!1,this.resetList=!0,this.pageChanged=!1,this.options=new i(t).merge(s),e.Assert.exists(t),e.Assert.exists(this.options),e.Assert.exists(this.options.resultContainer),e.Assert.exists(this.options.resultTemplate),e.Assert.exists(this.options.waitAnimationContainer),e.Assert.exists(this.options.infiniteScrollContainer),this.showOrHideElementsDependingOnState(!1,!1),e.$(this.root).on(e.Events.QueryEvents.newQuery,e.$.proxy(this.handleNewQuery,this)),e.$(this.root).on(e.Events.QueryEvents.querySuccess,e.$.proxy(this.handleProcessNewQueryResults,this)),e.$(this.root).on(e.Events.QueryEvents.duringQuery,e.$.proxy(this.handleDuringQuery,this)),e.$(this.root).on(e.Events.QueryEvents.queryError,function(){l.hideWaitingAnimation(),e.$(l.options.resultContainer).empty(),l.currentlyDisplayedResults=[]}),this.options.enableInfiniteScroll&&e.$(this.options.infiniteScrollContainer).scroll(function(e){return l.handleScrollOfResultList(e)});var u=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.first);e.$(this.queryStateModel.element).on(u,e.$.proxy(this.handlePageChanged,this))}return __extends(o,n),o.prototype.handlePageChanged=function(){var t=this;e.$(this.root).one(e.Events.QueryEvents.querySuccess,function(){e.$(t.options.infiniteScrollContainer).scrollTop(0)})},o.prototype.handleNewQuery=function(){this.disabled||e.$(this.element).show()},o.prototype.displayMoreResults=function(t){var i=this;return e.Assert.isLargerOrEqualsThan(1,t),e.Assert.check(this.hasPotentiallyMoreResultsToDisplay()),this.isCurrentlyFetchingMoreResults()?(this.logger.warn("Ignoring request to display more results since we're already doing so"),void 0):this.hasPotentiallyMoreResultsToDisplay()?(this.options.showInfiniteScrollWaitingAnimation&&this.showWaitingAnimationForInfiniteScrolling(),this.fetchingMoreResults=this.queryController.fetchMore(t),this.fetchingMoreResults.done(function(n){e.Assert.exists(n);var o=n.results;i.reachedTheEndOfResults=t>n.results.length,i._buildResults(n),_.each(o,function(e){i.currentlyDisplayedResults.push(e)}),e.$(i.element).trigger(e.Events.ResultListEvents.newResultsDisplayed,{})}),this.fetchingMoreResults.always(function(){i.hideWaitingAnimationForInfiniteScrolling(),i.fetchingMoreResults=void 0,e.Defer.defer(function(){return i.handleScrollOfResultList()})}),void 0):(this.logger.warn("Ignoring request to display more results since we know there aren't more to display"),void 0)},o.prototype._triggerNewResultDisplayed=function(t,i){var n={result:t,item:i};e.$(this.element).trigger(e.Events.ResultListEvents.newResultDisplayed,n)},o.prototype._buildResults=function(t){var i=this;e.$.each(t.results,function(t,n){var o=i._instantiateTemplateForResult(n);e.$(o).data("CoveoResult",n),e.$(i.options.resultContainer).append(o),i._autoCreateComponentsInsideResult(o,n),i._triggerNewResultDisplayed(n,o)})},o.prototype._instantiateTemplateForResult=function(i){e.Assert.exists(i);var n=this.options.resultTemplate.instantiateToElement(i);return t.Component.bindResultToElement(n,i),n},o.prototype._autoCreateComponentsInsideResult=function(i,n){e.Assert.exists(i);var o=this.searchInterface.options,s=e.$.extend({},{options:o},this.getBindings(),{result:n});t.CoveoJQuery.automaticallyCreateComponentsInside(i,s)},o.prototype.handleDuringQuery=function(){this.logger.trace("Emptying the result container"),this.currentlyDisplayedResults=[],this.cancelFetchingMoreResultsIfNeeded(),this.showWaitingAnimation(),this.showOrHideElementsDependingOnState(!1,!1)},o.prototype.handleProcessNewQueryResults=function(i,n){if(e.Assert.exists(n),e.Assert.exists(n.results),e.$(this.element).fastToggle(!this.disabled),!this.disabled){var o=n.results;this.logger.trace("Received query results from new query",o),this.hideWaitingAnimation(),this.options.resultContainer.innerHTML="",this.currentlyDisplayedResults=[],this._buildResults(o),this.currentlyDisplayedResults=o.results,this.reachedTheEndOfResults=!1,this.showOrHideElementsDependingOnState(!0,0!=this.currentlyDisplayedResults.length),this.options.enableInfiniteScroll&&o.results.length==n.queryBuilder.numberOfResults&&this.handleScrollOfResultList(),t.Device.isMobileDevice()&&void 0!=this.options.mobileScrollContainer&&(this.options.mobileScrollContainer.scrollTop=0),e.$(this.element).trigger(e.Events.ResultListEvents.newResultsDisplayed,{})}},o.prototype.reset=function(){this.hideWaitingAnimation(),e.$(this.options.resultContainer).empty(),this.currentlyDisplayedResults=[]},o.prototype.handleScrollOfResultList=function(e){this.isCurrentlyFetchingMoreResults()||this.isScrollingOfResultListAlmostAtTheBottom()&&this.hasPotentiallyMoreResultsToDisplay()&&this.displayMoreResults(this.options.infiniteScrollPageSize,null!=e)},o.prototype.isCurrentlyFetchingMoreResults=function(){return e.Utils.exists(this.fetchingMoreResults)},o.prototype.isScrollingOfResultListAlmostAtTheBottom=function(){var t;try{t=e.$(this.options.infiniteScrollContainer).get(0)instanceof Window}catch(i){t=!1}return t?this.isScrollAtBottomForWindowElement():this.isScrollAtBottomForHtmlElement()},o.prototype.isScrollAtBottomForWindowElement=function(){var t=e.$(window).height(),i=e.$(window).scrollTop(),n=e.$(document).height();return t/2>n-(t+i)},o.prototype.isScrollAtBottomForHtmlElement=function(){var t=e.$(this.options.infiniteScrollContainer).innerHeight(),i=e.$(this.options.infiniteScrollContainer).get(0).scrollHeight,n=e.$(this.options.infiniteScrollContainer).scrollTop()+t;return t/2>i-n},o.prototype.hasPotentiallyMoreResultsToDisplay=function(){return this.currentlyDisplayedResults.length>0&&!this.reachedTheEndOfResults},o.prototype.cancelFetchingMoreResultsIfNeeded=function(){this.isCurrentlyFetchingMoreResults()&&(this.logger.trace("Cancelling fetching more results"),this.fetchingMoreResults.reject(),this.fetchingMoreResults=void 0)},o.prototype.showOrHideElementsDependingOnState=function(t,i){e.$(this.element).find(".coveo-show-if-query").fastToggle(t),e.$(this.element).find(".coveo-show-if-no-query").fastToggle(!t),e.$(this.element).find(".coveo-show-if-results").fastToggle(t&&i),e.$(this.element).find(".coveo-show-if-no-results").fastToggle(t&&!i)},o.prototype.showWaitingAnimation=function(){switch(this.options.waitAnimation.toLowerCase()){case"fade":e.$(this.options.waitAnimationContainer).addClass("coveo-fade-out");break;case"spinner":e.$(this.options.resultContainer).children().hide(),0==e.$(this.options.waitAnimationContainer).find(".coveo-wait-animation").length&&e.$(this.options.waitAnimationContainer).append('<img src="'+t.Images.WaitAnimation+'" class="coveo-wait-animation"/>')}},o.prototype.hideWaitingAnimation=function(){switch(this.options.waitAnimation.toLowerCase()){case"fade":e.$(this.options.waitAnimationContainer).removeClass("coveo-fade-out");break;case"spinner":e.$(this.options.waitAnimationContainer).children("img.coveo-wait-animation").detach()}},o.prototype.showWaitingAnimationForInfiniteScrolling=function(){e.$(this.options.waitAnimationContainer).append('<img src="'+t.Images.WaitAnimation+'" class="coveo-wait-animation"/>')},o.prototype.hideWaitingAnimationForInfiniteScrolling=function(){e.$(this.options.waitAnimationContainer).children("img.coveo-wait-animation").detach()},o.prototype.getOptions=function(){return this.options?this.options:new i(this.element)},o.ID="ResultList",o}(t.Component);t.ResultList=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.omniBoxZIndex=this.loadNumberFromAttribute("data-omnibox-z-index",51),this.headerTitle=this.loadStringFromAttribute("data-header-title")}return __extends(t,e),t}(t.DefaultResultListOptions);t.DefaultOmniBoxResultListOptions=i;var n=function(n){function o(t,s,r){n.call(this,t,s,r,o.ID),this.element=t,this.options=s,this.bindings=r,this.options=new i(t).merge(s),this.setupOptions(),this.bind.onRoot(e.Events.OmniBoxEvents.populateOmniBox,this.handlePopulateOmniBox)}return __extends(o,n),o.prototype._buildResults=function(i){var n=this;if(this.lastOmniboxRequest){var o=e.$("<div></div>");o.append("<div class='coveo-omnibox-result-list-header'>          <span class='coveo-icon-omnibox-result-list'></span>           <span class='coveo-caption'>"+(this.options.headerTitle||t.l.SuggestedResults())+"</span>         </div>"),_.each(i.results,function(t){var i=n._instantiateTemplateForResult(t);e.$(i).data("CoveoResult",t).addClass("coveo-omnibox-selectable").appendTo(o),e.$(i).on("keyboardSelect",function(){n.options.onSelect.call(n,t,e.$(i),n.lastOmniboxRequest.omniboxObject)}),n._autoCreateComponentsInsideResult(i,t),n._triggerNewResultDisplayed(t,i)}),this.lastOmniboxRequest.deferred.resolve({element:o.get(0),zIndex:this.options.omniBoxZIndex})}},o.prototype.setupOptions=function(){this.logger.info("Disabling infinite scroll for OmniBoxResultList",this),this.options.enableInfiniteScroll=!1,this.options.onSelect=this.options.onSelect||this.onRowSelection
},o.prototype.handlePopulateOmniBox=function(i,n){var o=this,s=e.$.Deferred();n.rows.push({deferred:s}),this.lastOmniboxRequest={omniboxObject:n,deferred:s},this.queryController.executeQuery({beforeExecuteQuery:function(){return o.usageAnalytics.logSearchAsYouType(t.AnalyticsActionCauseList.searchboxSubmit,{})}})},o.prototype.onRowSelection=function(e){this.usageAnalytics.logClickEvent(t.AnalyticsActionCauseList.documentOpen,{documentTitle:e.title,documentURL:e.clickUri},e,this.root),window.location.href=e.clickUri},o.ID="OmniBoxResultList",o}(t.ResultList);t.OmniBoxResultList=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t,!1,!1),this.layoutType=this.loadStringFromAttribute("data-layout-type","row").toLowerCase(),this.heightThreshold=this.loadNumberFromAttribute("data-height-threshold",250),this.columnWidth=this.loadNumberFromAttribute("data-column-width",225)}return __extends(t,e),t.prototype.findScrollParent=function(){},t}(t.DefaultResultListOptions);t.DefaultImageResultListOptions=i;var n=function(t){function n(o,s,r,a){"undefined"==typeof a&&(a=e.Ui.ResultList.ID),t.call(this,o,new i(o).merge(s),r,n.ID),this.element=o,this.columnResultsArray=[],this.imagesInCurrentRow=[],this.imagesLoaded=0,this.resultIndex=0,this.lastRowHeight=0,this.options=t.prototype.getOptions.call(this),this.lastRowHeight=this.options.heightThreshold,e.$(this.root).on(e.Events.ResultListEvents.newResultsDisplayed,e.$.proxy(this.handleProcessNewResultsDisplayed,this)),this.bindWindowResizeEvent()}return __extends(n,t),n.prototype.getResultsElement=function(){return e.$(this.element).find(".CoveoResult")},n.prototype.getResultsElementImages=function(){return e.$(this.element).find(".CoveoResult img")},n.prototype.getResultsContainerDiv=function(){return e.$(this.element).find("> div")},n.prototype.bindWindowResizeEvent=function(){var t,i=this;e.$(window).on("resize",function(){clearTimeout(t),t=setTimeout(i.retrieveLayoutMethod(),250)})},n.prototype.handleProcessNewResultsDisplayed=function(){this.disabled?e.$(this.element).fadeOut():e.$(this.element).fadeIn(),this.onImageProxy(this.retrieveLayoutMethod())},n.prototype.addTransitionAllToElement=function(e){_.defer(function(){e.addClass("coveo-transition-all")})},n.prototype.retrieveLayoutMethod=function(){var e=this;if(!this.disabled){if(this.options.layoutType.toLowerCase()==n.columnLayoutTypeStr)return function(){return e.setupColumns()};if(this.options.layoutType.toLowerCase()==n.rowLayoutTypeStr)return function(){return e.setupRows()}}return function(){}},n.prototype.onImageProxy=function(t){var i=(this.getResultsElement().each(function(t,i){0==e.$(i).find("img").length&&e.$(i).detach()}),this.getResultsElementImages()),n=0,o=function(o){e.$(o).height()>0?(null==e.$(o).attr("width")&&null==e.$(o).attr("height")&&(e.$(o).attr("height",e.$(o).height()),e.$(o).attr("width",e.$(o).width())),n++,n==i.length&&t()):(e.$(o).parent().detach(),i=i.not(o),n==i.length&&t())};i.each(function(t,i){this.src&&this.complete||e.$(i).height()>0?o(i):e.$(i).off("load").one("load",function(){o(i)})})},n.prototype.getHorizontalMargin=function(e){return parseInt(e.css("margin-left"))+parseInt(e.css("margin-right"))},n.prototype.getVerticalMargin=function(e){return parseInt(e.css("margin-top"))+parseInt(e.css("margin-bottom"))},n.prototype.setupColumns=function(){var t=this.getResultsContainerDiv().width(),i=this.getResultsElement(),n=this.options.columnWidth,o=this.getHorizontalMargin(i),s=Math.floor(t/(n+o));this.columnResultsArray=[];for(var r=0;s>r;r++)this.columnResultsArray.push(o);this.positionColumns(n,o),e.$(this.element).trigger(e.Events.ImageResultListEvents.imageResultsLayoutComplete,{}),this.options.enableInfiniteScroll&&this.adjustNumberOfResults()},n.prototype.positionColumns=function(t,i){var n=this,o=this.getResultsElement();_.each(o,function(o){var s=_.min(n.columnResultsArray),r=e.$.inArray(s,n.columnResultsArray),a=i+r*(t+i);e.$(o).css({left:a+"px",top:s+"px",width:t+"px"}),n.columnResultsArray[r]=s+e.$(o).outerHeight()+i}),this.setResultsContainerHeight(_.max(this.columnResultsArray)),this.addTransitionAllToElement(o)},n.prototype.setResultsContainerHeight=function(t){e.$(this.element).height(Math.ceil(t)),e.$(this.element).attr("data-height",Math.ceil(t))},n.prototype.setupRows=function(){var t=this.getResultsElement(),i=e.$(this.element).width();this.resultIndex=0;for(var n=0;this.resultIndex<t.length;){this.imagesInCurrentRow=[];var o=this.getCurrentRowHeight(t,i);this.setCurrentRowImagesDimensions(t,o,n),n+=o}this.setResultsContainerHeight(n),e.$(this.element).trigger(e.Events.ImageResultListEvents.imageResultsLayoutComplete,{}),this.addTransitionAllToElement(t),this.options.enableInfiniteScroll&&this.adjustNumberOfResults()},n.prototype.getCurrentRowHeight=function(e,t){for(var i=0,n=null;this.resultIndex<e.length&&(null==n||n>=this.options.heightThreshold);){var o=this.getImageDimensionsFromResult(e.eq(this.resultIndex));null!=o&&(i+=o.width/o.height,n=t/i),this.imagesInCurrentRow.push(this.resultIndex),this.resultIndex++}return n>this.options.heightThreshold&&(n=this.lastRowHeight),this.lastRowHeight=n,n},n.prototype.getImageDimensionsFromResult=function(e){var t=e.find("img"),i=parseInt(t.attr("height")),n=parseInt(t.attr("width"));return{height:i,width:n}},n.prototype.setCurrentRowImagesDimensions=function(e,t,i){var n=this,o=0;_.each(this.imagesInCurrentRow,function(s){var r=parseInt(e.eq(s).find("img").attr("width")),a=parseInt(e.eq(s).find("img").attr("height")),l=r*t/a,u=n.getHorizontalMargin(e.eq(s)),c=n.getVerticalMargin(e.eq(s));e.eq(s).css({height:Math.round(t-c),width:Math.round(l-u),left:Math.round(o),top:Math.round(i)}),o+=l})},n.prototype.adjustNumberOfResults=function(){var i=Number(e.$(this.element).attr("data-height"));0==e.$.isNumeric(i)&&(i=e.$(this.element).height()),i<e.$(this.options.infiniteScrollContainer).height()&&t.prototype.hasPotentiallyMoreResultsToDisplay.call(this)&&t.prototype.displayMoreResults.call(this,this.options.infiniteScrollPageSize,!1)},n.ID="ImageResultList",n.rowLayoutTypeStr="row",n.columnLayoutTypeStr="column",n}(t.ResultList);t.ImageResultList=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.field=this.loadStringFromAttribute("data-field"),this.openInOutlook=this.loadBooleanFromAttribute("data-open-in-outlook",!1),this.openQuickView=this.loadBooleanFromAttribute("data-open-quickview",!1),this.alwaysOpenInNewWindow=this.loadBooleanFromAttribute("data-always-open-in-new-window",!1)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultResultLinkOptions=i;var n=function(n){function o(t,s,r,a,l){n.call(this,t,o.ID,r),this.element=t,this.options=s,this.result=a,this.os=l,this.options=new i(t).merge(s),this.options=e.$.extend({},this.options,this.componentOptionsModel.get(e.Models.ComponentOptionsModel.attributesEnum.resultLink)),this.result=a||this.resolveResult(),e.Assert.exists(this.componentOptionsModel),e.Assert.exists(this.result),e.$(t).on("mousedown touchend",e.$.proxy(this.logOpenDocument,this)),this.bindOnClickIfNotUndefined()||this.bindOpenQuickViewIfNotUndefined()||this.setHrefIfNotAlready()||this.openLinkThatIsNotAnAnchor()}return __extends(o,n),o.prototype.bindOnClickIfNotUndefined=function(){var t=this;return void 0!=this.options.onClick?(e.$(this.element).fastClick(function(e){t.options.onClick.call(t,e,t.result)}),!0):!1},o.prototype.bindOpenQuickViewIfNotUndefined=function(){var t=this;return this.options.openQuickView?(e.$(this.element).fastClick(function(i){i.preventDefault();var n=e.$(t.element).parent().find(".CoveoQuickView .coveo-icon-for-quickview");0==n.length&&(n=e.$(t.element).closest(".CoveoQuickView .coveo-icon-for-quickview")),n.fastClick()}),!0):!1},o.prototype.openLinkThatIsNotAnAnchor=function(){var i=this;t.Device.isPhonegap()?t.PhonegapUtils.bindOpenLinkInPhonegap(this.element,this.getResultUri()):this.elementIsAnAnchor()||e.$(this.element).fastClick(function(){i.options.alwaysOpenInNewWindow?i.options.openInOutlook&&i.hasOutlookField()?window.location.href=i.getResultUri():window.open(i.getResultUri(),"_blank"):window.location.href=i.getResultUri()})},o.prototype.setHrefIfNotAlready=function(){if(t.Device.isPhonegap()&&this.elementIsAnAnchor()){var i=e.$(this.element).attr("href");return(void 0==i||""==i)&&(i=this.getResultUri()),e.$(this.element).removeAttr("href"),e.$(this.element).removeAttr("target"),t.PhonegapUtils.bindOpenLinkInPhonegap(this.element,i),!0}return this.elementIsAnAnchor()&&!e.Utils.isNonEmptyString(e.$(this.element).attr("href"))?(e.$(this.element).attr("href",this.getResultUri()),!this.options.alwaysOpenInNewWindow||this.options.openInOutlook&&this.hasOutlookField()||e.$(this.element).attr("target","_blank"),!0):!1},o.prototype.bindPhonegapClick=function(){t.Device.isPhonegap()&&t.PhonegapUtils.bindOpenLinkInPhonegap(this.element,this.getResultUri())},o.prototype.logOpenDocument=function(){this.usageAnalytics.logClickEvent(t.AnalyticsActionCauseList.documentOpen,{documentURL:this.result.clickUri,documentTitle:this.result.title},this.result,this.root)},o.prototype.getResultUri=function(){return void 0==this.options.field&&this.options.openInOutlook&&this.setField(),void 0!=this.options.field?this.result.raw[e.Utils.getCoveoFieldKey(this.options.field)]:this.result.clickUri},o.prototype.elementIsAnAnchor=function(){return"A"==this.element.tagName},o.prototype.setField=function(){var i=e.Utils.exists(this.os)?this.os:t.OS.get();1==i&&this.hasOutlookField()?this.options.field="@sysoutlookformacuri":0==i&&this.hasOutlookField()&&(this.options.field="@sysoutlookuri")},o.prototype.hasOutlookField=function(){var i=e.Utils.exists(this.os)?this.os:t.OS.get();return 1==i&&void 0!=this.result.raw.sysoutlookformacuri?!0:0==i&&void 0!=this.result.raw.sysoutlookuri?!0:!1},o.ID="ResultLink",o}(t.Component);t.ResultLink=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(i,n){"undefined"==typeof n&&(n=""),this.sort=i,this.direction=n,e.Assert.isNonEmptyString(i),e.Assert.check(_.contains(t.validSorts,i)||t.sortIsField(i)),t.sortNeedsDirection(i)?e.Assert.check(_.contains(t.validDirections,n)):e.Assert.check(""==n)}return t.prototype.putInQueryBuilder=function(i){e.Assert.exists(i),t.sortIsField(this.sort)?(i.sortCriteria="field"+this.direction,i.sortField=this.sort):i.sortCriteria=""!=this.direction?this.sort+this.direction:this.sort},t.prototype.getValueFromResult=function(i){return e.Assert.exists(i),t.sortIsField(this.sort)?(e.Assert.stringStartsWith(this.sort,"@"),i.raw[this.sort.substr(1)]):"date"==this.sort?i.raw.sysdate:(e.Assert.fail("Cannot retrieve value: "+this.sort),void 0)},t.prototype.toString=function(){return e.Utils.isNonEmptyString(this.direction)?this.sort+" "+this.direction:this.sort},t.prototype.equals=function(t){return e.Assert.exists(t),t.sort==this.sort&&t.direction==this.direction},t.parse=function(i){e.Assert.isNonEmptyString(i);var n=i.split(" ");return new t(n[0],n[1])},t.sortIsField=function(e){return"@"==e.substr(0,1)},t.sortNeedsDirection=function(e){return _.contains(t.sortsNeedingDirection,e)||t.sortIsField(e)},t.validSorts=["relevancy","date","qre"],t.sortsNeedingDirection=["date"],t.validDirections=["ascending","descending"],t}();t.SortCriteria=i;var n=function(t){function n(n){var o=this;t.call(this,n),this.sortCriterias=[];var s=this.loadStringFromAttribute("data-sort-criteria");_.each(e.$.trim(s).split(","),function(e){o.sortCriterias.push(i.parse(e))})}return __extends(n,t),n}(t.ComponentOptions);t.DefaultSortOptions=n;var o=function(o){function s(t,i,r){o.call(this,t,s.ID,r),this.element=t,this.options=i,this.listenToQueryStateChange=!0,this.options=new n(t).merge(i);var a=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne)+e.Models.QueryStateModel.attributesEnum.sort;e.$(this.root).on(a,e.$.proxy(this.handleQueryStateChanged,this)),e.$(this.root).on(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQuery,this)),this.bind.fastClick(e.$(this.element),this.handleClick),this.isToggle()&&e.$(this.element).append('<span class="coveo-icon" />'),this.updateAppearance()}return __extends(s,o),s.prototype.select=function(t,i){if("undefined"==typeof i&&(i=!1),t)this.currentCriteria=_.find(this.options.sortCriterias,function(e){return e.direction==t});else if(e.Utils.exists(this.currentCriteria)){var n=_.indexOf(this.options.sortCriterias,this.currentCriteria);e.Assert.check(n>=0),this.currentCriteria=this.options.sortCriterias[(n+1)%this.options.sortCriterias.length]}else this.currentCriteria=this.options.sortCriterias[0];this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.sort,this.currentCriteria.toString(),{silent:i})},s.prototype.disable=function(){e.$(this.element).addClass("coveo-tab-disabled"),o.prototype.disable.call(this)},s.prototype.enable=function(){e.$(this.element).removeClass("coveo-tab-disabled"),o.prototype.enable.call(this)},s.prototype.getCurrentCriteria=function(){return this.currentCriteria},s.prototype.handleQueryStateChanged=function(){var t=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.sort);if(e.Utils.isNonEmptyString(t)){var n=i.parse(t);this.currentCriteria=_.find(this.options.sortCriterias,function(e){return n.equals(e)})}else this.currentCriteria=null;this.updateAppearance()},s.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i);var n=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.sort);(n==e.Models.QueryStateModel.defaultAttributes.sort||this.isSelected())&&this.currentCriteria&&this.currentCriteria.putInQueryBuilder(i.queryBuilder)},s.prototype.handleClick=function(){var e=this,i=this.currentCriteria;this.select(),i!=this.currentCriteria&&this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return e.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.resultsSort,{resultsSortBy:e.currentCriteria.sort+e.currentCriteria.direction})}})},s.prototype.isToggle=function(){return this.options.sortCriterias.length>1},s.prototype.isSelected=function(){return e.Utils.exists(this.currentCriteria)},s.prototype.updateAppearance=function(){if(e.$(this.element).toggleClass("coveo-selected",this.isSelected()),this.isToggle()){var t=this.currentCriteria?this.currentCriteria.direction:this.options.sortCriterias[0].direction;e.$(this.element).toggleClass("coveo-ascending","ascending"==t)}},s.prototype.match=function(e){return _.any(this.options.sortCriterias,function(t){return e==t.toString()})},s.ID="Sort",s}(t.Component);t.Sort=o,t.CoveoJQuery.registerAutoCreateComponent(o)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.numberOfPages=this.loadNumberFromAttribute("data-number-of-pages",10),this.navigationButton=this.loadBooleanFromAttribute("data-show-previous-next",!0)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultPagerOptions=i;var n=function(n){function o(t,s,r){var a=this;n.call(this,t,o.ID,r),this.element=t,this.options=s,this.listenToQueryStateChange=!0,this.needToReset=!0,this.ignoreNextQuerySuccess=!1,this.listTemplate=_.template("<ul></ul>"),this.listItemTemplate=_.template('<li class="<%= _class %>"></li>'),this.listItemValueTemplate=_.template("<a><%= listItemValue %></a>"),this.navigationButtonTemplate=_.template('<li class="<%= _class %>"><a><span title="<%= buttonValue %>"/></a></li>'),this.options=new i(t).merge(s),this.currentPage=1,this.bind.onRoot(e.Events.QueryEvents.newQuery,function(){return a.handleNewQuery()}),this.bind.onRoot(e.Events.QueryEvents.buildingQuery,function(e,t){return a.handleBuildingQuery(e,t)}),this.bind.onRoot(e.Events.QueryEvents.querySuccess,function(e,t){return a.handleQuerySuccess(e,t)}),this.bind.onRoot(e.Events.QueryEvents.queryError,function(e,t){return a.handleQueryError(e,t)}),this.bind.onRoot(e.Events.QueryEvents.noResults,function(e,t){return a.handleNoResults(e,t)});var l=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.first);e.$(this.queryStateModel.element).on(l,e.$.proxy(this.handleQueryStateModelChanged,this))}return __extends(o,n),o.prototype.setPage=function(t){e.Assert.exists(t),this.needToReset=!1,this.currentPage=t,this.updateQueryStateModel(this.getFirstResultNumber(this.currentPage)),this.queryController.deferExecuteQuery()},o.prototype.previousPage=function(){this.needToReset=!1,this.currentPage=this.currentPage-1,this.currentPage=Math.max(this.currentPage,1),this.updateQueryStateModel(this.getFirstResultNumber(this.currentPage)),this.queryController.deferExecuteQuery()},o.prototype.nextPage=function(){this.needToReset=!1,this.currentPage=this.currentPage+1,this.currentPage=Math.min(this.currentPage,1e3),this.updateQueryStateModel(this.getFirstResultNumber(this.currentPage)),this.queryController.deferExecuteQuery()},o.prototype.handleNewQuery=function(){this.needToReset&&(this.currentPage=1,this.updateQueryStateModel(this.getFirstResultNumber(this.currentPage))),this.needToReset=!0},o.prototype.updateQueryStateModel=function(t){this.listenToQueryStateChange=!1,this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.first,t),this.listenToQueryStateChange=!0},o.prototype.handleQueryError=function(){this.reset()},o.prototype.handleQuerySuccess=function(t,i){var n=this;if(this.reset(),this.ignoreNextQuerySuccess)this.ignoreNextQuerySuccess=!1;else{e.Assert.isNotUndefined(i);var o=i.query.firstResult,s=i.results.totalCount,r=this.computePagerBoundary(o,s);if(this.currentPage=r.currentPage,r.end-r.start>0){for(var a=e.$(this.listTemplate()).appendTo(this.element),l=r.start;l<=r.end;l++){var u=e.$(this.listItemValueTemplate({listItemValue:l}));!function(t){var i=e.$(n.listItemTemplate({_class:t==n.currentPage?"coveo-active":""})).fastClick(function(){return n.handleClickPage(t)});i.append(u).appendTo(a)}(l)}this.options.navigationButton&&r.lastResultPage>1&&this.renderNavigationButton(r,a)}}},o.prototype.handleNoResults=function(e,t){var i=this.computePagerBoundary(t.results.totalCount,t.results.totalCount).lastResultPage;this.currentPage>i&&(this.ignoreNextQuerySuccess=!0,this.setPage(i))},o.prototype.reset=function(){e.$(this.element).empty()},o.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i);var n=this.getQueryEventArgs();i.queryBuilder.firstResult=n.first,i.queryBuilder.numberOfResults=n.count},o.prototype.computePagerBoundary=function(e,t){var i=this.queryController.options.resultsPerPage,n=Math.floor(e/i)+1,o=Math.ceil(t/i);o=Math.max(o,1);var s=Math.floor(this.options.numberOfPages/2),r=n-s;r=Math.max(r,1);var a=r+this.options.numberOfPages-1;return a=Math.min(a,o),{start:r,end:a,lastResultPage:o,currentPage:n}},o.prototype.renderNavigationButton=function(i,n){var o=this;if(this.currentPage>1){var s=e.$(this.navigationButtonTemplate({_class:"coveo-previous",buttonValue:t.l.Previous()})).prependTo(n);s.fastClick(function(){return o.handleClickPrevious()})}if(this.currentPage<i.lastResultPage){var r=e.$(this.navigationButtonTemplate({_class:"coveo-next",buttonValue:t.l.Next()})).appendTo(n);r.fastClick(function(){return o.handleClickNext()})}},o.prototype.handleQueryStateModelChanged=function(t,i){if(this.listenToQueryStateChange){e.Assert.exists(i),this.needToReset=!1;var n=i.value;this.currentPage=this.fromFirstResultsToPageNumber(n)}},o.prototype.handleClickPage=function(t){e.Assert.exists(t),this.setPage(t)},o.prototype.handleClickPrevious=function(){this.previousPage()},o.prototype.handleClickNext=function(){this.nextPage()},o.prototype.fromFirstResultsToPageNumber=function(e){return e/this.queryController.options.resultsPerPage+1},o.prototype.getFirstResultNumber=function(e){return"undefined"==typeof e&&(e=this.currentPage),(e-1)*this.queryController.options.resultsPerPage},o.prototype.getQueryEventArgs=function(){return{count:this.queryController.options.resultsPerPage,first:this.getFirstResultNumber()}},o.ID="Pager",o}(t.Component);t.Pager=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.field=this.loadStringFromAttribute("data-field"),this.operation=this.loadStringFromAttribute("data-operation","sum"),this.format=this.loadStringFromAttribute("data-format","c0")}return __extends(t,e),t}(t.ComponentOptions);t.DefaultAggregateOptions=i;var n=function(t){function n(o,s,r){t.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=new i(o).merge(s),this.bind.onRoot(e.Events.QueryEvents.buildingQuery,this.handleBuildingQuery),this.bind.onRoot(e.Events.QueryEvents.querySuccess,this.handleQuerySuccess),e.$(this.element).hide()}return __extends(n,t),n.prototype.handleBuildingQuery=function(e,t){var i={field:this.options.field,maximumNumberOfValues:0,computedFields:[{field:this.options.field,operation:this.options.operation}]};this.index=t.queryBuilder.groupByRequests.length,t.queryBuilder.groupByRequests.push(i)},n.prototype.handleQuerySuccess=function(t,i){if(e.Utils.isNumber(this.index)&&0!=i.results.groupByResults.length){var n=i.results.groupByResults[this.index],o=n.globalComputedFieldResults[0];e.$(this.element).text(Globalize.format(o,this.options.format)),e.$(this.element).show()}else e.$(this.element).hide()},n.ID="Aggregate",n}(t.Component);t.Aggregate=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(){this.selected=!1,this.excluded=!1,this.waitingForDelta=!1}return t.prototype.reset=function(){this.selected=!1,this.excluded=!1},t.prototype.updateCountsFromNewValue=function(t){e.Assert.exists(t),this.occurrences=t.occurrences,this.delta=t.delta,this.computedField=t.computedField},t.prototype.cloneWithZeroOccurrences=function(){return this.occurrences=0,this.computedField=0,this.delta=void 0,this},t.prototype.cloneWithDelta=function(t,i){e.Assert.isLargerOrEqualsThan(0,t);var n=this.cloneWithZeroOccurrences();return n.delta=i,n.occurrences=t,n},t.prototype.getFormattedCount=function(){var t=void 0;return e.Utils.exists(this.delta)&&this.delta>0?t="+"+Globalize.format(this.delta,"n0"):this.occurrences>0&&(t=Globalize.format(this.occurrences,"n0")),t},t.prototype.getFormattedComputedField=function(e){return 0!=this.computedField?Globalize.format(this.computedField,e):void 0},t.create=function(e){if(_.isString(e))return t.createFromValue(e);if(_.isObject(e))return"computedFieldResults"in e?t.createFromGroupByValue(e):t.createFromFieldValue(e);throw new Error("Can't create value from "+e)},t.createFromValue=function(i){e.Assert.isNonEmptyString(i);var n=new t;return n.value=i,n.lookupValue=i,n},t.createFromGroupByValue=function(i){e.Assert.exists(i),e.Assert.exists(i);var n=new t;return n.value=i.value,n.lookupValue=e.Utils.exists(i.lookupValue)?i.lookupValue:i.value,n.occurrences=i.numberOfResults,n.computedField=e.Utils.isNonEmptyArray(i.computedFieldResults)?i.computedFieldResults[0]:void 0,n.score=i.score,n},t.createFromFieldValue=function(i){e.Assert.exists(i);var n=new t;return n.value=i.value,n.lookupValue=i.lookupValue,n.occurrences=i.numberOfResults,n},t}();t.FacetValue=i;var n=function(){function t(t){this.values=e.Utils.exists(t)?_.map(t.values,function(e){return i.createFromGroupByValue(e)}):[]}return t.prototype.add=function(t){e.Assert.exists(t),e.Assert.check(!this.contains(t.value)),this.values.push(t)},t.prototype.remove=function(t){e.Assert.isNonEmptyString(t),this.values=_.filter(this.values,function(e){return e.value!=t})},t.prototype.size=function(){return this.values.length},t.prototype.isEmpty=function(){return 0==this.values.length},t.prototype.at=function(t){return e.Assert.isLargerOrEqualsThan(0,t),e.Assert.isSmallerThan(this.values.length,t),this.values[t]},t.prototype.get=function(e){return _.find(this.values,function(t){return t.value==e})},t.prototype.contains=function(t){return e.Utils.exists(this.get(t))},t.prototype.getAll=function(){return this.values},t.prototype.getSelected=function(){return _.filter(this.values,function(e){return e.selected})},t.prototype.getExcluded=function(){return _.filter(this.values,function(e){return e.excluded})},t.prototype.hasSelectedOrExcludedValues=function(){return 0!=this.getSelected().length||0!=this.getExcluded().length},t.prototype.reset=function(){_.each(this.values,function(e){return e.reset()})},t.prototype.importActiveValuesFromOtherList=function(t){var i=this;e.Assert.exists(t),_.each(t.getSelected(),function(t){var n=i.get(t.value);e.Utils.exists(n)?n.selected=!0:i.values.push(t.cloneWithZeroOccurrences())}),_.each(t.getExcluded(),function(t){var n=i.get(t.value);e.Utils.exists(n)?n.excluded=!0:i.values.push(t.cloneWithZeroOccurrences())})},t.prototype.updateCountsFromNewValues=function(t){e.Assert.exists(t),this.values=_.map(this.values,function(i){var n=t.get(i.value);return e.Utils.exists(n)?(i.updateCountsFromNewValue(n),i):i.cloneWithZeroOccurrences()})},t.prototype.updateDeltaWithFilteredFacetValues=function(t){e.Assert.exists(t),_.each(this.values,function(i){var n=t.get(i.value);i.waitingForDelta=!1,e.Utils.exists(n)?i.delta=i.occurrences-n.occurrences>0?i.occurrences-n.occurrences:null:i.selected||i.excluded||(i.delta=i.occurrences)})},t.prototype.mergeWithUnfilteredFacetValues=function(t){var i=this;e.Assert.exists(t);var n=[];_.each(t.values,function(t){var o=i.get(t.value);e.Utils.exists(o)?o.occurrences==t.occurrences?n.push(o):n.push(t.cloneWithDelta(t.occurrences,t.occurrences-o.occurrences)):n.push(t.cloneWithDelta(t.occurrences,t.occurrences))});var o=0;_.each(this.values,function(i){var s=t.get(i.value);if(e.Utils.exists(s)){for(var r=0;r<n.length;r++)if(n[r].value==i.value){o=r+1;break}}else(i.selected||i.excluded)&&(n.splice(o,0,i),o++)}),this.values=n},t.prototype.sortValuesDependingOnStatus=function(e){if(this.values=_.sortBy(this.values,function(e){return e.selected?1:e.excluded?3:2}),null!=e&&e<this.values.length){var t=this.getExcluded().length,i=this.values.splice(this.values.length-t,t);Array.prototype.splice.apply(this.values,[e-t,0].concat(i))}},t}();t.FacetValues=n}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(n,o){var s=this;this.facet=o,this.facetSettingsIconTemplate=_.template("<span class='coveo-icon'></span>"),this.facetSettingsButtonTemplate=_.template("<div title='"+t.l.Settings()+"' class='coveo-settings'></div>"),this.facetSettingsPopupTemplate=_.template('<div class="coveo-settings-popup"></div>'),this.facetSettingsSectionTemplate=_.template("<div class='coveo-section <%= _class %>'></div>"),this.facetSettingsSectionIconTemplate=_.template("<div class='coveo-icon'></div>"),this.facetSettingsItemsTemplate=_.template("<div class='coveo-items'></div>"),this.facetSettingsItemTemplate=_.template("<div class='coveo-item' title='<%- title %>'><%- label %></div>"),this.enabledSorts=[],this.enabledSortsIgnoreRenderBecauseOfPairs=[],this.customSortDirection="ascending",this.customSortDirectionChange=!1,_.each(n,function(e){var t=i.availableSorts[e.toLowerCase()];void 0!=t&&s.enabledSorts.push(t)}),this.removeEnabledSortsBasedOnFacetType(),this.filterDuplicateForRendering(),e.Utils.isNonEmptyArray(this.enabledSorts)&&(void 0!=this.facet.options.sortCriteria&&(this.activeSort=_.find(this.enabledSorts,function(e){return e.name==s.facet.options.sortCriteria})),this.activeSort||(this.activeSort=this.enabledSorts[0]))}return i.prototype.build=function(){if(this.settingsButton=e.$(this.facetSettingsButtonTemplate()),this.settingsIcon=e.$(this.facetSettingsIconTemplate()),this.settingsPopup=e.$(this.facetSettingsPopupTemplate()),e.Utils.isNonEmptyArray(this.enabledSorts)){var t=this.buildSortSection();this.directionSection=this.buildDirectionSection()}return this.saveStateSection=this.buildSaveStateSection(),this.clearStateSection=this.buildClearStateSection(),this.hideSection=this.buildHideSection(),this.showSection=this.buildShowSection(),this.handleMouseEventOnButton(t),e.Utils.isNonEmptyArray(this.enabledSorts)?this.settingsPopup.append(t.element,this.directionSection,this.saveStateSection,this.clearStateSection,this.hideSection,this.showSection):this.settingsPopup.append(this.saveStateSection,this.clearStateSection,this.hideSection,this.showSection),this.settingsButton.append(this.settingsIcon),this.settingsButton},i.prototype.reorderValues=function(e){return"custom"==this.activeSort.name&&void 0!=this.facet.options.customSort?this.reorderValuesWithCustomOrder(e):e},i.prototype.loadSavedState=function(){var t=this.facetStateLocalStorage.load(),i=this.facet.queryStateModel.get(this.includedStateAttribute),n=this.facet.queryStateModel.get(this.excludedStateAttribute),o=this.facet.queryStateModel.get(this.operatorStateAttribute);if(!e.Utils.isNullOrUndefined(t)&&e.Utils.isEmptyArray(i)&&e.Utils.isEmptyArray(n)&&!e.Utils.isNonEmptyString(o)){var s={};s[this.includedStateAttribute]=t.included,s[this.excludedStateAttribute]=t.excluded,s[this.operatorStateAttribute]=t.operator,this.facet.queryStateModel.setMultiple(s),this.loadedFromSettings=s}},i.prototype.removeEnabledSortsBasedOnFacetType=function(){if(this.facet instanceof t.FacetRange){var e=this.facet;e.options.slider&&(this.enabledSorts=[])}},i.prototype.reorderValuesWithCustomOrder=function(e){var t=this,i=e.length,n=_.map(e,function(e){var n=_.indexOf(t.facet.options.customSort,e.lookupValue||e.value);return n=-1==n?++i:n,{facetValue:e,index:n}}),o=_.sortBy(n,"index");return o="ascending"==this.customSortDirection?o:o.reverse(),_.pluck(o,"facetValue")},i.prototype.buildSortSection=function(){var t=e.$(this.facetSettingsSectionTemplate({_class:"coveo-sort"})),i=e.$(this.facetSettingsSectionIconTemplate()),n=e.$(this.facetSettingsItemsTemplate()),o=this.buildSortSectionItems();return n.append(o),t.append(i,n),{element:t,sortItems:o}},i.prototype.buildSortSectionItems=function(){var t=this;return _.map(this.enabledSorts,function(i){return _.contains(t.enabledSortsIgnoreRenderBecauseOfPairs,i)?e.$("<div></div>").hide():e.$(t.facetSettingsItemTemplate({label:e.L10N.format(i.label),title:i.description})).click(function(e){return t.handleClickSortButton(e,i)})})},i.prototype.closePopupAndUpdateSort=function(){this.closePopup(),"custom"!=this.activeSort.name?this.facet.updateSort(this.activeSort.name):(this.facet.updateSort("nosort"),this.customSortDirectionChange&&(this.customSortDirectionChange=!1,this.facet.queryController.executeQuery()))},i.prototype.closePopup=function(){this.settingsPopup.detach()},i.prototype.buildDirectionSection=function(){var i=this,n=e.$(this.facetSettingsSectionTemplate({_class:"coveo-direction"})),o=e.$(this.facetSettingsSectionIconTemplate()),s=e.$(this.facetSettingsItemsTemplate()),r=e.$(this.facetSettingsItemTemplate({label:t.l.Ascending(),title:t.l.Ascending()})).click(function(e){return i.handleDirectionClick(e,"ascending")}),a=e.$(this.facetSettingsItemTemplate({label:t.l.Descending(),title:t.l.Descending()})).click(function(e){return i.handleDirectionClick(e,"descending")});return s.append(r,a),n.append(o,s),this.activeSort.directionToggle?this.selectItem(this.getItems(n).first()):n.addClass("coveo-disabled"),n},i.prototype.buildSaveStateSection=function(){var i=this,n=e.$(this.facetSettingsSectionTemplate({_class:"coveo-save-state"})),o=e.$(this.facetSettingsSectionIconTemplate()),s=e.$(this.facetSettingsItemsTemplate());this.facetStateLocalStorage=new e.LocalStorageUtils("facet-state-"+this.facet.options.uniqueId),this.includedStateAttribute=e.Models.QueryStateModel.getFacetId(this.facet.options.uniqueId),this.excludedStateAttribute=e.Models.QueryStateModel.getFacetId(this.facet.options.uniqueId,!1),this.operatorStateAttribute=e.Models.QueryStateModel.getFacetOperator(this.facet.options.uniqueId);
e.$(this.facetSettingsItemTemplate({label:t.l.SaveFacetState(),title:t.l.SaveFacetState()})).fastClick(function(e){return i.handleSaveStateClick(e)}).appendTo(s);return n.append(o,s),n},i.prototype.buildClearStateSection=function(){{var i=this,n=e.$(this.facetSettingsSectionTemplate({_class:"coveo-clear-state"})),o=e.$(this.facetSettingsSectionIconTemplate()),s=e.$(this.facetSettingsItemsTemplate());e.$(this.facetSettingsItemTemplate({label:t.l.ClearFacetState(),title:t.l.ClearFacetState()})).fastClick(function(e){return i.handleClearStateClick(e)}).appendTo(s)}return n.append(o,s),n},i.prototype.buildHideSection=function(){{var i=this,n=e.$(this.facetSettingsSectionTemplate({_class:"coveo-hide"})),o=e.$(this.facetSettingsSectionIconTemplate()),s=e.$(this.facetSettingsItemsTemplate());e.$(this.facetSettingsItemTemplate({label:t.l.Collapse(),title:t.l.HideFacet()})).fastClick(function(){i.facet.collapseFacet(),i.settingsPopup.detach()}).appendTo(s)}return n.append(o,s),n},i.prototype.buildShowSection=function(){{var i=this,n=e.$(this.facetSettingsSectionTemplate({_class:"coveo-show"})),o=e.$(this.facetSettingsSectionIconTemplate()),s=e.$(this.facetSettingsItemsTemplate());e.$(this.facetSettingsItemTemplate({label:t.l.Expand(),title:t.l.Expand()})).click(function(){i.facet.expandFacet(),i.settingsPopup.detach()}).appendTo(s)}return n.append(o,s),n},i.prototype.handleClickSettingsButtons=function(i,n){var o=this;this.settingsPopup.is(":visible")?this.settingsPopup.detach():(t.JQueryUtils.positionPopup(this.settingsPopup,e.$(i.delegateTarget),e.$(this.facet.root),e.$(this.facet.root),this.getPopupAlignment()),this.hideSection.toggle(!e.$(this.facet.element).hasClass("coveo-collapsed")),this.showSection.toggle(e.$(this.facet.element).hasClass("coveo-collapsed")),this.clearStateSection.toggle(!e.Utils.isNullOrUndefined(this.facetStateLocalStorage.load())),_.each(this.enabledSorts,function(e,t){o.activeSort.name.toLowerCase()==e.name.toLowerCase()?o.selectItem(n.sortItems[t]):o.unselectItem(n.sortItems[t])}))},i.prototype.handleClickSortButton=function(t,n){this.activeSort=n,n.directionToggle&&_.contains(this.enabledSorts,i.availableSorts[this.activeSort.relatedSort])?this.activateDirectionSection():this.disableDirectionSection(),this.selectItem(e.$(t.target)),this.closePopupAndUpdateSort()},i.prototype.handleDirectionClick=function(t,n){e.$(t.target).parent().parent().hasClass("coveo-disabled")||-1!=this.activeSort.name.indexOf(n)||(this.activeSort=i.availableSorts[this.activeSort.relatedSort],this.unselectSection(this.directionSection),this.selectItem(e.$(t.target)),"custom"==this.activeSort.name&&this.customSortDirection!=n&&(this.customSortDirection=n,this.customSortDirectionChange=!0),this.closePopupAndUpdateSort())},i.prototype.handleSaveStateClick=function(){this.facetStateLocalStorage.save({included:this.facet.queryStateModel.get(this.includedStateAttribute),excluded:this.facet.queryStateModel.get(this.excludedStateAttribute),operator:this.facet.queryStateModel.get(this.operatorStateAttribute)}),this.closePopup()},i.prototype.handleClearStateClick=function(){var e=this;this.facetStateLocalStorage.remove(),this.facet.reset(),this.closePopup(),this.facet.triggerNewQuery(function(){return e.facet.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetClearAll,{facetId:e.facet.options.uniqueId})})},i.prototype.handleMouseEventOnButton=function(t){var i,n=this;this.settingsButton.click(function(e){return n.handleClickSettingsButtons(e,t)}),e.$([this.settingsIcon[0],this.settingsPopup[0]]).mouseleave(function(){return i=setTimeout(function(){n.settingsPopup.detach()},300)}).mouseenter(function(){return clearTimeout(i)})},i.prototype.activateDirectionSection=function(){this.directionSection.removeClass("coveo-disabled"),this.unselectSection(this.directionSection),this.selectItem(this.getItems(this.directionSection).first())},i.prototype.disableDirectionSection=function(){this.directionSection.addClass("coveo-disabled"),this.unselectSection(this.directionSection)},i.prototype.getItems=function(e){return e.find(".coveo-item")},i.prototype.unselectSection=function(e){this.getItems(e).removeClass("coveo-selected")},i.prototype.selectItem=function(e){e.addClass("coveo-selected")},i.prototype.unselectItem=function(e){e.removeClass("coveo-selected")},i.prototype.filterDuplicateForRendering=function(){this.hasDuplicate("alphaascending","alphadescending")&&this.enabledSortsIgnoreRenderBecauseOfPairs.push(i.availableSorts.alphadescending),this.hasDuplicate("computedfieldascending","computedfielddescending")&&this.enabledSortsIgnoreRenderBecauseOfPairs.push(i.availableSorts.computedfielddescending)},i.prototype.getPopupAlignment=function(){var e=t.Device.isMobileDevice()?1:2,i=2;return{horizontal:e,vertical:i}},i.prototype.hasDuplicate=function(e,t){var i=_.filter(this.enabledSorts,function(i){return i.name==e||i.name==t});return void 0!=i&&2==i.length},i.availableSorts={score:{label:t.l.Score(),directionToggle:!1,description:t.l.ScoreDescription(),name:"score"},occurrences:{label:t.l.Occurrences(),directionToggle:!1,description:t.l.OccurrencesDescription(),name:"occurrences"},alphaascending:{label:t.l.Label(),directionToggle:!0,description:t.l.LabelDescription(),name:"alphaascending",relatedSort:"alphadescending"},alphadescending:{label:t.l.Label(),directionToggle:!0,description:t.l.LabelDescription(),name:"alphadescending",relatedSort:"alphaascending"},computedfieldascending:{label:t.l.Value(),directionToggle:!0,description:t.l.ValueDescription(),name:"computedfieldascending",relatedSort:"computedfielddescending"},computedfielddescending:{label:t.l.Value(),directionToggle:!0,description:t.l.ValueDescription(),name:"computedfielddescending",relatedSort:"computedfieldascending"},chisquare:{label:t.l.RelativeFrequency(),directionToggle:!1,description:t.l.RelativeFrequencyDescription(),name:"chisquare"},custom:{label:t.l.Custom(),directionToggle:!0,description:t.l.CustomDescription(),name:"custom",relatedSort:"custom"}},i}();t.FacetSettings=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(i,n){var o=this;this.facet=i,this.facetSearchValuesListKlass=n,this.showingFacetSearchWaitAnimation=!1,this.searchTemplate=_.template("<div class='coveo-search'></div>"),this.magnifierTemplate=_.template("<div class='coveo-magnifier'></div>"),this.waitTemplate=_.template("<div class='coveo-wait-animation'></div>"),this.clearIconTemplate=_.template("<span class='coveo-icon'></span>"),this.clearTemplate=_.template("<div title='"+t.l.Clear(t.l.Search())+"' class='coveo-clear'></div>"),this.middleTemplate=_.template("<div class='coveo-middle'></div>"),this.inputTemplate=_.template("<input type='text' autocapitalize='off' autocorrect='off' placeholder='<%- placeholder %>'/>"),this.searchResultsTemplate=_.template('<ul class="coveo-search-results"/>'),this.searchResults=e.$(this.searchResultsTemplate()),e.$(window).resize(function(){t.Device.isMobileDevice()||o.positionSearchResults()})}return i.prototype.build=function(){return t.Device.isMobileDevice()?this.buildSearchMobile():this.buildBaseSearch()},i.prototype.positionSearchResults=function(){if(null!=this.searchResults&&this.searchResults.is(":visible"))if(t.Device.isMobileDevice())this.searchResults.insertAfter(this.search);else{var i=this.searchResults.outerWidth()-this.searchResults.innerWidth();this.searchResults.outerWidth(this.search.outerWidth()-i),this.searchResults.show(),t.JQueryUtils.positionPopup(this.searchResults,this.search,e.$(this.facet.element),e.$(this.facet.root),{vertical:2,horizontal:1})}},i.prototype.completelyDismissSearch=function(){this.cancelAnyPendingSearchOperation(),this.facet.unfadeInactiveValuesInMainList(),this.search.removeClass("coveo-no-results"),this.hideSearchResultsElement(),this.input.val("")},i.prototype.buildBaseSearch=function(){var i=this;return this.search=e.$(this.searchTemplate()),this.magnifier=e.$(this.magnifierTemplate()).appendTo(this.search),this.wait=e.$(this.waitTemplate()).hide().appendTo(this.search),this.clearIcon=e.$(this.clearIconTemplate()),this.clear=e.$(this.clearTemplate()).appendTo(this.search).hide().append(this.clearIcon),this.middle=e.$(this.middleTemplate()).appendTo(this.search),this.input=e.$(this.inputTemplate({placeholder:t.l.SearchIn(this.facet.options.title)})).appendTo(this.middle),t.Component.pointElementsToDummyForm(this.input),this.input.keyup(function(e){return i.handleFacetSearchKeyUp(e)}),this.clear.fastClick(function(){return i.handleFacetSearchClear()}),this.input.focus(function(e){return i.handleFacetSearchFocus(e)}),this.input.blur(function(){return i.handleFacetSearchBlur()}),this.search},i.prototype.buildSearchMobile=function(){var i=this,n=e.$("<div class='coveo-search-button-mobile'>"+t.l.SearchIn(this.facet.options.title)+"</div>");return this.search=this.buildBaseSearch(),n.fastClick(function(){var n=e.ModalBox.open(e.$("<div />").append(i.search),{title:t.JQueryUtils.getPopUpCloseButton(t.l.Close(),t.l.SearchIn(i.facet.options.title)),validation:function(){return i.completelyDismissSearch(),!0},className:"coveo-mobile-facet-search"});e.$(n.wrapper.find(".coveo-title")).fastClick(function(){return n.close()}),i.input.val("").keyup().focus()}),n},i.prototype.handleFacetSearchKeyUp=function(i){e.Assert.exists(i);var n=""==this.input.val();this.showOrHideClearElement(n),t.Device.isMobileDevice()?this.startNewSearchTimeout():this.handleKeyboardNavigation(i,n)},i.prototype.handleFacetSearchFocus=function(){""==this.getValueInInputForFacetSearch()||t.Device.isMobileDevice()||this.startNewSearchTimeout(),t.Device.isSmallScreenWidth()&&t.JQueryUtils.addToggleClassOnSearchInterface("slide-left")},i.prototype.handleFacetSearchBlur=function(){var e=this;setTimeout(function(){t.Device.isMobileDevice()||e.completelyDismissSearch()},250)},i.prototype.handleFacetSearchClear=function(){this.input.val(""),this.clear.hide(),this.completelyDismissSearch()},i.prototype.showOrHideClearElement=function(e){e?(this.clear.hide(),this.search.removeClass("coveo-no-results")):this.clear.show()},i.prototype.handleKeyboardNavigation=function(e,t){switch(e.which){case 13:this.keyboardNavigationEnterPressed(e,t);break;case 46:this.keyboardNavigationDeletePressed(e);break;case 27:this.completelyDismissSearch();break;case 40:this.moveCurrentResultDown();break;case 38:this.moveCurrentResultUp();break;default:this.highlightCurrentQueryWithinSearchResults(),this.startNewSearchTimeout()}},i.prototype.keyboardNavigationEnterPressed=function(e,t){e.shiftKey?this.triggerNewFacetSearch():this.searchResults.is(":visible")||"block"==this.searchResults.css("display")?(this.performSelectActionOnCurrentSearchResult(),this.completelyDismissSearch()):this.search.is(".coveo-no-results")||t||this.selectAllValuesMatchingSearch()},i.prototype.keyboardNavigationDeletePressed=function(e){e.shiftKey&&(this.performExcludeActionOnCurrentSearchResult(),this.completelyDismissSearch(),this.input.val(""))},i.prototype.triggerNewFacetSearch=function(i){var n=this;"undefined"==typeof i&&(i=this.facet.options.numberOfValuesInFacetSearch),this.cancelAnyPendingSearchOperation(),this.showFacetSearchWaitingAnimation(),this.facet.logger.info("Triggering new facet search");{var o=this.getValueInInputForFacetSearch();t.FacetUtils.getValuesToUseForSearchInFacet(o,this.facet)}this.facetSearchDeferred=this.facet.facetQueryController.recursiveFacetSearch(o,this.facet.options.numberOfValuesInFacetSearch),this.facetSearchDeferred.done(function(e){n.facet.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.facetSearch,{facetId:n.facet.options.uniqueId},n.facet.root),n.facet.logger.debug("Received field values",e),n._processNewFacetSearchResults(e.slice(0,n.facet.options.numberOfValuesInFacetSearch+1)),n.hideFacetSearchWaitingAnimation(),n.facetSearchDeferred=void 0}),this.facetSearchDeferred.fail(function(t,i){e.Utils.exists(i)&&(n.facet.logger.error("Error while retrieving facet values",i),n.hideFacetSearchWaitingAnimation()),n.facetSearchDeferred=void 0})},i.prototype.startNewSearchTimeout=function(){var e=this;this.cancelAnyPendingSearchOperation(),this.facetSearchTimeout=setTimeout(function(){""!=e.getValueInInputForFacetSearch()?e.triggerNewFacetSearch():e.completelyDismissSearch()},this.facet.options.facetSearchDelay)},i.prototype.cancelAnyPendingSearchOperation=function(){e.Utils.exists(this.facetSearchTimeout)&&(clearTimeout(this.facetSearchTimeout),this.facetSearchTimeout=void 0),e.Utils.exists(this.facetSearchDeferred)&&(this.facetSearchDeferred.reject(),this.facetSearchDeferred=void 0),this.hideFacetSearchWaitingAnimation()},i.prototype._processNewFacetSearchResults=function(i){e.Assert.exists(i),i.length>0?(this.search.removeClass("coveo-no-results"),this.facet.fadeInactiveValuesInMainList(this.facet.options.facetSearchDelay),this.rebuildSearchResults(i),this.showSearchResultsElement(),this.highlightCurrentQueryWithinSearchResults(),t.FacetUtils.clipCaptionsToAvoidOverflowingTheirContainer(this.facet,!0),this.makeFirstSearchResultTheCurrentOne()):(this.hideSearchResultsElement(),this.search.addClass("coveo-no-results"))},i.prototype.rebuildSearchResults=function(i){var n=this;e.Assert.exists(i),this.searchResults.empty();var o=e.$('<li class="coveo-selectable coveo-select-all"/>').text("Select All").appendTo(this.searchResults);o.fastClick(function(){return n.selectAllValuesMatchingSearch()});var s=_.map(i,function(e){return t.FacetValue.create(e)});new this.facetSearchValuesListKlass(this.facet,t.FacetValueElement).build(s).appendTo(this.searchResults),this.searchResults.find(".coveo-selectable").each(function(t,i){e.$(i).mousemove(function(){n.makeCurrentResult(e.$(i))})})},i.prototype.showSearchResultsElement=function(){this.searchResults.appendTo(this.facet.root),this.positionSearchResults()},i.prototype.hideSearchResultsElement=function(){this.searchResults.remove()},i.prototype.highlightCurrentQueryWithinSearchResults=function(){var t=this;e.$(this.searchResults).find(".coveo-caption").each(function(i,n){var o=t.getValueInInputForFacetSearch(),s=new RegExp("("+e.StringUtils.wildcardsToRegex(o)+")","ig"),r=e.$(n).text(),a=r.replace(s,'<span class="coveo-highlight">$1</span>');e.$(n).html(a)})},i.prototype.makeFirstSearchResultTheCurrentOne=function(){this.makeCurrentResult(this.getSelectables().first())},i.prototype.makeCurrentResult=function(){this.getSelectables().removeClass("coveo-current"),this.getSelectables().first().addClass("coveo-current")},i.prototype.moveCurrentResultDown=function(){var e=this.searchResults.find(".coveo-current");this.getSelectables().removeClass("coveo-current");var t=e.next(".coveo-selectable").first();t.length>0?t.addClass("coveo-current"):e.siblings(".coveo-selectable").first().addClass("coveo-current")},i.prototype.moveCurrentResultUp=function(){var e=this.searchResults.find(".coveo-current");this.searchResults.find(".coveo-selectable").removeClass("coveo-current");var t=e.prev(".coveo-selectable").first();t.length>0?t.addClass("coveo-current"):e.siblings(".coveo-selectable").last().addClass("coveo-current")},i.prototype.getSelectables=function(e){return"undefined"==typeof e&&(e=this.searchResults),e.find(".coveo-selectable")},i.prototype.performSelectActionOnCurrentSearchResult=function(){var t=this.searchResults.find(".coveo-current");e.Assert.check(1==t.length);var i=t.find('input[type="checkbox"]');i.length>0?(i.prop("checked",!0),i.change()):t.fastClick()},i.prototype.performExcludeActionOnCurrentSearchResult=function(){var t=this.searchResults.find(".coveo-current");e.Assert.check(1==t.length),t.find(".coveo-exclude").fastClick()},i.prototype.getValueInInputForFacetSearch=function(){return this.input.val()},i.prototype.selectAllValuesMatchingSearch=function(){var i=this;this.facet.showWaitingAnimation();var n=this.getValueInInputForFacetSearch(),o=t.FacetUtils.getValuesToUseForSearchInFacet(n,this.facet),s=this.facet.facetQueryController.searchInFacet(1e3,o);s.done(function(n){i.completelyDismissSearch();var o=_.map(n,function(n){var o=i.facet.values.get(n.value);return e.Utils.exists(o)||(o=t.FacetValue.create(n)),o.selected=!0,o.excluded=!1,o});i.facet.processFacetSearchAllResultsSelected(o)}),this.completelyDismissSearch()},i.prototype.showFacetSearchWaitingAnimation=function(){var t=this;e.Defer.defer(function(){t.showingFacetSearchWaitAnimation||(t.wait.width(t.magnifier.width()),t.wait.height(t.magnifier.height()),t.magnifier.hide(),t.wait.show(),t.showingFacetSearchWaitAnimation=!0)})},i.prototype.hideFacetSearchWaitingAnimation=function(){this.showingFacetSearchWaitAnimation&&(this.magnifier.show(),this.wait.hide(),this.showingFacetSearchWaitAnimation=!1)},i}();t.FacetSearch=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(e.FacetSearch);e.HierarchicalFacetSearch=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(e,t){this.facet=e,this.facetValueElementKlass=t,this.valueList={}}return i.prototype.build=function(){return this.valueContainer=e.$('<ul class="coveo-values"/>'),this.valueContainer},i.prototype.get=function(i){var n;return i instanceof t.FacetValue?n=i.value:(i=e.Utils.anyTypeToString(i),n=i),this.ensureFacetValueIsInList(i),this.valueList[n]},i.prototype.select=function(e){var t=this.get(e);return t.select(),t},i.prototype.unselect=function(e){var t=this.get(e);return t.unselect(),t},i.prototype.exclude=function(e){var t=this.get(e);return t.exclude(),t},i.prototype.unExclude=function(e){var t=this.get(e);return t.unexclude(),t},i.prototype.toggleSelect=function(e){var t=this.get(e);return t.facetValue.selected?t.unselect():t.select(),t},i.prototype.toggleExclude=function(e){var t=this.get(e);return t.facetValue.excluded?t.unexclude():t.exclude(),t},i.prototype.rebuild=function(e){var i=this;this.valueContainer.empty();var n=this._getValuesToBuildWith();_.each(n,function(t,n){if(i.facetValueShouldBeRemoved(t))i.facet.values.remove(t.value);else if(e>n){var o=new i.facetValueElementKlass(i.facet,t,!0);i.valueList[t.value]=o;var s=o.build().listElement;i.valueContainer.append(s)}}),t.FacetUtils.addNoStateCssClassToFacetValues(this.facet,this.valueContainer),t.FacetUtils.clipCaptionsToAvoidOverflowingTheirContainer(this.facet)},i.prototype._getValuesToBuildWith=function(){return this.facet.facetSettings?this.facet.facetSettings.reorderValues(this.facet.values.getAll()):this.facet.values.getAll()},i.prototype.facetValueShouldBeRemoved=function(e){return!(0!=e.occurrences||0!=e.delta&&void 0!=e.delta||e.selected||e.excluded||this.facet.keepDisplayedValuesNextTime)},i.prototype.ensureFacetValueIsInList=function(i){var n=i instanceof t.FacetValue?i:t.FacetValue.createFromValue(i);e.Assert.exists(n),this.facet.values.contains(n.value)||(this.facet.values.add(n),this.valueList[n.value]=new t.FacetValueElement(this.facet,n,!0),this.valueList[n.value].build()),void 0==this.valueList[n.value]&&(this.valueList[n.value]=new t.FacetValueElement(this.facet,n,!0),this.valueList[n.value].build())},i.prototype.addNoStateCssClassToFacetValues=function(){if(0!=this.facet.values.getSelected().length){var t=this.valueContainer.find("li").not(".coveo-selected");_.each(t,function(t){e.$(t).addClass("coveo-no-state")})}},i}();t.FacetValuesList=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){e.TranslatedFacetValues={image:e.l.image(),txt:e.l.txt(),zip:e.l.zip(),pdf:e.l.pdf(),html:e.l.html(),xml:e.l.xml(),doc:e.l.doc(),xls:e.l.xls(),ppt:e.l.ppt(),mov:e.l.mov(),folder:e.l.folder(),exchangemessage:e.l.exchangemessage(),exchangeappointment:e.l.exchangeappointment(),exchangenote:e.l.exchangenote(),exchangetask:e.l.exchangetask(),exchangeperson:e.l.exchangeperson(),activedirperson:e.l.activedirperson(),exchangeactivity:e.l.exchangeactivity(),exchangecalendarmessage:e.l.exchangecalendarmessage(),exchangedocument:e.l.exchangedocument(),exchangeofficecom:e.l.exchangeofficecom()}}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(e){function t(t,i){e.call(this,t,i),this.facet=t,this.facetValueElementKlass=i}return __extends(t,e),t.prototype._getValuesToBuildWith=function(){return this.hierarchyFacetValues},t}(e.FacetValuesList);e.HierarchicalFacetValuesList=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(e,t,i,n){this.facet=e,this.facetValues=t,this.omniboxObject=i,this.omniBoxValueElementKlass=n}return i.prototype.build=function(){var e=this,t=[];return _.each(this.facetValues,function(i){t.push(e.buildOmniBoxForOneRow(i,e.omniboxObject))}),this.buildFinalOmniBoxElement(t)},i.prototype.buildOmniBoxForOneRow=function(t,i){var n=new this.omniBoxValueElementKlass(this.facet,t,i),o=n.build().listElement,s=i.completeQueryExpression.regex,r=i.completeQueryExpression.word;o.find(".coveo-caption").html(this.highlightOmniBoxMatch(this.facet.getValueCaption(t),s,r));var a=e.$("<div class='coveo-omnibox-selectable coveo-omnibox-facet-value'></div>").append(o);return a.on("keyboardSelect",function(){o.find("input[type=checkbox]").change()}),a},i.prototype.buildFinalOmniBoxElement=function(i){var n=this.buildOmniBoxHeader();if(e.Utils.isEmptyArray(i))return void 0;var o=e.$("<div></div>").append(n,i);return t.FacetUtils.addNoStateCssClassToFacetValues(this.facet,o),o},i.prototype.buildOmniBoxHeader=function(){var t=e.$("<span class='coveo-icon "+this.facet.options.field.substr(1)+"'></span>"),i=this.facet.options.title;return e.$("<div class='coveo-omnibox-facet-header'></div>").append(t,i)},i.prototype.highlightOmniBoxMatch=function(e,t,i){var n=e.search(t),o=n+i.length;return e.slice(0,n)+"<span class='coveo-highlights'>"+e.slice(n,o)+"</span>"+e.slice(o)},i.prototype.omniBoxCloseEvent=function(e){e.closeOmniBox(),e.clear()},i}();t.OmniboxValuesList=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(t){function i(i,n,o){t.call(this,i,n,o,e.OmniboxHierarchicalValueElement),this.facet=i,this.facetValues=n,this.omniboxObject=o}return __extends(i,t),i}(e.OmniboxValuesList);e.OmniboxHierarchicalValuesList=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(i,n,o){this.facet=i,this.facetValues=n,this.breadcrumbValueElementKlass=o,this.setExpandedAndCollapsed(),this.elem=e.$("<div/>").addClass("coveo-facet-breadcrumb");var s=t.Device.isMobileDevice()?e.$("<div/>"):e.$("<span/>");s.addClass("coveo-title").text(this.facet.options.title+(t.Device.isMobileDevice()?"":":")).appendTo(this.elem),this.valueContainer=e.$("<span/>").addClass("coveo-values").appendTo(this.elem)}return i.prototype.build=function(){return this.buildExpanded(),0!=this.collapsed.length&&this.buildCollapsed(),this.elem},i.prototype.buildExpanded=function(){var i=this;_.each(this.expanded,function(n,o){0==o||t.Device.isMobileDevice()||e.$("<span/>").addClass("coveo-separator").text(", ").appendTo(i.valueContainer),new i.breadcrumbValueElementKlass(i.facet,n).build().appendTo(i.valueContainer)})},i.prototype.buildCollapsed=function(){var i=this,n=_.filter(this.collapsed,function(e){return e.selected}).length,o=_.filter(this.collapsed,function(e){return e.excluded}).length;e.Assert.check(n+o==this.collapsed.length);var s=e.$("<div/>").addClass("coveo-value");t.Device.isMobileDevice()||e.$("<span/>").addClass("coveo-separator").text(", ").appendTo(s),n>0&&(e.$("<span/>").addClass("coveo-multi-count").text(Globalize.format(n,"n0")).appendTo(s),e.$("<div/>").addClass("coveo-selected").addClass("coveo-multi-icon").appendTo(s)),o>0&&(e.$("<span/>").addClass("coveo-multi-count").text(Globalize.format(o,"n0")).appendTo(s),e.$("<div />").addClass("coveo-excluded").addClass("coveo-multi-icon").appendTo(s));var r=_.map(this.collapsed,function(e){return new i.breadcrumbValueElementKlass(i.facet,e)}),a=_.map(r,function(e){return e.getBreadcrumbTooltip()});s.attr("title",a.join("\n")),s.fastClick(function(){var i=[];_.forEach(r,function(n){t.Device.isMobileDevice()||i.push(e.$("<span/>").addClass("coveo-separator").text(", ")[0]),i.push(n.build(!1).get(0))}),e.$(i).insertBefore(s),s.detach()}),this.valueContainer.append(s)},i.prototype.setExpandedAndCollapsed=function(){this.facetValues.length>this.facet.options.numberOfValuesInBreadcrumb?(this.collapsed=_.rest(this.facetValues,this.facet.options.numberOfValuesInBreadcrumb-1),this.expanded=_.first(this.facetValues,this.facet.options.numberOfValuesInBreadcrumb-1)):(this.collapsed=[],this.expanded=this.facetValues)},i}();t.BreadcrumbValueList=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(t){function i(i,n,o){t.call(this,i,n,e.HierarchicalBreadcrumbValueElement),this.facet=i,this.facetValues=n,this.valueHierarchy=o}return __extends(i,t),i}(e.BreadcrumbValueList);e.HierarchicalBreadcrumbValueList=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(){function e(e,t){this.facet=e,this.facetValueElementKlass=t}return e.prototype.build=function(e){var t=this,i=_.map(e,function(e){return _.find(t.facet.values.getAll(),function(t){return t.value==e.value})||e});return _.reduce(_.map(i,function(e){return new t.facetValueElementKlass(t.facet,e,t.facet.keepDisplayedValuesNextTime).build().listElement}),function(e,t){return e.add(t)})},e}();e.FacetSearchValuesList=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(t){function i(i){t.call(this,i,e.HierarchicalFacetSearchValueElement),this.facet=i}return __extends(i,t),i}(e.FacetSearchValuesList);e.HierarchicalFacetSearchValuesList=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(e,t){this.facet=e,this.facetValue=t}return i.prototype.build=function(){this.listElement=e.$('<li class="coveo-value coveo-selectable"/>'),this.listElement.data("value",this.facetValue.value),this.facetValue.excluded||(this.excludeIcon=this._buildExcludeIcon().appendTo(this.listElement)),this.label=e.$("<label/>").appendTo(this.listElement),e.Utils.exists(this.facetValue.computedField)&&(this.computedField=this._buildValueComputedField().appendTo(this.label),this.label.addClass("coveo-with-computed-field"));var t=e.$('<div class="coveo-label"/>').appendTo(this.label);return this.checkbox=this._buildValueCheckbox().appendTo(t),this.stylishCheckbox=this._buildValueStylishCheckbox().appendTo(t),this.facet.options.showIcon&&(this.icon=this._buildValueIcon().appendTo(t)),this.valueCaption=this._buildValueCaption().appendTo(t),this.valueCount=this._buildValueCount().appendTo(t),this._setCssClassOnListValueElement(),this.bindEvent({displayNextTime:!0,pinFacet:this.facet.options.preservePosition}),this},i.prototype.bindEvent=function(t){this.isOmnibox=e.Utils.isNullOrUndefined(t.omniboxObject)?!1:!0,this._handleEventForCheckboxChange(t),this.facetValue.excluded?this._handleEventForExcludedValueElement(t):this._handleEventForValueElement(t)},i.prototype.select=function(){this.facetValue.selected=!0,this.facetValue.excluded=!1,this._setCssClassOnListValueElement()},i.prototype.unselect=function(){this.facetValue.selected=!1,this.facetValue.excluded=!1,this._setCssClassOnListValueElement()},i.prototype.exclude=function(){this.facetValue.selected=!1,this.facetValue.excluded=!0,this._setCssClassOnListValueElement()},i.prototype.unexclude=function(){this.facetValue.selected=!1,this.facetValue.excluded=!1,this._setCssClassOnListValueElement()},i.prototype._buildExcludeIcon=function(){return e.$("<div />").attr("title",t.l.Exclude(this.facet.getValueCaption(this.facetValue))).addClass("coveo-exclude")},i.prototype._buildValueComputedField=function(){var t=this.facetValue.getFormattedComputedField(this.facet.options.computedFieldFormat);return e.Utils.isNonEmptyString(t)?e.$("<span/>").addClass("coveo-computed-field").text(t):e.$([])},i.prototype._buildValueCheckbox=function(){var i=e.$('<input type="checkbox"/>');return i.prop("checked",this.facetValue.selected),i.prop("disabled",this.facetValue.excluded),t.Component.pointElementsToDummyForm(i),i},i.prototype._buildValueStylishCheckbox=function(){var t=e.$("<div/>").addClass("coveo-checkbox");return e.$("<span/>").appendTo(t),t},i.prototype._buildValueIcon=function(){var t=this._getValueIcon();return e.Utils.exists(t)?e.$('<img class="coveo-icon"/>').prop("src",this._getValueIcon()):this._buildValueIconFromSprite()},i.prototype._getValueIcon=function(){return e.Utils.exists(this.facet.options.valueIcon)?this.facet.options.valueIcon(this.facetValue):void 0},i.prototype._buildValueIconFromSprite=function(){return e.$("<div />").addClass("coveo-icon").addClass(this.facet.options.field.substr(1)).addClass(this.facetValue.value)},i.prototype._buildValueCaption=function(){return e.$('<span class="coveo-caption"/>').text(this.facet.getValueCaption(this.facetValue))},i.prototype._buildValueCount=function(){var t=this.facetValue.getFormattedCount();if(e.Utils.isNonEmptyString(t)){var i=e.$("<span/>").addClass("coveo-count").text(t);return i}return e.$([])},i.prototype._handleSelectValue=function(e){var i=this;this.facet.keepDisplayedValuesNextTime=e.displayNextTime&&!this.facet.options.useAnd;var n;this.facetValue.excluded?(n=t.AnalyticsActionCauseList.facetUnexclude,this.facet.unexcludeValue(this.facetValue)):(n=this.facetValue.selected?t.AnalyticsActionCauseList.facetDeselect:t.AnalyticsActionCauseList.facetSelect,this.facet.toggleSelectValue(this.facetValue)),this.isOmnibox&&(n=t.AnalyticsActionCauseList.omniboxFacet),this.facet.triggerNewQuery(function(){return i.facet.usageAnalytics.logSearchEvent(n,i.getAnalyticsFacetMeta())})},i.prototype._handleExcludeClick=function(e){var i=this;this.facet.keepDisplayedValuesNextTime=e.displayNextTime&&!this.facet.options.useAnd,this.facet.toggleExcludeValue(this.facetValue);var n=this.isOmnibox?t.AnalyticsActionCauseList.omniboxFacet:t.AnalyticsActionCauseList.facetExclude;this.facet.triggerNewQuery(function(){return i.facet.usageAnalytics.logSearchEvent(n,i.getAnalyticsFacetMeta())})},i.prototype._handleEventForExcludedValueElement=function(e){var t=this;this.label.fastClick(function(i){e.pinFacet&&t.facet.pinFacetPosition(),e.omniboxObject&&t._omniBoxCloseEvent(e.omniboxObject),t._handleSelectValue(e),i.stopPropagation()})},i.prototype._handleEventForValueElement=function(e){var t=this;this.excludeIcon.fastClick(function(i){e.omniboxObject&&t._omniBoxCloseEvent(e.omniboxObject),t._handleExcludeClick(e),i.stopPropagation()}),this.label.fastClick(function(i){e.pinFacet&&t.facet.pinFacetPosition(),i.preventDefault(),t.checkbox.change()})},i.prototype._handleEventForCheckboxChange=function(i){var n=this;this.checkbox.change(function(){i.omniboxObject&&n._omniBoxCloseEvent(i.omniboxObject),n._handleSelectValue(i),t.Device.isMobileDevice()&&e.Defer.defer(function(){e.ModalBox.close(!0),n.facet.facetSearch.completelyDismissSearch()})})},i.prototype._omniBoxCloseEvent=function(e){e.closeOmniBox(),e.clear()},i.prototype._setCssClassOnListValueElement=function(){this.listElement.toggleClass("coveo-selected",this.facetValue.selected),this.listElement.toggleClass("coveo-excluded",this.facetValue.excluded)},i.prototype.getAnalyticsFacetMeta=function(){return{facetId:this.facet.options.uniqueId,facetValue:this.facetValue.value}},i}();t.ValueElement=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(t){function i(i,n,o){var s=this;t.call(this,i,n),this.facet=i,this.facetValue=n,this.keepDisplayedValueNextTime=o,this.firstQuery=!0,e.$(i.root).one(e.Events.QueryEvents.querySuccess,function(){s.firstQuery=!1})}return __extends(i,t),i.prototype.bindEvent=function(){t.prototype.bindEvent.call(this,{displayNextTime:this.keepDisplayedValueNextTime,pinFacet:this.facet.options.preservePosition})
},i}(t.ValueElement);t.FacetValueElement=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i),this.facet=t,this.facetValue=i,this.eventArg=n}return __extends(t,e),t.prototype.bindEvent=function(){e.prototype.bindEvent.call(this,{displayNextTime:!1,pinFacet:!1,omniboxObject:this.eventArg})},t}(e.ValueElement);e.OmniBoxValueElement=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i,n),this.facet=t,this.facetValue=i,this.eventArg=n}return __extends(t,e),t.prototype._handleSelectValue=function(t){this.facet.open(this.facetValue),e.prototype._handleSelectValue.call(this,t)},t.prototype._handleExcludeClick=function(t){this.facet.open(this.facetValue),e.prototype._handleExcludeClick.call(this,t)},t}(e.OmniBoxValueElement);e.OmniboxHierarchicalValueElement=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(t){function i(e,i,n){t.call(this,e,i,n),this.facet=e,this.facetValue=i,this.keepDisplayedValueNextTime=n}return __extends(i,t),i.prototype.build=function(){var e=t.prototype.build.call(this);return e.label.append(e.excludeIcon),e},i.prototype.buildXOfYCountText=function(t){var i=this,n=this.facet.facetQueryController,o=_.find(n.lastGroupByForCountOf.values,function(e){return e.value==i.facetValue.value});if(o){var s=Globalize.format(o.numberOfResults,"n0");return s!=t?t+" "+e.l.Of()+" "+s:t}return t},i}(e.FacetValueElement);e.HierarchicalFacetValueElement=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i,n),this.facet=t,this.facetValue=i,this.keepDisplayedValueNextTime=n}return __extends(t,e),t.prototype._handleSelectValue=function(t){this.facet.open(this.facetValue),e.prototype._handleSelectValue.call(this,t)},t.prototype._handleExcludeClick=function(t){this.facet.open(this.facetValue),e.prototype._handleExcludeClick.call(this,t)},t}(e.FacetValueElement);e.HierarchicalFacetSearchValueElement=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(e,t){this.facet=e,this.facetValue=t}return i.prototype.build=function(i){var n=this;"undefined"==typeof i&&(i=!0),e.Assert.exists(this.facetValue);var o=t.Device.isMobileDevice()?e.$("<div/>"):e.$("<span/>");o.addClass("coveo-value"),o.toggleClass("coveo-selected",this.facetValue.selected),o.toggleClass("coveo-excluded",this.facetValue.excluded),o.attr("title",this.getBreadcrumbTooltip()),e.$("<span/>").addClass("coveo-caption").text(this.facet.getValueCaption(this.facetValue)).appendTo(o),e.$("<span/>").addClass("coveo-clear").appendTo(o);var s=!1;return o.fastClick(function(){s||(s=!0,n.facetValue.excluded?n.facet.unexcludeValue(n.facetValue.value):n.facet.deselectValue(n.facetValue.value),n.facet.triggerNewQuery(function(){return n.facet.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.breadcrumbFacet,{facetId:n.facet.options.uniqueId,facetValue:n.facetValue.value})}))}),o},i.prototype.getBreadcrumbTooltip=function(){var e=[this.facet.getValueCaption(this.facetValue),this.facetValue.getFormattedCount(),this.facetValue.getFormattedComputedField(this.facet.options.computedFieldFormat)];return _.compact(e).join(" ")},i}();t.BreadcrumbValueElement=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){var t=function(e){function t(t,i){e.call(this,t,i),this.facet=t,this.facetValue=i}return __extends(t,e),t.prototype.build=function(){var t=e.prototype.build.call(this);return t.addClass("coveo-hierarchical-facet-value"),t.find(".coveo-caption").html(this.facetValue.value.split(this.facet.options.delimitingCharacter).join("<span class='coveo-hierarchical-breadcrumb-separator'></span>")),t},t}(e.BreadcrumbValueElement);e.HierarchicalBreadcrumbValueElement=t}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(i){function n(n){i.call(this,n),this.icon=this.loadStringFromAttribute("data-icon",""),this.caption=this.loadStringFromAttribute("data-caption",""),this.expression=this.loadStringFromAttribute("data-expression",""),this.constant=this.loadBooleanFromAttribute("data-constant",!0),this.uniqueId=this.loadStringFromAttribute("data-id",e.$.trim(e.$(this.element).text()));var o=this.loadStringFromAttribute("data-endpoint",void 0);this.endpoint=e.Rest.SearchEndpoint.endpoints[o];var s=this.loadStringFromAttribute("data-sort");void 0!=s&&(this.sort=t.SortCriteria.parse(s))}return __extends(n,i),n}(t.ComponentOptions);t.DefaultTabOptions=i;var n=function(n){function o(t,s,r){n.call(this,t,o.ID,r),this.element=t,this.options=s,this.iconTemplate=_.template("<span class='coveo-icon <%= icon %>'></span>"),this.tabTemplate=_.template("<%= icon %><%= caption %>"),this.isFirstQuery=!0,this.options=new i(t).merge(s),e.$(this.root).on(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQuery,this));var a=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.t);e.$(this.root).on(a,e.$.proxy(this.handleQueryStateChanged,this)),this.render(),e.$(this.element).fastClick(e.$.proxy(this.handleClick,this))}return __extends(o,n),o.prototype.select=function(){this.queryStateModel.setMultiple({t:this.options.uniqueId,sort:e.Models.QueryStateModel.defaultAttributes.sort})},o.prototype.handleClick=function(e){var i=this;e.preventDefault(),this.select(),t.Device.isMobileDevice()&&t.JQueryUtils.removeToggleClassOnSearchInterface(),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.interfaceChange,{interfaceChangeTo:i.options.uniqueId})}})},o.prototype.render=function(){var t=this.options.icon,i="";if(""!=t)i=this.iconTemplate({icon:t});else{var n=e.$(this.element).children()[0];void 0!=n&&(i=n.outerHTML)}var o=this.options.caption,s="";s=""==o?e.$.trim(e.$(this.element).text()):o,s=s.toLocaleString(),e.$(this.element).html("");var r=this.tabTemplate({icon:i,caption:s});e.$(this.element).append(r)},o.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i),this.isFirstQuery=!1,this.isSelected()&&e.Utils.isNonEmptyString(this.options.expression)&&(this.options.constant?i.queryBuilder.constantExpression.add(this.options.expression):i.queryBuilder.advancedExpression.add(this.options.expression))},o.prototype.handleQueryStateChanged=function(t,i){e.Assert.exists(i),this.isSelected()?(e.$(this.element).addClass("coveo-selected"),this.queryController.setEndpoint(this.options.endpoint),this.showAndHideAppropriateElements()):e.$(this.element).removeClass("coveo-selected")},o.prototype.isSelected=function(){var t=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.t);return t==this.options.uniqueId},o.prototype.showAndHideAppropriateElements=function(){var t=this,i=[],n=[];_.each(e.$(this.root).find("[data-tab],[data-tab-not]"),function(e){t.isElementIncludedInTab(e)?(t.toggleAllComponentsUnder(e,!0),i.push(e)):(t.toggleAllComponentsUnder(e,!1),n.push(e))}),e.$(this.root).one(e.Events.QueryEvents.querySuccess,function(){_.each(i,function(t){return e.$(t).removeClass("coveo-tab-disabled")}),_.each(n,function(t){return e.$(t).addClass("coveo-tab-disabled")})})},o.prototype.isElementIncludedInTab=function(t){e.Assert.exists(t);var i=this.splitListOfTabs(e.$(t).attr("data-tab")),n=this.splitListOfTabs(e.$(t).attr("data-tab-not"));return e.Assert.check(!(0!=i.length&&0!=n.length),"You cannot both explicity include and exclude an element from tabs"),0!=i.length&&-1!=_.indexOf(i,this.options.uniqueId)||0!=n.length&&-1==_.indexOf(n,this.options.uniqueId)||0==i.length&&0==n.length},o.prototype.splitListOfTabs=function(t){return e.Utils.exists(t)?_.map(t.split(","),function(t){return e.Utils.trim(t)}):[]},o.prototype.toggleAllComponentsUnder=function(i,n){e.Assert.exists(i),e.$(i).find("*").addBack().each(function(e,i){var o=t.Component.get(i,void 0,!0);o&&(n?o.enable():o.disable())})},o.prototype.enable=function(){n.prototype.enable.call(this),e.$(this.element).css("display","")},o.prototype.disable=function(){n.prototype.disable.call(this),e.$(this.element).css("display","none")},o.ID="Tab",o}(t.Component);t.Tab=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(i){function n(e){i.call(this,e),this.title=this.loadStringFromAttribute("data-title",void 0),this.showLoadingAnimation=this.loadBooleanFromAttribute("data-show-loading-animation",!0),this.contentTemplate=this.loadResultTemplateFromSelectorAttribute("data-template-selector"),this.contentTemplate=this.loadResultTemplateFromIdAttribute("data-template-id",this.contentTemplate),this.contentTemplate=this.loadChildResultTemplateFromSelector(".content-template",this.contentTemplate),this.loadingAnimation=this.getLoadingAnimationOption()}return __extends(n,i),n.prototype.getLoadingAnimationOption=function(){var i=this.loadHtmlElementFromSelectorAttribute("data-loading-animation-selector");if(i)e.$(i).remove();else{var n=this.loadResultTemplateFromIdAttribute("data-loading-animation-template-id");n&&(i=n.instantiateToElement())}return i=i||t.JQueryUtils.getBasicLoadingAnimation().get(0)},n}(t.ComponentOptions);t.DefaultQuickViewOptions=i;var n=function(n){function o(t,s,r,a){var l=this;n.call(this,t,o.ID,r),this.element=t,this.options=s,this.result=a,this.childsElements=[],this.options=new i(t).merge(s),null==this.options.contentTemplate?e.$(this.root).one(e.Events.ResultListEvents.newResultsDisplayed,function(){l.dialogBoxContent=e.$(l.element).children().detach(),l.createLinkAndAppendItToDom(a)}):this.element.innerHTML.match(/^\s*$/)&&this.createLinkAndAppendItToDom(a),this.bindClick(a)}return __extends(o,n),o.prototype.open=function(){var e=this.prepareOpenQuickViewObject();this.createModalBox(e),this.bindQuickViewEvents(e),this.animateAndOpen()},o.prototype.close=function(){this.modalbox.close(),t.Device.isAndroid()&&t.Device.isPhonegap()&&e.$(document).off("backbutton")},o.prototype.createLinkAndAppendItToDom=function(t){("undefined"==typeof t.hasHtmlVersion||t.hasHtmlVersion)&&(this.link=e.$(o.quickViewLinkTemplate()),e.$(this.element).append(this.link))},o.prototype.bindClick=function(t){"undefined"==typeof t.hasHtmlVersion||t.hasHtmlVersion?e.$(this.element).fastClick(e.$.proxy(this.open,this)):e.$(this.element).css("display","none")},o.prototype.bindQuickViewEvents=function(i){var n=this;t.Device.isAndroid()&&t.Device.isPhonegap()&&e.$(document).on("backbutton",function(){n.close()}),e.$(this.modalbox.wrapper.find(".coveo-title")).fastClick(function(){return n.close()}),e.$(window).on("resize orientationchange",i.resizeHandler),this.modalbox.content.on(e.Events.UserActionEvents.quickViewLoaded,function(){e.$(i.loadingAnimation).remove()})},o.prototype.animateAndOpen=function(){var i=this,n=this.modalbox.wrapper.css("animation-duration");if(n){var o=/^(.+)(ms|s)$/.exec(n),s=Number(o[1])*("s"==o[2]?1e3:1);setTimeout(function(){e.$(i.modalbox.modalBox.find("."+t.Component.computeCssClassNameForType(t.QuickViewDocument.ID))).coveo("open"),i.resizeIFrame()},s)}else e.$(this.modalbox.modalBox.find("."+t.Component.computeCssClassNameForType(t.QuickViewDocument.ID))).coveo("open"),this.resizeIFrame()},o.prototype.createModalBox=function(i){var n=this;i.content&&(this.dialogBoxContent=i.content);var o=e.$("<div/>").append(this.dialogBoxContent);this.options.title&&o.prepend(e.$('<div class="coveo-title" />').html(this.options.title)),this.modalbox=e.ModalBox.open(o,{overlayClose:!0,title:t.JQueryUtils.getPopUpCloseButton(t.l.Close(),t.l.QuickView()),className:"coveo-quick-view",validation:function(){return e.$(window).off("resize orientationchange",i.resizeHandler),n.modalbox=null,!0}})},o.prototype.prepareOpenQuickViewObject=function(){var e=this,t=function(){e.resizeIFrame()},i=this.options.loadingAnimation;return{resizeHandler:t,loadingAnimation:i,content:void 0!=this.options.contentTemplate?this.prepareQuickViewContent(i):void 0}},o.prototype.prepareQuickViewContent=function(i){var n=e.$(this.options.contentTemplate.instantiateToElement(this.result)),o=this.searchInterface.options,s=e.$.extend({},{options:o},this.getBindings(),{result:this.result});return t.CoveoJQuery.automaticallyCreateComponentsInside(n.get(0),s),0!=n.find("."+t.Component.computeCssClassNameForType(t.QuickViewDocument.ID)).length&&this.options.showLoadingAnimation&&n.prepend(i),n},o.prototype.resizeIFrame=function(){var e=this.modalbox.content.find("."+t.Component.computeCssClassNameForType(t.QuickViewDocument.ID)).find("iframe");if(0!=e.length){var i=this.modalbox.content.get(0).scrollHeight-this.modalbox.content.outerHeight(),n=this.modalbox.content.get(0).scrollWidth-this.modalbox.content.outerWidth();i>0?e.height(e.height()-i):e.css("height",""),n>0?e.width(e.width()-n-5):e.css("width","")}},o.ID="QuickView",o.quickViewLinkTemplate=_.template("<div class='coveo-icon-for-quickview'>"+t.l.QuickView()+"</div>"),o}(t.Component);t.QuickView=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i="CoveoHighlight",n=function(e){function t(t){e.call(this,t),this.maximumDocumentSize=this.loadNumberFromAttribute("data-maximum-document-size",0),this.allowedZoom=this.loadBooleanFromAttribute("data-allowed-zoom",!0),this.minimumZoom=this.loadNumberFromAttribute("data-minimum-zoom",.5),this.maximumZoom=this.loadNumberFromAttribute("data-maximum-zoom",4)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultQuickViewDocumentOptions=n;var o=function(o){function s(t,i,r,a){o.call(this,t,s.ID,r),this.element=t,this.options=i,this.result=a,this.options=new n(t).merge(i),this.result=a||this.resolveResult(),e.Assert.exists(this.result)}return __extends(s,o),s.prototype.createDom=function(){this.header=this.buildHeader().appendTo(e.$(this.element)),this.iframe=this.buildIFrame().appendTo(e.$(this.element))},s.prototype.open=function(){var i=this;this.ensureDom(),this.usageAnalytics.logClickEvent(t.AnalyticsActionCauseList.documentQuickView,{documentTitle:this.result.title,documentURL:this.result.clickUri},this.result,this.queryController.element);var n=(new Date).getTime(),o=this.iframe.find("iframe")[0];o.src="about:blank";var s=this.queryController.getEndpoint(),r={query:this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.q),requestedOutputSize:this.options.maximumDocumentSize};s.getDocumentHtml(this.result.uniqueId,r).done(function(e){i.renderHTMLDocument(o,e),i.triggerQuickviewLoaded(n)}).fail(function(t,r){0!=r.status?(i.renderErrorReport(o),i.triggerQuickviewLoaded(n)):(o.onload=function(){i.triggerQuickviewLoaded(n)},o.src=s.getViewAsHtmlUri(i.result.uniqueId,i.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.q)))})},s.prototype.renderHTMLDocument=function(e,i){var n=this;e.onload=function(){n.onReceivingMessage(e.contentWindow)},this.writeToIFrame(e,i),this.wrapPreElementsInIframe(e),t.Device.isMobileDevice()&&this.bindOpenIframeLinksInPhonegap(e)},s.prototype.renderErrorReport=function(e){var i="<html><body style='font-family: Arimo, \"Helvetica Neue\", Helvetica, Arial, sans-serif; -webkit-text-size-adjust: none;'>"+t.l.OopsError()+"</body></html>";this.writeToIFrame(e,i)},s.prototype.writeToIFrame=function(e,t){var i=t;"object"==typeof t&&(i=t.getElementsByTagName("html")[0].outerHTML),e.contentWindow.document.open(),e.contentWindow.document.write(i),e.contentWindow.document.close()},s.prototype.bindOpenIframeLinksInPhonegap=function(i){try{var n=e.$(i.contentWindow.document).find("a");_.each(n,function(e){var i=e.href;e.href="javascript:",t.PhonegapUtils.bindOpenLinkInPhonegap(e,i)})}catch(o){}},s.prototype.wrapPreElementsInIframe=function(i){var n=this;try{var o=document.createElement("style");o.type="text/css";var s='html pre { white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;} body, html {Arimo, "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-text-size-adjust: none; margin:0; padding:0; transform-origin:0 0; -ms-transform-origin:0 0; -webkit-transform-origin:0 0;} * { max-width: 100%; -webkit-text-size-adjust: none; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;} html body {height: auto; width: auto;}';o.styleSheet?o.styleSheet.cssText=s:o.appendChild(document.createTextNode(s));var r=i.contentWindow.document.head;if(r.appendChild(o),t.Device.isMobileDevice()&&this.options.allowedZoom){var a=t.Device.isIos()?this.iframe.get(0):i.contentWindow.document.body,l=t.Device.isIos()?i:i.contentWindow.document.body.firstChild;e.$(a).css("overflow","scroll");var u={scaleElement:l,scrollElement:a,scale:1,scroll:{left:0,top:0},initialState:void 0};e.$(a).on("touchstart",function(e){n.handleTouchStart(e,u)}).on("touchmove",function(e){n.handleTouchMove(e,u)}).on("touchend",function(e){n.handleTouchEnd(e,u)}),this.iframeSizeCalculation(i),e.$(window).on("orientationchange",function(){n.iframeSizeCalculation(i),e.$(u.scrollElement).animate({scrollLeft:0,scrollTop:0},0)})}}catch(c){}},s.prototype.handleTouchStart=function(e,t){var i=this,n=_.map(e.originalEvent.touches,function(e){return i.mouseEventToPoint(e,t.scrollElement)});t.initialState={scale:t.scale,touches:n,centerClient:{x:this.getMeanValue(n,"x"),y:this.getMeanValue(n,"y")},scroll:{left:t.scrollElement.scrollLeft,top:t.scrollElement.scrollTop},distance:2==n.length?this.distance(n[0],n[1]):0}},s.prototype.handleTouchMove=function(e,t){var i=this,n=_.map(e.originalEvent.touches,function(e){return i.mouseEventToPoint(e,t.scrollElement)});if(null!=t.initialState){if(2===n.length){var o=this.distance(n[0],n[1]);t.scale=Math.max(this.options.minimumZoom,Math.min(this.options.maximumZoom,o/t.initialState.distance*t.initialState.scale))}return t.scroll={left:(t.initialState.scroll.left+t.initialState.centerClient.x)/t.initialState.scale*t.scale-this.getMeanValue(n,"x"),top:(t.initialState.scroll.top+t.initialState.centerClient.y)/t.initialState.scale*t.scale-this.getMeanValue(n,"y")},this.updateScaleScroll(t.scrollElement,t.scaleElement,t.scale,t.scroll,!1),e.preventDefault(),!1}},s.prototype.handleTouchEnd=function(e,i){e.originalEvent.touches;this.updateScaleScroll(i.scrollElement,i.scaleElement,i.scale,i.scroll,!0),t.Device.isIos()&&this.overlaps.css({"-ms-transform":"scale("+i.scale+","+i.scale+") translate(0, 0)","-webkit-transform":"scale("+i.scale+","+i.scale+") translate(0, 0)",transform:"scale("+i.scale+","+i.scale+") translate(0, 0)","transform-origin":"0 0","-ms-transform-origin":"0 0","-webkit-transform-origin":"0 0"}),i.initialState=null},s.prototype.iframeSizeCalculation=function(i){var n=e.$(i.contentWindow.document.body).width(),o=e.$(i.contentWindow.document.body).height();e.$(i.contentWindow.document.body).width(n),e.$(i.contentWindow.document.body).height(o),t.Device.isMobileDevice()&&this.resizeIframe(),t.Device.isIos()&&(this.overlaps&&this.overlaps.remove(),this.overlaps=e.$("<div />").css({top:0,left:0,width:Math.max(window.innerWidth,n),height:Math.max(window.innerHeight,o),position:"absolute"}).appendTo(this.iframe),this.overlaps.fastClick(function(t){var n=e.$(i).offset();e.$(i.contentWindow.document.elementFromPoint(t.clientX-n.left,t.clientY-n.top)).fastClick()}),e.$(this.iframe).css({position:"relative"}))},s.prototype.getMeanValue=function(e,t){return 1==e.length?e[0][t]:_.reduce(e,function(e,i){return e[t]+i[t]})/e.length},s.prototype.mouseEventToPoint=function(t,i){var n=e.$(i).offset();return{x:t.clientX-n.left,y:t.clientY-n.top}},s.prototype.distance=function(e,t){return Math.ceil(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)))},s.prototype.updateScaleScroll=function(t,i,n,o,s){if("undefined"==typeof s&&(s=!0),s){var r="scale("+n+","+n+") translate(0, 0)";e.$(i).css({"-ms-transform":r,"-webkit-transform":r,transform:r,"transform-origin":"0 0","-ms-transform-origin":"0 0","-webkit-transform-origin":"0 0"}),e.$(t).animate({scrollLeft:o.left,scrollTop:o.top},0)}else{e.$(t).animate({scrollLeft:0,scrollTop:0},0);var r="scale("+n+","+n+") translate("+-1*o.left/n+"px, "+-1*o.top/n+"px)";e.$(i).css({"-ms-transform":r,"-webkit-transform":r,transform:r,"transform-origin":"0 0","-ms-transform-origin":"0 0","-webkit-transform-origin":"0 0"})}},s.prototype.triggerQuickviewLoaded=function(t){var i=(new Date).getTime(),n={duration:i-t};e.$(this.element).trigger(e.Events.UserActionEvents.quickViewLoaded,n)},s.prototype.onReceivingMessage=function(t){var n=this;this.header.empty();var o={};this.keywordsState=[];var s=e.$(t.document.body).find("[id^="+i+"]");0==s.length&&this.header.css("min-height",0);for(var r=0;r<s.length;r++){var a=s[r],l=a.id.substr(i.length+1).match(/^([0-9]+)\.([0-9]+)\.([0-9]+)$/);if(null!=l){var u=l[1],c=l[2];o[u]?o[u].count=Math.max(o[u].count,Number(c)):o[u]={text:a.innerHTML,count:1,index:u}}}for(var h=_.keys(o),r=0;r<h.length;r++){var u=h[r],d=o[u],p=e.$(t.document.body).find('[id^="'+i+":"+u+'.1"]')[0],f=p.style.backgroundColor;this.keywordsState.push({word:d,color:f,currentIndex:0,index:Number(d.index)})}e.$.each(this.keywordsState,function(e,i){n.header.append(n.buildWordButton(i,t))})},s.prototype.buildWordButton=function(t,i){var n=this,o=e.$("<span/>").addClass("coveo-term");return o.append(e.$("<span/>").addClass("coveo-term-left-arrow").append(e.$("<span/>").addClass("coveo-term-left-arrow-icon")).click(function(){n.navigate(t,!0,i)})),o.append(e.$("<span/>").addClass("coveo-term-name").text(t.word.text).click(function(){n.navigate(t,!1,i)})),o.append(e.$("<span/>").addClass("coveo-term-right-arrow").append(e.$("<span/>").addClass("coveo-term-right-arrow-icon")).click(function(){n.navigate(t,!1,i)})),o.css("background-color",t.color),o},s.prototype.navigate=function(t,n,o){var s,r=t.currentIndex;s=n?1>=r?t.word.count:r-1:r==t.word.count?1:r+1;var a=e.$(o.document.body),l=a.find('[id^="'+i+":"+t.word.index+"."+s+'"]')[0],u=e.$(l).offset(),c=a.get(0);a.stop(!0).animate({scrollLeft:u.left-c.clientWidth/2+e.$(l).width()/2,scrollTop:u.top-c.clientHeight/2+e.$(l).height()/2}),this.iframe.stop(!0).animate({scrollLeft:u.left-this.iframe.width()/2+e.$(l).width()/2,scrollTop:u.top-this.iframe.height()/2+e.$(l).height()/2});var h=a.find('[id^="'+i+":"+t.word.index+"."+r+'"]')[0];null!=h&&(h.style.border=""),l.style.border="1px dotted #333",t.currentIndex=s},s.prototype.buildHeader=function(){return e.$("<div/>").addClass("coveo-quickview-header")},s.prototype.buildIFrame=function(){return e.$('<div class="coveo-iframeWrapper"><iframe/></div>')},s.prototype.resizeIframe=function(){var i=_.reduce(e.$(".coveo-modalBox .coveo-title, .coveo-modalBox .coveo-quick-view-header, .coveo-modalBox ."+t.Component.computeCssClassNameForType(t.EmailAction.ID)),function(t,i){return t+e.$(i).height()},0)+20;e.$(this.iframe).height(e.$(".coveo-modalBox .coveo-body").height()-i)},s.ID="QuickViewDocument",s}(t.Component);t.QuickViewDocument=o,t.CoveoJQuery.registerAutoCreateComponent(o)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function i(i){e.call(this,i),this.title=this.loadStringFromAttribute("data-title","No Title"),this.field=this.loadStringFromAttribute("data-field"),this.isMultiValueField=this.loadBooleanFromAttribute("data-is-multi-value-field",!1),this.numberOfValues=this.loadNumberFromAttribute("data-number-of-values",5),this.morePageSize=this.loadNumberFromAttribute("data-page-size",10),this.availableSorts=this.loadStringFromAttribute("data-available-sorts","occurrences,score,alphaAscending,alphaDescending").split(","),this.sortCriteria=this.loadStringFromAttribute("data-sort-criteria",this.availableSorts.length>0?this.availableSorts[0]:"occurrences"),this.injectionDepth=this.loadNumberFromAttribute("data-injection-depth",1e3),this.showIcon=this.loadBooleanFromAttribute("data-show-icon",!1),this.headerIcon=this.loadStringFromAttribute("data-header-icon"),this.useAnd=this.loadBooleanFromAttribute("data-use-and",!1),this.enableCollapse=this.loadBooleanFromAttribute("data-enable-collapse",!0),this.allowTogglingOperator=this.loadBooleanFromAttribute("data-allow-toggling-operator",!1),this.enableMoreLess=this.loadBooleanFromAttribute("data-enable-more-less",!0),this.lookupField=this.loadStringFromAttribute("data-lookup-field"),this.enableFacetSearch=this.loadBooleanFromAttribute("data-enable-facet-search",!0),this.facetSearchDelay=this.loadNumberFromAttribute("data-facet-search-delay",100),this.numberOfValuesInFacetSearch=this.loadNumberFromAttribute("data-number-of-values-in-facet-search",15),this.includeInBreadcrumb=this.loadBooleanFromAttribute("data-include-in-breadcrumb",!0),this.includeInOmniBox=this.loadBooleanFromAttribute("data-include-in-omnibox",this.enableFacetSearch),this.numberOfValuesInBreadcrumb=this.loadNumberFromAttribute("data-number-of-values-in-breadcrumb",t.Device.isMobileDevice()?3:5),this.numberOfValuesInOmniBox=this.loadNumberFromAttribute("data-number-of-values-in-omnibox",5),this.numberOfValuesInBreadcrumb=this.loadNumberFromAttribute("data-number-of-values-in-breadcrumb",5),this.uniqueId=this.loadStringFromAttribute("data-id",this.field),this.computedField=this.loadStringFromAttribute("data-computed-field"),this.computedFieldOperation=this.loadStringFromAttribute("data-computed-field-operation","sum"),this.computedFieldFormat=this.loadStringFromAttribute("data-computed-field-format","c0"),this.computedFieldCaption=this.loadStringFromAttribute("data-computed-field-caption",t.l.ComputedField()),this.preservePosition=this.loadBooleanFromAttribute("data-preserve-position",!0),this.scrollContainer=this.loadHtmlElementFromSelectorAttribute("data-scroll-container",t.JQueryUtils.findScrollingParent(i)),this.paddingContainer=this.loadHtmlElementFromSelectorAttribute("data-padding-container",this.element.parentElement),this.customSort=this.loadStringArrayFromAttribute("data-custom-sort",void 0,","),this.enableSettings=this.loadBooleanFromAttribute("data-enable-settings",!0),this.allowedValues=this.loadStringArrayFromAttribute("data-allowed-values",void 0,",")}return __extends(i,e),i}(t.ComponentOptions);t.DefaultFacetOptions=i;var n=function(n){function o(s,r,a,l){"undefined"==typeof l&&(l=o.ID);var u=this;n.call(this,s,l,a),this.element=s,this.options=r,this.keepDisplayedValuesNextTime=!1,this.values=new t.FacetValues,this.firstQuery=!0,this.canFetchMore=!0,this.showingWaitAnimation=!1,this.listenToQueryStateChange=!0,this.options=new i(s).merge(r),e.Assert.check(e.Utils.isCoveoField(this.options.field),this.options.field+" is not a valid field"),this.options.field=this.options.field.toLowerCase(),null!=this.options.valueCaption&&(this.options.availableSorts=_.filter(this.options.availableSorts,function(e){return!/^alpha.*$/.test(e)})),this._omniBoxZIndex=o.omniboxIndex,o.omniboxIndex--,this._checkForComputedFieldAndSort(),this._checkForValueCaptionType(),this._checkForAllowedValuesOption(),this._checkForCustomSort(),this._initFacetQueryController(),this._initQueryEvents(),this._initQueryStateEvents(),this._initComponentStateEvents(),this._initOmniBoxEvents(),this._initBreadCrumbEvents(),this.numberOfValues=this.options.numberOfValues,e.$(window).resize(function(){u.disabled||t.FacetUtils.clipCaptionsToAvoidOverflowingTheirContainer(u)}),this._updateAppearanceDependingOnState(),e.$(this.root).one(e.Events.QueryEvents.querySuccess,function(){u.firstQuery=!1})}return __extends(o,n),o.prototype.createDom=function(){var t=this;this._initBottomAndTopSpacer(),this._buildFacetContent(),this._updateAppearanceDependingOnState(),this.facetSettings&&(this.searchInterface.options.enableHistory?this.bind.onRoot(e.Events.InitializationEvents.restoreHistoryState,function(){t.facetSettings.loadSavedState()}):this.facetSettings.loadSavedState())},o.prototype.selectValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Selecting facet value",this.facetValuesList.select(t)),this._facetValueHasChanged()},o.prototype.selectMultipleValues=function(t){var i=this;e.Assert.exists(t),this.ensureDom(),_.each(t,function(e){i.logger.info("Selecting facet value",i.facetValuesList.select(e))}),this._facetValueHasChanged()},o.prototype.deselectValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Deselecting facet value",this.facetValuesList.unselect(t)),this._facetValueHasChanged()},o.prototype.deselectMultipleValues=function(t){var i=this;e.Assert.exists(t),this.ensureDom(),_.each(t,function(e){i.logger.info("Deselecting facet value",i.facetValuesList.unselect(e))}),this._facetValueHasChanged()},o.prototype.excludeValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Excluding facet value",this.facetValuesList.exclude(t)),this._facetValueHasChanged()},o.prototype.excludeMultipleValues=function(t){var i=this;e.Assert.exists(t),this.ensureDom(),_.each(t,function(e){i.logger.info("Excluding facet value",i.facetValuesList.exclude(e))}),this._facetValueHasChanged()},o.prototype.unexcludeValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Unexcluding facet value",this.facetValuesList.unExclude(t)),this._facetValueHasChanged()},o.prototype.unexcludeMultipleValues=function(t){var i=this;e.Assert.exists(t),this.ensureDom(),_.each(t,function(e){i.logger.info("Unexcluding facet value",i.facetValuesList.unExclude(e))}),this._facetValueHasChanged()},o.prototype.toggleSelectValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Toggle select facet value",this.facetValuesList.toggleSelect(t)),this._facetValueHasChanged()},o.prototype.toggleExcludeValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Toggle exclude facet value",this.facetValuesList.toggleExclude(t)),this._facetValueHasChanged()},o.prototype.getDisplayedValues=function(){return this.ensureDom(),_.first(_.pluck(this.values.getAll(),"value"),this.numberOfValues)},o.prototype.getSelectedValues=function(){return this.ensureDom(),_.map(this.values.getSelected(),function(e){return e.value})},o.prototype.getExcludedValues=function(){return this.ensureDom(),_.map(this.values.getExcluded(),function(e){return e.value})},o.prototype.reset=function(){this.ensureDom(),this.values.reset(),this._rebuildValueElements(),this._updateAppearanceDependingOnState(),this._updateQueryStateModel()},o.prototype.switchToAnd=function(){this.ensureDom(),this.logger.info("Switching to AND"),this.options.useAnd=!0,this._rebuildOperatorToggle(),this._updateOperatorQueryStateModel()},o.prototype.getEndpoint=function(){return this.queryController.getEndpoint()},o.prototype.switchToOr=function(){this.ensureDom(),this.logger.info("Switching to OR"),this.options.useAnd=!1,this._rebuildOperatorToggle(),this._updateOperatorQueryStateModel()},o.prototype.updateSort=function(e){var i=this;this.options.sortCriteria!=e&&(this.options.sortCriteria=e,this.triggerNewQuery(function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetSortValues,{facetId:i.options.uniqueId,facetSortBy:e})}))},o.prototype.collapseFacet=function(){this.collapseElement.hide(),this.excludeElement.show(),e.$(this.element).addClass("coveo-collapsed")},o.prototype.expandFacet=function(){this.excludeElement.hide(),this.collapseElement.show(),e.$(this.element).removeClass("coveo-collapsed"),t.FacetUtils.clipCaptionsToAvoidOverflowingTheirContainer(this)},o.prototype.unfadeInactiveValuesInMainList=function(){e.$(this.element).removeClass("coveo-fade")},o.prototype.fadeInactiveValuesInMainList=function(){e.$(this.element).addClass("coveo-fade")},o.prototype.showWaitingAnimation=function(){var t=this;e.Defer.defer(function(){t.showingWaitAnimation||(t.headerElement.find(".coveo-icon").first().css("display","none"),t.headerElement.find(".coveo-wait-animation").css("display",""),t.showingWaitAnimation=!0)
})},o.prototype.hideWaitingAnimation=function(){var t=this;e.Defer.defer(function(){t.showingWaitAnimation&&(t.headerElement.find(".coveo-icon").css("display",""),t.headerElement.find(".coveo-wait-animation").css("display","none"),t.showingWaitAnimation=!1)})},o.prototype.processFacetSearchAllResultsSelected=function(e){var i=this,n=[];_.each(e,function(e){i._ensureFacetValueIsInList(e),n.push(e.value)}),this._updateQueryStateModel(),this.triggerNewQuery(function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetSelectAll,{facetId:i.options.uniqueId})})},o.prototype.pinFacetPosition=function(){this.pinnedViewportPosition=this.element.getBoundingClientRect().top},o.prototype.getValueCaption=function(i){e.Assert.exists(i);var n=i.lookupValue||i.value,o=n;return o=t.FacetUtils.tryToGetTranslatedCaption(n),e.Utils.exists(this.options.valueCaption)&&("object"==typeof this.options.valueCaption&&(o=this.options.valueCaption[n]||o),"function"==typeof this.options.valueCaption&&(this.values.get(n),o=this.options.valueCaption.call(this,this.facetValuesList.get(n).facetValue))),o},o.prototype.enable=function(){n.prototype.enable.call(this)},o.prototype.disable=function(){n.prototype.disable.call(this)},o.prototype.triggerNewQuery=function(t){var i=this;this.queryController.deferExecuteQuery({beforeExecuteQuery:t}),e.Defer.defer(function(){return i.showWaitingAnimation()})},o.prototype._checkForComputedFieldAndSort=function(){-1!=this.options.sortCriteria.toLowerCase().indexOf("computedfield")&&e.Utils.isNullOrUndefined(this.options.computedField)&&this.logger.warn("Sort criteria is specified as ComputedField, but the facet uses no computed field. Facet will always be empty !",this)},o.prototype._checkForValueCaptionType=function(){this.options.valueCaption&&"function"==typeof this.options.valueCaption&&(this.options.enableFacetSearch=!1,this.options.includeInOmniBox=!1,this.logger.warn("Using a function as valueCaption is now deprecated. Use a json key value pair instead. Facet search and omnibox has been disabled for this facet",this))},o.prototype._checkForAllowedValuesOption=function(){void 0!=this.options.allowedValues&&(this.logger.info("Allowed values option set on facet : Disabling more/less",this),this.options.enableMoreLess=!1,this.logger.info("Allowed values options set on facet : Number of values set to lenght of allowed values : "+this.options.allowedValues.length,this),this.options.numberOfValues=this.options.allowedValues.length,this.logger.info("Allowed values options set in facet : Disabling facet search",this),this.options.enableFacetSearch=!1)},o.prototype._checkForCustomSort=function(){void 0==this.options.customSort||_.contains(this.options.availableSorts,"custom")||this.options.availableSorts.unshift("custom"),"custom"==this.options.availableSorts[0]&&(this.options.sortCriteria="nosort")},o.prototype._initQueryEvents=function(){this.bind.onRoot(e.Events.QueryEvents.duringQuery,this._handleDuringQuery),this.bind.onRoot(e.Events.QueryEvents.buildingQuery,this._handleBuildingQuery),this.bind.onRoot(e.Events.QueryEvents.doneBuildingQuery,this._handleDoneBuildingQuery),this.bind.onRoot(e.Events.QueryEvents.querySuccess,this._handleDeferredQuerySuccess)},o.prototype._initQueryStateEvents=function(){this.includedAttributeId=e.Models.QueryStateModel.getFacetId(this.options.uniqueId),this.excludedAttributeId=e.Models.QueryStateModel.getFacetId(this.options.uniqueId,!1),this.operatorAttributeId=e.Models.QueryStateModel.getFacetOperator(this.options.uniqueId),this.lookupValueAttributeId=e.Models.QueryStateModel.getFacetLookupValue(this.options.uniqueId);{var t=this.queryStateModel.getEventName(e.Models.Model.eventTypes.change);this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+this.includedAttributeId),this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+this.excludedAttributeId)}this.queryStateModel.registerNewAttribute(this.includedAttributeId,[]),this.queryStateModel.registerNewAttribute(this.excludedAttributeId,[]),this.queryStateModel.registerNewAttribute(this.operatorAttributeId,""),this.queryStateModel.registerNewAttribute(this.lookupValueAttributeId,{}),this.bind.onRoot(t,this._handleQueryStateChanged)},o.prototype._initComponentStateEvents=function(){this.componentStateId=e.Models.QueryStateModel.getFacetId(this.options.uniqueId),this.componentStateModel.registerComponent(this.componentStateId,this)},o.prototype._initOmniBoxEvents=function(){this.options.includeInOmniBox&&this.bind.onRoot(e.Events.OmniBoxEvents.populateOmniBox,this._handlePopulateOmnibox)},o.prototype._initBreadCrumbEvents=function(){this.options.includeInBreadcrumb&&(this.bind.onRoot(e.Events.BreadcrumbEvents.populateBreadcrumb,this._handlePopulateBreadcrumb),this.bind.onRoot(e.Events.BreadcrumbEvents.clearBreadcrumb,this._handleClearBreadcrumb))},o.prototype._initBottomAndTopSpacer=function(){var t=this,i=e.$(this.options.paddingContainer).children(".coveo-bottomSpace"),n=e.$(this.options.paddingContainer).children(".coveo-topSpace");this.options.preservePosition&&(e.$(this.options.paddingContainer).mouseleave(function(){return t._unpinFacetPosition()}),this.pinnedTopSpace=n,this.pinnedBottomSpace=i,0==this.pinnedTopSpace.length&&(this.pinnedTopSpace=e.$("<div />").addClass("coveo-topSpace").prependTo(this.options.paddingContainer)),0==this.pinnedBottomSpace.length&&(this.pinnedBottomSpace=e.$("<div />").addClass("coveo-bottomSpace").appendTo(this.options.paddingContainer)))},o.prototype._initFacetQueryController=function(){this.facetQueryController=new e.Controllers.FacetQueryController(this)},o.prototype._initFacetValuesList=function(){this.facetValuesList=new t.FacetValuesList(this,t.FacetValueElement),e.$(this.element).append(this.facetValuesList.build())},o.prototype._initFacetSearch=function(){this.facetSearch=new t.FacetSearch(this,t.FacetSearchValuesList),e.$(this.element).append(this.facetSearch.build())},o.prototype._updateIncludedQueryStateModel=function(){var e={included:this.getSelectedValues(),title:this.includedAttributeId};this.queryStateModel.set(this.includedAttributeId,e.included)},o.prototype._facetValueHasChanged=function(){var t=this;this._updateQueryStateModel(),this._rebuildValueElements(),e.Defer.defer(function(){t._updateAppearanceDependingOnState()})},o.prototype._updateExcludedQueryStateModel=function(){var e={title:this.excludedAttributeId,excluded:this.getExcludedValues()};this.queryStateModel.set(this.excludedAttributeId,e.excluded)},o.prototype._updateOperatorQueryStateModel=function(){if(this.options.allowTogglingOperator){var e="";(0!=this.getSelectedValues().length||0!=this.getExcludedValues().length)&&(e=this.options.useAnd?"and":"or"),this.queryStateModel.set(this.operatorAttributeId,e)}},o.prototype._updateLookupValueQueryStateModel=function(){if(this.options.lookupField){var e={};_.each(this.values.getSelected().concat(this.values.getExcluded()),function(t){e[t.value]=t.lookupValue}),this.queryStateModel.set(this.lookupValueAttributeId,e)}},o.prototype._handleQueryStateChangedOperator=function(e){"and"==e?this.switchToAnd():"or"==e&&this.switchToOr()},o.prototype._handleQueryStateChangedIncluded=function(t){var i=_.difference(this.getSelectedValues(),t);e.Utils.isNonEmptyArray(i)&&this.deselectMultipleValues(i),e.Utils.arrayEqual(this.getSelectedValues(),t,!1)||this.selectMultipleValues(t)},o.prototype._handleQueryStateChangedExcluded=function(t){var i=_.difference(this.getExcludedValues(),t);e.Utils.isNonEmptyArray(i)&&this.unexcludeMultipleValues(i),e.Utils.arrayEqual(this.getExcludedValues(),t,!1)||this.excludeMultipleValues(t)},o.prototype._handleLookupvalueChanged=function(e){var t=this;_.each(e,function(e,i){t.facetValuesList.get(decodeURIComponent(i)).facetValue.lookupValue=decodeURIComponent(e)})},o.prototype._handleQueryStateChanged=function(t,i){e.Assert.exists(i),this.ensureDom();var n=i.attributes,o=n[this.includedAttributeId],s=n[this.excludedAttributeId],r=n[this.operatorAttributeId],a=n[this.lookupValueAttributeId];this.listenToQueryStateChange&&(e.Utils.isNullOrEmptyString(r)||this._handleQueryStateChangedOperator(r),e.Utils.isNullOrUndefined(o)||this._handleQueryStateChangedIncluded(o),e.Utils.isNullOrUndefined(s)||this._handleQueryStateChangedExcluded(s),e.Utils.isNullOrUndefined(a)||this._handleLookupvalueChanged(a))},o.prototype._handlePopulateOmnibox=function(t,i){e.Assert.exists(i),e.Assert.exists(i.completeQueryExpression),this.canFetchMore?this._handleOmniBoxWithSearchInFacet(i):this._handleOmniBoxWithStaticValue(i)},o.prototype._handleOmniBoxWithStaticValue=function(e){var i=this,n=e.completeQueryExpression.regex,o=(e.completeQueryExpression.word,_.first(_.filter(this.getDisplayedValues(),function(e){return n.test(i.getValueCaption(i.facetValuesList.get(e).facetValue))}),this.options.numberOfValuesInOmniBox)),s=_.map(o,function(e){return i.facetValuesList.get(e).facetValue}),r=new t.OmniboxValuesList(this,s,e,t.OmniBoxValueElement).build();e.rows.push({element:r?r.get(0):void 0,zIndex:this._omniBoxZIndex})},o.prototype._handleOmniBoxWithSearchInFacet=function(i){var n=this,o=(i.completeQueryExpression.regex,e.$.Deferred());i.rows.push({deferred:o});var s=this.facetQueryController.recursiveFacetSearch(i.completeQueryExpression.word,this.options.numberOfValuesInOmniBox);s.done(function(e){var s=_.map(e,function(e){return n.values.get(e.lookupValue)||t.FacetValue.create(e)}),r=new t.OmniboxValuesList(n,s,i,t.OmniBoxValueElement).build();o.resolve({element:r?r.get(0):void 0,zIndex:n._omniBoxZIndex})}),s.fail(function(){o.resolve({element:void 0})})},o.prototype._handleDuringQuery=function(){this.ensureDom(),this.keepDisplayedValuesNextTime||this.fadeInactiveValuesInMainList(this.options.facetSearchDelay)},o.prototype._handleBuildingQuery=function(t,i){if(e.Assert.exists(i),e.Assert.exists(i.queryBuilder),this.facetQueryController.prepareForNewQuery(),this.values.hasSelectedOrExcludedValues()){var n=this.facetQueryController.computeOurFilterExpression();this.logger.trace("Putting filter in query",n),i.queryBuilder.advancedExpression.add(n)}},o.prototype._handleDoneBuildingQuery=function(t,i){e.Assert.exists(i),e.Assert.exists(i.queryBuilder);var n=i.queryBuilder;this.facetQueryController.putGroupByIntoQueryBuilder(n)},o.prototype._handleDeferredQuerySuccess=function(t,i){e.Assert.exists(i),this.unfadeInactiveValuesInMainList(),this.hideWaitingAnimation();var n=i.results.groupByResults[this.facetQueryController.lastGroupByRequestIndex];n||(this.keepDisplayedValuesNextTime=!1),this._processNewGroupByResults(n)},o.prototype._handlePopulateBreadcrumb=function(i,n){if(e.Assert.exists(n),this.values.hasSelectedOrExcludedValues()){var o=new t.BreadcrumbValueList(this,this.values.getSelected().concat(this.values.getExcluded()),t.BreadcrumbValueElement).build();n.breadcrumbs.push({element:o.get(0)})}},o.prototype._handleClearBreadcrumb=function(t,i){e.Assert.exists(i),this.reset()},o.prototype._processNewGroupByResults=function(e){this.logger.trace("Displaying group by results",e),void 0!=e&&void 0!=e.values&&(this.nbAvailableValues=e.values.length,this.canFetchMore=this.numberOfValues<this.nbAvailableValues);var i=new t.FacetValues(e);this._updateValues(i),this.numberOfValues>this.nbAvailableValues&&(this.numberOfValues=this.nbAvailableValues),this.values.hasSelectedOrExcludedValues()&&!this.options.useAnd&&this.options.isMultiValueField?this._triggerUpdateDeltaQuery(_.filter(this.values.getAll(),function(e){return!e.selected&&!e.excluded})):this.values.getSelected().length>0&&!this.options.useAnd&&this.values.updateDeltaWithFilteredFacetValues(new t.FacetValues),this.values.hasSelectedOrExcludedValues()&&!this.options.useAnd&&this.options.isMultiValueField||(this._rebuildValueElements(),this._updateAppearanceDependingOnState(),this._ensurePinnedFacetHasntMoved()),this.keepDisplayedValuesNextTime=!1},o.prototype._updateValues=function(t){e.Assert.exists(t),this.keepDisplayedValuesNextTime?this.values.updateCountsFromNewValues(t):(t.importActiveValuesFromOtherList(this.values),t.sortValuesDependingOnStatus(this.numberOfValues),this.values=t)},o.prototype._ensureFacetValueIsInList=function(t){e.Assert.exists(t),this.values.contains(t.value)||this.values.add(t)},o.prototype._isAnyValueCurrentlyDisplayed=function(){return!this.values.isEmpty()},o.prototype._handleOperatorClick=function(){var e=this;if(this.options.useAnd?this.switchToOr():this.switchToAnd(),0!=this.getSelectedValues().length){var i=this.options.useAnd?"AND":"OR",n=this.options.useAnd?"OR":"AND";this.triggerNewQuery(function(){return e.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetToggle,{facetId:e.options.uniqueId,facetOperatorBefore:n,facetOperatorAfter:i})})}},o.prototype._handleEraserClick=function(){var e=this;this.reset(),this.triggerNewQuery(function(){return e.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetClearAll,{facetId:e.options.uniqueId})})},o.prototype._updateQueryStateModel=function(){this.listenToQueryStateChange=!1,this._updateExcludedQueryStateModel(),this._updateIncludedQueryStateModel(),this._updateOperatorQueryStateModel(),this._updateLookupValueQueryStateModel(),this.listenToQueryStateChange=!0},o.prototype._buildFacetContent=function(){this.headerElement=this._buildHeader().appendTo(this.element),this._initFacetValuesList(),this.options.enableFacetSearch&&this._initFacetSearch(),this.options.enableMoreLess&&(this.footerElement=this._buildFooter().appendTo(this.element),this._moreElement=this._buildMore().appendTo(this.footerElement),this._lessElement=this._buildLess().appendTo(this.footerElement))},o.prototype._buildHeader=function(){var t=e.$('<div class="coveo-header"/>');return this._buildIcon().appendTo(t),this._buildWaitAnimation().appendTo(t),this.options.enableSettings&&this._buildSettingsButtons().appendTo(t),this.options.enableCollapse&&(this.collapseElement=this._buildCollapse().appendTo(t),this.excludeElement=this._buildExpand().appendTo(t)),this.operatorElement=this._buildOperatorToggle().appendTo(t),this.operatorElement.fastToggle(this.options.allowTogglingOperator),this._eraserElement=this._buildEraser().appendTo(t),this._buildTitle().appendTo(t),t},o.prototype._buildIcon=function(){var t;return t=this.options.headerIcon?"coveo-icon-custom "+this.options.headerIcon:"coveo-icon "+this.options.field.substr(1),e.$("<div></div>").addClass(t)},o.prototype._buildWaitAnimation=function(){return e.$("<div />").addClass("coveo-wait-animation").css("display","none")},o.prototype._buildCollapse=function(){var i=this,n=e.$("<span></span>").addClass("coveo-icon");return e.$("<div />").attr("title",t.l.Collapse()).addClass("coveo-collapse").append(n).fastClick(function(){i.collapseFacet()})},o.prototype._buildExpand=function(){var i=this,n=e.$("<span></span>").addClass("coveo-icon");return e.$("<div />").attr("title",t.l.Expand()).hide().addClass("coveo-expand").append(n).fastClick(function(){i.expandFacet()})},o.prototype._buildTitle=function(){return e.$('<div class="coveo-title"/>').text(this.options.title)},o.prototype._buildOperatorToggle=function(){var i=this;return e.$("<div />").addClass("coveo-"+(this.options.useAnd?"and":"or")).attr("title",t.l.SwitchTo(this.options.useAnd?t.l.Or():t.l.And())).addClass("coveo-operator").fastClick(function(){i._handleOperatorClick()})},o.prototype._buildSettingsButtons=function(){return this.facetSettings=new t.FacetSettings(this.options.availableSorts,this),this.facetSettings.build()},o.prototype._rebuildOperatorToggle=function(){var e=this._buildOperatorToggle();this.operatorElement&&this.operatorElement.replaceWith(e),this.operatorElement=e},o.prototype._buildEraser=function(){var i=this,n=e.$("<span></span>").addClass("coveo-icon");return e.$("<div />").attr("title",t.l.Clear(this.options.title)).append(n).addClass("coveo-eraser").fastClick(function(){i._handleEraserClick()})},o.prototype._updateNumberOfValues=function(){this.numberOfValues=Math.max(this.numberOfValues,this.values.getExcluded().length+this.values.getSelected().length),this.numberOfValues=Math.min(this.numberOfValues,this.values.size()),this.numberOfValues=Math.max(this.numberOfValues,this.options.numberOfValues)},o.prototype._rebuildValueElements=function(){this._updateNumberOfValues(),this.facetValuesList.rebuild(this.numberOfValues),this.options.enableMoreLess&&this._updateMoreLess()},o.prototype._updateMoreLess=function(){this.values.getExcluded().length+this.values.getSelected().length<this.numberOfValues&&this.options.numberOfValues<this.numberOfValues?this._lessElement.show():this._lessElement.hide(),this._moreElement.toggleClass("coveo-active",this.nbAvailableValues>this.numberOfValues)},o.prototype._buildFooter=function(){return e.$('<div class="coveo-footer"/>')},o.prototype._buildMore=function(){return e.$('<a class="coveo-more">'+t.l.More()+"</a>").fastClick(e.$.proxy(this._handleClickMore,this))},o.prototype._handleClickMore=function(){var e=this.numberOfValues-this.options.numberOfValues,t=Math.floor(e/this.options.morePageSize)+1;this.numberOfValues=this.options.numberOfValues+t*this.options.morePageSize,this.values.size()>=this.numberOfValues||!this.canFetchMore?this._rebuildValueElements():this._triggerMoreQuery()},o.prototype._triggerMoreQuery=function(){var e=this;this.logger.info("Triggering new facet more query"),this.showWaitingAnimation(),this.facetQueryController.fetchMore().done(function(i){var n=new t.FacetValues(i.groupByResults[0]);i.groupByResults.length>1&&_.each(i.groupByResults,function(e,i){i>0&&_.each(e.values,function(e){n.contains(e.value)||n.add(t.FacetValue.createFromGroupByValue(e))})}),n.importActiveValuesFromOtherList(e.values),n.sortValuesDependingOnStatus(e.numberOfValues),e.values=n,e.nbAvailableValues=e.values.size(),e.canFetchMore=e.numberOfValues<e.nbAvailableValues,e.values.hasSelectedOrExcludedValues()&&!e.options.useAnd&&e.options.isMultiValueField?e._triggerUpdateDeltaQuery(_.filter(e.values.getAll(),function(e){return!e.selected&&!e.excluded})):(e.values.hasSelectedOrExcludedValues()&&!e.options.useAnd?(e.values.updateDeltaWithFilteredFacetValues(new t.FacetValues),e.hideWaitingAnimation()):e.hideWaitingAnimation(),e._rebuildValueElements())}).fail(function(){return e.hideWaitingAnimation()})},o.prototype._triggerUpdateDeltaQuery=function(e){var i=this;this.showWaitingAnimation(),this.facetQueryController.searchInFacetToUpdateDelta(e).done(function(e){var n=new t.FacetValues;_.each(e.groupByResults,function(e){_.each(e.values,function(e){n.contains(e.value)||n.add(t.FacetValue.createFromGroupByValue(e))})}),i.values.updateDeltaWithFilteredFacetValues(n),i._rebuildValueElements(),i.hideWaitingAnimation()})},o.prototype._buildLess=function(){return e.$('<a class="coveo-less">'+t.l.Less()+"</a>").hide().fastClick(e.$.proxy(this._handleClickLess,this))},o.prototype._handleClickLess=function(){this._lessElement.hide(),this.numberOfValues=Math.max(this.options.numberOfValues,this.values.getExcluded().length+this.values.getSelected().length),this._moreElement.addClass("coveo-active"),this.values.sortValuesDependingOnStatus(this.numberOfValues),this._rebuildValueElements()},o.prototype._unpinFacetPosition=function(){var e=this;this._isFacetPinned()&&(this.pinnedTopSpace.animate({height:0},"fast",function(){void 0!=e.facetSearch&&e.facetSearch.positionSearchResults()}),this.pinnedBottomSpace.animate({height:0},"fast",function(){void 0!=e.facetSearch&&e.facetSearch.positionSearchResults()}),this.pinnedViewportPosition=void 0)},o.prototype._isFacetPinned=function(){return e.Utils.exists(this.pinnedViewportPosition)},o.prototype._ensurePinnedFacetHasntMoved=function(){var t=this;if(this._isFacetPinned()){e.Assert.exists(this.pinnedViewportPosition),this.pinnedTopSpace.height(0),this.pinnedBottomSpace.height(0);var i=this.options.scrollContainer==document.body?window:this.options.scrollContainer,n=this.element.getBoundingClientRect().top,o=n-this.pinnedViewportPosition;e.$(i).scrollTop(e.$(i).scrollTop()+o),n=this.element.getBoundingClientRect().top,o=n-this.pinnedViewportPosition,0>o?this.pinnedTopSpace.height(-1*o):setTimeout(function(){var n=t.element.getBoundingClientRect().top,o=n-t.pinnedViewportPosition;e.$(i).scrollTop(e.$(i).scrollTop()+o);for(var s=0,r=0;o>0&&r++<100;)s+=100,t.pinnedBottomSpace.height(s),n=t.element.getBoundingClientRect().top,o=n-t.pinnedViewportPosition,e.$(i).scrollTop(e.$(i).scrollTop()+o)},0)}},o.prototype._updateAppearanceDependingOnState=function(){e.$(this.element).toggleClass("coveo-active",this.values.hasSelectedOrExcludedValues()),e.$(this.element).toggleClass("coveo-empty",!this._isAnyValueCurrentlyDisplayed()),e.$(this._eraserElement).fastToggle(this.values.hasSelectedOrExcludedValues())},o.ID="Facet",o.omniboxIndex=50,o}(e.Ui.Component);t.Facet=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.dateField=this.loadBooleanFromAttribute("data-date-field"),this.valueCaption=this.loadStringFromAttribute("data-value-caption")}return __extends(t,e),t.prototype.combineSliderOption=function(e){this.slider={graph:{},displayAsPercent:{},displayAsValue:{}};var t=e.slider;return void 0==t&&(t={}),void 0==t.graph&&(t.graph={}),void 0==t.displayAsPercent&&(t.displayAsPercent={}),void 0==t.displayAsValue&&(t.displayAsValue={}),this.slider.start=this.loadStringFromAttribute("data-slider-start",t.start),void 0!=this.slider.start&&(this.slider.start=this.dateField?new Date(this.slider.start).getTime():parseInt(this.slider.start,10)),this.slider.end=this.loadStringFromAttribute("data-slider-end",t.end),void 0!=this.slider.end&&(this.slider.end=this.dateField?new Date(this.slider.end).getTime():parseInt(this.slider.end,10)),this.slider.steps=this.loadNumberFromAttribute("data-slider-steps",t.steps),this.slider.rangeSlider=this.loadBooleanFromAttribute("data-range-slider",t.rangeSlider),this.slider.excludeOuterBounds=this.loadBooleanFromAttribute("data-slider-exclude-outer-bounds",t.excludeOuterBounds),this.slider.rounded=this.loadNumberFromAttribute("data-slider-rounded",t.rounded),this.slider.displayAsValue.unitSign=this.loadStringFromAttribute("data-slider-display-as-value-unit-sign",t.displayAsValue.unitSign),this.slider.displayAsValue.separator=this.loadStringFromAttribute("data-slider-display-as-value-separator",t.displayAsValue.separator),this.slider.displayAsPercent.separator=this.loadStringFromAttribute("data-slider-display-as-percent-separator",t.displayAsPercent.separator),this.slider.dateFormat=this.loadStringFromAttribute("data-slider-date-format",t.dateFormat),this.slider.graph.steps=this.loadNumberFromAttribute("data-slider-graph-steps",t.graph.steps),this.slider.graph.animationDuration=this.loadNumberFromAttribute("data-slider-graph-animation-duration",t.graph.animationDuration),this.slider=this.removeUndefinedOptions(this.slider),this},t.prototype.removeUndefinedOptions=function(e){var t=this;return _.each(_.keys(e),function(i){_.isObject(e[i])?(t.removeUndefinedOptions(e[i]),0==_.keys(e[i]).length&&"start"!=i&&"end"!=i&&delete e[i]):void 0==e[i]&&delete e[i]}),0==_.keys(e).length&&(e=void 0),e},t}(t.DefaultFacetOptions),n=function(n){function o(t,s,r){n.call(this,t,_.extend(new i(t).combineSliderOption(s).merge(s),{enableMoreLess:!1,enableFacetSearch:!1,isMultiValueField:!1,includeInOmniBox:!1}),r,o.ID),this.element=t,this.isEmpty=!1,this.options.slider&&(this.options.enableFacetSearch=!1,this.options.enableSettings=!1,this.options.includeInOmniBox=!1,this.options.slider.graph&&(e.FeatureDetectionUtils.supportSVG()||(this.options.slider.graph=void 0,this.logger.info("Your browser does not support SVG. Cannot add graphic to your facet range",this)),"undefined"==typeof d3&&(this.options.slider.graph=void 0,this.logger.info("Cannot find the required dependencies d3.js. Cannot add graphic to your facet range",this))),this.handleNoresults())}return __extends(o,n),o.prototype.reset=function(){this.options.slider?(this.slider.initializeState(),this.updateQueryState(),this.updateFacetStyle()):n.prototype.reset.call(this)},o.prototype.getSelectedValues=function(){return this.options.slider?void 0!=this.startOfSlider&&void 0!=this.endOfSlider?[this.startOfSlider.toString(),this.endOfSlider.toString()]:["undefined","undefined"]:n.prototype.getSelectedValues.call(this)},o.prototype.getValueCaption=function(i){var o=n.prototype.getValueCaption.call(this,i);if(e.Utils.exists(this.options.valueCaption)&&"string"==typeof this.options.valueCaption){var s=/^(.*)\.\.(.*)$/.exec(i.value);if(null!=s){var r=t.TemplateHelpers.getHelper(this.options.valueCaption);if(null!=r)o=r.call(this,s[1])+" - "+r.call(this,s[2]);else var a=s[1].match(/^[\+\-]?[0-9]+(\.[0-9]+)?$/)?Number(s[1]):e.DateUtils.convertFromJsonDateIfNeeded(s[1]),l=s[2].match(/^[\+\-]?[0-9]+(\.[0-9]+)?$/)?Number(s[2]):e.DateUtils.convertFromJsonDateIfNeeded(s[2]),o=Globalize.format(a,this.options.valueCaption)+" - "+Globalize.format(l,this.options.valueCaption)}}return o},o.prototype._initFacetValuesList=function(){this.options.slider||n.prototype._initFacetValuesList.call(this)},o.prototype._handlePopulateBreadcrumb=function(e,t){var i=this;this.options.slider?this.slider&&this.sliderIsActive()&&t.breadcrumbs.push({element:this.buildBreadcrumbFacetSlider().get(0),clearAll:function(){return i.reset()}}):n.prototype._handlePopulateBreadcrumb.call(this,e,t)},o.prototype.getSliderBoundaryForQuery=function(){var e=!1;return this.options.slider&&!this.slider?e=!0:this.options.slider&&this.slider&&this.sliderIsActive()&&(e=!0),e?this.generateBoundary():void 0},o.prototype.handleNoresults=function(){var t=this;e.$(this.root).on(e.Events.QueryEvents.noResults,function(){t.isEmpty=!0,t._updateAppearanceDependingOnState()}),e.$(this.root).on(e.Events.QueryEvents.newQuery,function(){t.isEmpty=!1})},o.prototype.sliderIsActive=function(){var t=this.queryStateModel.get(this.rangeQueryStateAttribute),i=[this.initialStartOfSlider,this.initialEndOfSlider];return!(void 0==t||isNaN(t[0])||isNaN(t[1])||isNaN(this.initialStartOfSlider)||isNaN(this.initialEndOfSlider)||e.Utils.arrayEqual(t,i))},o.prototype.buildBreadcrumbFacetSlider=function(){var i=this,n=e.$("<div/>").addClass("coveo-facet-breadcrumb");e.$("<span/>").addClass("coveo-title").text(this.options.title+":").appendTo(n);{var o=e.$("<span/>").addClass("coveo-values").appendTo(n),s=e.$("<span class='coveo-value'>"+this.slider.getCaption()+"</span>").appendTo(o);e.$("<span class='coveo-clear'></span>").appendTo(s)}return s.fastClick(function(){i.reset(),i.triggerNewQuery(function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetClearAll,{facetId:i.options.uniqueId})})}),n},o.prototype.initSlider=function(){this.buildSlider(),this.slider.initializeState([this.startOfSlider,this.endOfSlider]),this.updateFacetStyle()},o.prototype._initQueryStateEvents=function(){var t=this;if(this.options.slider){this.rangeQueryStateAttribute=e.Models.QueryStateModel.getFacetId(this.options.uniqueId)+":range",this.queryStateModel.registerNewAttribute(this.rangeQueryStateAttribute,[void 0,void 0]);var i=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+this.rangeQueryStateAttribute);this.bind.onRoot(i,function(i,n){t.slider?t.handleRangeQueryStateChanged(i,n):e.$(t.root).one(e.Events.QueryEvents.querySuccess,function(){return t.handleRangeQueryStateChanged(i,n)})})}else n.prototype._initQueryStateEvents.call(this)},o.prototype.handleRangeQueryStateChanged=function(e,t){this.setupSliderIfNeeded(t),this.startOfSlider=void 0==t.value[0]?this.startOfSlider:t.value[0],this.endOfSlider=void 0==t.value[1]?this.endOfSlider:t.value[1],this.slider.setValues([this.startOfSlider,this.endOfSlider]),this.updateFacetStyle()},o.prototype.buildSlider=function(){var i=this,n=e.$("<div class='coveo-values coveo-slider-container'></div>");this.options.slider.graph&&n.addClass("coveo-with-graph");var o=e.$("<div></div>");this.slider=new t.Slider(o,e.$.extend({},this.options.slider,{dateField:this.options.dateField})),o.on(e.Events.SliderEvents.endSlide,function(e,t){i.handleEndSlide(e,t)}),o.on(e.Events.SliderEvents.duringSlide,function(e,t){i.handleDuringSlide(e,t)}),this.slider.options.graph&&o.on(e.Events.SliderEvents.graphValueSelected,function(e,t){i.handleGraphValueSelected(e,t)}),n.append(o),e.$(this.element).append(n),this.updateFacetStyle()},o.prototype._initFacetQueryController=function(){this.facetQueryController=new e.Controllers.FacetRangeQueryController(this)},o.prototype._handleBuildingQuery=function(t,i){e.Assert.exists(i),e.Assert.exists(i.queryBuilder);var o=this.getSliderBoundaryForQuery();if(void 0!=o){this.facetQueryController.prepareForNewQuery();var s=this.facetQueryController.computeOurFilterExpression(o);e.Utils.isNonEmptyString(s)&&(this.logger.trace("Putting filter in query",s),i.queryBuilder.advancedExpression.add(s))}else n.prototype._handleBuildingQuery.call(this,t,i)},o.prototype._processNewGroupByResults=function(e){var t=this;this.options.slider?this._updateAppearanceDependingOnState():(null!=e&&(null!=this.options.ranges||this.keepDisplayedValuesNextTime&&!this.values.hasSelectedOrExcludedValues()||(this.keepDisplayedValuesNextTime=!1,e.values.sort(function(e,i){var n=e.value.split(".."),o=i.value.split("..");return t.options.dateField?Date.parse(n[0])-Date.parse(o[0]):Number(n[0])-Number(o[0])}))),n.prototype._processNewGroupByResults.call(this,e))},o.prototype._handleDeferredQuerySuccess=function(e,t){n.prototype._handleDeferredQuerySuccess.call(this,e,t),this.setupSliderIfNeeded(t);var i=t.results.groupByResults[this.facetQueryController.lastGroupByRequestIndex];void 0==i||void 0==i.values[0]?(this.isEmpty=!0,this._updateAppearanceDependingOnState()):this.options.slider&&this.options.slider.graph&&this.renderToSliderGraph(t)},o.prototype._facetValueShouldBeRemoved=function(){return!1},o.prototype._rebuildValueElements=function(){this.options.slider||n.prototype._rebuildValueElements.call(this)},o.prototype.handleEndSlide=function(e,i){var o=this,s=i.slider.getValues();this.startOfSlider=s[0],this.endOfSlider=s[1],this.updateQueryState(s),this.updateFacetStyle(),n.prototype.triggerNewQuery.call(this,function(){return o.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetRangeSlider,{facetId:o.options.uniqueId,facetRangeStart:o.startOfSlider.toString(),facetRangeEnd:o.endOfSlider.toString()})})},o.prototype.handleDuringSlide=function(e,t){var i=t.slider.getValues();this.startOfSlider=i[0],this.endOfSlider=i[1],this.updateQueryState([this.startOfSlider,this.endOfSlider],!0),this.updateFacetStyle()},o.prototype.handleGraphValueSelected=function(e,i){var o=this;this.options.slider.rangeSlider&&(this.startOfSlider=i.start),this.endOfSlider=i.end,this.slider.setValues([this.startOfSlider,this.endOfSlider]),this.updateQueryState(),n.prototype.triggerNewQuery.call(this,function(){return o.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetRangeGraph,{facetId:o.options.uniqueId,facetRangeStart:o.startOfSlider.toString(),facetRangeEnd:o.endOfSlider.toString()})})},o.prototype.updateQueryState=function(e,t){"undefined"==typeof e&&(e=this.slider.getValues()),"undefined"==typeof t&&(t=!1);var i=[];i[0]=e[0]+0,i[1]=e[1]+0,this.queryStateModel.set(this.rangeQueryStateAttribute,i,{silent:t})},o.prototype.updateFacetStyle=function(){this.sliderIsActive()?e.$(this.element).removeClass("coveo-disabled"):e.$(this.element).addClass("coveo-disabled")},o.prototype.renderToSliderGraph=function(e){var t,i=this,n=e.results.groupByResults[this.facetQueryController.graphGroupByQueriesIndex];n&&(t=_.map(n.values,function(e){var t=e.value.split("..")[0],n=e.value.split("..")[1];i.options.dateField?(t=new Date(t.split("@")[0]).getTime(),n=new Date(n.split("@")[0]).getTime()):(t=parseInt(t,10),n=parseInt(n,10));var o=e.numberOfResults;return{start:t,y:o,end:n,isDate:i.options.dateField}
})),void 0!=t&&this.slider.drawGraph(t)},o.prototype._updateAppearanceDependingOnState=function(){this.options.slider?this.isEmpty&&!this.sliderIsActive()?e.$(this.element).addClass("coveo-disabled-empty"):(e.$(this.element).removeClass("coveo-disabled-empty"),e.$(this._eraserElement).fastToggle(this.sliderIsActive())):n.prototype._updateAppearanceDependingOnState.call(this)},o.prototype.generateBoundary=function(){if(this.slider){var e=this.generateBoundaryFromSlider();return void 0==e[0]&&void 0==e[1]?this.generateBoundaryFromState():e}return this.generateBoundaryFromState()},o.prototype.generateBoundaryFromSlider=function(){var e,t;return void 0!=this.startOfSlider&&(e=this.startOfSlider),void 0!=this.endOfSlider&&(t=this.endOfSlider),[e,t]},o.prototype.generateBoundaryFromState=function(){var e,t,i=this.queryStateModel.get(this.rangeQueryStateAttribute)[0];void 0!=i&&(e=i);var n=this.queryStateModel.get(this.rangeQueryStateAttribute)[1];return void 0!=n&&(t=n),e!=this.queryStateModel.getDefault(this.rangeQueryStateAttribute)[0]||t!=this.queryStateModel.getDefault(this.rangeQueryStateAttribute)[1]?[e,t]:[void 0,void 0]},o.prototype.setupSliderIfNeeded=function(t){if(this.ensureDom(),!e.Utils.isNullOrUndefined(this.options.slider)&&e.Utils.isNullOrUndefined(this.slider)){this.alreadySetBoundary()||this.trySetSliderBoundaryFromOptions(),this.alreadySetBoundary()||void 0==t||this.trySetSliderBoundaryFromQueryResult(t),this.trySetSliderBoundaryFromState(),this.setupSliderStateVariables();var i=this.verifySetup();i?(this.logger.warn("Error while trying to initialize slider",this),this.slider=void 0,this.options.slider=void 0):(this.initSlider(),this.updateQueryState())}},o.prototype.verifySetup=function(){var e=0;return e+=void 0==this.initialStartOfSlider?1:0,e+=isNaN(this.initialStartOfSlider)?1:0,e+=void 0==this.initialEndOfSlider?1:0,e+=isNaN(this.initialEndOfSlider)?1:0},o.prototype.setupSliderStateVariables=function(){this.initialStartOfSlider=parseInt(this.initialStartOfSlider.toString(),10),this.initialEndOfSlider=parseInt(this.initialEndOfSlider.toString(),10),this.startOfSlider=this.startOfSlider?parseInt(this.startOfSlider.toString(),10):this.initialStartOfSlider,this.endOfSlider=this.endOfSlider?parseInt(this.endOfSlider.toString(),10):this.initialEndOfSlider,this.startOfSlider==this.endOfSlider&&(this.endOfSlider+=1),this.initialStartOfSlider==this.initialEndOfSlider&&(this.initialEndOfSlider+=1),this.options.slider.start=this.initialStartOfSlider,this.options.slider.end=this.initialEndOfSlider,this.queryStateModel.setNewDefault(this.rangeQueryStateAttribute,[this.initialStartOfSlider,this.initialEndOfSlider])},o.prototype.alreadySetBoundary=function(){return void 0!=this.startOfSlider&&void 0!=this.endOfSlider},o.prototype.trySetSliderBoundaryFromOptions=function(){e.Utils.isNullOrUndefined(this.options.slider.start)||this.setupInitialSliderStateStart(this.options.slider.start),e.Utils.isNullOrUndefined(this.options.slider.end)||this.setupInitialSliderStateEnd(this.options.slider.end)},o.prototype.trySetSliderBoundaryFromState=function(){var e=this.queryStateModel.get(this.rangeQueryStateAttribute);e&&void 0!=e[0]&&void 0!=e[1]&&(this.setupInitialSliderStateStart(e[0]),this.setupInitialSliderStateEnd(e[1]),this.startOfSlider=e[0],this.endOfSlider=e[1])},o.prototype.trySetSliderBoundaryFromQueryResult=function(e){var t=e.results.groupByResults[this.facetQueryController.lastGroupByRequestIndex];t&&t.values[0]&&(this.setupInitialSliderStateStart(t.values[0].value.split("..")[0]),this.setupInitialSliderStateEnd(t.values[t.values.length-1].value.split("..")[1]))},o.prototype.setupInitialSliderStateStart=function(e){void 0==this.initialStartOfSlider&&(this.initialStartOfSlider=e,this.options.dateField&&isNaN(e)&&(this.initialStartOfSlider=new Date(e.replace("@"," ")).getTime()))},o.prototype.setupInitialSliderStateEnd=function(e){void 0==this.initialEndOfSlider&&(this.initialEndOfSlider=e,this.options.dateField&&isNaN(e)&&(this.initialEndOfSlider=new Date(e.replace("@"," ")).getTime()))},o.ID="FacetRange",o}(t.Facet);t.FacetRange=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.delimitingCharacter=this.loadStringFromAttribute("data-delimiting-character","|"),this.levelStart=this.loadNumberFromAttribute("data-level-start",0),this.levelEnd=this.loadNumberFromAttribute("data-level-end"),this.marginByLevel=this.loadNumberFromAttribute("data-margin-by-level",10)}return __extends(t,e),t}(t.DefaultFacetOptions);t.DefaultHierarchicalFacetOptions=i;var n=function(n){function o(e,t,s){n.call(this,e,_.extend(new i(e).merge(t),{numberOfValues:1e4}),s,o.ID),this.element=e,this.bindings=s,this.firstPlacement=!0,this.numberOfValuesToShow=new i(e).numberOfValues||t.numberOfValues||5,this.originalNumberOfValuesToShow=this.numberOfValuesToShow,this.logger.info("Hierarchy facet : Set number of values very high in order to build hierarchy",this.options.numberOfValues,this)}return __extends(o,n),o.prototype.selectValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]);var i=e instanceof t.FacetValue?e.value:e,o=this.valueHierarchy[i];this.options.useAnd||this.selectChilds(o,o.childs),this.flagParentForSelection(o),n.prototype.selectValue.call(this,e)},o.prototype.selectMultipleValues=function(e){var i=this;this.ensureDom(),this.ensureValueHierarchyExists(e),_.each(e,function(e){var n=e instanceof t.FacetValue?e.value:e,o=i.valueHierarchy[n];i.flagParentForSelection(o),i.options.useAnd||_.each(o.childs,function(e){i.logger.info("Selecting facet value",i.facetValuesList.select(e.facetValue))})}),n.prototype.selectMultipleValues.call(this,e)},o.prototype.deselectValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]);var i=e instanceof t.FacetValue?e.value:e,o=this.valueHierarchy[i];if(!this.options.useAnd){var s=void 0!=o.childs;if(s){var r=_.filter(o.childs,function(e){return e.facetValue.selected||e.facetValue.excluded});r.length==o.childs.length&&this.deselectChilds(o,o.childs)}}this.unflagParentForSelection(o),n.prototype.deselectValue.call(this,e)},o.prototype.excludeValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]);var i=e instanceof t.FacetValue?e.value:e,o=this.valueHierarchy[i];this.options.useAnd?(this.deselectChilds(o,o.childs),this.close(o)):this.excludeChilds(o.childs),this.flagParentForSelection(o),n.prototype.excludeValue.call(this,e)},o.prototype.unexcludeValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]);var i=e instanceof t.FacetValue?e.value:e,o=this.valueHierarchy[i];this.options.useAnd||this.unexcludeChilds(o.childs),this.unflagParentForSelection(o),n.prototype.unexcludeValue.call(this,e)},o.prototype.deselectMultipleValues=function(e){var i=this;this.ensureDom(),this.ensureValueHierarchyExists(e),_.each(e,function(e){var n=e instanceof t.FacetValue?e.value:e,o=i.valueHierarchy[n];i.unflagParentForSelection(o),i.options.useAnd||_.each(o.childs,function(e){i.logger.info("Deselecting facet value",i.facetValuesList.unselect(e.facetValue))})}),n.prototype.deselectMultipleValues.call(this,e)},o.prototype.toggleSelectValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]);var i=e instanceof t.FacetValue?e.value:e;0==this.valueHierarchy[i].facetValue.selected?this.selectValue(e):this.deselectValue(e)},o.prototype.toggleExcludeValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]);var i=e instanceof t.FacetValue?e.value:e;0==this.valueHierarchy[i].facetValue.excluded?this.excludeValue(e):this.unexcludeValue(e)},o.prototype.getValueCaption=function(t){var i=this.getSelf(t),n=i;return e.Utils.exists(this.options.valueCaption)&&("object"==typeof this.options.valueCaption&&(n=this.options.valueCaption[i]||n),"function"==typeof this.options.valueCaption&&(n=this.options.valueCaption.call(this,t))),n},o.prototype.getDisplayedValues=function(){return _.first(_.pluck(this.values.getAll(),"value"),this.numberOfValuesToShow)},o.prototype.updateSort=function(e){this.firstPlacement=!0,n.prototype.updateSort.call(this,e)},o.prototype.open=function(e){var i=e instanceof t.FacetValue?this.valueHierarchy[e.value]:e;this.facetValuesList.get(i.facetValue).listElement.addClass("coveo-open"),this.showChilds(i.childs),void 0!=i.parent&&this.open(this.valueHierarchy[i.facetValue.value].parent),this.valueHierarchy[i.facetValue.value].keepOpened=!0},o.prototype.close=function(e){var i=this,n=e instanceof t.FacetValue?this.valueHierarchy[e.value]:e;this.facetValuesList.get(n.facetValue).listElement.removeClass("coveo-open"),this.hideChilds(n.childs),_.each(n.childs,function(e){i.close(i.valueHierarchy[e.facetValue.value])}),this.valueHierarchy[n.facetValue.value].keepOpened=!1},o.prototype.getLevel=function(e){return e.value.split(this.options.delimitingCharacter).length-1},o.prototype.reset=function(){_.each(this.valueHierarchy,function(e){e.hasChildSelected=!1,e.keepOpened=!1}),n.prototype.reset.call(this)},o.prototype._isAnyValueCurrentlyDisplayed=function(){return n.prototype._isAnyValueCurrentlyDisplayed.call(this)&&0!=e.$(this.element).find(".coveo-value").length},o.prototype._initFacetSearch=function(){this.facetSearch=new t.HierarchicalFacetSearch(this,t.HierarchicalFacetSearchValuesList),e.$(this.element).append(this.facetSearch.build())},o.prototype._handlePopulateBreadcrumb=function(i,n){if(e.Assert.exists(n),this.values.hasSelectedOrExcludedValues()){var o=new t.HierarchicalBreadcrumbValueList(this,this.values.getSelected().concat(this.values.getExcluded()),this.valueHierarchy).build();n.breadcrumbs.push({element:o.get(0)})}},o.prototype._handleOmniBoxWithStaticValue=function(e){var i=this,n=e.completeQueryExpression.regex,o=(e.completeQueryExpression.word,_.first(_.filter(this.valueHierarchy,function(e){return n.test(i.getValueCaption(e.facetValue))}),this.options.numberOfValuesInOmniBox)),s=_.map(o,function(e){return i.facetValuesList.get(e.facetValue).facetValue}),r=new t.OmniboxHierarchicalValuesList(this,s,e).build();e.rows.push({element:r?r.get(0):void 0,zIndex:this._omniBoxZIndex})},o.prototype._rebuildValueElements=function(){this.createValueHierarchy(),this.setValueListContent(),n.prototype._rebuildValueElements.call(this),this.buildParentChildRelationship(),this.crop()},o.prototype._initFacetValuesList=function(){this.facetValuesList=new t.HierarchicalFacetValuesList(this,t.HierarchicalFacetValueElement),e.$(this.element).append(this.facetValuesList.build())},o.prototype._updateMoreLess=function(){this._moreElement.toggleClass("coveo-active",this.topLevelHierarchy.length>this.numberOfValuesToShow),this.numberOfValuesToShow>this.originalNumberOfValuesToShow?this._lessElement.show():this._lessElement.hide()},o.prototype._handleClickMore=function(){this.numberOfValuesToShow+=this.originalNumberOfValuesToShow,this.numberOfValuesToShow=Math.min(this.numberOfValuesToShow,this.values.size()),this._rebuildValueElements()},o.prototype._handleClickLess=function(){this.numberOfValuesToShow=this.originalNumberOfValuesToShow,this._rebuildValueElements()},o.prototype.setValueListContent=function(){var e=this;this.facetValuesList.hierarchyFacetValues=_.map(this.valueHierarchy,function(t){return e.values.contains(t.facetValue.value)||(t.facetValue.occurrences=0,e.values.add(t.facetValue)),t.facetValue})},o.prototype.ensureValueHierarchyExists=function(e){var i=this;e[0]&&"string"==typeof e[0]&&(e=_.map(e,function(e){return t.FacetValue.createFromValue(e)}));var n=!1;_.each(e,function(e){(void 0==i.valueHierarchy||void 0==i.valueHierarchy[e.value])&&(n=!0)}),n&&this.createValueHierarchy(e)},o.prototype.crop=function(){var e=this,t=_.partition(this.topLevelHierarchy,function(e){return e.facetValue.selected||e.facetValue.excluded});_.each(_.last(t[1],t[1].length-(this.numberOfValuesToShow-t[0].length)),function(t){e.facetValuesList.get(t.facetValue).listElement.hide()})},o.prototype.placeChildsUnderTheirParent=function(e,t){var i=this;_.each(e.childs.reverse(),function(e){var n=i.facetValuesList.get(e.facetValue).listElement;i.firstPlacement&&n.insertAfter(t)}),e.keepOpened?(this.open(e),this.showChilds(e.childs)):this.hideChilds(e.childs)},o.prototype.addCssClassToParentAndChilds=function(t,i){var n=this;i.addClass("coveo-has-childs"),t.hasChildSelected&&i.addClass("coveo-has-childs-selected");var o=e.$("<div class='coveo-has-childs-toggle'></div>").fastClick(function(){i.hasClass("coveo-open")?n.close(t):n.open(t)});i.prepend(o)},o.prototype.buildParentChildRelationship=function(){var t=this;_.each(this.valueHierarchy,function(i){var n=t.facetValuesList.get(i.facetValue).listElement;e.Utils.isNonEmptyArray(i.childs)?(t.placeChildsUnderTheirParent(i,n),t.addCssClassToParentAndChilds(i,n)):n.addClass("coveo-no-childs"),n.css("margin-left",t.options.marginByLevel*(i.level-t.options.levelStart))}),this.firstPlacement&&!this.firstQuery?(this.firstPlacement=!1,this.setOriginalPosition()):_.each(this.originalPosition,function(e,i){var n=t.facetValuesList.get(e.facetValue).listElement;n.parent().children().eq(i).after(n)})},o.prototype.setOriginalPosition=function(){var e=this;this.originalPosition=[],_.each(this.valueHierarchy,function(t){e.originalPosition[e.facetValuesList.get(t.facetValue).listElement.index()]=t})},o.prototype.createValueHierarchy=function(e){var t=this;if("undefined"==typeof e&&(e=this.values.getAll()),this.valueHierarchy=this.valueHierarchy?this.valueHierarchy:{},!this.flatHierarchy||_.keys(this.flatHierarchy).length<_.keys(e).length){this.flatHierarchy=_.map(e,function(e){var i=t.getParent(e),n=t.getSelf(e);return{facetValue:e,level:t.getLevel(e),parent:i,self:n}}),this.setInHierarchy(this.flatHierarchy),_.each(this.valueHierarchy,function(e){e.facetValue.selected&&t.flagParentForSelection(e)})}else _.each(this.values.getAll(),function(e){t.valueHierarchy[e.value]&&(t.valueHierarchy[e.value].facetValue=e)})},o.prototype.setInHierarchy=function(e){var t=this,i=_.filter(e,function(e){var i=void 0==t.options.levelStart||e.level>=t.options.levelStart,n=void 0==t.options.levelEnd||e.level<t.options.levelEnd;return i&&n});_.each(i,function(e){var n=_.map(_.filter(i,function(t){return t.parent==e.self}),function(e){return{facetValue:e.facetValue,level:e.level,keepOpened:!1,hasChildSelected:!1}}),o=_.find(i,function(t){return t.self==e.parent});t.valueHierarchy[e.facetValue.value]={childs:n,parent:void 0==o?void 0:{facetValue:o.facetValue,level:o.level,keepOpened:!1,hasChildSelected:!1},facetValue:e.facetValue,level:e.level,keepOpened:!1,hasChildSelected:!1}});var n=this.options.levelStart||0;this.topLevelHierarchy=_.filter(this.valueHierarchy,function(e){return e.level==n})},o.prototype.getParent=function(e){var t=e.value.lastIndexOf(this.options.delimitingCharacter);if(-1!=t){var i=e.value.substring(0,t).lastIndexOf(this.options.delimitingCharacter);return e.value.substring(i+1,t)}return void 0},o.prototype.getSelf=function(e){var t=this.getParent(e);if(void 0==t)return e.value;var i=e.value.indexOf(t);return e.value.substring(i+t.length+1)},o.prototype.showFacetValue=function(e){this.facetValuesList.get(e.facetValue).listElement.removeClass("coveo-inactive")},o.prototype.hideFacetValue=function(e){this.facetValuesList.get(e.facetValue).listElement.addClass("coveo-inactive")},o.prototype.hideChilds=function(e){var t=this;_.each(e,function(e){t.hideFacetValue(e)})},o.prototype.showChilds=function(e){var t=this;_.each(e,function(e){t.showFacetValue(e)})},o.prototype.hideParent=function(e){e&&this.hideFacetValue(e)},o.prototype.showParent=function(e){e&&this.showFacetValue(e)},o.prototype.selectChilds=function(e,t){this.flagParentForSelection(e),this.selectMultipleValues(_.map(t,function(e){return e.facetValue}))},o.prototype.deselectChilds=function(e,t){e.hasChildSelected=!1,this.deselectMultipleValues(_.map(t,function(e){return e.facetValue}))},o.prototype.excludeChilds=function(e){this.excludeMultipleValues(_.map(e,function(e){return e.facetValue}))},o.prototype.unexcludeChilds=function(e){this.unexcludeMultipleValues(_.map(e,function(e){return e.facetValue}))},o.prototype.selectParent=function(e){void 0!=e&&(this.selectValue(e.facetValue),e.parent&&this.selectParent(this.valueHierarchy[e.parent.facetValue.value]))},o.prototype.deselectParent=function(e){void 0!=e&&this.deselectValue(e.facetValue)},o.prototype.flagParentForSelection=function(e){for(var t=e.parent;t;){var i=this.valueHierarchy[t.facetValue.value];i.hasChildSelected=!0,t=i.parent}},o.prototype.unflagParentForSelection=function(e){for(var t=this,i=e.parent;i;){var n=this.valueHierarchy[i.facetValue.value],o=_.filter(n.childs,function(i){var n=t.valueHierarchy[i.facetValue.value];return n.facetValue.value!=e.facetValue.value&&(n.facetValue.selected||n.facetValue.excluded||n.hasChildSelected)});0==o.length&&(n.hasChildSelected=!1),i=n.parent}},o.ID="HierarchicalFacet",o}(t.Facet);t.HierarchicalFacet=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultDidYouMeanOptions=i;var n=function(n){function o(t,s,r){n.call(this,t,o.ID,r),this.element=t,this.options=s,this.bindings=r,this.options=new i(t).merge(s),e.Assert.exists(t),e.Assert.exists(this.options),this.hideNext=!0,this.bind.onRoot(e.Events.QueryEvents.buildingQuery,this.handlePrepareQueryBuilder),this.bind.onRoot(e.Events.QueryEvents.querySuccess,this.handleProcessNewQueryResults),this.bind.onRoot(e.Events.QueryEvents.noResults,this.handleNoResults),this.bind.onRoot(e.Events.QueryEvents.newQuery,this.handleNewQuery),e.$(this.element).hide()}return __extends(o,n),o.prototype.handleNewQuery=function(){this.hideNext?(e.$(this.element).empty(),e.$(this.element).hide()):this.hideNext=!0},o.prototype.handlePrepareQueryBuilder=function(t,i){e.Assert.exists(i),i.queryBuilder.enableDidYouMean=!0},o.prototype.handleNoResults=function(i,n){if(e.Utils.isNonEmptyArray(n.results.queryCorrections)&&!n.searchAsYouType){var o=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.q),s=this.buildCorrectedSentence(n.results.queryCorrections[0]);this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,n.results.queryCorrections[0].correctedQuery),n.retryTheQuery=!0,this.hideNext=!1;{e.$("<div/>").html(t.l.noResultFor("<span class='coveo-highlight'>"+e.StringUtils.htmlEncode(o)+"</span>")).appendTo(this.element),e.$("<div/>").html(t.l.autoCorrectedQueryTo("<span class='coveo-highlight'>"+s+"</span>")).appendTo(this.element)}e.$(this.element).show(),this.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.didyoumeanAutomatic,{})}},o.prototype.handleProcessNewQueryResults=function(i,n){var o=this;e.Assert.exists(n),e.Assert.exists(n.results);var s=n.results;if(this.logger.trace("Received query results from new query",s),e.Utils.isNonEmptyArray(s.queryCorrections)){var r=this.buildCorrectedSentence(s.queryCorrections[0]),a=e.$("<div/>").text(t.l.didYouMean("")).appendTo(this.element),l=e.$("<a/>").html(r).appendTo(a);e.$(l).fastClick(function(){o.doQueryWithCorrectedTerm(s.queryCorrections[0].correctedQuery)}),e.$(this.element).show()}},o.prototype.buildCorrectedSentence=function(t){var i=[],n='<span class="coveo-word-correction">',o="</span>",s=0;return _.each(t.wordCorrections,function(r){i.push(e.StringUtils.htmlEncode(t.correctedQuery.slice(s,r.offset))),s=r.offset,i.push(n),i.push(e.StringUtils.htmlEncode(t.correctedQuery.slice(s,r.length+s))),i.push(o),s=r.offset+r.length}),i.push(e.StringUtils.htmlEncode(t.correctedQuery.slice(s))),i.join("")},o.prototype.doQueryWithCorrectedTerm=function(i){var n=this;this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,i),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return n.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.didyoumeanClick,{})}})},o.ID="DidYouMean",o}(t.Component);t.DidYouMean=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.tabSectionToOpen=this.loadStringFromAttribute("data-tab-section-to-open")}return __extends(t,e),t}(t.ComponentOptions);t.DefaultCurrentTabOptions=i;var n=function(n){function o(t,s,r){var a=this;n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s);var l=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.t);e.$(this.root).on(l,e.$.proxy(this.handleTabChange,this)),this.options.tabSectionToOpen&&(e.$(this.options.tabSectionToOpen).addClass("coveo-targeted-by-current-tab"),e.$(this.element).addClass("coveo-targeting-tab-section"),this.bind.fastClick(e.$(this.element),function(){e.$(".coveo-glass").toggleClass("coveo-active-glass").toggleClass("coveo-active-glass-for-current-tab"),e.$(a.element).toggleClass("coveo-opening-tab-section"),e.$(a.options.tabSectionToOpen).toggleClass("coveo-opened-by-current-tab"),e.$(a.element).hasClass("coveo-opening-tab-section")?(e.$(a.options.tabSectionToOpen).css("z-index","1001"),e.$(a.element).css("z-index","1001")):(e.$(a.options.tabSectionToOpen).css("z-index",void 0),e.$(a.element).css("z-index",void 0))}))}return __extends(o,n),o.prototype.handleTabChange=function(){var i=this,n=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.t);if(e.Utils.isNonEmptyString(n)){var o=!1;e.$(this.root).find(t.Component.computeSelectorForType(t.Tab.ID)).each(function(s,r){var a=t.Component.get(r,t.Tab);a.options.uniqueId==n&&(e.$(i.element).html(e.$(a.element).html()),o=!0)}),e.Assert.check(o,"Cannot find the currently active tab")}else e.$(this.element).hide()},o.ID="CurrentTab",o}(t.Component);t.CurrentTab=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultBreadcrumbOptions=i;var n=function(n){function o(t,s,r){var a=this;n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s),e.$(this.root).on(e.Events.QueryEvents.querySuccess,function(){return a.handleQuerySuccess()}),e.$(this.element).hide()}return __extends(o,n),o.prototype.handleQuerySuccess=function(){var i=this;this.element.innerHTML="";var n=this.getBreadcrumbs(),o=e.$("<div />").addClass("coveo-clear-all");e.$(this.element).fastToggle(0!=n.length),t.Device.isMobileDevice()||e.$(this.element).append(o);for(var s=0;s<n.length;s++)e.$(n[s].element).addClass("item").appendTo(this.element);t.Device.isMobileDevice()&&e.$(this.element).append(o),o.attr("title",t.l.ClearAllFilters()),o.append(e.$("<div />").addClass("coveo-icon")),this.bind.fastClick(o,function(){i.clearBreadcrumbs()})},o.prototype.getBreadcrumbs=function(){var t={breadcrumbs:[]};return e.$(this.root).trigger(e.Events.BreadcrumbEvents.populateBreadcrumb,t),this.logger.debug("Retrieved breadcrumbs",t.breadcrumbs),t.breadcrumbs},o.prototype.clearBreadcrumbs=function(){var i=this,n={};e.$(this.root).trigger(e.Events.BreadcrumbEvents.clearBreadcrumb,n),this.logger.debug("Clearing breadcrumbs"),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.breadcrumbResetAll,{})}})},o.ID="Breadcrumb",o}(t.Component);t.Breadcrumb=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultHiddenQueryOptions=i;var n=function(n){function o(t,s,r){n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s),e.$(this.root).on(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQuery,this)),e.$(this.root).on(this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.hq),e.$.proxy(this.handleUpdateUi,this))}return __extends(o,n),o.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i);var n=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.hq);e.Utils.isNonEmptyString(n)?i.queryBuilder.advancedExpression.add(n):e.$(this.element).hide()},o.prototype.handleUpdateUi=function(t,i){e.Assert.exists(i);var n=i.value,o=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.hd);e.Utils.isNonEmptyString(n)?(this.updatePanel(o),e.$(this.element).show()):e.$(this.element).hide()},o.prototype.updatePanel=function(i){var n=this;e.$(this.element).empty();var o=e.$("<span></span>").text(i),s=e.$("<a/>").attr("href","#").text(t.l.Remove()).addClass("coveo-remove").fastClick(function(){n.usageAnalytics.isContextual=!1,n.clearHiddenQuery()});this.usageAnalytics.isContextual=!0,e.$(this.element).append(o,s)},o.prototype.clearHiddenQuery=function(){var i=this,n=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.hd);this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.hd,""),this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.hq,""),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.contextRemove,{contextName:n})}})},o.ID="HiddenQuery",o}(t.Component);t.HiddenQuery=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultQueryDurationOptions=i;var n=function(n){function o(t,s,r){var a=this;n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s),e.$(this.root).on(e.Events.QueryEvents.querySuccess,e.$.proxy(this.handleQuerySuccess,this)),e.$(this.root).on(e.Events.QueryEvents.queryError,function(){e.$(a.element).hide()}),e.$(this.element).hide()}return __extends(o,n),o.prototype.handleQuerySuccess=function(i,n){e.Assert.exists(n);var o=t.l.Duration(this.formatQueryDuration(n.results.duration))+"\n"+t.l.IndexDuration(this.formatQueryDuration(n.results.indexDuration))+"\n"+t.l.ProxyDuration(this.formatQueryDuration(n.results.proxyDuration))+"\n"+t.l.ClientDuration(this.formatQueryDuration(n.results.clientDuration));e.$(this.element).text(this.formatQueryDuration(n.results.duration)),e.$(this.element).attr("title",o),e.$(this.element).show()},o.prototype.formatQueryDuration=function(e){if(void 0==e)return t.l.Unavailable();var i=Math.max(e/1e3,.01);return t.l.Seconds(Globalize.format(i,"n2"),i)},o.ID="QueryDuration",o}(t.Component);t.QueryDuration=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultQuerySummaryOptions=i;var n=function(n){function o(t,s,r){var a=this;n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s),e.$(this.root).on(e.Events.QueryEvents.querySuccess,e.$.proxy(this.handleQuerySuccess,this)),e.$(this.root).on(e.Events.QueryEvents.queryError,function(){e.$(a.element).hide()}),e.$(this.element).hide()}return __extends(o,n),o.prototype.handleQuerySuccess=function(i,n){if(e.Assert.exists(n),e.$(this.element).show(),n.results.results.length>0){var o=Globalize.format(n.query.firstResult+1,"n0"),s=Globalize.format(n.query.firstResult+n.results.results.length,"n0"),r=Globalize.format(n.results.totalCount,"n0");e.$(this.element).html(t.l.ShowingResultsOf('<span class="coveo-highlight">'+o+"</span>",'<span class ="coveo-highlight">'+s+"</span>",'<span class ="coveo-highlight">'+r+"</span>",n.results.results.length))}else e.$(this.element).html(t.l.QueryDidntMatchAnyDocuments())},o.ID="QuerySummary",o}(t.Component);t.QuerySummary=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.popUp=this.loadBooleanFromAttribute("data-pop-up",!1),this.showDetailedError=this.loadBooleanFromAttribute("data-show-detailed-error",!1)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultErrorReportOptions=i;var n=function(n){function o(t,s,r){n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s),e.$(this.element).append(e.$("<div />").addClass("coveo-error-title").append("<h3></h3><h4></h4>"));var a=e.$("<div />").addClass("coveo-options").append(this.buildPrevious()).append(this.buildClear()).append(this.buildRetry());e.$(this.element).append(a).append(this.message=e.$("<div class='coveo-error-message'></div>")).hide(),e.$(this.root).on(e.Events.QueryEvents.newQuery,e.$.proxy(this.handleNewQuery,this)),e.$(this.root).on(e.Events.QueryEvents.queryError,e.$.proxy(this.handleQueryError,this))}return __extends(o,n),o.prototype.setErrorTitle=function(){var i={h3:t.l.OopsError(),h4:t.l.ProblemPersists()};t.Device.isPhonegap()&&navigator.connection&&window.Connection&&(navigator.connection.type===window.Connection.NONE||0===navigator.connection.type)&&(i={h3:t.l.CannotConnect(),h4:t.l.NoNetworkConnection()}),e.$(this.element).find("h3").text(i.h3),e.$(this.element).find("h4").text(i.h4)},o.prototype.buildPrevious=function(){var i=this;return e.$("<span class='coveo-previous' > "+t.l.GoBack()+" </span>").fastClick(function(){i.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.errorBack,{},i.root),i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.errorBack,{}),history.back()})},o.prototype.buildClear=function(){var i=this;return e.$("<span class='coveo-clear'>"+t.l.Reset()+"</span>").fastClick(function(){i.queryStateModel.reset(),i.queryController.deferExecuteQuery({beforeExecuteQuery:function(){i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.errorClearQuery,{}),i.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.errorClearQuery,{},i.root)}})})},o.prototype.buildRetry=function(){var i=this;return e.$("<span class='coveo-retry'>"+t.l.Retry()+"</span>").fastClick(function(){i.queryController.deferExecuteQuery({beforeExecuteQuery:function(){i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.errorRetry,{}),i.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.errorRetry,{},i.root)}})})},o.prototype.handleNewQuery=function(){e.$(this.element).hide(),null!=this.closePopup&&this.closePopup()},o.prototype.handleQueryError=function(i,n){if(e.Assert.exists(n),e.Assert.exists(n.error),!n.error.isMissingAuthentication&&(this.message.empty(),this.setErrorTitle(),this.options.showDetailedError&&this.message.append(e.$("<span class='coveo-more-info'>"+t.l.MoreInfo()+"</span>").fastClick(function(t){e.$(t.target).parent().html(_.template("<pre><%- type %>\n<%- message %></pre>",n.error))})),e.$(this.element).show(),this.options.popUp)){var o=e.ModalBox.open(e.$(this.element).clone(!0,!0),{title:t.JQueryUtils.getPopUpCloseButton(t.l.Close(),t.l.ErrorReport()),titleClose:!0,overlayClose:!0,className:"coveo-error-report"});this.closePopup=o.close}},o.ID="ErrorReport",o}(t.Component);t.ErrorReport=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(Coveo){!function(Ui){var DefaultFieldValueOptions=function(e){function t(t){e.call(this,t),this.field=this.loadStringFromAttribute("data-field"),this.facet=this.loadStringFromAttribute("data-facet",this.field),this.htmlValue=this.loadBooleanFromAttribute("data-html-value",!1),this.helper=this.loadStringFromAttribute("data-helper"),this.helperOptions=this.loadStringFromAttribute("data-helper-options"),this.splitValues=this.loadBooleanFromAttribute("data-split-values",!1)}return __extends(t,e),t}(Ui.ComponentOptions);Ui.DefaultFieldValueOptions=DefaultFieldValueOptions;var FieldValue=function(_super){function FieldValue(e,t,i,n){var o=this;
_super.call(this,e,FieldValue.ID,i),this.element=e,this.options=t,this.result=n,this.options=new DefaultFieldValueOptions(e).merge(t),this.result=this.result||this.resolveResult(),Coveo.Assert.exists(this.result),this.options.field=this.options.field.toLowerCase();var s=Coveo.Utils.getCoveoFieldKey(this.options.field),r=this.result.raw[s];null==r&&(r=this.result[s]),_.isObject(r)&&(r=null);var a;this.options.splitValues&&r?(a=r.split(";"),a=_.map(a,function(e){return Coveo.$.trim(e)})):a=[r],_.each(a,function(e){void 0!=e&&o.renderOneValue(e)})}return __extends(FieldValue,_super),FieldValue.prototype.getHelperOptions=function(){return!this.evaluatedHelperOptions&&Coveo.Utils.isNonEmptyString(this.options.helperOptions)&&(this.evaluatedHelperOptions=eval("("+this.options.helperOptions+")")),this.evaluatedHelperOptions},FieldValue.prototype.renderOneValue=function(e){var t=Coveo.$("<span></span>"),i=e;this.options.helper&&(i=Ui.TemplateHelpers.getHelper(this.options.helper).call(this,e,this.getHelperOptions())),this.options.htmlValue?t.html(i):t.text(i),Coveo.$(this.element).append(t),this.bindEventOnValue(t,e)},FieldValue.prototype.bindEventOnValue=function(e,t){var i=this,n=Coveo.Models.QueryStateModel.getFacetId(this.options.facet),o=this.queryStateModel.get(n),s=this.componentStateModel.get(n),r=_.filter(s,function(e){return!e.disabled}).length>0;null!=o&&r&&(Coveo.$(e).on("click",function(){_.contains(o,t)?i.queryStateModel.set(n,_.without(o,t)):i.queryStateModel.set(n,_.union(o,[t])),i.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return i.usageAnalytics.logSearchEvent(Ui.AnalyticsActionCauseList.documentField,{facetId:i.options.facet,facetValue:t})}})}),_.contains(o,t)&&Coveo.$(e).addClass("coveo-selected"),Coveo.$(e).addClass("coveo-clickable"))},FieldValue.ID="FieldValue",FieldValue}(Ui.Component);Ui.FieldValue=FieldValue,Ui.CoveoJQuery.registerAutoCreateComponent(FieldValue)}(Coveo.Ui||(Coveo.Ui={}));var Ui=Coveo.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(t.ComponentOptions),n=function(t){function n(n,o,r,a){t.call(this,n,s.ID,r),this.element=n,this.options=o,this.options=new i(n).merge(o);var l=e.$(this.element).find("tr[data-field]");l.each(function(e,t){new s(t,{},r,a)}),0==e.$(n).find("tr").length&&e.$(n).detach()}return __extends(n,t),n.ID="FieldTable",n}(t.Component);t.CoveoJQuery.registerAutoCreateComponent(n);var o=function(e){function t(t){e.call(this,t),this.field=this.loadStringFromAttribute("data-field"),this.facet=this.loadStringFromAttribute("data-facet",this.field),this.caption=this.loadStringFromAttribute("data-caption",this.field.substr(1)),this.htmlValue=this.loadBooleanFromAttribute("data-html-value",!1),this.helper=this.loadStringFromAttribute("data-helper"),this.helperOptions=this.loadStringFromAttribute("data-helper-options"),this.splitValues=this.loadBooleanFromAttribute("data-split-values",!1)}return __extends(t,e),t}(t.ComponentOptions),s=function(i){function n(s,r,a,l){i.call(this,s,n.ID,a),this.element=s,this.options=r,this.result=l,this.options=new o(s).merge(r),this.result=l||this.resolveResult();var u=e.Utils.getCoveoFieldKey(this.options.field);if(null!=this.result.raw[u]||null!=this.result[u]){e.$(s).append('<th class ="CoveoCaption">'+this.options.caption.toLocaleString()+"</th>");var c=e.$("<td />").appendTo(s);new t.FieldValue(c[0],{field:this.options.field,facet:this.options.facet,htmlValue:this.options.htmlValue,helper:this.options.helper,helperOptions:this.options.helperOptions,splitValues:this.options.splitValues},a,l)}else e.$(s).detach()}return __extends(n,i),n.ID="ValueRow",n}(t.Component)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=(function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(t.ComponentOptions),function(i){function n(e,o,s,r){i.call(this,e,n.ID,s),this.element=e,this.options=o,this.result=r;var a=r.raw.sysparents;a?this.renderParentsXml(e,a):this.renderUri(e,r),t.Device.isPhonegap()&&t.PhonegapUtils.bindOpenLinkInPhonegap(e,this.uri)}return __extends(n,i),n.prototype.renderParentsXml=function(t,i){for(var n=e.$.parseXML(i),o=n.getElementsByTagName("parent"),s=[],r=[],a=0;a<o.length;a++){if(a>0){var l=this.buildSeperator();r.push(l),t.appendChild(l)}var u=o.item(a),c=this.buildHtmlToken(u.getAttribute("name"),u.getAttribute("uri"));s.push(c),t.appendChild(c)}if(s.length>1){var h=this.buildEllipsis();t.insertBefore(h,r[0]);var d=this.buildSeperator();t.insertBefore(d,h);for(var p=0,f=[],a=0;a<s.length;a++)f[a]=s[a].offsetWidth,p+=f[a];var m=r[0].offsetWidth,v=h.offsetWidth,g=t.offsetWidth;if(p>=g){p+=v+m;for(var y=[],a=1;a<s.length&&p>=g;)t.removeChild(s[a]),t.removeChild(r[a-1]),a>1&&y.push(r[a-1]),y.push(s[a]),p-=f[a]+m,a++;h.onclick=function(){for(var e=0;e<y.length;e++)t.insertBefore(y[e],h);t.removeChild(h)}}else t.removeChild(h),t.removeChild(d)}},n.prototype.renderUri=function(i,n){this.uri=n.clickUri;var o;o=-1==n.printableUri.indexOf("\\")?e.StringAndHoles.shortenUri(n.printableUri,e.$(i).width()/7):e.StringAndHoles.shortenPath(n.printableUri,e.$(i).width()/7);var s=e.HighlightUtils.highlightString(o.value,n.printableUriHighlights,o.holes,"coveo-highlight"),r=e.$("<a>").attr("title",n.printableUri).addClass("coveo-printable-uri").html(s);t.Device.isPhonegap()||r.attr("href",n.clickUri),r.appendTo(i)},n.prototype.buildSeperator=function(){var e=document.createElement("span");return e.innerText=">",e.className="coveo-printable-uri-separator",e},n.prototype.buildEllipsis=function(){var e=document.createElement("span");return e.innerText="...",e.className="coveo-printable-uri",e},n.prototype.buildHtmlToken=function(e,i){var n=e.charAt(0).toUpperCase()+e.slice(1),o=document.createElement("a");return t.Device.isPhonegap()||(o.href=i),this.uri=i,o.className="coveo-printable-uri",o.innerText=n,o},n.ID="PrintableUri",n}(t.Component));t.PrintableUri=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.includeInMenu=this.loadStringArrayFromAttribute("data-include-in-menu",[],","),this.menuDelay=this.loadNumberFromAttribute("data-menu-delay",300)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultSettingsOptions=i;var n=function(n){function o(t,s,r){n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s),e.$(this.root).on(e.Events.InitializationEvents.afterInitialization,e.$.proxy(this.init,this))}return __extends(o,n),o.prototype.init=function(){var t=this;this.menu=this.buildMenu(),e.$("<span/>").addClass("coveo-settings-icon").appendTo(this.element),e.$(this.element).fastClick(function(){t.toggleMenu()}),this.settingsButton=e.$(this.element);var i;e.$([this.settingsButton[0],this.menu[0]]).mouseleave(function(){i=setTimeout(function(){t.menu.detach()},t.options.menuDelay)}).mouseenter(function(){clearTimeout(i)})},o.prototype.buildMenu=function(){var t=e.$("<div/>").addClass("coveo-advanced-menu"),i=_.map(this.options.includeInMenu,function(t){return e.$(t).coveo()});return t.append(this.buildSection(i)),t},o.prototype.buildSection=function(t){var i=this,n=_.map(t,function(n){var o=_.filter(t,function(t){return!e.Utils.objectEqual(t,n)}),s=e.$("<div/>").addClass("coveo-section").addClass(n.getCssClass());e.$("<div/>").addClass("coveo-icon").appendTo(s);var r=e.$("<div>").addClass("coveo-items").appendTo(s);return _.each(n.getMenuItems(),function(e){var t=_.filter(n.getMenuItems(),function(t){return t.text!=e.text});r.append(i.buildLine(e.text,e.onOpen,o,t))}),s});return _.reduce(n,function(e,t){return e.add(t)})},o.prototype.buildLine=function(t,i,n,o){var s=this,r=o.concat(_.flatten(_.map(n,function(e){return e.getMenuItems()}),!0));return e.$("<div/>").addClass("coveo-item").text(t).fastClick(function(){s.menu.detach(),i(),_.invoke(r,"onClose")})},o.prototype.toggleMenu=function(){this.menu.is(":visible")?this.menu.detach():t.JQueryUtils.positionPopup(this.menu,e.$(this.element),e.$(this.root),e.$(this.root),this.getPopupPositioning())},o.prototype.getPopupPositioning=function(){return{horizontal:4,vertical:2,verticalOffset:8}},o.ID="Settings",o}(t.Component);t.Settings=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultShareQueryOptions=i;var n=function(i){function n(t,o,s){i.call(this,t,n.ID,s),this.element=t,this.options=o,this.dialogBoxContent=this.buildContent(),e.$(t).append(this.dialogBoxContent),e.$(this.root).on(e.Events.QueryEvents.querySuccess,e.$.proxy(this.handleProcessNewQueryResults,this))}return __extends(n,i),n.prototype.open=function(){e.$("."+t.Component.computeMemberNameForType(n.ID)).height(137)},n.prototype.close=function(){e.$(this.element).height(0)},n.prototype.getCssClass=function(){return"coveo-share-query"},n.prototype.getMenuItems=function(){var e=this;return[{text:t.l.ShareQuery(),onOpen:function(){return e.open()},onClose:function(){return e.close()}}]},n.prototype.handleProcessNewQueryResults=function(t,i){e.Assert.exists(i),e.Assert.exists(i.results);var n=i.query;this.linkToThisQuery.val(window.location.href),this.completeQuery.val(e.$.trim(this.outputIfNotNull(n.q)+" "+this.outputIfNotNull(n.aq)+" "+this.outputIfNotNull(n.cq))),this.logger.trace("Received query results from new query",n)},n.prototype.outputIfNotNull=function(e){return e?"("+e+")":""},n.prototype.buildContent=function(){var i=this,n=e.$("<div/>").addClass("coveo-query-summary-info");n.append(e.$("<span/>").addClass("coveo-query-summary-info-title").text(t.l.ShareQuery()));var o=e.$("<div/>").addClass("coveo-query-summary-info-close").append("<span/>");o.fastClick(function(){return i.close()}),n.append(o);var s=e.$("<div/>").addClass("coveo-query-summary-info-boxes");return this.linkToThisQuery=e.$("<input/>").attr("type","text").addClass("coveo-query-summary-info-input"),this.linkToThisQuery.fastClick(function(){return i.linkToThisQuery.select()}),this.completeQuery=e.$("<input/>").attr("type","text").addClass("coveo-query-summary-info-input"),s.append(this.buildTextBoxWithLabel(t.l.Link()+":",this.linkToThisQuery)),s.append(this.buildTextBoxWithLabel(t.l.CompleteQuery()+":",this.completeQuery)),s.appendTo(n),t.Component.pointElementsToDummyForm(n),n},n.prototype.buildTextBoxWithLabel=function(t,i){var n=e.$("<span/>").addClass("coveo-query-summary-info-label").text(t);return e.$("<div/>").append(n).append(i)},n.create=function(t,i,o){return e.Assert.exists(t),new n(t,i,o)},n.ID="ShareQuery",n}(t.Component);t.ShareQuery=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.classToToggle=this.loadStringFromAttribute("data-toggle-class"),this.target=this.loadStringFromAttribute("data-toggle-target"),this.activateGlass=this.loadBooleanFromAttribute("data-toggle-glass",!1)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultToggleButtonOptions=i;var n=function(n){function o(t,s,r){var a=this;n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s),e.Assert.exists(t),e.Assert.exists(this.options),this.classToToggle=this.options.classToToggle,this.target=this.options.target,this.activateGlass=this.options.activateGlass,this.activateGlass&&this.buildGlass(),e.$(t).fastClick(function(){return a.handleClick()}),"A"==t.tagName&&e.$(t).attr("href","javascript:");var l=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.t);this.bind.onRoot(l,this.handleTabChanged)}return __extends(o,n),o.prototype.handleClick=function(){e.$("."+this.target).hasClass(this.classToToggle)?this.removeToggleClass():this.addToggleClass()},o.prototype.handleTabChanged=function(){this.removeToggleClass()},o.prototype.addToggleClass=function(){t.JQueryUtils.addToggleClassOnSearchInterface(this.classToToggle.substr(6),t.Device.isPhonegap())},o.prototype.removeToggleClass=function(){t.JQueryUtils.removeToggleClassOnSearchInterface(t.Device.isPhonegap())},o.prototype.getGlass=function(){return e.$(".coveo-glass")},o.prototype.buildGlass=function(){if(0==this.getGlass().length){var i=e.$("<div></div>").addClass("coveo-glass");i.fastClick(function(){t.JQueryUtils.removeToggleClassOnSearchInterface()});var n=e.$("."+t.Component.computeCssClassNameForType(t.SearchInterface.ID));e.$(n).append(i)}},o.ID="ToggleButton",o}(t.Component);t.ToggleButton=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(i){function n(n){i.call(this,n),this.field=this.loadStringFromAttribute("data-field"),this.childField=this.loadStringFromAttribute("data-child-field","@systopparentid"),this.parentField=this.loadStringFromAttribute("data-parent-field","@syscontainsattachment"),this.range=this.loadNumberFromAttribute("data-range",2);var o=this.loadStringFromAttribute("data-rearrange");e.Utils.isNonEmptyString(o)&&(this.rearrange=t.SortCriteria.parse(o)),this.enableExpand=this.loadBooleanFromAttribute("data-enable-expand",!0),this.expandExpression=this.loadStringFromAttribute("data-expand-expression"),this.maximumExpandedResults=this.loadNumberFromAttribute("data-maximum-expanded-results",100),this.expandFoldingField=this.loadStringFromAttribute("data-expand-folding-field"),e.Assert.exists(this.field),e.Assert.exists(0==this.field.indexOf("@")),e.Assert.exists(this.range),e.Assert.exists(this.maximumExpandedResults)}return __extends(n,i),n}(t.ComponentOptions);t.DefaultFoldingOptions=i;var n=function(n){function o(t,s,r){n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s),this.bind.onRoot(e.Events.QueryEvents.buildingQuery,this.handleBuildingQuery),this.bind.onRoot(e.Events.QueryEvents.preprocessResults,this.handlepreprocessResults)}return __extends(o,n),o.resultNodeToQueryResult=function(e){var t=e.result;return t.attachments=_.map(_.sortBy(e.children,"score"),o.resultNodeToQueryResult),t.parentResult=null!=e.parent?e.parent.result:null,t},o.findUniqueId=function(e,t){for(var i=0;i<e.length;i++){if(e[i].result.uniqueId==t)return e[i];var n=o.findUniqueId(e[i].children,t);if(null!=n)return n}return null},o.foldWithParent=function(e){var t={score:Number.NEGATIVE_INFINITY,children:[],result:{}};return _.each(e,function(e,i){var n=o.findUniqueId(t.children,e.uniqueId);if(null==e.parentResult||e.parentResult.uniqueId==e.uniqueId)null==n&&(n={result:e,score:i,children:[]},t.children.push(n),n.parent=t);else{null!=n?(n.score=Math.min(i,n.score),n.parent.children=_.without(n.parent.children,n)):n={result:e,score:i,children:[]};var s=o.findUniqueId(t.children,e.parentResult.uniqueId);null==s&&(s={result:e.parentResult,score:Number.POSITIVE_INFINITY,children:[]},t.children.push(s),s.parent=t),s.children.push(n),n.parent=s;for(var r=s;null!=r&&n.score<r.score;)r.score=n.score,r=r.parent}}),o.resultNodeToQueryResult(t).attachments},o.defaultGetResult=function(e){var t=e.childResults||[];t.unshift(e),e.childResults=[],t=o.foldWithParent(t);var i=t.shift();return i.childResults=t,i},o.defaultGetMoreResults=function(e){return o.foldWithParent(e)},o.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i),this.disabled||(i.queryBuilder.childField=this.options.childField,i.queryBuilder.parentField=this.options.parentField,i.queryBuilder.filterField=this.options.field,i.queryBuilder.filterFieldRange=this.options.range)},o.prototype.handlepreprocessResults=function(t,i){e.Assert.exists(i),e.Assert.check(!i.results._folded,"Two folding component are active at the same time for the same tab. Can't process result !"),i.results._folded=!0;var n=i.results,s=this.options.getResult||o.defaultGetResult;n.results=_.map(n.results,s),this.addLoadMoreHandler(n.results,i.query)},o.prototype.addLoadMoreHandler=function(t,i){var n=this;return _.map(t,function(t){return n.options.enableExpand&&!e.Utils.isNullOrUndefined(t.raw[n.options.field.substr(1)])&&(t.moreResults=function(){return n.moreResults(t,i)}),t})},o.prototype.moreResults=function(i,n){var o=this,s=e.$.Deferred(),r=new t.QueryBuilder;r.numberOfResults=this.options.maximumExpandedResults;var a=i.raw[this.options.field.substr(1)];e.Utils.isNonEmptyString(a)&&r.advancedExpression.addFieldExpression(this.options.field,"=",[a]),e.Utils.isNonEmptyString(n.q)&&r.expression.add("("+n.q+") OR @sysuri"),e.Utils.isNonEmptyString(this.options.expandExpression)&&r.constantExpression.add(this.options.expandExpression),null!=this.options.parentField&&(r.parentField=this.options.parentField),null!=this.options.childField&&(r.childField=this.options.childField),this.options.rearrange?this.options.rearrange.putInQueryBuilder(r):(r.sortCriteria=n.sortCriteria,r.sortField=n.sortField);var l=r.build();return this.queryController.getEndpoint().search(l).done(function(t){e.QueryUtils.setIndexAndUidOnQueryResults(l,t,i.queryUid),e.QueryUtils.setStateObjectOnQueryResults(o.queryStateModel.get(),t),o.handlePreprocessMoreResults(t),s.resolve(t.results)}),s},o.prototype.handlePreprocessMoreResults=function(e){var t=this.options.getMoreResults||o.defaultGetMoreResults;e.results=t(e.results)},o.ID="Folding",o}(t.Component);t.Folding=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(i){function n(n){i.call(this,n),this.normalCaption=this.loadLocalizedStringFromAttribute("data-normal-caption"),this.expandedCaption=this.loadLocalizedStringFromAttribute("data-expanded-caption"),this.moreCaption=this.loadLocalizedStringFromAttribute("data-more-caption",t.l.ShowMore()),this.lessCaption=this.loadLocalizedStringFromAttribute("data-less-caption",t.l.ShowLess()),this.oneResultCaption=this.loadLocalizedStringFromAttribute("data-one-result-caption",t.l.DisplayingTheOnlyMessage()),this.resultTemplate=this.loadResultTemplateFromSelectorAttribute("data-result-template-selector"),this.resultTemplate=this.loadResultTemplateFromIdAttribute("data-result-template-id",this.resultTemplate),this.resultTemplate=this.loadChildResultTemplateFromSelector(".result-template",this.resultTemplate),this.resultTemplate=this.resultTemplate||new t.DefaultResultTemplate,e.Assert.exists(this.resultTemplate)}return __extends(n,i),n}(t.ComponentOptions);t.DefaultResultFoldingOptions=i;var n=function(n){function o(t,s,r,a){n.call(this,t,o.ID,r),this.element=t,this.options=s,this.result=a,this.showingMoreResults=!1,this.options=new i(t).merge(s),e.Assert.exists(a),this.buildElements(),this.displayThoseResults(this.result.childResults),this.updateElementVisibility(),0!=this.result.childResults.length||this.result.moreResults||e.$(this.element).hide()}return __extends(o,n),o.prototype.showMoreResults=function(){var i=this;e.Assert.exists(this.result.moreResults),this.cancelAnyPendingShowMore(),this.moreResultsDeferred=this.result.moreResults(),this.waitAnimation=t.JQueryUtils.getBasicLoadingDots().appendTo(this.results),this.updateElementVisibility(),this.moreResultsDeferred.done(function(e){i.showingMoreResults=!0,i.displayThoseResults(e),i.updateElementVisibility(e.length)}),this.moreResultsDeferred.always(function(){i.moreResultsDeferred=void 0,i.waitAnimation.detach(),i.waitAnimation=void 0})},o.prototype.showLessResults=function(){this.cancelAnyPendingShowMore(),this.showingMoreResults=!1,this.displayThoseResults(this.result.childResults),this.updateElementVisibility(),this.scrollToResultElement()},o.prototype.buildElements=function(){this.buildHeader(),this.buildResults(),this.buildFooter()},o.prototype.buildHeader=function(){var t=e.$("<div/>").addClass("coveo-folding-header").appendTo(this.element);void 0!=this.options.normalCaption&&void 0!=this.options.expandedCaption&&(this.normalCaption=e.$("<div/>").addClass("coveo-folding-header-caption").text(this.options.normalCaption).appendTo(t),this.expandedCaption=e.$("<div/>").addClass("coveo-folding-header-caption").text(this.options.expandedCaption).appendTo(t)),this.onlyOneMessageCaption=e.$("<div/>").addClass("coveo-folding-header-caption").text(this.options.oneResultCaption).appendTo(t)},o.prototype.buildResults=function(){this.results=e.$("<div/>").addClass("coveo-folding-results").appendTo(this.element)},o.prototype.buildFooter=function(){var t=this,i=e.$("<div/>").addClass("coveo-folding-footer").appendTo(this.element.parentElement);if(this.result.moreResults){this.showMore=e.$("<div/>").addClass("coveo-folding-footer-section-for-less").appendTo(i).fastClick(function(){return t.showMoreResults()}),this.showLess=e.$("<div/>").addClass("coveo-folding-footer-section-for-more").appendTo(i).fastClick(function(){return t.showLessResults()});var n=e.$("<div><span class='coveo-folding-footer-icon'></span></div>").addClass("coveo-more"),o=e.$("<div><span class='coveo-folding-footer-icon'></span></div>").addClass("coveo-less"),s=e.$("<a/>").addClass("coveo-folding-show-more").text(this.options.moreCaption),r=e.$("<a/>").addClass("coveo-folding-show-less").text(this.options.lessCaption);this.showMore.append(s),this.showLess.append(r),this.showMore.append(n),this.showLess.append(o)}},o.prototype.updateElementVisibility=function(t){this.normalCaption&&this.normalCaption.fastToggle(!this.showingMoreResults&&this.result.childResults.length>0),this.expandedCaption&&this.expandedCaption.fastToggle(this.showingMoreResults),this.onlyOneMessageCaption.fastToggle(t&&1==t),this.showMore&&(this.showMore.fastToggle(!this.showingMoreResults&&!e.Utils.exists(this.moreResultsDeferred)),this.showLess.fastToggle(this.showingMoreResults)),e.$(this.element).find(".coveo-show-if-normal").fastToggle(!this.showingMoreResults),e.$(this.element).find(".coveo-show-if-expanded").fastToggle(this.showingMoreResults)},o.prototype.scrollToResultElement=function(){var i=e.$(this.element).closest(".CoveoResult").offset(),n=e.$(this.root).find("."+t.Component.computeCssClassNameForType(t.ResultList.ID)),o=!1;if(0!=n.length){var s=n.coveo(),r=s.options.mobileScrollContainer||s.options.infiniteScrollContainer,a=r.scrollHeight>e.$(r).height();a&&(o=!0,e.$(r).animate({scrollTop:r.scrollTop+i.top-(t.Device.isMobileDevice()?50:0)}))}i.top<e.$(window).scrollTop()&&!o&&e.$("html, body").animate({scrollTop:i.top})},o.prototype.displayThoseResults=function(e){var t=this;this.results.empty(),_.each(e,function(e){t.renderChildResult(e)})},o.prototype.renderChildResult=function(t){var i=e.$(this.options.resultTemplate.instantiateToElement(t)).addClass("coveo-child-result").appendTo(this.results);i.toggleClass("coveo-normal-child-result",!this.showingMoreResults),i.toggleClass("coveo-expanded-child-result",this.showingMoreResults),this.autoCreateComponentsInsideResult(i.get(0),t)},o.prototype.autoCreateComponentsInsideResult=function(i,n){e.Assert.exists(i);var o=this.searchInterface.options,s=e.$.extend({},{options:o},this.getBindings(),{result:n});t.CoveoJQuery.automaticallyCreateComponentsInside(i,s)},o.prototype.cancelAnyPendingShowMore=function(){this.moreResultsDeferred&&this.moreResultsDeferred.reject(),e.Assert.doesNotExists(this.moreResultsDeferred),e.Assert.doesNotExists(this.waitAnimation)},o.ID="ResultFolding",o}(t.Component);t.ResultFolding=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t}(t.ComponentOptions),n=function(n){function o(t,s,r){var a=this;n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s),e.$(this.root).on(e.Events.ResultListEvents.newResultsDisplayed,function(){return a.handleNewResultsDisplayed()})}return __extends(o,n),o.prototype.handleNewResultsDisplayed=function(){var t=this;e.$(this.root).find(".CoveoResult").dblclick(function(e){return t.handleResultDoubleClick(e)})},o.prototype.handleResultDoubleClick=function(i){var n=e.$(i.target).hasClass(t.Component.computeCssClassNameForType(t.ResultLink.ID));if(i.altKey&&!n){var o=e.$(i.currentTarget).data("CoveoResult"),s=this.buildResultInfo(o),r=e.ModalBox.open(s,{title:"Debug",className:"coveo-debug"});e.$(r.wrapper.find(".coveo-title")).fastClick(function(){return r.close()}),e.$(r.overlay).fastClick(function(){return r.close()}),i.cancelBubble=!0,i.result=!1}},o.prototype.buildResultInfo=function(t){e.Assert.exists(t);var i=e.$("<div/>");return i.append(e.$("<div/>").append(e.$("<a/>").attr("href",t.clickUri).text(t.title||t.uri))),e.$("<div>Properties</div>").addClass("coveo-debug-title").appendTo(i),this.buildPropertyTable(t).appendTo(i),e.$("<div>Fields</div>").addClass("coveo-debug-title").appendTo(i),this.buildFieldTable(t).appendTo(i),e.$("<div>Ranking Info</div>").addClass("coveo-debug-title").appendTo(i),this.buildRankingInfo(t).appendTo(i),i},o.prototype.buildPropertyTable=function(t){var i=this;e.Assert.exists(t);var n=e.$("<table/>").addClass("coveo-debug-property-table"),o=_.keys(t).sort();return _.each(o,function(o){if("raw"!=o&&o[0]==o.toLowerCase()[0]){var s=e.$("<tr/>").appendTo(n);e.$("<td/>").addClass("coveo-debug-property-name").text(o).appendTo(s),e.$("<td/>").addClass("coveo-debug-property-value").append(i.formatValue(t[o])).appendTo(s)}}),n},o.prototype.buildFieldTable=function(t){var i=this;e.Assert.exists(t);var n=e.$("<table/>").addClass("coveo-debug-fields-table"),o=_.keys(t.raw).sort();return _.each(o,function(o){var s=e.$("<tr/>").appendTo(n);e.$("<td/>").addClass("coveo-debug-field-name").text("@"+o).appendTo(s),e.$("<td/>").addClass("coveo-debug-field-value").append(i.formatValue(t.raw[o])).appendTo(s)}),n},o.prototype.buildRankingInfo=function(t){return e.Assert.exists(t),e.$("<div/>").addClass("coveo-debug-ranking-info").text(t.rankingInfo)},o.prototype.formatValue=function(t){return e.Utils.isNonEmptyString(t)&&0==t.indexOf("http")?e.$("<a/>").attr("href",t).text(t):e.$("<span/>").text(t)},o.ID="Debug",o}(t.Component);t.Debug=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.menuDelay=this.loadNumberFromAttribute("data-menu-delay",300)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultTabGroupMenuOptions=i;var n=function(n){function o(e,t,s){n.call(this,e,o.ID,s),this.options=t,this.menuIsOpen=!1,this.menuItemsContainerTemplate=_.template("<div class='coveo-menu-item-container'></div>"),this.activeMenuItemTemplate=_.template("<a class='coveo-menu-item-active'><%= itemIcon %><%= caption %><%= showMoreIcon %> </a>"),this.activeMenuItemIconTemplate=_.template("<span class='coveo-icon <%= _class %>'></span>"),this.activeMenuItemCaptionTemplate=_.template("<span class='coveo-caption'><%= text %></span>"),this.options=new i(e).merge(t),this.initQueryStateEvents(),this.initMiscEvents()}return __extends(o,n),o.prototype.open=function(){this.renderMenu(),this.menuItemsContainer.css("min-width",this.activeMenuItemDisplay.outerWidth()),this.menuItemsContainer.show(),this.activeMenuItemDisplay.addClass("coveo-menu-open"),this.menuIsOpen=!0},o.prototype.close=function(){this.menuItemsContainer.hide(),this.activeMenuItemDisplay.removeClass("coveo-menu-open"),this.menuIsOpen=!1},o.prototype.handleClick=function(e){this.targetIsAMenuItem(e)?this.handleClickOnMenuItem(e):this.handleClickOnMenu()},o.prototype.handleClickOnMenuItem=function(e){var i=t.Component.get(this.getCorrectTarget(e).get(0),t.TabGroup);this.selectMenuItem(this.getItemInMenuById(i.getId())),this.close(),this.queryController.deferExecuteQuery()},o.prototype.handleClickOnMenu=function(){this.menuIsOpen?this.close():this.open()},o.prototype.handleMouseLeave=function(){this.close()},o.prototype.handleAfterInitialization=function(){this.initMenuItems();var t=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.tg);this.selectMenuItem(this.getItemInMenuById(t))},o.prototype.handleQueryStateChange=function(t,i){e.Assert.exists(i),this.selectMenuItem(this.getItemInMenuById(i.value))},o.prototype.initMenuItems=function(){var i=this;this.menuItemsContainer=e.$(this.menuItemsContainerTemplate()).hide(),this.activeMenuItemDisplay=e.$("<div></div>"),e.$(this.element).append(this.activeMenuItemDisplay,this.menuItemsContainer),this.menuItems=_.map(e.$(this.element).find("."+t.Component.computeCssClassNameForType(t.TabGroup.ID)),function(t){return i.menuItemsContainer.append(t),{tabGroup:e.$(t).coveo(),element:e.$(t)}})},o.prototype.initQueryStateEvents=function(){var t=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.tg);e.$(this.root).on(t,e.$.proxy(this.handleQueryStateChange,this))},o.prototype.initMiscEvents=function(){var t=this;e.$(this.root).on(e.Events.InitializationEvents.afterInitialization,function(){return t.handleAfterInitialization()}),e.$(this.element).fastClick(function(e){t.handleClick(e)}),e.$(this.element).mouseleave(function(e){setTimeout(function(){t.handleMouseLeave(e)},t.options.menuDelay)})},o.prototype.renderDisplayActiveMenuItem=function(){this.activeMenuItemDisplay.empty(),this.activeMenuItemDisplay.html(this.activeMenuItemTemplate({itemIcon:this.activeMenuItemIconTemplate({_class:this.activeMenuItem.tabGroup.getIcon()}),caption:this.activeMenuItemCaptionTemplate({text:this.activeMenuItem.tabGroup.getTitle()}),showMoreIcon:this.activeMenuItemIconTemplate({_class:"coveo-show-more"})}))},o.prototype.renderMenu=function(){_.each(this.getInactiveMenuItems(),function(e){e.element.show()}),this.activeMenuItem.element.hide()},o.prototype.selectMenuItem=function(e){void 0!=this.menuItems&&(void 0==e&&(e=this.menuItems[0]),this.activeMenuItem=e,this.activeMenuItem.tabGroup.select(),this.renderDisplayActiveMenuItem())},o.prototype.getItemInMenuById=function(e){return _.find(this.menuItems,function(t){return t.tabGroup.getId()==e})},o.prototype.getItemInMenuByElement=function(t){return _.find(this.menuItems,function(i){return e.Utils.objectEqual(t,i.element)})},o.prototype.getInactiveMenuItems=function(){var t=this;return _.reject(this.menuItems,function(i){return e.Utils.objectEqual(i,t.activeMenuItem)})},o.prototype.getItemMenuClass=function(){return t.Component.computeCssClassNameForType(t.TabGroup.ID)},o.prototype.getCorrectTarget=function(t){return e.$(t.target).parent().hasClass(this.getItemMenuClass())?e.$(t.target).parent():e.$(t.target)},o.prototype.targetIsAMenuItem=function(e){return this.getCorrectTarget(e).hasClass(this.getItemMenuClass())},o.ID="TabGroupMenu",o}(t.Component);t.TabGroupMenu=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(t){function i(i){t.call(this,i),this.id=this.loadStringFromAttribute("data-id"),this.icon=this.loadStringFromAttribute("data-icon",""),this.expression=this.loadStringFromAttribute("data-expression"),e.Assert.exists(this.id)}return __extends(i,t),i}(t.ComponentOptions);t.DefaultTabGroupOptions=i;var n=function(n){function o(t,s,r){n.call(this,t,o.ID,r),this.options=s,this.isSelected=!1,this.iconTemplate=_.template("<span class='coveo-icon <%= _class %>'></span>"),this.options=new i(t).merge(s),this.title=e.$(this.element).text(),this.initQueryEvents(),this.initQueryStateEvents(),e.$(this.element).prepend(this.iconTemplate({_class:this.options.icon}))}return __extends(o,n),o.prototype.select=function(){this.actionOnSelect(),this.updateQueryStateModel()},o.prototype.getTitle=function(){return this.title},o.prototype.getIcon=function(){return this.options.icon},o.prototype.getId=function(){return this.options.id},o.prototype.actionOnSelect=function(){this.hideTabsNotInThisGroup(),this.isSelected=!0},o.prototype.actionOnUnSelect=function(){this.isSelected=!1
},o.prototype.updateQueryStateModel=function(){this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.tg,this.options.id)},o.prototype.initQueryEvents=function(){e.$(this.root).on(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQueryEvents,this))},o.prototype.initQueryStateEvents=function(){var t=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.tg);e.$(this.root).on(t,e.$.proxy(this.handleQueryStateChange,this))},o.prototype.handleBuildingQueryEvents=function(t,i){e.Assert.exists(i),this.isSelected&&e.Utils.isNonEmptyString(this.options.expression)&&i.queryBuilder.advancedExpression.add(this.options.expression)},o.prototype.handleQueryStateChange=function(t,i){e.Assert.exists(i),i.value==this.options.id?this.actionOnSelect():this.actionOnUnSelect()},o.prototype.hideTabsNotInThisGroup=function(){var e=this,t=this.getAllTabs();_.each(t,function(t){e.isElementIncludedInTabGroup(t.element)?t.enable():t.disable()})},o.prototype.getAllVisibleTab=function(){return _.filter(this.getAllTabs(),function(t){return e.$(t.element).is(":visible")})},o.prototype.getAllTabs=function(){return this.searchInterface.components(t.Tab.ID)},o.prototype.isElementIncludedInTabGroup=function(t){var i=e.$(t).attr("data-tab-group");return void 0==i||_.contains(i.split(","),this.options.id)},o.ID="TabGroup",o}(t.Component);t.TabGroup=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(t){function i(n){t.call(this,n),this.user=this.loadStringFromAttribute("data-user"),this.endpoint=this.loadStringFromAttribute("data-endpoint",e.Rest.AnalyticsEndpoint.DEFAULT_ANALYTICS_URI),this.token=this.loadStringFromAttribute("data-token",i.getDefaultToken()),this.searchHub=this.loadStringFromAttribute("data-search-hub","default"),this.sendToCloud=this.loadBooleanFromAttribute("data-send-to-cloud",!0)}return __extends(i,t),i.getDefaultToken=function(){var t=e.Rest.SearchEndpoint.endpoints["default"];return t?t.options.accessToken:void 0},i}(t.ComponentOptions);t.DefaultAnalyticsOptions=i;var n=function(n){function o(t,s,r){n.call(this,t,o.ID,r),this.element=t,this.options=s,this.options=new i(t).merge(s),this.initializeAnalyticsClient(),e.Assert.exists(this.client)}return __extends(o,n),o.prototype.initializeAnalyticsClient=function(){if(e.Utils.isNonEmptyString(this.options.endpoint)){var i=new e.Rest.AnalyticsEndpoint({token:this.options.token,userId:this.options.user,serviceUrl:this.options.endpoint});this.client=new t.LiveAnalyticsClient(i,this.root||this.element,this.options.searchHub,this.options.sendToCloud)}else this.client=new t.NoopAnalyticsClient},o.ID="Analytics",o}(t.Component);t.Analytics=n}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){e.AnalyticsActionCauseList={interfaceLoad:{name:"interfaceLoad",type:"interface"},interfaceChange:{name:"interfaceChange",type:"interface",metaMap:{interfaceChangeTo:1}},contextRemove:{name:"contextRemove",type:"misc",metaMap:{contextName:1}},didyoumeanAutomatic:{name:"didyoumeanAutomatic",type:"misc"},didyoumeanClick:{name:"didyoumeanClick",type:"misc"},resultsSort:{name:"resultsSort",type:"misc",metaMap:{resultsSortBy:1}},searchboxSubmit:{name:"searchboxSubmit",type:"search box"},searchboxClear:{name:"searchboxClear",type:"search box"},searchboxAsYouType:{name:"searchboxAsYouType",type:"search box"},breadcrumbFacet:{name:"breadcrumbFacet",type:"breadcrumb",metaMap:{facetId:1,facetValue:2}},breadcrumbResetAll:{name:"breadcrumbResetAll",type:"breadcrumb"},documentTag:{name:"documentTag",type:"document",metaMap:{facetId:1,facetValue:2}},documentField:{name:"documentField",type:"document",metaMap:{facetId:1,facetValue:2}},documentQuickView:{name:"documentQuickView",type:"document",metaMap:{documentTitle:1,documentURL:2}},documentOpen:{name:"documentOpen",type:"document",metaMap:{documentTitle:1,documentURL:2}},omniboxSearch:{name:"omniboxSearch",type:"omnibox"},omniboxFacet:{name:"omniboxFacet",type:"omnibox",metaMap:{facetId:1,facetValue:2}},omniboxAnalytics:{name:"omniboxAnalytics",type:"omnibox"},omniboxField:{name:"omniboxField",type:"omnibox"},facetClearAll:{name:"facetClearAll",type:"facet",metaMap:{facetId:1}},facetSearch:{name:"facetSearch",type:"facet",metaMap:{facetId:1}},facetToggle:{name:"facetToggle",type:"facet",metaMap:{facetId:1,facetOperatorBefore:2,facetOperatorAfter:3}},facetRangeSlider:{name:"facetRangeSlider",type:"facet",metaMap:{facetId:1,facetRangeStart:2,facetRangeEnd:3}},facetRangeGraph:{name:"facetRangeGraph",type:"facet",metaMap:{facetId:1,facetRangeStart:2,facetRangeEnd:3}},facetSelect:{name:"facetSelect",type:"facet",metaMap:{facetId:1,facetValue:2}},facetSelectAll:{name:"facetSelectAll",type:"facet",metaMap:{facetId:1,facetValue:2}},facetDeselect:{name:"facetDeselect",type:"facet",metaMap:{facetId:1,facetValue:2}},facetExclude:{name:"facetExclude",type:"facet",metaMap:{facetId:1,facetValue:2}},facetUnexclude:{name:"facetUnexclude",type:"facet",metaMap:{facetId:1,facetValue:2}},facetSortValues:{name:"facetSortValues",type:"facet",metaMap:{facetId:1,facetSortBy:2}},errorBack:{name:"errorBack",type:"errors"},errorClearQuery:{name:"errorClearQuery",type:"errors"},errorRetry:{name:"errorRetry",type:"errors"},expandToFullUI:{name:"expandToFullUI",type:"interface"},caseCreate:{name:"caseCreate",type:"case"},casecontextAdd:{name:"casecontextAdd",type:"casecontext",metaMap:{caseID:5}},casecontextRemove:{name:"casecontextRemove",type:"casecontext",metaMap:{caseID:5}},preferencesChange:{name:"preferencesChange",type:"preferences",metaMap:{preferenceName:1,preferenceType:2}},caseAttach:{name:"caseAttach",type:"case",metaMap:{documentTitle:1,resultUriHash:3,articleID:4,caseID:5}},caseDetach:{name:"caseDetach",type:"case",metaMap:{documentTitle:1,resultUriHash:3,articleID:4,caseID:5}},customfiltersChange:{name:"customfiltersChange",type:"customfilters",metaMap:{customFilterName:1,customFilterType:2,customFilterExpression:3}}}}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function i(i){e.call(this,i),this.field=this.loadStringFromAttribute("data-field"),this.queryOverride=this.loadStringFromAttribute("data-query-override",""),this.omniboxSuggestionOptions=new t.DefaultSuggestionForOmniBoxOptions(i,{headerTitle:t.l.SuggestedResults(),omniBoxZIndex:51})}return __extends(i,e),i}(t.ComponentOptions);t.DefaultTopFieldSuggestionsOptions=i;var n=function(n){function o(s,r,a){n.call(this,s,o.ID,a),this.options=r,this.topFieldElementHeaderTemplate=_.template("<div class='coveo-top-field-suggestion-header'>        <span class='coveo-icon-top-field'></span>         <span class='coveo-caption'><%= headerTitle %></span>       </div>"),this.topFieldElementRowTemplate=_.template("<div class='coveo-omnibox-selectable coveo-top-field-suggestion-row'>         <%= data %>       </div>"),this.options=new i(s).mergeDeep(r),e.Assert.check(e.Utils.isCoveoField(this.options.field),this.options.field+" is not a valid field"),this.options.omniboxSuggestionOptions.onSelect=this.options.omniboxSuggestionOptions.onSelect||this.onRowSelection;var l={header:{template:this.topFieldElementHeaderTemplate,title:this.options.omniboxSuggestionOptions.headerTitle},row:this.topFieldElementRowTemplate};this.suggestionForOmniBox=new t.SuggestionForOmniBox(l,e.$.proxy(this.options.omniboxSuggestionOptions.onSelect,this)),e.$(this.root).on(e.Events.OmniBoxEvents.populateOmniBox,e.$.proxy(this.handlePopulateOmniBox,this))}return __extends(o,n),o.prototype.handlePopulateOmniBox=function(t,i){var n=this;if(e.Assert.exists(i),!this.disabled){var o=i.completeQueryExpression.word,s=e.$.Deferred(),r=this.queryController.getEndpoint().listFieldValues(this.buildListFieldValueRequest(o));r.done(function(e){var t=n.suggestionForOmniBox.buildOmniBoxElement(e,i);s.resolve({element:void 0==t?void 0:t.get(0),zIndex:n.options.omniboxSuggestionOptions.omniBoxZIndex})}),r.fail(function(){n.resolveWithUndefined(s)}),i.rows.push({deferred:s})}},o.prototype.resolveWithUndefined=function(e){e.resolve({element:void 0})},o.prototype.onRowSelection=function(i,n){var o=this;n.clear(),n.closeOmniBox(),this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,i),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return o.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.omniboxField,{})}})},o.prototype.buildListFieldValueRequest=function(e){return{field:this.options.field,ignoreAccents:!0,sortCriteria:"occurrences",maximumNumberOfValues:this.options.omniboxSuggestionOptions.numberOfSuggestions,patternType:"Wildcards",pattern:"*"+e+"*",queryOverride:this.options.queryOverride}},o.ID="TopFieldSuggestions",o}(e.Ui.Component);t.TopFieldSuggestions=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function i(i,n){e.call(this,i),this.omniboxSuggestionOptions=new t.DefaultSuggestionForOmniBoxOptions(i,n)}return __extends(i,e),i}(t.ComponentOptions);t.DefaultTopAnalyticsSuggestionsOptions=i;var n=function(n){function o(s,r,a){n.call(this,s,o.ID,a),this.options=r,this.topAnalyticsElementHeaderTemplate=_.template("<div class='coveo-top-analytics-suggestion-header'>        <span class='coveo-icon-top-analytics'></span>         <span class='coveo-caption'><%= headerTitle %></span>       </div>"),this.topAnalyticsElementRowTemplate=_.template("<div class='coveo-omnibox-selectable coveo-top-analytics-suggestion-row'>         <%= data %>       </div>"),this.options=new i(s,{headerTitle:t.l.SuggestedQueries(),omniBoxZIndex:52}).mergeDeep(r),this.options.omniboxSuggestionOptions.onSelect=this.options.omniboxSuggestionOptions.onSelect||this.onRowSelection;var l={header:{template:this.topAnalyticsElementHeaderTemplate,title:this.options.omniboxSuggestionOptions.headerTitle},row:this.topAnalyticsElementRowTemplate};this.suggestionForOmniBox=new t.SuggestionForOmniBox(l,e.$.proxy(this.options.omniboxSuggestionOptions.onSelect,this)),e.$(this.root).on(e.Events.OmniBoxEvents.populateOmniBox,e.$.proxy(this.handlePopulateOmnibox,this))}return __extends(o,n),o.prototype.handlePopulateOmnibox=function(t,i){var n=this;if(e.Assert.exists(i),!this.disabled){var o=e.$.Deferred(),s=this.usageAnalytics.getTopQueries({pageSize:this.options.omniboxSuggestionOptions.numberOfSuggestions,queryText:i.completeQueryExpression.word});s.done(function(e){var t=_.map(e,function(e){return{value:e}}),s=n.suggestionForOmniBox.buildOmniBoxElement(t,i);o.resolve({element:void 0==s?void 0:s.get(0),zIndex:n.options.omniboxSuggestionOptions.omniBoxZIndex})}),s.fail(function(){n.resolveWithUndefined(o)}),i.rows.push({deferred:o})}},o.prototype.onRowSelection=function(i,n){var o=this;n.clear(),n.closeOmniBox(),this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,i),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return o.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.omniboxAnalytics,{})}})},o.prototype.resolveWithUndefined=function(e){e.resolve({element:void 0})},o.ID="TopAnalyticsSuggestions",o}(e.Ui.Component);t.TopAnalyticsSuggestions=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t,i){e.call(this,t),this.headerTitle=this.loadStringFromAttribute("data-header-title",i.headerTitle),this.omniBoxZIndex=this.loadNumberFromAttribute("data-omnibox-z-index",i.omniBoxZIndex),this.numberOfSuggestions=this.loadNumberFromAttribute("data-number-of-suggestions",i.numberOfSuggestions||5)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultSuggestionForOmniBoxOptions=i;var n=function(){function i(e,t){this.structure=e,this.onSelect=t}return i.prototype.buildOmniBoxElement=function(t,i){var n;if(0!=t.length){n=e.$("<div></div>");var o=this.buildElementHeader();n.append(o);var s=this.buildRowElements(t,i);_.each(s,function(e){n.append(e)})}return n},i.prototype.buildElementHeader=function(){return e.$(this.structure.header.template({headerTitle:this.structure.header.title}))},i.prototype.buildRowElements=function(i,n){var o=this,s=[];return _.each(i,function(i){var r=e.$(o.structure.row({rawValue:i.value,data:t.JQueryUtils.highlightElement(i.value,n.completeQueryExpression.word)}));r.fastClick(function(){o.onSelect.call(o,i.value,n)}),r.on("keyboardSelect",function(){o.onSelect.call(o,i.value,n)}),s.push(r)}),s},i}();t.SuggestionForOmniBox=n}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(i){function n(n){i.call(this,n),this.id=this.loadStringFromAttribute("data-id"),this.caption=this.loadStringFromAttribute("data-caption",t.l.PleaseEnterYourCredentials(e.Rest.SearchEndpoint.endpoints[this.id].getBaseUri())),this.autoTriggerQuery=this.loadBooleanFromAttribute("data-auto-trigger-query",!0)}return __extends(n,i),n}(t.ComponentOptions);t.DefaultLoginOptions=i;var n=function(n){function o(s,r,a){n.call(this,s,o.ID,a),this.element=s,this.options=r,this.settingButtonTemplate=_.template("<div class='coveo-login-tab'>Login</div>"),this.loginInfoTemplate=_.template("<div class='coveo-login-info'></div>"),this.loginFormTemplate=_.template("<form class='coveo-login-form'></form>"),this.userInputTemplate=_.template("<div class='coveo-input-container'>        <span class='coveo-username-icon'></span>        <input class='coveo-username' type='text' placeholder='"+t.l.Username()+"' autocorrect='off' autocapitalize='off' />      </div>"),this.passwordInputTemplate=_.template("<div class='coveo-input-container'>        <span class='coveo-password-icon'></span>        <input class='coveo-password'  type='password' placeholder='"+t.l.Password()+"' autocorrect='off' autocapitalize='off' />      </div>"),this.formSubmitTemplate=_.template("<button class='coveo-submit'type='submit'><div class='coveo-icon coveo-waiting'></div>"+t.l.GetStarted()+"</button>"),this.loginFormContainerTemplate=_.template("<div class='coveo-login-form-container'>        <div class='coveo-login-form-container-logo'></div>      </div>"),this.errorMessageTemplate=_.template("<div class='coveo-login-error-message'></div>"),this.options=new i(s).merge(r),e.Assert.exists(this.options.id),e.Assert.exists(e.Rest.SearchEndpoint.endpoints[this.options.id]),this.isHidden=!0,this.buildLoginButton(),this.bind.onRoot(e.Events.QueryEvents.queryError,this.handleQueryError),this.updateEndpointWithCredentials()}return __extends(o,n),o.prototype.getUser=function(){return window.localStorage.getItem(this.getLocalStorageKeyUser())},o.prototype.setUser=function(e){window.localStorage.setItem(this.getLocalStorageKeyUser(),e)},o.prototype.getPassword=function(){return window.localStorage.getItem(this.getLocalStorageKeyPassword())},o.prototype.setPassword=function(e){window.localStorage.setItem(this.getLocalStorageKeyPassword(),e)},o.prototype.createDom=function(){this.buildLoginForm(),this.setLoginInfoMessage(this.options.caption)},o.prototype.handleQueryError=function(e,t){this.isAccessDeniedError(t.error)&&this.showLoginPanel()},o.prototype.isAccessDeniedError=function(e){return 401===e.status||403===e.status},o.prototype.handleBackButton=function(){this.loginFormContainer.hide(),e.$(document).off("backbutton")},o.prototype.validateCredentials=function(){var i=this;this.loginSubmit.addClass("coveo-waiting"),this.errorMessage.removeClass("coveo-show");var n=e.Rest.SearchEndpoint.endpoints[this.options.id].getBaseUri();e.AjaxUtils.ajaxBasicAuth("GET",n,this.getUser(),this.getPassword(),function(){i.loginSubmit.removeClass("coveo-waiting"),i.updateEndpointWithCredentials(),i.hideLoginPanel()},function(){i.loginSubmit.removeClass("coveo-waiting"),i.errorMessage.html(t.l.BadUserPass()).addClass("coveo-show")})},o.prototype.getBasicAuthBase64=function(){return"Basic "+btoa(this.getUser()+":"+this.getPassword())},o.prototype.buildLoginForm=function(){var t=this;this.errorMessage=e.$(this.errorMessageTemplate()),this.loginForm=e.$(this.loginFormTemplate()),this.loginInfo=e.$(this.loginInfoTemplate()),this.loginUser=e.$(this.userInputTemplate()),this.loginUser.keypress(function(e){return t.handleInputKeypress(e)}),this.loginPassword=e.$(this.passwordInputTemplate()),this.loginPassword.keypress(function(e){return t.handleInputKeypress(e)}),this.loginSubmit=e.$(this.formSubmitTemplate()),this.loginForm.append(this.loginInfo,this.loginUser,this.loginPassword,this.loginSubmit).hide(),this.getOrCreateLoginFormContainer(),this.loginFormContainer.append(this.errorMessage,this.loginForm),this.loadingAnimation=e.$(this.searchInterface.options.firstLoadingAnimation),this.loginForm.submit(function(e){return t.handleLoginFormSubmit(e)}),this.loginSubmit.fastClick(function(e){return t.handleLoginFormSubmit(e)}),this.loginUser.find("input").val(this.getUser()),this.loginPassword.find("input").val(this.getPassword())},o.prototype.handleInputKeypress=function(e){this.isHidden||13!=e.keyCode||this.handleLoginFormSubmit(e)},o.prototype.getOrCreateLoginFormContainer=function(){this.loginFormContainer=e.$(this.root).find(".coveo-login-form-container"),0==this.loginFormContainer.length&&(this.loginFormContainer=e.$(this.loginFormContainerTemplate()),e.$(this.root).append(this.loginFormContainer))},o.prototype.showLoginPanel=function(){this.isHidden=!1,this.ensureDom(),t.JQueryUtils.removeToggleClassOnSearchInterface(),this.loginForm.show(),this.loginFormContainer.show(),t.Device.isPhonegap()&&e.$(document).on("backbutton",e.$.proxy(this.handleBackButton,this))},o.prototype.hideLoginPanel=function(){this.isHidden=!0,this.loginForm.hide(),0==this.loginFormContainer.find(".coveo-login-form:visible").length&&(this.loginFormContainer.hide(),this.queryController.executeQuery())},o.prototype.buildLoginButton=function(){var t=this;0==e.$(this.root).find(".coveo-login-tab").length?(e.$(this.element).append(e.$(this.settingButtonTemplate())),e.$(this.element).fastClick(function(){t.showLoginPanel()})):e.$(this.element).hide()},o.prototype.handleLoginFormSubmit=function(e){e.preventDefault(),t.MobileUtils.hideIOSKeyboard(document.activeElement),this.setUser(this.loginUser.find("input").val()),this.setPassword(this.loginPassword.find("input").val()),this.validateCredentials()},o.prototype.updateEndpointWithCredentials=function(){e.Rest.SearchEndpoint.endpoints[this.options.id].options.password=this.getPassword(),e.Rest.SearchEndpoint.endpoints[this.options.id].options.username=this.getUser()},o.prototype.setLoginInfoMessage=function(e){this.loginInfo.html(e)},o.prototype.getLocalStorageKeyUser=function(){return"coveo-user-"+this.options.id},o.prototype.getLocalStorageKeyPassword=function(){return"coveo-password-"+this.options.id},o.ID="Login",o}(t.Component);t.Login=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(i){function n(n){i.call(this,n),this.resultTemplate=this.loadResultTemplateFromSelectorAttribute("data-result-template-selector"),this.resultTemplate=this.loadResultTemplateFromIdAttribute("data-result-template-id",this.resultTemplate),this.resultTemplate=this.loadChildResultTemplateFromSelector(".result-template",this.resultTemplate),this.resultTemplate=this.resultTemplate||new t.DefaultResultTemplate,e.Assert.exists(this.resultTemplate),this.subResultTemplate=this.loadResultTemplateFromSelectorAttribute("data-sub-result-template-selector"),this.subResultTemplate=this.loadResultTemplateFromIdAttribute("data-sub-result-template-id",this.subResultTemplate),this.subResultTemplate=this.loadChildResultTemplateFromSelector(".sub-result-template",this.subResultTemplate),this.subResultTemplate=this.subResultTemplate||this.resultTemplate,this.maximumAttachmentLevel=this.loadNumberFromAttribute("data-maximum-attachment-level",5)}return __extends(n,i),n}(t.ComponentOptions);t.DefaultResultAttachmentsOptions=i;var n=function(n){function o(t,s,r,a,l){"undefined"==typeof l&&(l=0),n.call(this,t,o.ID,r),this.element=t,this.options=s,this.bindings=r,this.attachmentLevel=l,this.options=new i(t).merge(s),this.attachments=a.attachments,e.Utils.isNonEmptyArray(this.attachments)&&this.renderAttachments()}return __extends(o,n),o.prototype.renderAttachments=function(){var t=this;_.each(this.attachments,function(i){var n=t.attachmentLevel>0?t.options.subResultTemplate.instantiateToElement(i):t.options.resultTemplate.instantiateToElement(i);if(t.autoCreateComponentsInsideResult(n,e.$.extend({},i,{attachments:[]})),e.$(t.element).append(n),t.attachmentHasSubAttachment(i)&&t.attachmentLevel<t.options.maximumAttachmentLevel){var s=e.$("<div></div>");e.$(n).append(s),new o(s.get(0),t.options,t.bindings,i,t.attachmentLevel+1)}})},o.prototype.attachmentHasSubAttachment=function(t){return e.Utils.isNonEmptyArray(t.attachments)?!0:e.Utils.isNonEmptyArray(t.childResults)?(t.attachments=t.childResults,!0):!1},o.prototype.autoCreateComponentsInsideResult=function(i,n){e.Assert.exists(i);var s=this.searchInterface.options,r=e.$.extend({},{options:s},this.getBindings(),{result:n});t.CoveoJQuery.automaticallyCreateComponentsInside(i,r,[o.ID])},o.ID="ResultAttachments",o}(t.Component);t.ResultAttachments=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){function i(e){var t=n(e);return t?t.client:void 0}function n(i){var n=e.$(i).find("."+t.Component.computeCssClassNameForType(t.Analytics.ID));return 0!=n.length?n.coveo():void 0}e.Ui.CoveoJQuery.registerNamedMethod("logCustomEvent",function(e){for(var t=[],n=0;n<arguments.length-1;n++)t[n]=arguments[n+1];var o=i(e);if(o){var s=t[0],r=t[1];o.logCustomEvent(s,r,e)}}),e.Ui.CoveoJQuery.registerNamedMethod("logSearchEvent",function(e){for(var t=[],n=0;n<arguments.length-1;n++)t[n]=arguments[n+1];var o=i(e);if(o){var s=t[0],r=t[1];o.logSearchEvent(s,r)}}),e.Ui.CoveoJQuery.registerNamedMethod("logSearchAsYouTypeEvent",function(e){for(var t=[],n=0;n<arguments.length-1;n++)t[n]=arguments[n+1];var o=i(e);if(o){var s=t[0],r=t[1];o.logSearchAsYouType(s,r)}}),e.Ui.CoveoJQuery.registerNamedMethod("logClickEvent",function(e){for(var t=[],n=0;n<arguments.length-1;n++)t[n]=arguments[n+1];var o=i(e);if(o){var s=t[0],r=t[1],a=t[2];o.logClickEvent(s,r,a,e)}}),e.Ui.CoveoJQuery.registerNamedMethod("logCustomEventVersion",function(t){for(var n=[],o=0;o<arguments.length-1;o++)n[o]=arguments[o+1];var s=i(t);if(s){var r=s;e.Rest.AnalyticsEndpoint.CUSTOM_ANALYTICS_VERSION=n[0],r.endpoint.sendCustomEvent(n[1]),e.Rest.AnalyticsEndpoint.CUSTOM_ANALYTICS_VERSION=void 0}})}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(t,i,n,o){this._root=t,this._endpoint=i,this._templateSearchEvent=n,this._sendToCloud=o,this.searchDeferred=[],this.searchEvents=[],this.results=[],this.armed=!1,this._cancelled=!1,this._finished=!1,e.Assert.exists(t),e.Assert.exists(i),e.Assert.exists(n),this.handler=e.$.proxy(this._handleDuringQuery,this),this.newQueryHandler=e.$.proxy(this._handleNewQuery,this),e.$(t).on(e.Events.QueryEvents.duringQuery+" "+e.Events.QueryEvents.duringFetchMoreQuery,this.handler),e.$(t).on(e.Events.QueryEvents.newQuery,this.newQueryHandler)}return i.prototype.getEventCause=function(){return this._templateSearchEvent.actionCause},i.prototype.getEventMeta=function(){return this._templateSearchEvent.customData},i.prototype.cancel=function(){this._stopRecording(),this._cancelled=!0},i.prototype._handleNewQuery=function(i){var n=t.Component.get(i.target,e.Controllers.QueryController);e.Assert.exists(n),n.newSearchUid()},i.prototype._handleDuringQuery=function(i,n){var o=this;e.Assert.check(!this._finished),e.Assert.check(!this._cancelled),this.searchDeferred.push(n.deferred);var s=t.Component.get(i.target,t.SearchInterface);e.Assert.exists(s);var r=t.Component.get(i.target,e.Controllers.QueryController);e.Assert.exists(r),n.deferred.done(function(t){e.Assert.exists(t),e.Assert.check(!o._finished);var i=_.extend({},o._templateSearchEvent);o.fillSearchEvent(i,s,n.query,t,r.getSearchUid()),o.searchEvents.push(i),o.results.push(t)}).always(function(){var e=_.indexOf(o.searchDeferred,n.deferred);o.searchDeferred.splice(e,1),0==o.searchDeferred.length&&o.flush()})},i.prototype._stopRecording=function(){this.handler&&(e.$(this._root).off(e.Events.QueryEvents.duringQuery+" "+e.Events.QueryEvents.duringFetchMoreQuery,this.handler),this.handler=void 0),this.newQueryHandler&&(e.$(this._root).off(e.Events.QueryEvents.newQuery,this.newQueryHandler),this.newQueryHandler=void 0)},i.prototype.flush=function(){var t=this;this._cancelled||(this._stopRecording(),this._finished=!0,e.Assert.check(this.searchEvents.length==this.results.length),e.Defer.defer(function(){t._sendToCloud&&t._endpoint.sendSearchEvents(t.searchEvents);var i=_.map(t.searchEvents,function(t){return e.Rest.APIAnalyticsBuilder.convertSearchEventToAPI(t)});e.$(t._root).trigger(e.Events.AnalyticsEvents.searchEvent,{searchEvents:i})}))},i.prototype.fillSearchEvent=function(t,i,n,o,s){e.Assert.exists(t),e.Assert.exists(i),e.Assert.exists(n),e.Assert.exists(o);{var r=i.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.q);i.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.hq)}t.queryText=r||n.q||"",t.advancedQuery=n.aq||"",t.didYouMean=n.enableDidYouMean,t.results=this.convertResults(o),t.responseTime=o.duration,t.pageNumber=n.firstResult/n.numberOfResults,t.resultsPerPage=n.numberOfResults,t.facets=this.convertFacets(),t.searchQueryUid=s},i.prototype.convertResults=function(t){e.Assert.exists(t);var i=[];return e.$.each(t.results,function(e,t){i.push({clickUri:t.clickUri,documentUri:t.uri,documentUriHash:t.raw.sysurihash})}),i},i.prototype.convertFacets=function(){var t=this,i=[];return e.$.each(e.$(this.getFacetSelector()),function(n,o){var o=e.$(o).coveo();o.disabled||i.push({fieldName:o.options.field,mode:o.options.useAnd?"and":"or",name:o.options.title,sort:o.options.sortCriteria,selections:t.convertFacetValues(o)})}),i},i.prototype.getFacetSelector=function(){return["."+t.Component.computeCssClassNameForType(t.Facet.ID),"."+t.Component.computeCssClassNameForType(t.FacetRange.ID)].join(", ")},i.prototype.convertFacetValues=function(t){return e.Assert.exists(t),this.convertClassicFacetValues(t)},i.prototype.convertClassicFacetValues=function(t){var i=[];return t.disabled||(e.$.each(t.getSelectedValues(),function(e,t){i.push({entryName:t,status:"INCLUDE"})}),e.$.each(t.getExcludedValues(),function(e,t){i.push({entryName:t,status:"EXCLUDE"})})),i},i}();t.PendingSearchEvent=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(t){function i(i,n,o,s){t.call(this,i,n,o,s),this._root=i,this._endpoint=n,this._templateSearchEvent=o,this._sendToCloud=s,this.delayBeforeSending=5e3,this.armBatchDelay=50,this.beforeUnloadHandler=e.$.proxy(this.onWindowUnload,this),e.$(window).on("beforeunload",this.beforeUnloadHandler)}return __extends(i,t),i.prototype._handleDuringQuery=function(e,i){var n=this;this.toSendRightNow=function(){n.isCancelledOrFinished()||t.prototype._handleDuringQuery.call(n,e,i)},_.delay(function(){n.toSendRightNow()},this.delayBeforeSending)},i.prototype.sendRightNow=function(){this.toSendRightNow&&this.toSendRightNow()},i.prototype._stopRecording=function(){t.prototype._stopRecording.call(this),this.beforeUnloadHandler&&(e.$(window).off("beforeunload",this.beforeUnloadHandler),this.beforeUnloadHandler=void 0)},i.prototype.onWindowUnload=function(){this.isCancelledOrFinished()||(this.armBatchDelay=0,this.sendRightNow())},i.prototype.isCancelledOrFinished=function(){return this._cancelled?!0:this._finished?(this.cancel(),!0):!1},i}(t.PendingSearchEvent);t.PendingSearchAsYouTypeSearchEvent=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function i(i,n,o,s){this.endpoint=i,this.rootElement=n,this.originLevel1=o,this.sendToCloud=s,this.isContextual=!1,this.language=String.locale,this.device=t.Device.getDeviceName(),e.Assert.exists(i),e.Assert.exists(n),e.Assert.isNonEmptyString(this.language),e.Assert.isNonEmptyString(this.device),e.Assert.isNonEmptyString(this.originLevel1)}return i.prototype.isActivated=function(){return!0},i.prototype.getCurrentEventCause=function(){return null!=this.pendingSearchEvent?this.pendingSearchEvent.getEventCause():null!=this.pendingSearchAsYouTypeSearchEvent?this.pendingSearchAsYouTypeSearchEvent.getEventCause():null},i.prototype.getCurrentEventMeta=function(){return null!=this.pendingSearchEvent?this.pendingSearchEvent.getEventMeta():null!=this.pendingSearchAsYouTypeSearchEvent?this.pendingSearchAsYouTypeSearchEvent.getEventMeta():null},i.prototype.logSearchEvent=function(e,t){var i=this.buildMetaObject(e,t);this.pushSearchEvent(e,i)},i.prototype.logSearchAsYouType=function(e,t){var i=this.buildMetaObject(e,t);this.pushSearchAsYouTypeEvent(e,i)},i.prototype.logClickEvent=function(e,t,i,n){var o=this.buildMetaObject(e,t);this.pushClickEvent(e,o,i,n)},i.prototype.logCustomEvent=function(e,t,i){var n=this.buildMetaObject(e,t);this.pushCustomEvent(e,n,i)},i.prototype.getTopQueries=function(e){return this.endpoint.getTopQueries(e)},i.prototype.sendAllPendingEvents=function(){this.pendingSearchAsYouTypeSearchEvent&&this.pendingSearchAsYouTypeSearchEvent.sendRightNow()},i.prototype.pushCustomEvent=function(t,i,n){var o=this,s=this.buildCustomEvent(t,i,n);this.triggerChangeAnalyticsCustomData("CustomEvent",i,s),this.checkToSendAnyPendingSearchAsYouType(t),e.Defer.defer(function(){o.sendToCloud&&o.endpoint.sendCustomEvent(s),e.$(o.rootElement).trigger(e.Events.AnalyticsEvents.customEvent,{customEvent:e.Rest.APIAnalyticsBuilder.convertCustomEventToAPI(s)})})},i.prototype.pushSearchEvent=function(i,n){var o=this;if(e.Assert.exists(i),this.pendingSearchEvent&&this.pendingSearchEvent.getEventCause()!==i.name&&(this.pendingSearchEvent._stopRecording(),this.pendingSearchEvent=null),this.checkToSendAnyPendingSearchAsYouType(i),!this.pendingSearchEvent){var s=this.buildSearchEvent(i,n);this.triggerChangeAnalyticsCustomData("SearchEvent",n,s);var r=this.pendingSearchEvent=new t.PendingSearchEvent(this.rootElement,this.endpoint,s,this.sendToCloud);e.Defer.defer(function(){o.pendingSearchEvent=void 0,r._stopRecording()})}},i.prototype.checkToSendAnyPendingSearchAsYouType=function(e){this.eventIsNotRelatedToSearchBox(e.name)?this.sendAllPendingEvents():this.cancelAnyPendingSearchAsYouTypeEvent()},i.prototype.pushSearchAsYouTypeEvent=function(e,i){this.cancelAnyPendingSearchAsYouTypeEvent();var n=this.buildSearchEvent(e,i);this.triggerChangeAnalyticsCustomData("SearchEvent",i,n),this.pendingSearchAsYouTypeSearchEvent=new t.PendingSearchAsYouTypeSearchEvent(this.rootElement,this.endpoint,n,this.sendToCloud)},i.prototype.pushClickEvent=function(t,i,n,o){var s=this,r=this.buildClickEvent(t,i,n,o);this.triggerChangeAnalyticsCustomData("ClickEvent",i,r),e.Assert.isNonEmptyString(r.searchQueryUid),e.Assert.isNonEmptyString(r.collectionName),e.Assert.isNonEmptyString(r.sourceName),e.Assert.isNumber(r.documentPosition),e.Defer.defer(function(){s.sendToCloud&&s.endpoint.sendDocumentViewEvent(r),e.$(s.rootElement).trigger(e.Events.AnalyticsEvents.documentViewEvent,{documentViewEvent:e.Rest.APIAnalyticsBuilder.convertDocumentViewToAPI(r)})})},i.prototype.buildAnalyticsEvent=function(e,t){return{actionCause:e.name,actionType:e.type,device:this.device,language:this.language,responseTime:void 0,originLevel1:this.originLevel1,originLevel2:this.resolveActiveTabFromElement(this.rootElement),customData:_.keys(t.metaDataAsString).length>0?t.metaDataAsString:void 0,customMetadata1:t.metaDataAsNumber.customMetadata1,customMetadata2:t.metaDataAsNumber.customMetadata2,customMetadata3:t.metaDataAsNumber.customMetadata3,customMetadata4:t.metaDataAsNumber.customMetadata4,customMetadata5:t.metaDataAsNumber.customMetadata5,userAgent:navigator.userAgent}
},i.prototype.buildSearchEvent=function(e,i){return this.merge(this.buildAnalyticsEvent(e,i),{mobile:t.Device.isMobileDevice(),queryText:void 0,advancedQuery:void 0,results:void 0,resultsPerPage:void 0,searchQueryUid:void 0,pageNumber:void 0,didYouMean:void 0,facets:void 0,contextual:this.isContextual})},i.prototype.buildClickEvent=function(e,t,i){return this.merge(this.buildAnalyticsEvent(e,t),{searchQueryUid:i.queryUid,documentUri:i.uri,documentUriHash:i.raw.sysurihash,collectionName:i.raw.syscollection,sourceName:i.raw.syssource,documentPosition:i.index,responseTime:0,viewMethod:e.name})},i.prototype.buildCustomEvent=function(e,t){return this.merge(this.buildAnalyticsEvent(e,t),{eventType:e.type,eventValue:e.name,responseTime:0})},i.prototype.buildMetaObject=function(t,i){var n={metaDataAsNumber:{},metaDataAsString:{}};return _.each(i,function(e,i){if(void 0!=t.metaMap&&void 0!=t.metaMap[i]){var o=t.metaMap[i];n.metaDataAsNumber["customMetadata"+o.toString()]=e}n.metaDataAsString[i]=e}),n.metaDataAsString.JSUIVersion=e.version.lib+";"+e.version.product,n},i.prototype.cancelAnyPendingSearchEvent=function(){this.pendingSearchEvent&&(this.pendingSearchEvent.cancel(),this.pendingSearchEvent=void 0)},i.prototype.cancelAnyPendingSearchAsYouTypeEvent=function(){this.pendingSearchAsYouTypeSearchEvent&&(this.pendingSearchAsYouTypeSearchEvent.cancel(),this.pendingSearchAsYouTypeSearchEvent=void 0)},i.prototype.resolveActiveTabFromElement=function(t){e.Assert.exists(t);var i=this.resolveQueryStateModel(t);return i&&i.get(e.Models.QueryStateModel.attributesEnum.t)||"default"},i.prototype.resolveQueryStateModel=function(i){return t.Component.resolveBinding(i,e.Models.QueryStateModel)},i.prototype.eventIsNotRelatedToSearchBox=function(e){return e!==t.AnalyticsActionCauseList.searchboxSubmit.name&&e!==t.AnalyticsActionCauseList.searchboxClear.name},i.prototype.triggerChangeAnalyticsCustomData=function(t,i,n){var o={language:n.language,originLevel1:n.originLevel1,originLevel2:n.originLevel2,originLevel3:n.originLevel3},s=e.$.extend({},{type:t,metaObject:i},o);e.$(this.rootElement).trigger(e.Events.AnalyticsEvents.changeAnalyticsCustomData,s),n.language=s.language,n.originLevel1=s.originLevel1,n.originLevel2=s.originLevel2,n.originLevel3=s.originLevel3,n.customData=i.metaDataAsString,_.each(_.keys(i.metaDataAsNumber),function(e){n[e]=i.metaDataAsNumber[e]})},i.prototype.getChangeableAnalyticsDataObject=function(e){return{language:e.language||void 0,originLevel1:e.originLevel1||void 0,originLevel2:e.originLevel2||void 0,originLevel3:e.originLevel3||void 0}},i.prototype.merge=function(t,i){return e.$.extend({},t,i)},i}();t.LiveAnalyticsClient=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(e){"undefined"==typeof e&&(e=[]),this.analyticsClients=e,this.isContextual=!1}return t.prototype.isActivated=function(){return _.some(this.analyticsClients,function(e){return e.isActivated()})},t.prototype.getCurrentEventCause=function(){return _.find(_.map(this.analyticsClients,function(e){return e.getCurrentEventCause()}),function(e){return null!=e})},t.prototype.getCurrentEventMeta=function(){return _.find(_.map(this.analyticsClients,function(e){return e.getCurrentEventMeta()}),function(e){return null!=e})},t.prototype.logSearchEvent=function(e,t){_.each(this.analyticsClients,function(i){return i.logSearchEvent(e,t)})},t.prototype.logSearchAsYouType=function(e,t){_.each(this.analyticsClients,function(i){return i.logSearchEvent(e,t)})},t.prototype.logClickEvent=function(e,t,i,n){_.each(this.analyticsClients,function(o){return o.logClickEvent(e,t,i,n)})},t.prototype.logCustomEvent=function(e,t,i){_.each(this.analyticsClients,function(n){return n.logCustomEvent(e,t,i)})},t.prototype.getTopQueries=function(t){var i=this,n=e.$.Deferred(),o=[];return _.forEach(this.analyticsClients,function(e){e.getTopQueries(t).done(function(e){o[r]=e;for(var s=!0,r=0;r<i.analyticsClients.length&&s;r++)s=s&&void 0!=o[r];s&&n.resolve(i.mergeTopQueries(o,t.pageSize))})}),n},t.prototype.sendAllPendingEvents=function(){_.each(this.analyticsClients,function(e){return e.sendAllPendingEvents()})},t.prototype.mergeTopQueries=function(e,t){var i=[];return _.each(e,function(e){return _.each(e,function(e){return i.push(e)})}),i.length=Math.min(i.length,t),i},t}();t.MultiAnalyticsClient=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(){this.isContextual=!1}return t.prototype.isActivated=function(){return!1},t.prototype.getCurrentEventCause=function(){return null},t.prototype.getCurrentEventMeta=function(){return{}},t.prototype.logSearchEvent=function(){},t.prototype.logSearchAsYouType=function(){},t.prototype.logClickEvent=function(){},t.prototype.logCustomEvent=function(){},t.prototype.getTopQueries=function(){var t=e.$.Deferred();return t.resolve([]),t},t.prototype.sendAllPendingEvents=function(){},t}();t.NoopAnalyticsClient=i}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function e(e,t){this.element=e,this.options=t,this.steps=[],this.options.dateField&&(this.options.start=new Date(this.options.start).getTime(),this.options.end=new Date(this.options.end).getTime()),void 0==this.options.rounded&&(this.options.rounded=0),(this.options.steps||this.options.getSteps)&&this.buildSteps(),this.options.graph&&(this.sliderGraph=new a(this)),this.sliderLine=new n(this),this.sliderLine.build().appendTo(this.element),this.options.rangeSlider?(this.sliderRange=new s(this),this.sliderRange.build().appendTo(this.element)):(this.sliderButton=new o(this,1),this.sliderButton.build().addClass("coveo-no-range-button").appendTo(this.element),this.sliderLine.setActiveWidth(this.sliderButton)),this.sliderCaption=new r(this),this.sliderCaption.build().appendTo(this.element)}return e.prototype.onMoving=function(){this.options.rangeSlider?(this.sliderRange.setBoundary(),this.sliderLine.setActiveWidth(this.sliderRange.firstButton,this.sliderRange.secondButton)):this.sliderLine.setActiveWidth(this.sliderButton),this.options.graph&&this.sliderGraph.draw(),this.displayCaption()},e.prototype.initializeState=function(e){"undefined"==typeof e&&(e=[this.options.start,this.options.end]),this.currentValues=e,this.options.rangeSlider?(this.sliderRange.initializeSliderRangeState(e),this.sliderLine.setActiveWidth(this.sliderRange.firstButton,this.sliderRange.secondButton)):(void 0==e?this.sliderButton.toEnd():this.sliderButton.setValue(e[1]),this.sliderButton.leftBoundary=0,this.sliderButton.rightBoundary=this.element.width(),this.sliderLine.setActiveWidth(this.sliderButton)),this.displayCaption()},e.prototype.getPosition=function(){return this.options.rangeSlider?this.sliderRange.getPosition():[0,this.sliderButton.getPosition()]},e.prototype.getPercentPosition=function(){return this.options.rangeSlider?this.sliderRange.getPercentPosition():[0,this.sliderButton.getPercent()]},e.prototype.getValues=function(){return void 0!=this.currentValues?this.currentValues:this.options.rangeSlider?this.sliderRange.getValue():[this.options.start,this.sliderButton.getValue()]},e.prototype.getCaptionFromValue=function(e){return this.sliderCaption.getCaptionFromValues(e)},e.prototype.getCaption=function(){return this.sliderCaption.getCaption()},e.prototype.setValues=function(e){void 0!=e&&(e[0]=Math.max(e[0],this.options.start),e[1]=Math.min(e[1],this.options.end)),this.currentValues=e,this.options.rangeSlider?(this.sliderRange.setValue(e),this.sliderLine.setActiveWidth(this.sliderRange.firstButton,this.sliderRange.secondButton)):(this.sliderButton.setValue(e[1]),this.sliderLine.setActiveWidth(this.sliderButton)),this.displayCaption()},e.prototype.drawGraph=function(e){this.sliderGraph.draw(e)},e.prototype.displayCaption=function(){void 0!=this.options.valueCaption?this.sliderCaption.setFromString(this.options.valueCaption(this.getValues())):void 0!=this.options.percentCaption?this.sliderCaption.setFromString(this.options.percentCaption(this.getPercentPosition())):void 0!=this.options.displayAsPercent&&void 0!=this.options.displayAsPercent.separator?this.sliderCaption.setAsPercent():this.sliderCaption.setAsValue()},e.prototype.buildSteps=function(){if(this.options.getSteps)this.steps=this.options.getSteps(this.options.start,this.options.end);else for(var e=(this.options.end-this.options.start)/this.options.steps,t=this.options.start;t<=this.options.end;)this.steps.push(t),t+=e},e}();t.Slider=i;var n=function(){function t(e){this.slider=e}return t.prototype.build=function(){return this.backGround=e.$("<div class='coveo-slider-line coveo-background'></div>"),this.activePart=e.$("<div class='coveo-slider-line coveo-active'></div>"),this.backGround.add(this.activePart)},t.prototype.setActiveWidth=function(e,t){if(this.slider.options.rangeSlider){var i=100*(t.getPercent()-e.getPercent());this.activePart.css({width:i+"%",left:100*e.getPercent()+"%",right:100*t.getPercent()+"%"})}else{var i=100*e.getPercent();this.activePart.css({width:i+"%"})}},t}(),o=function(){function i(e,i){this.slider=e,this.which=i,this.eventMouseDown=t.Device.isMobileDevice()?"touchstart":"mousedown",this.eventMouseMove=t.Device.isMobileDevice()?"touchmove":"mousemove",this.eventMouseUp=t.Device.isMobileDevice()?"touchend":"mouseup"}return i.prototype.build=function(){return this.element=e.$("<div class='coveo-slider-button'></div>"),this.bindEvents(),this.element.get(0).CoveoSliderButton=this,this.element},i.prototype.toBeginning=function(){this.element.css({left:"0%"})},i.prototype.toEnd=function(){this.slider.element.width();this.element.css({left:"100%"})},i.prototype.setValue=function(e){var t=this.fromValueToPercent(e);this.element.css("left",Math.round(100*t)+"%")},i.prototype.getPosition=function(){var e=this.element.css("left");return-1!=e.indexOf("%")?parseFloat(e)/100*this.slider.element.width():parseFloat(e)},i.prototype.getPercent=function(e){return"undefined"==typeof e&&(e=this.getPosition()),+(e/this.slider.element.width()).toFixed(2)},i.prototype.getValue=function(){var e=this.getPercent()*(this.slider.options.end-this.slider.options.start)+this.slider.options.start;return e},i.prototype.fromValueToPercent=function(e){return 1-(this.slider.options.end-e)/(this.slider.options.end-this.slider.options.start)},i.prototype.fromPositionToValue=function(e){var t=this.getPercent(e);return this.slider.options.start+t*(this.slider.options.end-this.slider.options.start)},i.prototype.fromValueToPosition=function(e){var t=this.fromValueToPercent(e);return this.slider.element.width()*t},i.prototype.bindEvents=function(){var t=this;e.$(this.element).on(this.eventMouseDown,function(e){t.handleStartSlide(e)});var i=this.slider.options.document||document;e.$(i).on(this.eventMouseMove,function(e){"touchmove"==t.eventMouseMove&&t.isMouseDown&&e.preventDefault(),t.handleMoving(e)}),e.$(i).on(this.eventMouseUp,function(e){t.handleEndSlide(e)})},i.prototype.handleStartSlide=function(t){var i=this.getMousePosition(t);this.isMouseDown=!0,this.startPositionX=i.x,this.lastElementLeft=this.element.css("left"),this.origUserSelect=e.$("body").css("user-select"),this.origCursor=e.$("body").css("cursor"),e.$("body").css("user-select","none"),e.$("body").css("cursor","pointer"),e.$(this.element).addClass("coveo-active"),e.$(this.element).trigger(e.Events.SliderEvents.startSlide,{button:this,slider:this.slider})},i.prototype.handleMoving=function(t){this.isMouseDown&&(this.updatePosition(t),this.slider.onMoving(),this.handleButtonNearEnd(),this.element.trigger(e.Events.SliderEvents.duringSlide,{button:this,slider:this.slider}))},i.prototype.handleEndSlide=function(){this.isMouseDown&&(e.$("body").css("user-select",this.origUserSelect),e.$("body").css("cursor",this.origCursor),e.$(this.element).removeClass("coveo-active"),this.element.trigger(e.Events.SliderEvents.endSlide,{button:this,slider:this.slider})),this.isMouseDown=!1},i.prototype.handleButtonNearEnd=function(){0==this.which&&(void 0==this.origZIndex&&(this.origZIndex=this.element.css("z-index")),this.currentPos>90?this.element.css("z-index",this.origZIndex+1):this.element.css("z-index",this.origZIndex))},i.prototype.getMousePosition=function(e){var t=0,i=0;return"touchmove"==this.eventMouseMove?(t=e.originalEvent.touches[0].pageX,i=e.originalEvent.touches[0].pageY):e.pageX||e.pageY?(t=e.pageX,i=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:t,y:i}},i.prototype.updatePosition=function(e){var t=this.getMousePosition(e),i=t.x-this.startPositionX;if(this.currentPos=parseInt(this.lastElementLeft,10)+i,this.slider.options.steps||this.slider.options.getSteps){var n=this.snapToStep(i);this.currentPos=n.position;var o=n.value}this.currentPos=Math.max(this.leftBoundary,this.currentPos),this.currentPos=Math.min(this.rightBoundary,this.currentPos),this.currentPos=100*this.getPercent(this.currentPos),this.currentPos=Math.min(this.currentPos,100),this.currentPos=Math.max(this.currentPos,0),this.element.css("left",Math.round(this.currentPos)+"%"),this.slider.currentValues[this.which]=this.slider.options.steps||this.slider.options.getSteps?o:this.getValue()},i.prototype.snapToStep=function(){var e=this,t=_.map(this.slider.steps,function(t,i){return Math.abs(e.currentPos-e.fromValueToPosition(e.slider.steps[i]))}),i=_.map(this.slider.steps,function(t,i){return Math.abs(e.rightBoundary-e.fromValueToPosition(e.slider.steps[i]))}),n=_.map(this.slider.steps,function(t,i){return Math.abs(e.leftBoundary-e.fromValueToPosition(e.slider.steps[i]))}),o=_.min(t),s=_.min(i),r=_.min(n),a=this.slider.steps[_.indexOf(t,o)],l=this.slider.steps[_.indexOf(i,s)],u=this.slider.steps[_.indexOf(n,r)];return a=Math.min(a,l),a=Math.max(a,u),{position:this.fromValueToPosition(a),value:a}},i}();t.SliderButton=o;var s=function(){function e(e){this.slider=e,this.firstButton=new o(e,0),this.secondButton=new o(e,1)}return e.prototype.build=function(){var e=this.firstButton.build(),t=this.secondButton.build().addClass("coveo-range-button");return e.add(t)},e.prototype.initializeSliderRangeState=function(e){void 0==e?(this.firstButton.toBeginning(),this.secondButton.toEnd()):(this.firstButton.setValue(e[0]),this.secondButton.setValue(e[1])),this.setBoundary()},e.prototype.setValue=function(e){this.firstButton.setValue(e[0]),this.secondButton.setValue(e[1])},e.prototype.setBoundary=function(){this.firstButton.leftBoundary=0,this.firstButton.rightBoundary=this.secondButton.getPosition(),this.secondButton.leftBoundary=this.firstButton.getPosition(),this.secondButton.rightBoundary=this.slider.element.width()},e.prototype.getPosition=function(){return[this.firstButton.getPosition(),this.secondButton.getPosition()]},e.prototype.getPercentPosition=function(){return[this.firstButton.getPercent(),this.secondButton.getPercent()]},e.prototype.getValue=function(){return[this.firstButton.getValue(),this.secondButton.getValue()]},e}(),r=function(){function t(e){this.slider=e,this.separator="-",this.unitSign="",this.slider.options.displayAsPercent?this.separator=void 0!=this.slider.options.displayAsPercent.separator?this.slider.options.displayAsPercent.separator:this.separator:this.slider.options.displayAsValue&&(this.separator=void 0!=this.slider.options.displayAsValue.separator?this.slider.options.displayAsValue.separator:this.separator,this.unitSign=void 0!=this.slider.options.displayAsValue.unitSign?this.slider.options.displayAsValue.unitSign:this.unitSign)}return t.prototype.build=function(){return this.caption=e.$("<div class='coveo-slider-caption'></div>"),this.caption},t.prototype.getCaption=function(){return this.caption.text()},t.prototype.getCaptionFromValues=function(e){return this.getValueCaption(e)},t.prototype.getCaptionFromValuesAsPercent=function(e){return this.getValueCaption(e)},t.prototype.setAsValue=function(){this.caption.text(this.getValueCaption())},t.prototype.setAsPercent=function(){var e=this.slider.getPercentPosition();this.caption.text([(100*e[0]).toFixed(this.slider.options.rounded),"%",this.separator,(100*e[1]).toFixed(this.slider.options.rounded),"%"].join(" "))},t.prototype.setFromString=function(e){this.caption.text(e)},t.prototype.getValueCaption=function(e){"undefined"==typeof e&&(e=this.slider.getValues());var t=e[0],i=e[1];if(this.slider.options.dateField){var n=new Date(t),o=new Date(i);n.setHours(0,0,0,0),o.setHours(0,0,0,0),t=Globalize.format(n,this.slider.options.dateFormat||"MMM dd, yyyy"),i=Globalize.format(o,this.slider.options.dateFormat||"MMM dd, yyyy"),this.unitSign=""}else t=t.toFixed(this.slider.options.rounded),i=i.toFixed(this.slider.options.rounded);return[t,this.unitSign,this.separator,i,this.unitSign].join(" ")},t}(),a=function(){function t(t){var i=this;this.slider=t,this.svg=d3.select(t.element.get(0)).append("svg").append("g"),this.x=d3.scale.ordinal(),this.y=d3.scale.linear(),this.slider.options.graph.margin=e.Utils.mergeDeep({top:20,right:0,left:0,bottom:20},this.slider.options.graph.margin||{}),this.slider.options.graph.animationDuration=this.slider.options.graph.animationDuration||500,e.$(window).resize(function(){i.draw()}),this.tooltip=e.$("<div></div>").css({display:"none"}).addClass("coveo-slider-tooltip"),this.slider.element.append(this.tooltip),this.slider.options.graph.steps=this.slider.options.graph.steps||10}return t.prototype.draw=function(e){"undefined"==typeof e&&(e=this.oldData);var t=this.slider.element.outerWidth(),i=this.slider.element.outerHeight(),n=t-this.slider.options.graph.margin.left-this.slider.options.graph.margin.right,o=i-this.slider.options.graph.margin.top-this.slider.options.graph.margin.bottom;this.applyTransformOnSvg(n,o),this.setXAndYRange(n,o),this.setXAndYDomain(e);var s=this.svg.selectAll(".coveo-bar").data(e),r=this.slider.getValues();this.renderGraphBars(s,n,o,r),this.setGraphBarsTransition(s,o,r),this.oldData=e},t.prototype.setXAndYRange=function(e,t){this.x.rangeBands([0,e],.2,0),this.y.range([t-this.slider.options.graph.margin.top,0])},t.prototype.setXAndYDomain=function(e){this.padGraphWithEmptyData(e),this.x.domain(_.map(e,function(e){return e.start})),this.y.domain([0,d3.max(e,function(e){return e.y})])},t.prototype.padGraphWithEmptyData=function(e){var t=e[0].end-e[0].start;this.padBeginningOfGraphWithEmptyData(e,t),this.padEndOfGraphWithEmptyData(e,t)},t.prototype.padBeginningOfGraphWithEmptyData=function(e,t){if(e[0].start>this.slider.options.start)for(var i=e[0].start-this.slider.options.start,n=Math.round(i/t),o=e[0].start,s=n;s>0;s--)e.unshift({start:o-t,end:o,y:0}),o-=t},t.prototype.padEndOfGraphWithEmptyData=function(e,t){var i=e.length-1;if(e[i].end<this.slider.options.end)for(var n=this.slider.options.end-e[i].end,o=Math.round(n/t),s=e[i].end,r=0;o>r;r++)e.push({start:s,end:s+t,y:0}),s+=t},t.prototype.applyTransformOnSvg=function(t,i){e.$(this.slider.element).find("svg").attr("width",t).attr("height",i),this.svg.attr("transform","translate("+this.slider.options.graph.margin.left+","+this.slider.options.graph.margin.top+")")},t.prototype.renderGraphBars=function(e,t,i,n){e.enter().append("rect").attr("class",this.getFunctionForClass(n)).attr("width",this.x.rangeBand()).attr("height",this.getFunctionForHeight(i)).attr("x",this.getFunctionForX()).attr("y",this.getFunctionForY()).on("click",this.getFunctionForClick()).on("mouseover",this.getFunctionForMouseOver(i)).on("mouseout",this.getFunctionForMouseOut())},t.prototype.setGraphBarsTransition=function(e,t,i){e.transition().attr("x",this.getFunctionForX()).attr("width",this.x.rangeBand()).attr("class",this.getFunctionForClass(i)).transition().duration(this.slider.options.graph.animationDuration).attr("y",this.getFunctionForY()).attr("height",this.getFunctionForHeight(t))},t.prototype.getBarClass=function(e,t,i){return t.start>=e[0]&&t.end<=e[1]?"coveo-active":e[0]==this.slider.options.start&&0==i?"coveo-active":e[1]==this.slider.options.end&&i==this.slider.options.graph.steps-1?"coveo-active":""},t.prototype.setTooltip=function(e,t){this.tooltip.html("<span class='coveo-caption'>"+this.slider.getCaptionFromValue([e.start,e.end])+"</span><span class='coveo-count'>"+e.y+"</span>"),this.tooltip.css({display:"block",left:this.x(e.start)-.2*this.slider.options.graph.steps,top:this.y(e.y)-t})},t.prototype.getFunctionForX=function(){var e=this;return function(t){return e.x(t.start)}},t.prototype.getFunctionForY=function(){var e=this;return function(t){return e.y(t.y)}},t.prototype.getFunctionForHeight=function(e){var t=this;return function(i){return e-t.y(i.y)}},t.prototype.getFunctionForClass=function(e){var t=this;return function(i,n){return"coveo-bar "+t.getBarClass(e,i,n)}},t.prototype.getFunctionForClick=function(){var t=this;return function(i){t.slider.element.trigger(e.Events.SliderEvents.graphValueSelected,{start:i.start,end:i.end,value:i.y})}},t.prototype.getFunctionForMouseOver=function(e){var t=this;return function(i){d3.event.clientX,d3.event.clientY;t.setTooltip(i,e)}},t.prototype.getFunctionForMouseOut=function(){var e=this;return function(){e.tooltip.css("display","none")}},t}()}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.type=this.loadStringFromAttribute("data-type","forward"),this.currentUserEmail=this.loadStringFromAttribute("current-user-email","")}return __extends(t,e),t}(t.ComponentOptions);t.DefaultEmailActionOptions=i;var n=function(i){function n(o,s,r,a){var l=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.result=a,this.options=new t.DefaultEmailActionsOptions(this.element).merge(s),this.result=a||this.resolveResult(),this.setMailToFromResult(),e.$(this.element).fastClick(function(){l.showWaitingAnimation(),l.mailTo.bodyIsSet()?l.openMailTo():l.appendBodyToMailTo(function(){return l.openMailTo()})})}return __extends(n,i),n.prototype.showWaitingAnimation=function(){e.$(this.element).parent().find(".coveo-wait-animation").show()},n.prototype.hideWaitingAnimation=function(){e.$(this.element).parent().find(".coveo-wait-animation").hide()},n.prototype.setMailToFromResult=function(){switch(this.options.type){case n.reply:this.mailTo=t.EmailActionsUtils.buildReplyMailToFromResult(this.result,this.options.currentUserEmail),e.$(this.element).append(t.l.Reply);break;case n.replyAll:this.mailTo=t.EmailActionsUtils.buildReplyAllMailToFromResult(this.result,this.options.currentUserEmail),e.$(this.element).append(t.l.ReplyAll);break;case n.forward:e.$(this.element).append(t.l.Forward),this.mailTo=t.EmailActionsUtils.buildForwardMailToFromResult(this.result,this.options.currentUserEmail);break;default:this.mailTo=new t.MailTo({})}},n.prototype.appendBodyToMailTo=function(e){var i=this;if(t.Device.isPhonegap()){var n=this.queryController.getEndpoint(),o=t.Device.isAndroid()?n.getDocumentText(this.result.uniqueId):n.getDocumentHtml(this.result.uniqueId,"");o.done(function(t){return i.doneRetrieveBody(t,e)}).fail(function(){return i.doneRetrieveBody("",e)})}else this.queryController.getEndpoint().getDocumentText(this.result.uniqueId).done(function(t){return i.doneRetrieveBody(t,e)}).fail(function(){return i.doneRetrieveBody("",e)})},n.prototype.doneRetrieveBody=function(e,t){var i=e.content?e.content:e;this.mailTo.setMailToBodyFromText(i),t(e)},n.prototype.openMailTo=function(){this.mailTo.open(),this.hideWaitingAnimation()},n.ID="EmailAction",n.forward="forward",n.reply="reply",n.replyAll="replyAll",n}(e.Ui.Component);t.EmailAction=n}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.currentUserEmail="",this.reply=!0,this.replyAll=!0,this.forward=!0,this.currentUserEmail=this.loadStringFromAttribute("data-current-user-email",""),this.reply=this.loadBooleanFromAttribute("data-reply",!0),this.replyAll=this.loadBooleanFromAttribute("data-reply-all",!0),this.forward=this.loadBooleanFromAttribute("data-forward",!0)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultEmailActionsOptions=i;var n=function(n){function o(e,t,s,r){n.call(this,e,o.ID,s),this.element=e,this.options=t,this.result=r,this.options=new i(e).merge(t),this.result=r||this.resolveResult(),this.createAndAppendEmailActions(),this.appendWaitingAnimation()}return __extends(o,n),o.prototype.createAndAppendEmailActions=function(){this.options.reply&&(this.reply=new t.EmailAction(e.$(document.createElement("div"))[0],{type:t.EmailAction.reply,currentUserEmail:this.options.currentUserEmail},this.getBindings(),this.result),e.$(this.element).append(this.reply.element)),this.options.replyAll&&(this.replyAll=new t.EmailAction(e.$(document.createElement("div"))[0],{type:t.EmailAction.replyAll,currentUserEmail:this.options.currentUserEmail},this.getBindings(),this.result),e.$(this.element).append(this.replyAll.element)),this.options.forward&&(this.forward=new t.EmailAction(e.$(document.createElement("div"))[0],{type:t.EmailAction.forward,currentUserEmail:this.options.currentUserEmail},this.getBindings(),this.result),e.$(this.element).append(this.forward.element))},o.prototype.appendWaitingAnimation=function(){e.$(this.element).append(e.$(document.createElement("div")).addClass("coveo-wait-animation").hide())},o.ID="EmailActions",o}(e.Ui.Component);t.EmailActions=n,e.Ui.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultPreferencesPanelOptions=i;var n=function(i){function n(e,t,o){i.call(this,e,n.ID,o),this.element=e,this.options=t,this.buildCloseButton(),this.buildTitle()}return __extends(n,i),n.prototype.getCssClass=function(){return"coveo-preference-panel"},n.prototype.getMenuItems=function(){var e=this;return[{text:t.l.Preferences(),onOpen:function(){return e.open()},onClose:function(){return e.close()}}]},n.prototype.open=function(){e.$(this.element).addClass("coveo-active")},n.prototype.close=function(){e.$(this.element).removeClass("coveo-active")},n.prototype.save=function(){e.$(this.element).trigger(e.Events.PreferencesPanelEvents.savePreferences),this.queryController.executeQuery()},n.prototype.closeWithoutSave=function(){e.$(this.element).trigger(e.Events.PreferencesPanelEvents.exitPreferencesWithoutSave)},n.prototype.buildCloseButton=function(){var t=this,i=e.$("<div class='coveo-close'><span class='coveo-icon'></span></div>");i.fastClick(function(){t.closeWithoutSave(),t.close()}),e.$(this.element).prepend(i)},n.prototype.buildTitle=function(){var i=e.$("<div class='coveo-title'>"+t.l.Preferences()+"</div>");e.$(this.element).prepend(i)},n.ID="PreferencesPanel",n}(t.Component);t.PreferencesPanel=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(){function t(e,t,i){this.boxInputToBuild=e,this.nameOfInput=t,this.type=i,this.inputs={},this.inputTemplate=_.template("<div class='coveo-choice-container'>        <div class='coveo-section coveo-section-input'>          <input <%= otherAttribute %> class='coveo-<%= label %>' id='coveo-<%= label %>' type='<%= type %>' name='<%= name%>' value='<%= label %>' ></input><span class='coveo-input-icon'></span><label for='coveo-<%= label %>'><%= label %></label>        </div>        <div class='coveo-section coveo-section-tab'><%- tab %></div>      <div class='coveo-section coveo-section-expression'><%- expression %></div>      </div>")}return t.prototype.build=function(){var t=this;return _.reduce(_.map(this.boxInputToBuild,function(i){return t.inputs[i.label]=e.$(t.inputTemplate({label:i.label,name:t.nameOfInput,type:t.type,otherAttribute:i.otherAttribute,tab:i.tab,expression:i.expression})),t.inputs[i.label]}),function(e,t){return e.add(t)})},t.prototype.select=function(t){e.Assert.exists(this.inputs[t]),this.inputs[t].find("input").prop("checked",!0),this.inputs[t].find(".coveo-input-icon").addClass("coveo-selected")},t.prototype.unselect=function(t){e.Assert.exists(this.inputs[t]),this.inputs[t].find("input").prop("checked",!1),this.inputs[t].find(".coveo-input-icon").removeClass("coveo-selected")},t.prototype.getSelected=function(){var e=_.find(this.inputs,function(e){return e.find("input").prop("checked")});return e.find("input").val()},t.prototype.getSelecteds=function(){var e=_.filter(this.inputs,function(e){return e.find("input").prop("checked")});return _.map(e,function(e){return e.find("input").val()})},t}();t.PreferencesPanelBoxInput=i;var n=function(e){function t(t,i){e.call(this,t,i,"radio"),this.radioElementToBuild=t,this.name=i}return __extends(t,e),t}(i);t.PreferencesPanelRadioInput=n;var o=function(t){function i(e,i){t.call(this,e,i,"checkbox"),this.checkboxElementToBuild=e,this.name=i}return __extends(i,t),i.prototype.build=function(){var i=t.prototype.build.call(this),n=(i.find("input"),i.find(".coveo-input-icon"));return _.each(n,function(t){var i=e.$(t).siblings("input"),n=e.$(t);i.change(function(){n.toggleClass("coveo-selected",i.is(":checked"))}),n.fastClick(function(){i.prop("checked",!i.is(":checked")),i.change()})}),i},i}(i);t.PreferencesPanelCheckboxInput=o;var s=function(){function t(e,t){this.textElementToBuild=e,this.name=t,this.inputs={},this.inputTemplate=_.template("<div class='coveo-choice-container'><input <%= otherAttribute %> class='coveo-<%= label %>' id='coveo-<%= label %>' type='<%= type %>' name='<%= name%>' placeholder='<%= placeholder %>' ></input></div>")}return t.prototype.build=function(){var t=this;return _.reduce(_.map(this.textElementToBuild,function(i){return t.inputs[i.label]=e.$(t.inputTemplate({label:i.label,name:t.name,type:"text",otherAttribute:i.otherAttribute,placeholder:i.placeholder||i.label})),t.inputs[i.label]}),function(e,t){return e.add(t)})},t.prototype.getValues=function(){var e=this;return _.map(this.inputs,function(t,i){return e.getInput(i).val()})},t.prototype.setValue=function(t,i){e.Assert.exists(this.inputs[t]),this.getInput(t).val(i)},t.prototype.reset=function(){_.each(this.inputs,function(e){e.find("input").val("")})},t.prototype.getInput=function(t){e.Assert.exists(this.inputs[t]);var i=this.inputs[t].find("input");return 0==i.length&&(i=this.inputs[t].find("textarea")),i},t}();t.PreferencesPanelTextInput=s;var r=function(t){function i(){t.apply(this,arguments),this.inputTemplate=_.template("<div class='coveo-choice-container'><textarea <%= otherAttribute %> class='coveo-<%= label %>' id='coveo-<%= label %>' name='<%= name%>' placeholder='<%= placeholder %>' ></textarea></div>")}return __extends(i,t),i.prototype.build=function(){var t=this;return _.reduce(_.map(this.textElementToBuild,function(i){return t.inputs[i.label]=e.$(t.inputTemplate({label:i.label,name:t.name,otherAttribute:i.otherAttribute,placeholder:i.placeholder||i.label})),t.inputs[i.label]}),function(e,t){return e.add(t)})},i}(s);t.PreferencesPanelTextAreaInput=r;var a=function(){function t(e,t,i){this.toBuild=e,this.options=t,this.name=i,this.textInput=new r([{label:e.label,otherAttribute:"readonly"}],i)}return t.prototype.build=function(){var t=this;return this.select=e.$("<select multiple></select>"),_.each(this.options,function(i){t.select.append(e.$("<option>"+i+"</option>"))}),this.select.change(function(){var i=t.select.val();e.Utils.isNullOrUndefined(i)?t.reset():t.textInput.setValue(t.toBuild.label,i.join(","))}),this.textInput.build().append(this.select)},t.prototype.getValues=function(){return this.textInput.getValues()[0].split(",")},t.prototype.setValues=function(e){this.textInput.setValue(this.toBuild.label,e.join(","))},t.prototype.reset=function(){this.textInput.setValue(this.toBuild.label,"")},t}();t.PreferencePanelMultiSelectInput=a}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.loadBooleanFromAttribute("data-show-open-in-outlook",!0),this.loadBooleanFromAttribute("data-show-open-in-new-window",!0)
}return __extends(t,e),t}(t.ComponentOptions);t.DefaultResultsPreferencesOptions=i;var n=function(n){function o(s,r,a){var l=this;n.call(this,s,o.ID,a),this.element=s,this.options=r,this.bindings=a,this.options=new i(s).merge(r),this.preferencePanel=e.$(this.element).parents("."+t.Component.computeCssClassNameForType(t.PreferencesPanel.ID)),this.preferencePanelLocalStorage=new e.LocalStorageUtils(o.ID),e.Assert.exists(this.componentOptionsModel),e.Assert.exists(window.localStorage),e.Assert.isLargerOrEqualsThan(1,this.preferencePanel.length),this.preferences=new t.DefaultResultLinkOptions(this.element).merge(this.preferencePanelLocalStorage.load()),this.updateComponentOptionsModel(),this.bind.on(this.preferencePanel,e.Events.PreferencesPanelEvents.savePreferences,function(){return l.save()}),this.bind.on(this.preferencePanel,e.Events.PreferencesPanelEvents.exitPreferencesWithoutSave,function(){return l.exitWithoutSave()}),this.buildTitle(),this.buildCheckboxesInput()}return __extends(o,n),o.prototype.save=function(){this.fromCheckboxInputToPreferences(),this.logger.info("Saving preferences",this.preferences),this.preferencePanelLocalStorage.save(this.preferences),this.updateComponentOptionsModel()},o.prototype.exitWithoutSave=function(){this.fromPreferencesToCheckboxInput()},o.prototype.updateComponentOptionsModel=function(){this.componentOptionsModel.set(e.Models.ComponentOptionsModel.attributesEnum.resultLink,this.preferences)},o.prototype.buildTitle=function(){e.$(this.element).append(e.$("<div class='coveo-title'>"+t.l.LinkOpeningSettings()+"</div>"))},o.prototype.buildCheckboxesInput=function(){var i=this;this.preferencePanelCheckboxInput=new t.PreferencesPanelCheckboxInput([{label:t.l.OpenInOutlookWhenPossible()},{label:t.l.AlwaysOpenInNewWindow()}],o.ID);var n=e.$("<div class='coveo-choices-container'></div>");n.append(this.preferencePanelCheckboxInput.build()),n.find("input").change(function(e){i.fromPreferenceChangeEventToUsageAnalyticsLog(e),i.save(),i.queryController.executeQuery()}),e.$(this.element).append(n),this.fromPreferencesToCheckboxInput()},o.prototype.fromCheckboxInputToPreferences=function(){var e=this.preferencePanelCheckboxInput.getSelecteds();this.preferences={openInOutlook:!1,alwaysOpenInNewWindow:!1},_.contains(e,t.l.OpenInOutlookWhenPossible())&&(this.preferences.openInOutlook=!0),_.contains(e,t.l.AlwaysOpenInNewWindow())&&(this.preferences.alwaysOpenInNewWindow=!0)},o.prototype.fromPreferencesToCheckboxInput=function(){this.preferences.openInOutlook&&this.preferencePanelCheckboxInput.select(t.l.OpenInOutlookWhenPossible()),this.preferences.alwaysOpenInNewWindow&&this.preferencePanelCheckboxInput.select(t.l.AlwaysOpenInNewWindow())},o.prototype.fromPreferenceChangeEventToUsageAnalyticsLog=function(i){var n=e.$(i.target).is(":checked")?"selected":"unselected",o=e.$(i.target).val();this.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.preferencesChange,{preferenceName:o,preferenceType:n})},o.ID="ResultsPreferences",o}(t.Component);t.ResultsPreferences=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.includeInBreadcrumb=this.loadBooleanFromAttribute("data-include-in-breadcrumb",!0),this.showAdvancedFilters=this.loadBooleanFromAttribute("data-show-advanced-filters",!0)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultResultsFiltersPreferenceOptions=i;var n=function(n){function o(s,r,a){var l=this;n.call(this,s,o.ID,a),this.element=s,this.options=r,this.bindings=a,this.options=new i(s).merge(r),this.preferencePanel=e.$(this.element).parents("."+t.Component.computeCssClassNameForType(t.PreferencesPanel.ID)),this.preferencePanelLocalStorage=new e.LocalStorageUtils(o.ID),this.mergeLocalPreferencesWithStaticPreferences(),this.bindPreferencePanelEvent(),this.bindBreadcrumbEvent(),this.bindQueryEvent(),this.createDom();var u=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.t);e.$(this.root).one(u,function(){l.fromPreferencesToCheckboxInput()})}return __extends(o,n),o.prototype.createDom=function(){this.buildTitle(),this.buildCheckboxesInput(),this.options.showAdvancedFilters&&this.buildAdvancedFilters()},o.prototype.save=function(){this.fromCheckboxInputToPreferences();var e=_.omit(this.preferences,"tab");this.logger.info("Saving preferences",e),this.preferencePanelLocalStorage.save(e)},o.prototype.exitWithoutSave=function(){this.fromPreferencesToCheckboxInput()},o.prototype.bindPreferencePanelEvent=function(){var t=this;this.bind.on(this.preferencePanel,e.Events.PreferencesPanelEvents.savePreferences,function(){return t.save()}),this.bind.on(this.preferencePanel,e.Events.PreferencesPanelEvents.exitPreferencesWithoutSave,function(){return t.exitWithoutSave()})},o.prototype.bindBreadcrumbEvent=function(){this.options.includeInBreadcrumb&&(this.bind.onRoot(e.Events.BreadcrumbEvents.populateBreadcrumb,e.$.proxy(this.handlePopulateBreadcrumb,this)),this.bind.onRoot(e.Events.BreadcrumbEvents.clearBreadcrumb,e.$.proxy(this.handleClearBreadcrumb,this)))},o.prototype.bindQueryEvent=function(){this.bind.onRoot(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQuery,this))},o.prototype.handleBuildingQuery=function(e,t){_.each(this.getActiveFilters(),function(e){t.queryBuilder.advancedExpression.add(e.expression)})},o.prototype.handlePopulateBreadcrumb=function(i,n){var o=this.getActiveFilters();if(e.Utils.isNonEmptyArray(o)){var s=e.$("<div/>").addClass("coveo-results-filter-preferences-breadcrumb");e.$("<span/>").addClass("coveo-title").text(t.l.FiltersInYourPreferences()+":").appendTo(s);for(var r=e.$("<span/>").addClass("coveo-values").appendTo(s),a=0;a<o.length;a++)0!=a&&e.$("<span/>").addClass("coveo-separator").text(", ").appendTo(r),this.buildBreadcrumb(o[a]).appendTo(r);n.breadcrumbs.push({element:s.get(0)})}},o.prototype.handleClearBreadcrumb=function(){_.each(this.getActiveFilters(),function(e){e.selected=!1}),this.fromPreferencesToCheckboxInput()},o.prototype.buildTitle=function(){e.$(this.element).append(e.$("<div class='coveo-title'>"+t.l.ResultsFilteringExpression()+"</div>"))},o.prototype.buildAdvancedFilters=function(){var i=this;this.advancedFilters=e.$("<div>"+t.l.Create()+"</div>").addClass("coveo-advanced-filters"),this.buildAdvancedFilterInput(),this.buildAdvancedFilterFormValidate(),this.advancedFiltersBuilder=e.$("<div class='coveo-advanced-filters-builder'></div>"),this.advancedFiltersBuilder.append(this.advancedFilterFormValidate),this.advancedFilters.fastClick(function(){return i.openAdvancedFilterSectionOrSaveFilters()});var n=e.$("<a href='http://onlinehelp.coveo.com/en/ces/7.0/user/user_help.htm' target='_blank' class='coveo-online-help'>?</a>");e.$(this.element).find(".coveo-title").first().after(n,this.advancedFilters),e.$(this.element).append(this.advancedFiltersBuilder)},o.prototype.buildAdvancedFilterInput=function(){this.advancedFiltersTextInputCaption=new t.PreferencesPanelTextAreaInput([{label:t.l.Caption(),placeholder:t.l.EnterExpressionName(),otherAttribute:"required"}],o.ID+"-advanced-caption"),this.advancedFiltersTextInputExpression=new t.PreferencesPanelTextAreaInput([{label:t.l.Expression(),placeholder:t.l.EnterExpressionToFilterWith(),otherAttribute:"required"}],o.ID+"-advanced-expression"),this.advancedFiltersTabSelect=new t.PreferencePanelMultiSelectInput({label:t.l.Tab(),placeholder:t.l.SelectTab()},this.getAllTabs(),o.ID+"-multiselect")},o.prototype.buildAdvancedFilterFormValidate=function(){var t=this;this.advancedFilterFormValidate=e.$("<form></form>");var i=e.$("<input type='submit' />"),n=e.$("<span class='coveo-save'></span>"),o=e.$("<span class='coveo-close'></span>"),s=e.$("<div class='coveo-choice-container coveo-close-and-save'></div>").append(n,o);this.advancedFilterFormValidate.append(this.advancedFiltersTextInputCaption.build().addClass("coveo-caption"),this.advancedFiltersTabSelect.build().addClass("coveo-tab"),this.advancedFiltersTextInputExpression.build().addClass("coveo-expression"),s,i),n.fastClick(function(){i.click()}),o.fastClick(function(){t.advancedFiltersBuilder.toggleClass("coveo-active")}),this.advancedFilterFormValidate.find("textarea").keyup(function(e){13==e.keyCode&&i.click()}),this.advancedFilterFormValidate.submit(function(e){t.validateAndSaveAdvancedFilter(e)})},o.prototype.getAdvancedFiltersTextInputToBuild=function(){return[{label:t.l.Caption(),otherAttribute:"required"},{label:t.l.Expression(),otherAttribute:"required"}]},o.prototype.getAllTabs=function(){var i=e.$(this.root).find("."+t.Component.computeCssClassNameForType(t.Tab.ID));return _.map(i,function(t){var i=e.$(t).coveo();return i.options.uniqueId})},o.prototype.getPreferencesBoxInputToBuild=function(){return _.map(this.preferences,function(e){return{label:e.caption,tab:e.tab,expression:e.expression}})},o.prototype.buildCheckboxesInput=function(){var i=this;void 0!=this.preferenceContainer&&this.preferenceContainer.remove();var n=this.getPreferencesBoxInputToBuild();e.Utils.isNonEmptyArray(n)&&(this.preferencePanelCheckboxInput=new t.PreferencesPanelCheckboxInput(n,o.ID),this.preferenceContainer=e.$("<div class='coveo-choices-container'></div>"),this.preferenceContainer.append(this.preferencePanelCheckboxInput.build()),this.preferenceContainer.find(".coveo-choice-container").append("<div class='coveo-section coveo-section-edit-delete'></div>"),e.$(this.element).append(this.preferenceContainer),this.buildEditAdvancedFilter(),this.buildDeleteAdvancedFilter(),this.fromPreferencesToCheckboxInput(),this.preferenceContainer.find("input").change(function(t){i.save();var n=i.preferences[e.$(t.target).val()];i.fromFilterToAnalyticsEvent(n,n.selected?"selected":"unselected"),i.queryController.executeQuery()}))},o.prototype.buildDeleteAdvancedFilter=function(){var t=this;_.each(this.preferences,function(i){if(i.custom){var n=e.$("<span class='coveo-delete'><span class='coveo-icon'></span></span>"),o=t.getFilterElementByCaption(i.caption),s=o.closest(".coveo-section").siblings(".coveo-section-edit-delete");n.appendTo(s),n.fastClick(function(){t.confirmDelete(i,o)})}})},o.prototype.buildEditAdvancedFilter=function(){var t=this;_.each(this.preferences,function(i){if(i.custom){var n=e.$("<span class='coveo-edit'><span class='coveo-icon'></span></span>"),o=t.getFilterElementByCaption(i.caption),s=o.closest(".coveo-section").siblings(".coveo-section-edit-delete");n.appendTo(s),n.fastClick(function(){t.editElement(i,o)})}})},o.prototype.buildBreadcrumb=function(t){var i=this,n=e.$("<span/>").addClass("coveo-value");return e.$("<span/>").addClass("coveo-caption").text(t.caption).appendTo(n),e.$("<span/>").addClass("coveo-clear").appendTo(n),n.fastClick(function(){t.selected=!1,i.fromFilterToAnalyticsEvent(t,"cleared from breadcrumb"),i.fromPreferencesToCheckboxInput(),i.queryController.executeQuery()}),n},o.prototype.confirmDelete=function(e,i){confirm(t.l.AreYouSureDeleteFilter(e.caption,e.expression))&&(this.deleteFilterPreference(e,i),this.fromFilterToAnalyticsEvent(e,"deleted"),this.queryController.executeQuery())},o.prototype.editElement=function(e,t){var i=this.preferences[e.caption].caption,n=this.preferences[e.caption].tab,o=this.preferences[e.caption].expression;this.deleteFilterPreference(e,t),this.openAdvancedFilterSectionOrSaveFilters(),this.populateEditSection({tab:n,caption:i,expression:o}),this.advancedFiltersBuilder.find("input[type=text]").first().focus()},o.prototype.populateEditSection=function(e){"undefined"==typeof e&&(e={tab:[""],caption:"",expression:""}),this.advancedFiltersTextInputCaption.setValue(t.l.Caption(),e.caption),this.advancedFiltersTextInputExpression.setValue(t.l.Expression(),e.expression),this.advancedFiltersTabSelect.setValues(e.tab)},o.prototype.deleteFilterPreference=function(e,t){this.preferencePanelLocalStorage.remove(e.caption),delete this.preferences[e.caption],t.closest(".coveo-choice-container").remove()},o.prototype.openAdvancedFilterSectionOrSaveFilters=function(){this.advancedFiltersBuilder.hasClass("coveo-active")?this.advancedFilterFormValidate.find("input[type=submit]").click():(this.populateEditSection(),this.advancedFiltersBuilder.toggleClass("coveo-active"))},o.prototype.validateAndSaveAdvancedFilter=function(t){t.preventDefault(),this.advancedFiltersBuilder.removeClass("coveo-active");var i=this.advancedFiltersTextInputCaption.getValues()[0],n=this.advancedFiltersTextInputExpression.getValues()[0],o=this.advancedFiltersTabSelect.getValues();this.preferences[i]={caption:i,custom:!0,expression:n,tab:o,selected:!0},this.buildCheckboxesInput(),this.save(),this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.t,this.getActiveTab()),this.advancedFiltersTextInputCaption.reset(),this.advancedFiltersTextInputExpression.reset(),this.advancedFiltersTabSelect.reset(),this.advancedFiltersBuilder.appendTo(this.element),this.fromFilterToAnalyticsEvent(this.preferences[i],"saved"),this.queryController.executeQuery()},o.prototype.fromPreferencesToCheckboxInput=function(){var e=this;_.each(this.getActiveFilters(),function(t){e.preferencePanelCheckboxInput.select(t.caption)}),_.each(this.getInactiveFilters(),function(t){e.preferencePanelCheckboxInput.unselect(t.caption)})},o.prototype.fromCheckboxInputToPreferences=function(){var e=this.preferencePanelCheckboxInput.getSelecteds();_.each(this.preferences,function(t){t.selected=_.contains(e,t.caption)?!0:!1})},o.prototype.getActiveFilters=function(){var e=this,t=this.getActiveTab();return _.filter(this.preferences,function(i){return i.selected&&e.filterIsInActiveTab(i,t)})},o.prototype.getInactiveFilters=function(){var e=this,t=this.getActiveTab();return _.filter(this.preferences,function(i){return!i.selected||!e.filterIsInActiveTab(i,t)})},o.prototype.getActiveTab=function(){return this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.t)},o.prototype.filterIsInActiveTab=function(t,i){return t.tab=_.compact(t.tab),_.contains(t.tab,i)||e.Utils.isEmptyArray(t.tab)},o.prototype.getFilterElementByCaption=function(e){return this.preferenceContainer.find("input[value='"+e+"']").parent()},o.prototype.fromResultsFilterOptionToResultsPreferenceInterface=function(e){"undefined"==typeof e&&(e=this.options.filters);var t={};return _.each(this.options.filters,function(e,i){t[i]={expression:e.expression,tab:e.tab,selected:!1,custom:!1,caption:i}}),t},o.prototype.mergeLocalPreferencesWithStaticPreferences=function(){var t=this.fromResultsFilterOptionToResultsPreferenceInterface(),i=this.preferencePanelLocalStorage.load(),n=_.filter(i,function(e){var i=e.custom,n=_.find(t,function(t){return t.caption==e.caption});return i||void 0!=n}),o={};_.each(n,function(e){o[e.caption]={expression:e.expression,tab:e.tab,selected:e.selected,custom:e.custom,caption:e.caption}}),this.preferences=e.$.extend(!0,{},t,o)},o.prototype.fromFilterToAnalyticsEvent=function(e,i){this.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.customfiltersChange,{customFilterName:e.caption,customFilterExpression:e.expression,customFilterType:i})},o.ID="ResultsFiltersPreferences",o}(t.Component);t.ResultsFiltersPreferences=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.field=this.loadStringFromAttribute("data-field"),this.suggestBoxSize=this.loadNumberFromAttribute("data-suggested-box-size",5),this.autoCompleteTimer=this.loadNumberFromAttribute("data-auto-complete-timer",2e3)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultResultTaggingOptions=i;var n=function(n){function o(t,s,r,a,l){n.call(this,t,o.ID,r),this.element=t,this.options=s,this.result=a,this.os=l,this.options=new i(t).merge(s),this.options=e.$.extend({},this.options),this.result=a||this.resolveResult(),e.Assert.exists(this.componentOptionsModel),e.Assert.exists(this.result),this.options.field||this.logger.error("You must specify a field to the ResultTagging component"),this.tags=this.result.raw[e.Utils.getCoveoFieldKey(this.options.field)]||[],this.tagZone=e.$("<div></div>").addClass("coveo-tag-zone").appendTo(e.$(t)),e.$(t).append(this.buildTagIcon()),this.autoCompleteZone=e.$("<div></div>").addClass("coveo-auto-complete-zone").appendTo(e.$(t)),e.$(this.autoCompleteZone).append(this.buildTextBox()),e.$(this.autoCompleteZone).append(this.buildAddIcon()),e.$(this.autoCompleteZone).append(this.buildClearIcon()),this.buildExistingTags()}return __extends(o,n),o.prototype.buildExistingTags=function(){var t=this;this.tags&&_.each(this.tags,function(i){e.$(t.tagZone).append(t.buildTagValue(i))})},o.prototype.buildTagIcon=function(){var i=this,n=e.$("<div></div>").addClass("coveo-add-tag"),o=e.$("<span></span>").text(t.l.EnterTag()).addClass("coveo-add-tag-text");return n.append(e.$("<span></span>").addClass("coveo-add-tag-icon").fastClick(function(){return setTimeout(e.$.proxy(i.focusOnTextBox,i),20)})),n.append(o),n.attr("title",t.l.EnterTag()),n},o.prototype.focusOnTextBox=function(){this.textBox.focus()},o.prototype.buildTagValue=function(t){var i=this,n=e.$("<div></div>").addClass("coveo-tag");this.buildShortenedTagWithTitle(t).appendTo(n);var o=e.$("<span></span>").addClass("coveo-delete-icon").appendTo(n);return o.fastClick(function(){return i.doRemoveTag(n,t.toLowerCase())}),n},o.prototype.buildShortenedTagWithTitle=function(t){var i=e.StringUtils.removeMiddle(t,16,"..."),n=e.$("<a></a>").text(i).attr("title",t).attr("href","javascript:void;");return this.bindFacetEventOnValue(n,t),n},o.prototype.buildTextBox=function(){var i=this;return this.textBox=e.$("<input/>").attr("type","text").addClass("coveo-add-tag-textbox").attr("placeholder",t.l.EnterTag()),this.autoCompletePopup=e.$("<div></div>").addClass(o.AUTO_COMPLETE_CLASS).appendTo(e.$(this.autoCompleteZone)),this.manageAutocompleteAutoHide(),this.textBox.keyup(function(t){38==t.keyCode||40==t.keyCode||13==t.keyCode?i.manageUpDownEnter(t.keyCode):e.KeyboardUtils.isArrowKeyPushed(t.keyCode)||i.populateSuggestions(),e.$(i.element).removeClass("coveo-error")}),this.textBox.fastClick(function(){i.populateSuggestions()}),this.textBox},o.prototype.buildAddIcon=function(){var t=this;return e.$("<div></div>").addClass("coveo-add-tag-tick-icon").append(e.$("<span></span>")).fastClick(function(){return t.doAddTag()})},o.prototype.buildClearIcon=function(){var t=this;return e.$("<div></div>").addClass("coveo-clear-icon").append(e.$("<span></span>")).fastClick(function(){return t.textBox.val("")})},o.prototype.bindFacetEventOnValue=function(i,n){var o=this,s=e.Models.QueryStateModel.getFacetId(this.options.field),r=this.queryStateModel.get(s),a=this.componentStateModel.get(s),l=_.filter(a,function(e){return!e.disabled}).length>0;null!=r&&l&&(e.$(i).on("click",function(){_.contains(r,n)?o.queryStateModel.set(s,_.without(r,n)):o.queryStateModel.set(s,_.union(r,[n])),o.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return o.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.documentTag,{facetId:o.options.field,facetValue:n})}})}),_.contains(r,n)&&e.$(i).addClass("coveo-selected"),e.$(i).addClass("coveo-clickable"))},o.prototype.clearPopup=function(){this.autoCompletePopup.hide(),this.autoCompletePopup.empty()},o.prototype.showPopup=function(){this.autoCompletePopup.show()},o.prototype.populateSuggestions=function(){var e=this;this.autoCompletePopup.width(this.textBox.innerWidth());{var t=this.queryController.getEndpoint(),i=this.textBox.val(),n={field:this.options.field,ignoreAccents:!0,sortCriteria:"occurences",maximumNumberOfValues:this.options.suggestBoxSize,queryOverride:"@sysuri",pattern:this.buildRegEx(i),patternType:"RegularExpression"};t.listFieldValues(n).done(function(t){e.clearPopup(),_.each(t,function(t){e.autoCompletePopup.append(e.buildSelectableValue(t.lookupValue))}),e.showPopup()})}},o.prototype.manageAutocompleteAutoHide=function(){var t,i=this;this.textBox.on("mouseover",function(){window.clearTimeout(t)}),this.autoCompletePopup.mouseout(function(n){e.$(n.target).hasClass(o.AUTO_COMPLETE_CLASS)&&(t=window.setTimeout(e.$.proxy(i.clearPopup,i),i.options.autoCompleteTimer))}),this.autoCompletePopup.mouseenter(function(){window.clearTimeout(t)}),e.$(this.element).mouseenter(function(){i.clearPopup(),e.$(i.element).addClass("coveo-opened")}),e.$(this.element).closest(".CoveoResult").mouseleave(function(){i.clearPopup(),""==i.textBox.val()&&e.$(i.element).removeClass("coveo-opened")}),e.$(this.element).closest(".CoveoResult").focusout(function(t){""!=i.textBox.val()&&e.$(t.target).closest(".CoveoResult")!=e.$(i.element).closest(".CoveoResult")&&e.$(i.element).addClass("coveo-error")}),e.$(this.element).closest(".CoveoResult").focusin(function(){e.$(i.element).removeClass("coveo-error")})},o.prototype.buildRegEx=function(e){var t=this;return"(?=.*"+e+")"+_.map(this.tags,function(e){return t.buildTermToExclude(e)}).join("")+".*"},o.prototype.buildTermToExclude=function(e){return"(?!^"+e+"$)"},o.prototype.manageUpDownEnter=function(t){var i=e.$(this.element).find(".coveo-selectable");if(13==t)return this.doAddTag(),void 0;if(i.length>0){var n=this.computeNextIndex(t,i);n=Math.max(0,n),n=Math.min(i.length-1,n);var o=e.$(i.get(n));o.addClass("coveo-selected"),this.textBox.val(o.text())}},o.prototype.computeNextIndex=function(t,i){var n=0;return _.each(i,function(i,o){e.$(i).hasClass("coveo-selected")&&(38==t?n=o-1:40==t&&(n=o+1),e.$(i).removeClass("coveo-selected"))}),n},o.prototype.buildSelectableValue=function(t){var i=this,n=e.$("<div></div>").append(this.buildShortenedTagWithTitle(t));return n.addClass("coveo-selectable"),n.fastClick(function(){i.doAddTagWithValue(t)}),n},o.prototype.doRemoveTag=function(t,i){var n=this,o={fieldName:this.options.field,fieldValue:i,doAdd:!1,uniqueId:this.result.uniqueId},s=this.queryController.getEndpoint().tagDocument(o);s.done(function(){n.tags.splice(e.$.inArray(i,n.tags),1),t.remove()})},o.prototype.doAddTagWithValue=function(e){var t=this;_.each(e.split(","),function(e){t.doAddSingleTagValue(e)})},o.prototype.doAddSingleTagValue=function(t){var i=this;if(this.clearPopup(),e.$.inArray(t,this.tags)>-1)return e.$(this.element).addClass("coveo-error"),void 0;this.tags.push(t);var n={fieldName:this.options.field,fieldValue:t,doAdd:!0,uniqueId:this.result.uniqueId},o=this.queryController.getEndpoint().tagDocument(n);o.done(function(){i.tagZone.append(i.buildTagValue(t)),i.textBox.val(""),e.$(i.element).removeClass("coveo-error")}).fail(function(){i.tags=_.without(i.tags,_.findWhere(i.tags,t))})},o.prototype.doAddTag=function(){var e=this.textBox.val().toLowerCase().trim();this.doAddTagWithValue(e)},o.ID="ResultTagging",o.AUTO_COMPLETE_CLASS="coveo-auto-complete",o}(t.Component);t.ResultTagging=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){e.Device.isPhonegap()&&document.addEventListener("deviceready",function(){var e=window.StatusBar;e&&(e.backgroundColorByHexString("#ECECEC"),e.styleDefault())})}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));var Coveo;!function(e){!function(t){var i=function(e){function t(t){e.call(this,t),this.name=this.loadStringFromAttribute("data-name"),this.caption=this.loadLocalizedStringFromAttribute("data-caption",this.name),this.useIFrame=this.loadBooleanFromAttribute("data-use-iframe",!1),this.showIFrame=this.loadBooleanFromAttribute("data-show-iframe",!0)}return __extends(t,e),t}(t.ComponentOptions);t.DefaultAuthenticationProviderOptions=i;var n=function(n){function o(o,s,r){n.call(this,o,t.Analytics.ID,r),this.element=o,this.options=s,this.options=new i(o).merge(s),this.bind.onRoot(e.Events.QueryEvents.buildingCallOptions,this.handleBuildingCallOptions),this.bind.onRoot(e.Events.QueryEvents.queryError,this.handleQueryError)}return __extends(o,n),o.prototype.getCssClass=function(){return"coveo-authentication-provider"},o.prototype.getMenuItems=function(){var e=this;return[{text:t.l.Reauthenticate(this.options.caption),onOpen:function(){return e.authenticateWithProvider()},onClose:function(){return 0}}]},o.prototype.handleBuildingCallOptions=function(e,t){t.options.authentication.push(this.options.name)},o.prototype.handleQueryError=function(e,t){t.error.provider==this.options.name&&this.authenticateWithProvider()},o.prototype.authenticateWithProvider=function(){this.options.useIFrame?this.useIFrameToAuthenticate():this.redirectToAuthenticationProvider()},o.prototype.redirectToAuthenticationProvider=function(){this.logger.info("Redirecting to authentication provider "+this.options.name),window.location.href=this.getAuthenticationProviderUriForRedirect()},o.prototype.useIFrameToAuthenticate=function(){var t=this;this.logger.info("Using iframe to retrieve authentication for provider "+this.options.name);var i,n=e.$("<iframe/>").attr("src",this.getAuthenticationProviderUriForIFrame());i=this.options.showIFrame?this.createPopupForVisibleIFrame(n):this.createPopupForWaitMessage(n),e.$(window).one("message",function(){i.close(),n.detach(),t.logger.info("Got authentication for provider "+t.options.name+"; retrying query."),t.queryController.executeQuery()})},o.prototype.createPopupForWaitMessage=function(i){var n=e.$("<div/>").addClass("coveo-waiting-for-authentication-popup").append(t.JQueryUtils.getBasicLoadingDots());return i.hide().appendTo(document.body),e.ModalBox.open(n,{title:t.l.Authenticating(this.options.caption)})},o.prototype.createPopupForVisibleIFrame=function(t){var i=e.$("<div/>");return t.addClass("coveo-authentication-iframe").appendTo(i),e.ModalBox.open(i,{className:"coveo-authentication-popup"})},o.prototype.getAuthenticationProviderUriForRedirect=function(){return this.queryController.getEndpoint().getAuthenticationProviderUri(this.options.name,window.location.href,void 0)},o.prototype.getAuthenticationProviderUriForIFrame=function(){return this.queryController.getEndpoint().getAuthenticationProviderUri(this.options.name,void 0,"success")},o.ID="AuthenticationProvider",o}(t.Component);t.AuthenticationProvider=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(e.Ui||(e.Ui={}));e.Ui}(Coveo||(Coveo={}));
Coveo.Logger.disable();